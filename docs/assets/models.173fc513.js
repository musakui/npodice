import{f as e,s as n,q as t,a0 as i,V as r,ad as o,O as a,F as s,a as l,M as c,ae as f,af as u,B as d,a5 as h,ag as p,E as m,Q as v,d as A,C as E,ah as _,y as g,z as T,a6 as R,S as C,j as S,ai as y,h as b,l as I,m as O,n as M,L,aj as N,a9 as P,v as x,K as D,g as F,U,e as B,aa as w,t as V,ak as G,al as H,X as k,N as X,o as Y,am as W,J as z,an as Q,ac as K,Y as j,k as q,ao as Z,ap as J,x as $,ab as ee,i as ne,a7 as te,aq as ie,ar as re,as as oe,at as ae,a8 as se,au as le}from"./vendor.fe43ce37.js";import{T as ce,P as fe,M as ue,a as de,B as he,D as pe,b as me,c as ve,E as Ae}from"./app.27487983.js";import"./index.9a28c714.js";var Ee=function(){function e(){var e=this;this.promise=new Promise((function(n,t){e._resolve=n,e._reject=t}))}return Object.defineProperty(e.prototype,"resolve",{get:function(){return this._resolve},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"reject",{get:function(){return this._reject},enumerable:!1,configurable:!0}),e}(),_e=function(){function o(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this._keys=new Array}return o.prototype.attachControl=function(e){var n=this;e=t.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((function(){n._keys=[]})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((function(t){var r,o=t.event;o.metaKey||(t.type===i.KEYDOWN?-1===n.keysUp.indexOf(o.keyCode)&&-1===n.keysDown.indexOf(o.keyCode)&&-1===n.keysLeft.indexOf(o.keyCode)&&-1===n.keysRight.indexOf(o.keyCode)&&-1===n.keysUpward.indexOf(o.keyCode)&&-1===n.keysDownward.indexOf(o.keyCode)||(-1===(r=n._keys.indexOf(o.keyCode))&&n._keys.push(o.keyCode),e||o.preventDefault()):-1===n.keysUp.indexOf(o.keyCode)&&-1===n.keysDown.indexOf(o.keyCode)&&-1===n.keysLeft.indexOf(o.keyCode)&&-1===n.keysRight.indexOf(o.keyCode)&&-1===n.keysUpward.indexOf(o.keyCode)&&-1===n.keysDownward.indexOf(o.keyCode)||((r=n._keys.indexOf(o.keyCode))>=0&&n._keys.splice(r,1),e||o.preventDefault()))})))},o.prototype.detachControl=function(e){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},o.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var e=this.camera,n=0;n<this._keys.length;n++){var t=this._keys[n],i=e._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(t)?e._localDirection.copyFromFloats(-i,0,0):-1!==this.keysUp.indexOf(t)?e._localDirection.copyFromFloats(0,0,i):-1!==this.keysRight.indexOf(t)?e._localDirection.copyFromFloats(i,0,0):-1!==this.keysDown.indexOf(t)?e._localDirection.copyFromFloats(0,0,-i):-1!==this.keysUpward.indexOf(t)?e._localDirection.copyFromFloats(0,i,0):-1!==this.keysDownward.indexOf(t)&&e._localDirection.copyFromFloats(0,-i,0),e.getScene().useRightHandedSystem&&(e._localDirection.z*=-1),e.getViewMatrix().invertToRef(e._cameraTransformMatrix),r.TransformNormalToRef(e._localDirection,e._cameraTransformMatrix,e._transformedDirection),e.cameraDirection.addInPlace(e._transformedDirection)}},o.prototype.getClassName=function(){return"FreeCameraKeyboardMoveInput"},o.prototype._onLostFocus=function(){this._keys=[]},o.prototype.getSimpleName=function(){return"keyboard"},e([n()],o.prototype,"keysUp",void 0),e([n()],o.prototype,"keysUpward",void 0),e([n()],o.prototype,"keysDown",void 0),e([n()],o.prototype,"keysDownward",void 0),e([n()],o.prototype,"keysLeft",void 0),e([n()],o.prototype,"keysRight",void 0),o}();o.FreeCameraKeyboardMoveInput=_e;var ge=function(){function i(e){void 0===e&&(e=!0),this.touchEnabled=e,this.buttons=[0,1,2],this.angularSensibility=2e3,this.previousPosition=null,this.onPointerMovedObservable=new a,this._allowCameraRotation=!0}return i.prototype.attachControl=function(e){var n=this;e=t.BackCompatCameraNoPreventDefault(arguments);var i=this.camera.getEngine(),r=i.getInputElement();this._pointerInput||(this._pointerInput=function(t){var o=t.event;if(!i.isInVRExclusivePointerMode&&(n.touchEnabled||"touch"!==o.pointerType)&&(t.type===s.POINTERMOVE||-1!==n.buttons.indexOf(o.button))){var a=o.srcElement||o.target;if(t.type===s.POINTERDOWN&&a){try{a.setPointerCapture(o.pointerId)}catch(f){}n.previousPosition={x:o.clientX,y:o.clientY},e||(o.preventDefault(),r&&r.focus()),i.isPointerLock&&n._onMouseMove&&n._onMouseMove(t.event)}else if(t.type===s.POINTERUP&&a){try{a.releasePointerCapture(o.pointerId)}catch(f){}n.previousPosition=null,e||o.preventDefault()}else if(t.type===s.POINTERMOVE){if(!n.previousPosition)return void(i.isPointerLock&&n._onMouseMove&&n._onMouseMove(t.event));var l=o.clientX-n.previousPosition.x,c=o.clientY-n.previousPosition.y;n.camera.getScene().useRightHandedSystem&&(l*=-1),n.camera.parent&&n.camera.parent._getWorldMatrixDeterminant()<0&&(l*=-1),n._allowCameraRotation&&(n.camera.cameraRotation.y+=l/n.angularSensibility,n.camera.cameraRotation.x+=c/n.angularSensibility),n.onPointerMovedObservable.notifyObservers({offsetX:l,offsetY:c}),n.previousPosition={x:o.clientX,y:o.clientY},e||o.preventDefault()}}}),this._onMouseMove=function(t){if(i.isPointerLock&&!i.isInVRExclusivePointerMode){var r=t.movementX||t.mozMovementX||t.webkitMovementX||t.msMovementX||0;n.camera.getScene().useRightHandedSystem&&(r*=-1),n.camera.parent&&n.camera.parent._getWorldMatrixDeterminant()<0&&(r*=-1),n.camera.cameraRotation.y+=r/n.angularSensibility;var o=t.movementY||t.mozMovementY||t.webkitMovementY||t.msMovementY||0;n.camera.cameraRotation.x+=o/n.angularSensibility,n.previousPosition=null,e||t.preventDefault()}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,s.POINTERDOWN|s.POINTERUP|s.POINTERMOVE),r&&r.addEventListener("contextmenu",this.onContextMenu.bind(this),!1)},i.prototype.onContextMenu=function(e){e.preventDefault()},i.prototype.detachControl=function(e){if(this._observer){if(this.camera.getScene().onPointerObservable.remove(this._observer),this.onContextMenu){var n=this.camera.getEngine().getInputElement();n&&n.removeEventListener("contextmenu",this.onContextMenu)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this.previousPosition=null}},i.prototype.getClassName=function(){return"FreeCameraMouseInput"},i.prototype.getSimpleName=function(){return"mouse"},e([n()],i.prototype,"buttons",void 0),e([n()],i.prototype,"angularSensibility",void 0),i}();o.FreeCameraMouseInput=ge;var Te,Re,Ce=function(){function i(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new a,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}return i.prototype.attachControl=function(e){var n=this;e=t.BackCompatCameraNoPreventDefault(arguments),this._wheel=function(t){if(t.type===s.POINTERWHEEL){var i=t.event,r=i.deltaMode===WheelEvent.DOM_DELTA_LINE?n._ffMultiplier:1;void 0!==i.deltaY?(n._wheelDeltaX+=n.wheelPrecisionX*r*i.deltaX/n._normalize,n._wheelDeltaY-=n.wheelPrecisionY*r*i.deltaY/n._normalize,n._wheelDeltaZ+=n.wheelPrecisionZ*r*i.deltaZ/n._normalize):void 0!==i.wheelDeltaY?(n._wheelDeltaX+=n.wheelPrecisionX*r*i.wheelDeltaX/n._normalize,n._wheelDeltaY-=n.wheelPrecisionY*r*i.wheelDeltaY/n._normalize,n._wheelDeltaZ+=n.wheelPrecisionZ*r*i.wheelDeltaZ/n._normalize):i.wheelDelta&&(n._wheelDeltaY-=n.wheelPrecisionY*i.wheelDelta/n._normalize),i.preventDefault&&(e||i.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,s.POINTERWHEEL)},i.prototype.detachControl=function(e){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()},i.prototype.checkInputs=function(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0},i.prototype.getClassName=function(){return"BaseCameraMouseWheelInput"},i.prototype.getSimpleName=function(){return"mousewheel"},e([n()],i.prototype,"wheelPrecisionX",void 0),e([n()],i.prototype,"wheelPrecisionY",void 0),e([n()],i.prototype,"wheelPrecisionZ",void 0),i}();(Re=Te||(Te={}))[Re.MoveRelative=0]="MoveRelative",Re[Re.RotateRelative=1]="RotateRelative",Re[Re.MoveScene=2]="MoveScene";var Se=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e._moveRelative=r.Zero(),e._rotateRelative=r.Zero(),e._moveScene=r.Zero(),e._wheelXAction=Te.MoveRelative,e._wheelXActionCoordinate=f.X,e._wheelYAction=Te.MoveRelative,e._wheelYActionCoordinate=f.Z,e._wheelZAction=null,e._wheelZActionCoordinate=null,e}return l(i,t),i.prototype.getClassName=function(){return"FreeCameraMouseWheelInput"},Object.defineProperty(i.prototype,"wheelXMoveRelative",{get:function(){return this._wheelXAction!==Te.MoveRelative?null:this._wheelXActionCoordinate},set:function(e){null===e&&this._wheelXAction!==Te.MoveRelative||(this._wheelXAction=Te.MoveRelative,this._wheelXActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"wheelYMoveRelative",{get:function(){return this._wheelYAction!==Te.MoveRelative?null:this._wheelYActionCoordinate},set:function(e){null===e&&this._wheelYAction!==Te.MoveRelative||(this._wheelYAction=Te.MoveRelative,this._wheelYActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"wheelZMoveRelative",{get:function(){return this._wheelZAction!==Te.MoveRelative?null:this._wheelZActionCoordinate},set:function(e){null===e&&this._wheelZAction!==Te.MoveRelative||(this._wheelZAction=Te.MoveRelative,this._wheelZActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"wheelXRotateRelative",{get:function(){return this._wheelXAction!==Te.RotateRelative?null:this._wheelXActionCoordinate},set:function(e){null===e&&this._wheelXAction!==Te.RotateRelative||(this._wheelXAction=Te.RotateRelative,this._wheelXActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"wheelYRotateRelative",{get:function(){return this._wheelYAction!==Te.RotateRelative?null:this._wheelYActionCoordinate},set:function(e){null===e&&this._wheelYAction!==Te.RotateRelative||(this._wheelYAction=Te.RotateRelative,this._wheelYActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"wheelZRotateRelative",{get:function(){return this._wheelZAction!==Te.RotateRelative?null:this._wheelZActionCoordinate},set:function(e){null===e&&this._wheelZAction!==Te.RotateRelative||(this._wheelZAction=Te.RotateRelative,this._wheelZActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"wheelXMoveScene",{get:function(){return this._wheelXAction!==Te.MoveScene?null:this._wheelXActionCoordinate},set:function(e){null===e&&this._wheelXAction!==Te.MoveScene||(this._wheelXAction=Te.MoveScene,this._wheelXActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"wheelYMoveScene",{get:function(){return this._wheelYAction!==Te.MoveScene?null:this._wheelYActionCoordinate},set:function(e){null===e&&this._wheelYAction!==Te.MoveScene||(this._wheelYAction=Te.MoveScene,this._wheelYActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"wheelZMoveScene",{get:function(){return this._wheelZAction!==Te.MoveScene?null:this._wheelZActionCoordinate},set:function(e){null===e&&this._wheelZAction!==Te.MoveScene||(this._wheelZAction=Te.MoveScene,this._wheelZActionCoordinate=e)},enumerable:!1,configurable:!0}),i.prototype.checkInputs=function(){if(0!==this._wheelDeltaX||0!==this._wheelDeltaY||0!=this._wheelDeltaZ){this._moveRelative.setAll(0),this._rotateRelative.setAll(0),this._moveScene.setAll(0),this._updateCamera(),this.camera.getScene().useRightHandedSystem&&(this._moveRelative.z*=-1);var e=c.Zero();this.camera.getViewMatrix().invertToRef(e);var n=r.Zero();r.TransformNormalToRef(this._moveRelative,e,n),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(n),this.camera.cameraDirection.addInPlace(this._moveScene),t.prototype.checkInputs.call(this)}},i.prototype._updateCamera=function(){var e=this._moveRelative,n=this._rotateRelative,t=this._moveScene,i=function(i,r,o){if(0!==i&&null!==r&&null!==o){var a=null;switch(r){case Te.MoveRelative:a=e;break;case Te.RotateRelative:a=n;break;case Te.MoveScene:a=t}switch(o){case f.X:a.set(i,0,0);break;case f.Y:a.set(0,i,0);break;case f.Z:a.set(0,0,i)}}};i(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),i(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),i(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)},e([n()],i.prototype,"wheelXMoveRelative",null),e([n()],i.prototype,"wheelYMoveRelative",null),e([n()],i.prototype,"wheelZMoveRelative",null),e([n()],i.prototype,"wheelXRotateRelative",null),e([n()],i.prototype,"wheelYRotateRelative",null),e([n()],i.prototype,"wheelZRotateRelative",null),e([n()],i.prototype,"wheelXMoveScene",null),e([n()],i.prototype,"wheelYMoveScene",null),e([n()],i.prototype,"wheelZMoveScene",null),i}(Ce);o.FreeCameraMouseWheelInput=Se;var ye=function(){function i(e){void 0===e&&(e=!1),this.allowMouse=e,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array}return i.prototype.attachControl=function(e){var n=this;e=t.BackCompatCameraNoPreventDefault(arguments);var i=null;if(void 0===this._pointerInput&&(this._onLostFocus=function(){n._offsetX=null,n._offsetY=null},this._pointerInput=function(t){var r=t.event,o=!n.camera.getEngine().hostInformation.isMobile&&r instanceof MouseEvent;if(n.allowMouse||"mouse"!==r.pointerType&&!o)if(t.type===s.POINTERDOWN){if(e||r.preventDefault(),n._pointerPressed.push(r.pointerId),1!==n._pointerPressed.length)return;i={x:r.clientX,y:r.clientY}}else if(t.type===s.POINTERUP){if(e||r.preventDefault(),-1===(a=n._pointerPressed.indexOf(r.pointerId)))return;if(n._pointerPressed.splice(a,1),0!=a)return;i=null,n._offsetX=null,n._offsetY=null}else if(t.type===s.POINTERMOVE){if(e||r.preventDefault(),!i)return;var a;if(0!=(a=n._pointerPressed.indexOf(r.pointerId)))return;n._offsetX=r.clientX-i.x,n._offsetY=-(r.clientY-i.y)}}),this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,s.POINTERDOWN|s.POINTERUP|s.POINTERMOVE),this._onLostFocus){var r=this.camera.getEngine(),o=r.getInputElement();o&&o.addEventListener("blur",this._onLostFocus)}},i.prototype.detachControl=function(e){if(this._pointerInput){if(this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null),this._onLostFocus){var n=this.camera.getEngine().getInputElement();n&&n.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed=[],this._offsetX=null,this._offsetY=null}},i.prototype.checkInputs=function(){if(null!==this._offsetX&&null!==this._offsetY&&(0!==this._offsetX||0!==this._offsetY)){var e=this.camera;if(e.cameraRotation.y=this._offsetX/this.touchAngularSensibility,this._pointerPressed.length>1)e.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{var n=e._computeLocalCameraSpeed(),t=new r(0,0,n*this._offsetY/this.touchMoveSensibility);c.RotationYawPitchRollToRef(e.rotation.y,e.rotation.x,0,e._cameraRotationMatrix),e.cameraDirection.addInPlace(r.TransformCoordinates(t,e._cameraRotationMatrix))}}},i.prototype.getClassName=function(){return"FreeCameraTouchInput"},i.prototype.getSimpleName=function(){return"touch"},e([n()],i.prototype,"touchAngularSensibility",void 0),e([n()],i.prototype,"touchMoveSensibility",void 0),i}();o.FreeCameraTouchInput=ye;var be=function(e){function n(n){var t=e.call(this,n)||this;return t._mouseInput=null,t._mouseWheelInput=null,t}return l(n,e),n.prototype.addKeyboard=function(){return this.add(new _e),this},n.prototype.addMouse=function(e){return void 0===e&&(e=!0),this._mouseInput||(this._mouseInput=new ge(e),this.add(this._mouseInput)),this},n.prototype.removeMouse=function(){return this._mouseInput&&this.remove(this._mouseInput),this},n.prototype.addMouseWheel=function(){return this._mouseWheelInput||(this._mouseWheelInput=new Se,this.add(this._mouseWheelInput)),this},n.prototype.removeMouseWheel=function(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this},n.prototype.addTouch=function(){return this.add(new ye),this},n.prototype.clear=function(){e.prototype.clear.call(this),this._mouseInput=null},n}(u),Ie=function(i){function o(e,n,t,o){void 0===o&&(o=!0);var a=i.call(this,e,n,t,o)||this;return a.ellipsoid=new r(.5,1,.5),a.ellipsoidOffset=new r(0,0,0),a.checkCollisions=!1,a.applyGravity=!1,a._needMoveForGravity=!1,a._oldPosition=r.Zero(),a._diffPosition=r.Zero(),a._newPosition=r.Zero(),a._collisionMask=-1,a._onCollisionPositionChange=function(e,n,t){void 0===t&&(t=null);var i;i=n,a._newPosition.copyFrom(i),a._newPosition.subtractToRef(a._oldPosition,a._diffPosition),a._diffPosition.length()>m.CollisionsEpsilon&&(a.position.addInPlace(a._diffPosition),a.onCollide&&t&&a.onCollide(t))},a.inputs=new be(a),a.inputs.addKeyboard().addMouse(),a}return l(o,i),Object.defineProperty(o.prototype,"angularSensibility",{get:function(){var e=this.inputs.attached.mouse;return e?e.angularSensibility:0},set:function(e){var n=this.inputs.attached.mouse;n&&(n.angularSensibility=e)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysUp=e)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"keysUpward",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUpward:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysUpward=e)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysDown=e)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"keysDownward",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDownward:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysDownward=e)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysLeft=e)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysRight=e)},enumerable:!1,configurable:!0}),o.prototype.attachControl=function(e,n){n=t.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(n)},o.prototype.detachControl=function(e){this.inputs.detachElement(),this.cameraDirection=new r(0,0,0),this.cameraRotation=new d(0,0)},Object.defineProperty(o.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(e){this._collisionMask=isNaN(e)?-1:e},enumerable:!1,configurable:!0}),o.prototype._collideWithWorld=function(e){(this.parent?r.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);var n=this.getScene().collisionCoordinator;this._collider||(this._collider=n.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var t=e;this.applyGravity&&(t=e.add(this.getScene().gravity)),n.getNewPosition(this._oldPosition,t,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},o.prototype._checkInputs=function(){this._localDirection||(this._localDirection=r.Zero(),this._transformedDirection=r.Zero()),this.inputs.checkInputs(),i.prototype._checkInputs.call(this)},o.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},o.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):i.prototype._updatePosition.call(this)},o.prototype.dispose=function(){this.inputs.clear(),i.prototype.dispose.call(this)},o.prototype.getClassName=function(){return"FreeCamera"},e([h()],o.prototype,"ellipsoid",void 0),e([h()],o.prototype,"ellipsoidOffset",void 0),e([n()],o.prototype,"checkCollisions",void 0),e([n()],o.prototype,"applyGravity",void 0),o}(p),Oe=Object.freeze(new v(0,0,0,0)),Me=Object.freeze(r.Zero()),Le=Object.freeze(d.Zero()),Ne=Object.freeze(A.Zero()),Pe=Object.freeze(E.Black()),xe=function(){function e(e,n,t,i){var r=this;if(this._events=new Array,this._currentFrame=0,this._originalValue=new Array,this._originalBlendValue=null,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._currentValue=null,this._currentActiveTarget=null,this._directTarget=null,this._targetPath="",this._weight=1,this._ratioOffset=0,this._previousDelay=0,this._previousRatio=0,this._targetIsArray=!1,this._animation=n,this._target=e,this._scene=t,this._host=i,this._activeTargets=[],n._runtimeAnimations.push(this),this._animationState={key:0,repeatCount:0,loopMode:this._getCorrectLoopMode()},this._animation.dataType===_.ANIMATIONTYPE_MATRIX&&(this._animationState.workValue=c.Zero()),this._keys=this._animation.getKeys(),this._minFrame=this._keys[0].frame,this._maxFrame=this._keys[this._keys.length-1].frame,this._minValue=this._keys[0].value,this._maxValue=this._keys[this._keys.length-1].value,0!==this._minFrame){var o={frame:0,value:this._minValue};this._keys.splice(0,0,o)}if(this._target instanceof Array){for(var a=0,s=0,l=this._target;s<l.length;s++){var f=l[s];this._preparePath(f,a),this._getOriginalValues(a),a++}this._targetIsArray=!0}else this._preparePath(this._target),this._getOriginalValues(),this._targetIsArray=!1,this._directTarget=this._activeTargets[0];var u=n.getEvents();u&&u.length>0&&u.forEach((function(e){r._events.push(e._clone())})),this._enableBlending=e&&e.animationPropertiesOverride?e.animationPropertiesOverride.enableBlending:this._animation.enableBlending}return Object.defineProperty(e.prototype,"currentFrame",{get:function(){return this._currentFrame},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"weight",{get:function(){return this._weight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentValue",{get:function(){return this._currentValue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"targetPath",{get:function(){return this._targetPath},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._currentActiveTarget},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isAdditive",{get:function(){return this._host&&this._host.isAdditive},enumerable:!1,configurable:!0}),e.prototype._preparePath=function(e,n){void 0===n&&(n=0);var t=this._animation.targetPropertyPath;if(t.length>1){for(var i=e[t[0]],r=1;r<t.length-1;r++)i=i[t[r]];this._targetPath=t[t.length-1],this._activeTargets[n]=i}else this._targetPath=t[0],this._activeTargets[n]=e},Object.defineProperty(e.prototype,"animation",{get:function(){return this._animation},enumerable:!1,configurable:!0}),e.prototype.reset=function(e){if(void 0===e&&(e=!1),e)if(this._target instanceof Array)for(var n=0,t=0,i=this._target;t<i.length;t++){var r=i[t];void 0!==this._originalValue[n]&&this._setValue(r,this._activeTargets[n],this._originalValue[n],-1,n),n++}else void 0!==this._originalValue[0]&&this._setValue(this._target,this._directTarget,this._originalValue[0],-1,0);this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0;for(n=0;n<this._events.length;n++)this._events[n].isDone=!1},e.prototype.isStopped=function(){return this._stopped},e.prototype.dispose=function(){var e=this._animation.runtimeAnimations.indexOf(this);e>-1&&this._animation.runtimeAnimations.splice(e,1)},e.prototype.setValue=function(e,n){if(this._targetIsArray)for(var t=0;t<this._target.length;t++){var i=this._target[t];this._setValue(i,this._activeTargets[t],e,n,t)}else this._setValue(this._target,this._directTarget,e,n,0)},e.prototype._getOriginalValues=function(e){var n;void 0===e&&(e=0);var t=this._activeTargets[e];(n=t.getRestPose&&"_matrix"===this._targetPath?t.getRestPose():t[this._targetPath])&&n.clone?this._originalValue[e]=n.clone():this._originalValue[e]=n},e.prototype._setValue=function(e,n,t,i,r){if(this._currentActiveTarget=n,this._weight=i,this._enableBlending&&this._blendingFactor<=1){if(!this._originalBlendValue){var o=n[this._targetPath];o.clone?this._originalBlendValue=o.clone():this._originalBlendValue=o}this._originalBlendValue.m?_.AllowMatrixDecomposeForInterpolation?this._currentValue?c.DecomposeLerpToRef(this._originalBlendValue,t,this._blendingFactor,this._currentValue):this._currentValue=c.DecomposeLerp(this._originalBlendValue,t,this._blendingFactor):this._currentValue?c.LerpToRef(this._originalBlendValue,t,this._blendingFactor,this._currentValue):this._currentValue=c.Lerp(this._originalBlendValue,t,this._blendingFactor):this._currentValue=_._UniversalLerp(this._originalBlendValue,t,this._blendingFactor);var a=e&&e.animationPropertiesOverride?e.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=a}else this._currentValue=t;-1!==i?this._scene._registerTargetForLateAnimationBinding(this,this._originalValue[r]):n[this._targetPath]=this._currentValue,e.markAsDirty&&e.markAsDirty(this._animation.targetProperty)},e.prototype._getCorrectLoopMode=function(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode},e.prototype.goToFrame=function(e){var n=this._animation.getKeys();e<n[0].frame?e=n[0].frame:e>n[n.length-1].frame&&(e=n[n.length-1].frame);var t=this._events;if(t.length)for(var i=0;i<t.length;i++)t[i].onlyOnce||(t[i].isDone=t[i].frame<e);this._currentFrame=e;var r=this._animation._interpolate(e,this._animationState);this.setValue(r,-1)},e.prototype._prepareForSpeedRatioChange=function(e){var n=this._previousDelay*(this._animation.framePerSecond*e)/1e3;this._ratioOffset=this._previousRatio-n},e.prototype.animate=function(e,n,t,i,r,o){void 0===o&&(o=-1);var a=this._animation,s=a.targetPropertyPath;if(!s||s.length<1)return this._stopped=!0,!1;var l=!0;(n<this._minFrame||n>this._maxFrame)&&(n=this._minFrame),(t<this._minFrame||t>this._maxFrame)&&(t=this._maxFrame);var c,f,u=t-n,d=e*(a.framePerSecond*r)/1e3+this._ratioOffset,h=0;if(this._previousDelay=e,this._previousRatio=d,!i&&t>=n&&d>=u)l=!1,h=a._getKeyValue(this._maxValue);else if(!i&&n>=t&&d<=u)l=!1,h=a._getKeyValue(this._minValue);else if(this._animationState.loopMode!==_.ANIMATIONLOOPMODE_CYCLE){var p=t.toString()+n.toString();if(!this._offsetsCache[p]){this._animationState.repeatCount=0,this._animationState.loopMode=_.ANIMATIONLOOPMODE_CYCLE;var m=a._interpolate(n,this._animationState),v=a._interpolate(t,this._animationState);switch(this._animationState.loopMode=this._getCorrectLoopMode(),a.dataType){case _.ANIMATIONTYPE_FLOAT:this._offsetsCache[p]=v-m;break;case _.ANIMATIONTYPE_QUATERNION:this._offsetsCache[p]=v.subtract(m);break;case _.ANIMATIONTYPE_VECTOR3:this._offsetsCache[p]=v.subtract(m);case _.ANIMATIONTYPE_VECTOR2:this._offsetsCache[p]=v.subtract(m);case _.ANIMATIONTYPE_SIZE:this._offsetsCache[p]=v.subtract(m);case _.ANIMATIONTYPE_COLOR3:this._offsetsCache[p]=v.subtract(m)}this._highLimitsCache[p]=v}h=this._highLimitsCache[p],c=this._offsetsCache[p]}if(void 0===c)switch(a.dataType){case _.ANIMATIONTYPE_FLOAT:c=0;break;case _.ANIMATIONTYPE_QUATERNION:c=Oe;break;case _.ANIMATIONTYPE_VECTOR3:c=Me;break;case _.ANIMATIONTYPE_VECTOR2:c=Le;break;case _.ANIMATIONTYPE_SIZE:c=Ne;break;case _.ANIMATIONTYPE_COLOR3:c=Pe}if(this._host&&this._host.syncRoot){var A=this._host.syncRoot;f=n+(t-n)*((A.masterFrame-A.fromFrame)/(A.toFrame-A.fromFrame))}else f=l&&0!==u?n+d%u:t;var E=this._events;if((u>0&&this.currentFrame>f||u<0&&this.currentFrame<f)&&(this._onLoop(),E.length))for(var g=0;g<E.length;g++)E[g].onlyOnce||(E[g].isDone=!1);this._currentFrame=f,this._animationState.repeatCount=0===u?0:d/u>>0,this._animationState.highLimitValue=h,this._animationState.offsetValue=c;var T=a._interpolate(f,this._animationState);if(this.setValue(T,o),E.length)for(g=0;g<E.length;g++)if(u>0&&f>=E[g].frame&&E[g].frame>=n||u<0&&f<=E[g].frame&&E[g].frame<=n){var R=E[g];R.isDone||(R.onlyOnce&&(E.splice(g,1),g--),R.isDone=!0,R.action(f))}return l||(this._stopped=!0),l},e}(),De=function(e){function n(n,t,i,r,o,a,s){void 0===i&&(i=null),void 0===r&&(r=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null);var l=e.call(this,n,t.getScene())||this;return l.name=n,l.children=new Array,l.animations=new Array,l._index=null,l._absoluteTransform=new c,l._invertedAbsoluteTransform=new c,l._scalingDeterminant=1,l._worldTransform=new c,l._needToDecompose=!0,l._needToCompose=!1,l._linkedTransformNode=null,l._waitingTransformNodeId=null,l._skeleton=t,l._localMatrix=r?r.clone():c.Identity(),l._restPose=o||l._localMatrix.clone(),l._bindPose=l._localMatrix.clone(),l._baseMatrix=a||l._localMatrix.clone(),l._index=s,t.bones.push(l),l.setParent(i,!1),(a||r)&&l._updateDifferenceMatrix(),l}return l(n,e),Object.defineProperty(n.prototype,"_matrix",{get:function(){return this._compose(),this._localMatrix},set:function(e){this._localMatrix.copyFrom(e),this._needToDecompose=!0},enumerable:!1,configurable:!0}),n.prototype.getClassName=function(){return"Bone"},n.prototype.getSkeleton=function(){return this._skeleton},n.prototype.getParent=function(){return this._parent},n.prototype.getChildren=function(){return this.children},n.prototype.getIndex=function(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index},n.prototype.setParent=function(e,n){if(void 0===n&&(n=!0),this._parent!==e){if(this._parent){var t=this._parent.children.indexOf(this);-1!==t&&this._parent.children.splice(t,1)}this._parent=e,this._parent&&this._parent.children.push(this),n&&this._updateDifferenceMatrix(),this.markAsDirty()}},n.prototype.getLocalMatrix=function(){return this._compose(),this._localMatrix},n.prototype.getBaseMatrix=function(){return this._baseMatrix},n.prototype.getRestPose=function(){return this._restPose},n.prototype.setRestPose=function(e){this._restPose.copyFrom(e)},n.prototype.getBindPose=function(){return this._bindPose},n.prototype.setBindPose=function(e){this._bindPose.copyFrom(e)},n.prototype.getWorldMatrix=function(){return this._worldTransform},n.prototype.returnToRest=function(){this._skeleton._numBonesWithLinkedTransformNode>0?this.updateMatrix(this._restPose,!1,!1):this.updateMatrix(this._restPose,!1,!0)},n.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},n.prototype.getAbsoluteTransform=function(){return this._absoluteTransform},n.prototype.linkTransformNode=function(e){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=e,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++},n.prototype.getTransformNode=function(){return this._linkedTransformNode},Object.defineProperty(n.prototype,"position",{get:function(){return this._decompose(),this._localPosition},set:function(e){this._decompose(),this._localPosition.copyFrom(e),this._markAsDirtyAndCompose()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"rotation",{get:function(){return this.getRotation()},set:function(e){this.setRotation(e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"rotationQuaternion",{get:function(){return this._decompose(),this._localRotation},set:function(e){this.setRotationQuaternion(e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"scaling",{get:function(){return this.getScale()},set:function(e){this.setScale(e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"animationPropertiesOverride",{get:function(){return this._skeleton.animationPropertiesOverride},enumerable:!1,configurable:!0}),n.prototype._decompose=function(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=r.Zero(),this._localRotation=v.Zero(),this._localPosition=r.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))},n.prototype._compose=function(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,c.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix)):this._needToCompose=!1)},n.prototype.updateMatrix=function(e,n,t){void 0===n&&(n=!0),void 0===t&&(t=!0),this._baseMatrix.copyFrom(e),n&&this._updateDifferenceMatrix(),t?(this._needToCompose=!1,this._localMatrix.copyFrom(e),this._markAsDirtyAndDecompose()):this.markAsDirty()},n.prototype._updateDifferenceMatrix=function(e,n){if(void 0===n&&(n=!0),e||(e=this._baseMatrix),this._parent?e.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(e),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform),n)for(var t=0;t<this.children.length;t++)this.children[t]._updateDifferenceMatrix();this._scalingDeterminant=this._absoluteTransform.determinant()<0?-1:1},n.prototype.markAsDirty=function(){this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty()},n.prototype._markAsDirtyAndCompose=function(){this.markAsDirty(),this._needToCompose=!0},n.prototype._markAsDirtyAndDecompose=function(){this.markAsDirty(),this._needToDecompose=!0},n.prototype.translate=function(e,t,i){void 0===t&&(t=g.LOCAL);var o=this.getLocalMatrix();if(t==g.LOCAL)o.addAtIndex(12,e.x),o.addAtIndex(13,e.y),o.addAtIndex(14,e.z);else{var a=null;i&&(a=i.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=n._tmpMats[0],l=n._tmpVecs[0];this._parent?i&&a?(s.copyFrom(this._parent.getAbsoluteTransform()),s.multiplyToRef(a,s)):s.copyFrom(this._parent.getAbsoluteTransform()):c.IdentityToRef(s),s.setTranslationFromFloats(0,0,0),s.invert(),r.TransformCoordinatesToRef(e,s,l),o.addAtIndex(12,l.x),o.addAtIndex(13,l.y),o.addAtIndex(14,l.z)}this._markAsDirtyAndDecompose()},n.prototype.setPosition=function(e,t,i){void 0===t&&(t=g.LOCAL);var o=this.getLocalMatrix();if(t==g.LOCAL)o.setTranslationFromFloats(e.x,e.y,e.z);else{var a=null;i&&(a=i.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=n._tmpMats[0],l=n._tmpVecs[0];this._parent?(i&&a?(s.copyFrom(this._parent.getAbsoluteTransform()),s.multiplyToRef(a,s)):s.copyFrom(this._parent.getAbsoluteTransform()),s.invert()):c.IdentityToRef(s),r.TransformCoordinatesToRef(e,s,l),o.setTranslationFromFloats(l.x,l.y,l.z)}this._markAsDirtyAndDecompose()},n.prototype.setAbsolutePosition=function(e,n){this.setPosition(e,g.WORLD,n)},n.prototype.scale=function(e,t,i,r){void 0===r&&(r=!1);var o=this.getLocalMatrix(),a=n._tmpMats[0];c.ScalingToRef(e,t,i,a),a.multiplyToRef(o,o),a.invert();for(var s=0,l=this.children;s<l.length;s++){var f=(h=l[s]).getLocalMatrix();f.multiplyToRef(a,f),f.multiplyAtIndex(12,e),f.multiplyAtIndex(13,t),f.multiplyAtIndex(14,i),h._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),r)for(var u=0,d=this.children;u<d.length;u++){var h;(h=d[u]).scale(e,t,i,r)}},n.prototype.setScale=function(e){this._decompose(),this._localScaling.copyFrom(e),this._markAsDirtyAndCompose()},n.prototype.getScale=function(){return this._decompose(),this._localScaling},n.prototype.getScaleToRef=function(e){this._decompose(),e.copyFrom(this._localScaling)},n.prototype.setYawPitchRoll=function(e,t,i,r,o){if(void 0===r&&(r=g.LOCAL),r===g.LOCAL){var a=n._tmpQuat;return v.RotationYawPitchRollToRef(e,t,i,a),void this.setRotationQuaternion(a,r,o)}var s=n._tmpMats[0];if(this._getNegativeRotationToRef(s,o)){var l=n._tmpMats[1];c.RotationYawPitchRollToRef(e,t,i,l),s.multiplyToRef(l,l),this._rotateWithMatrix(l,r,o)}},n.prototype.rotate=function(e,t,i,r){void 0===i&&(i=g.LOCAL);var o=n._tmpMats[0];o.setTranslationFromFloats(0,0,0),c.RotationAxisToRef(e,t,o),this._rotateWithMatrix(o,i,r)},n.prototype.setAxisAngle=function(e,t,i,r){if(void 0===i&&(i=g.LOCAL),i===g.LOCAL){var o=n._tmpQuat;return v.RotationAxisToRef(e,t,o),void this.setRotationQuaternion(o,i,r)}var a=n._tmpMats[0];if(this._getNegativeRotationToRef(a,r)){var s=n._tmpMats[1];c.RotationAxisToRef(e,t,s),a.multiplyToRef(s,s),this._rotateWithMatrix(s,i,r)}},n.prototype.setRotation=function(e,n,t){void 0===n&&(n=g.LOCAL),this.setYawPitchRoll(e.y,e.x,e.z,n,t)},n.prototype.setRotationQuaternion=function(e,t,i){if(void 0===t&&(t=g.LOCAL),t===g.LOCAL)return this._decompose(),this._localRotation.copyFrom(e),void this._markAsDirtyAndCompose();var r=n._tmpMats[0];if(this._getNegativeRotationToRef(r,i)){var o=n._tmpMats[1];c.FromQuaternionToRef(e,o),r.multiplyToRef(o,o),this._rotateWithMatrix(o,t,i)}},n.prototype.setRotationMatrix=function(e,t,i){if(void 0===t&&(t=g.LOCAL),t===g.LOCAL){var r=n._tmpQuat;return v.FromRotationMatrixToRef(e,r),void this.setRotationQuaternion(r,t,i)}var o=n._tmpMats[0];if(this._getNegativeRotationToRef(o,i)){var a=n._tmpMats[1];a.copyFrom(e),o.multiplyToRef(e,a),this._rotateWithMatrix(a,t,i)}},n.prototype._rotateWithMatrix=function(e,t,i){void 0===t&&(t=g.LOCAL);var r=this.getLocalMatrix(),o=r.m[12],a=r.m[13],s=r.m[14],l=this.getParent(),c=n._tmpMats[3],f=n._tmpMats[4];l&&t==g.WORLD?(i?(c.copyFrom(i.getWorldMatrix()),l.getAbsoluteTransform().multiplyToRef(c,c)):c.copyFrom(l.getAbsoluteTransform()),f.copyFrom(c),f.invert(),r.multiplyToRef(c,r),r.multiplyToRef(e,r),r.multiplyToRef(f,r)):t==g.WORLD&&i?(c.copyFrom(i.getWorldMatrix()),f.copyFrom(c),f.invert(),r.multiplyToRef(c,r),r.multiplyToRef(e,r),r.multiplyToRef(f,r)):r.multiplyToRef(e,r),r.setTranslationFromFloats(o,a,s),this.computeAbsoluteTransforms(),this._markAsDirtyAndDecompose()},n.prototype._getNegativeRotationToRef=function(e,t){var i=n._tmpMats[2];return e.copyFrom(this.getAbsoluteTransform()),t&&(e.multiplyToRef(t.getWorldMatrix(),e),c.ScalingToRef(t.scaling.x,t.scaling.y,t.scaling.z,i)),e.invert(),!isNaN(e.m[0])&&(i.multiplyAtIndex(0,this._scalingDeterminant),e.multiplyToRef(i,e),!0)},n.prototype.getPosition=function(e,n){void 0===e&&(e=g.LOCAL),void 0===n&&(n=null);var t=r.Zero();return this.getPositionToRef(e,n,t),t},n.prototype.getPositionToRef=function(e,t,i){if(void 0===e&&(e=g.LOCAL),e==g.LOCAL){var r=this.getLocalMatrix();i.x=r.m[12],i.y=r.m[13],i.z=r.m[14]}else{var o=null;t&&(o=t.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var a=n._tmpMats[0];t&&o?(a.copyFrom(this.getAbsoluteTransform()),a.multiplyToRef(o,a)):a=this.getAbsoluteTransform(),i.x=a.m[12],i.y=a.m[13],i.z=a.m[14]}},n.prototype.getAbsolutePosition=function(e){void 0===e&&(e=null);var n=r.Zero();return this.getPositionToRef(g.WORLD,e,n),n},n.prototype.getAbsolutePositionToRef=function(e,n){this.getPositionToRef(g.WORLD,e,n)},n.prototype.computeAbsoluteTransforms=function(){if(this._compose(),this._parent)this._localMatrix.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform);else{this._absoluteTransform.copyFrom(this._localMatrix);var e=this._skeleton.getPoseMatrix();e&&this._absoluteTransform.multiplyToRef(e,this._absoluteTransform)}for(var n=this.children,t=n.length,i=0;i<t;i++)n[i].computeAbsoluteTransforms()},n.prototype.getDirection=function(e,n){void 0===n&&(n=null);var t=r.Zero();return this.getDirectionToRef(e,n,t),t},n.prototype.getDirectionToRef=function(e,t,i){void 0===t&&(t=null);var o=null;t&&(o=t.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var a=n._tmpMats[0];a.copyFrom(this.getAbsoluteTransform()),t&&o&&a.multiplyToRef(o,a),r.TransformNormalToRef(e,a,i),i.normalize()},n.prototype.getRotation=function(e,n){void 0===e&&(e=g.LOCAL),void 0===n&&(n=null);var t=r.Zero();return this.getRotationToRef(e,n,t),t},n.prototype.getRotationToRef=function(e,t,i){void 0===e&&(e=g.LOCAL),void 0===t&&(t=null);var r=n._tmpQuat;this.getRotationQuaternionToRef(e,t,r),r.toEulerAnglesToRef(i)},n.prototype.getRotationQuaternion=function(e,n){void 0===e&&(e=g.LOCAL),void 0===n&&(n=null);var t=v.Identity();return this.getRotationQuaternionToRef(e,n,t),t},n.prototype.getRotationQuaternionToRef=function(e,t,i){if(void 0===e&&(e=g.LOCAL),void 0===t&&(t=null),e==g.LOCAL)this._decompose(),i.copyFrom(this._localRotation);else{var r=n._tmpMats[0],o=this.getAbsoluteTransform();t?o.multiplyToRef(t.getWorldMatrix(),r):r.copyFrom(o),r.multiplyAtIndex(0,this._scalingDeterminant),r.multiplyAtIndex(1,this._scalingDeterminant),r.multiplyAtIndex(2,this._scalingDeterminant),r.decompose(void 0,i,void 0)}},n.prototype.getRotationMatrix=function(e,n){void 0===e&&(e=g.LOCAL);var t=c.Identity();return this.getRotationMatrixToRef(e,n,t),t},n.prototype.getRotationMatrixToRef=function(e,t,i){if(void 0===e&&(e=g.LOCAL),e==g.LOCAL)this.getLocalMatrix().getRotationMatrixToRef(i);else{var r=n._tmpMats[0],o=this.getAbsoluteTransform();t?o.multiplyToRef(t.getWorldMatrix(),r):r.copyFrom(o),r.multiplyAtIndex(0,this._scalingDeterminant),r.multiplyAtIndex(1,this._scalingDeterminant),r.multiplyAtIndex(2,this._scalingDeterminant),r.getRotationMatrixToRef(i)}},n.prototype.getAbsolutePositionFromLocal=function(e,n){void 0===n&&(n=null);var t=r.Zero();return this.getAbsolutePositionFromLocalToRef(e,n,t),t},n.prototype.getAbsolutePositionFromLocalToRef=function(e,t,i){void 0===t&&(t=null);var o=null;t&&(o=t.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var a=n._tmpMats[0];t&&o?(a.copyFrom(this.getAbsoluteTransform()),a.multiplyToRef(o,a)):a=this.getAbsoluteTransform(),r.TransformCoordinatesToRef(e,a,i)},n.prototype.getLocalPositionFromAbsolute=function(e,n){void 0===n&&(n=null);var t=r.Zero();return this.getLocalPositionFromAbsoluteToRef(e,n,t),t},n.prototype.getLocalPositionFromAbsoluteToRef=function(e,t,i){void 0===t&&(t=null);var o=null;t&&(o=t.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var a=n._tmpMats[0];a.copyFrom(this.getAbsoluteTransform()),t&&o&&a.multiplyToRef(o,a),a.invert(),r.TransformCoordinatesToRef(e,a,i)},n.prototype.setCurrentPoseAsRest=function(){this.setRestPose(this.getLocalMatrix())},n._tmpVecs=T.BuildArray(2,r.Zero),n._tmpQuat=v.Identity(),n._tmpMats=T.BuildArray(5,c.Identity),n}(R),Fe=function(){function e(e,n,t,i,r,o,s,l,c,f){void 0===t&&(t=0),void 0===i&&(i=100),void 0===r&&(r=!1),void 0===o&&(o=1),void 0===f&&(f=!1),this.target=n,this.fromFrame=t,this.toFrame=i,this.loopAnimation=r,this.onAnimationEnd=s,this.onAnimationLoop=c,this.isAdditive=f,this._localDelayOffset=null,this._pausedDelay=null,this._runtimeAnimations=new Array,this._paused=!1,this._speedRatio=1,this._weight=-1,this._syncRoot=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new a,this.onAnimationLoopObservable=new a,this._scene=e,l&&this.appendAnimations(n,l),this._speedRatio=o,e._activeAnimatables.push(this)}return Object.defineProperty(e.prototype,"syncRoot",{get:function(){return this._syncRoot},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"masterFrame",{get:function(){return 0===this._runtimeAnimations.length?0:this._runtimeAnimations[0].currentFrame},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"weight",{get:function(){return this._weight},set:function(e){this._weight=-1!==e?Math.min(Math.max(e,0),1):-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(e){for(var n=0;n<this._runtimeAnimations.length;n++){this._runtimeAnimations[n]._prepareForSpeedRatioChange(e)}this._speedRatio=e},enumerable:!1,configurable:!0}),e.prototype.syncWith=function(e){if(this._syncRoot=e,e){var n=this._scene._activeAnimatables.indexOf(this);n>-1&&(this._scene._activeAnimatables.splice(n,1),this._scene._activeAnimatables.push(this))}return this},e.prototype.getAnimations=function(){return this._runtimeAnimations},e.prototype.appendAnimations=function(e,n){for(var t=this,i=0;i<n.length;i++){var r=n[i],o=new xe(e,r,this._scene,this);o._onLoop=function(){t.onAnimationLoopObservable.notifyObservers(t),t.onAnimationLoop&&t.onAnimationLoop()},this._runtimeAnimations.push(o)}},e.prototype.getAnimationByTargetProperty=function(e){for(var n=this._runtimeAnimations,t=0;t<n.length;t++)if(n[t].animation.targetProperty===e)return n[t].animation;return null},e.prototype.getRuntimeAnimationByTargetProperty=function(e){for(var n=this._runtimeAnimations,t=0;t<n.length;t++)if(n[t].animation.targetProperty===e)return n[t];return null},e.prototype.reset=function(){for(var e=this._runtimeAnimations,n=0;n<e.length;n++)e[n].reset(!0);this._localDelayOffset=null,this._pausedDelay=null},e.prototype.enableBlending=function(e){for(var n=this._runtimeAnimations,t=0;t<n.length;t++)n[t].animation.enableBlending=!0,n[t].animation.blendingSpeed=e},e.prototype.disableBlending=function(){for(var e=this._runtimeAnimations,n=0;n<e.length;n++)e[n].animation.enableBlending=!1},e.prototype.goToFrame=function(e){var n=this._runtimeAnimations;if(n[0]){var t=n[0].animation.framePerSecond,i=n[0].currentFrame,r=0===this.speedRatio?0:(e-i)/t*1e3/this.speedRatio;null===this._localDelayOffset&&(this._localDelayOffset=0),this._localDelayOffset-=r}for(var o=0;o<n.length;o++)n[o].goToFrame(e)},e.prototype.pause=function(){this._paused||(this._paused=!0)},e.prototype.restart=function(){this._paused=!1},e.prototype._raiseOnAnimationEnd=function(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)},e.prototype.stop=function(e,n){if(e||n){var t=this._scene._activeAnimatables.indexOf(this);if(t>-1){for(var i=(o=this._runtimeAnimations).length-1;i>=0;i--){var r=o[i];e&&r.animation.name!=e||(n&&!n(r.target)||(r.dispose(),o.splice(i,1)))}0==o.length&&(this._scene._activeAnimatables.splice(t,1),this._raiseOnAnimationEnd())}}else{if((i=this._scene._activeAnimatables.indexOf(this))>-1){this._scene._activeAnimatables.splice(i,1);var o=this._runtimeAnimations;for(i=0;i<o.length;i++)o[i].dispose();this._raiseOnAnimationEnd()}}},e.prototype.waitAsync=function(){var e=this;return new Promise((function(n,t){e.onAnimationEndObservable.add((function(){n(e)}),void 0,void 0,e,!0)}))},e.prototype._animate=function(e){if(this._paused)return this.animationStarted=!1,null===this._pausedDelay&&(this._pausedDelay=e),!0;if(null===this._localDelayOffset?(this._localDelayOffset=e,this._pausedDelay=null):null!==this._pausedDelay&&(this._localDelayOffset+=e-this._pausedDelay,this._pausedDelay=null),0===this._weight)return!0;var n,t=!1,i=this._runtimeAnimations;for(n=0;n<i.length;n++){var r=i[n].animate(e-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);t=t||r}if(this.animationStarted=t,!t){if(this.disposeOnEnd)for(n=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(n,1),n=0;n<i.length;n++)i[n].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return t},e}();C.prototype._animate=function(){if(this.animationsEnabled){var e=y.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=e}this.deltaTime=this.useConstantAnimationDeltaTime?16:(e-this._animationTimeLast)*this.animationTimeScale,this._animationTimeLast=e;var n=this._activeAnimatables;if(0!==n.length){this._animationTime+=this.deltaTime;for(var t=this._animationTime,i=0;i<n.length;i++){var r=n[i];!r._animate(t)&&r.disposeOnEnd&&i--}this._processLateAnimationBindings()}}},C.prototype.beginWeightedAnimation=function(e,n,t,i,r,o,a,s,l,c,f){void 0===i&&(i=1),void 0===o&&(o=1),void 0===f&&(f=!1);var u=this.beginAnimation(e,n,t,r,o,a,s,!1,l,c,f);return u.weight=i,u},C.prototype.beginAnimation=function(e,n,t,i,r,o,a,s,l,c,f){void 0===r&&(r=1),void 0===s&&(s=!0),void 0===f&&(f=!1),n>t&&r>0&&(r*=-1),s&&this.stopAnimation(e,void 0,l),a||(a=new Fe(this,e,n,t,i,r,o,void 0,c,f));var u=!l||l(e);if(e.animations&&u&&a.appendAnimations(e,e.animations),e.getAnimatables)for(var d=e.getAnimatables(),h=0;h<d.length;h++)this.beginAnimation(d[h],n,t,i,r,o,a,s,l,c);return a.reset(),a},C.prototype.beginHierarchyAnimation=function(e,n,t,i,r,o,a,s,l,c,f,u){void 0===o&&(o=1),void 0===l&&(l=!0),void 0===u&&(u=!1);var d=e.getDescendants(n),h=[];h.push(this.beginAnimation(e,t,i,r,o,a,s,l,c,void 0,u));for(var p=0,m=d;p<m.length;p++){var v=m[p];h.push(this.beginAnimation(v,t,i,r,o,a,s,l,c,void 0,u))}return h},C.prototype.beginDirectAnimation=function(e,n,t,i,r,o,a,s,l){return void 0===l&&(l=!1),void 0===o&&(o=1),t>i&&o>0&&(o*=-1),new Fe(this,e,t,i,r,o,a,n,s,l)},C.prototype.beginDirectHierarchyAnimation=function(e,n,t,i,r,o,a,s,l,c){void 0===c&&(c=!1);var f=e.getDescendants(n),u=[];u.push(this.beginDirectAnimation(e,t,i,r,o,a,s,l,c));for(var d=0,h=f;d<h.length;d++){var p=h[d];u.push(this.beginDirectAnimation(p,t,i,r,o,a,s,l,c))}return u},C.prototype.getAnimatableByTarget=function(e){for(var n=0;n<this._activeAnimatables.length;n++)if(this._activeAnimatables[n].target===e)return this._activeAnimatables[n];return null},C.prototype.getAllAnimatablesByTarget=function(e){for(var n=[],t=0;t<this._activeAnimatables.length;t++)this._activeAnimatables[t].target===e&&n.push(this._activeAnimatables[t]);return n},C.prototype.stopAnimation=function(e,n,t){for(var i=0,r=this.getAllAnimatablesByTarget(e);i<r.length;i++){r[i].stop(n,t)}},C.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(var e=0;e<this._activeAnimatables.length;e++)this._activeAnimatables[e].stop();this._activeAnimatables=[]}for(var n=0,t=this.animationGroups;n<t.length;n++){t[n].stop()}},C.prototype._registerTargetForLateAnimationBinding=function(e,n){var t=e.target;this._registeredForLateAnimationBindings.pushNoDuplicate(t),t._lateAnimationHolders||(t._lateAnimationHolders={}),t._lateAnimationHolders[e.targetPath]||(t._lateAnimationHolders[e.targetPath]={totalWeight:0,totalAdditiveWeight:0,animations:[],additiveAnimations:[],originalValue:n}),e.isAdditive?(t._lateAnimationHolders[e.targetPath].additiveAnimations.push(e),t._lateAnimationHolders[e.targetPath].totalAdditiveWeight+=e.weight):(t._lateAnimationHolders[e.targetPath].animations.push(e),t._lateAnimationHolders[e.targetPath].totalWeight+=e.weight)},C.prototype._processLateAnimationBindingsForMatrices=function(e){if(0===e.totalWeight&&0===e.totalAdditiveWeight)return e.originalValue;var n=1,t=S.Vector3[0],i=S.Vector3[1],o=S.Quaternion[0],a=0,s=e.animations[0],l=e.originalValue,f=1,u=!1;if(e.totalWeight<1)f=1-e.totalWeight,l.decompose(i,o,t);else{if(a=1,n=e.totalWeight,1==(f=s.weight/n)){if(!e.totalAdditiveWeight)return s.currentValue;u=!0}s.currentValue.decompose(i,o,t)}if(!u){i.scaleInPlace(f),t.scaleInPlace(f),o.scaleInPlace(f);for(var d=a;d<e.animations.length;d++){if(0!==(E=e.animations[d]).weight){f=E.weight/n;var h=S.Vector3[2],p=S.Vector3[3],m=S.Quaternion[1];E.currentValue.decompose(p,m,h),p.scaleAndAddToRef(f,i),m.scaleAndAddToRef(f,o),h.scaleAndAddToRef(f,t)}}}for(var A=0;A<e.additiveAnimations.length;A++){var E;if(0!==(E=e.additiveAnimations[A]).weight){h=S.Vector3[2],p=S.Vector3[3],m=S.Quaternion[1];E.currentValue.decompose(p,m,h),p.multiplyToRef(i,p),r.LerpToRef(i,p,E.weight,i),o.multiplyToRef(m,m),v.SlerpToRef(o,m,E.weight,o),h.scaleAndAddToRef(E.weight,t)}}var _=s?s._animationState.workValue:S.Matrix[0].clone();return c.ComposeToRef(i,o,t,_),_},C.prototype._processLateAnimationBindingsForQuaternions=function(e,n){if(0===e.totalWeight&&0===e.totalAdditiveWeight)return n;var t=e.animations[0],i=e.originalValue,r=n;if(0===e.totalWeight&&e.totalAdditiveWeight>0)r.copyFrom(i);else if(1===e.animations.length){if(v.SlerpToRef(i,t.currentValue,Math.min(1,e.totalWeight),r),0===e.totalAdditiveWeight)return r}else if(e.animations.length>1){var o=1,a=void 0,s=void 0;if(e.totalWeight<1){var l=1-e.totalWeight;s=[],(a=[]).push(i),s.push(l)}else{if(2===e.animations.length&&(v.SlerpToRef(e.animations[0].currentValue,e.animations[1].currentValue,e.animations[1].weight/e.totalWeight,n),0===e.totalAdditiveWeight))return n;a=[],s=[],o=e.totalWeight}for(var c=0;c<e.animations.length;c++){var f=e.animations[c];a.push(f.currentValue),s.push(f.weight/o)}for(var u=0,d=0;d<a.length;)d?(u+=s[d],v.SlerpToRef(r,a[d],s[d]/u,r),d++):(v.SlerpToRef(a[d],a[d+1],s[d+1]/(s[d]+s[d+1]),n),r=n,u=s[d]+s[d+1],d+=2)}for(var h=0;h<e.additiveAnimations.length;h++){0!==(f=e.additiveAnimations[h]).weight&&(r.multiplyToRef(f.currentValue,S.Quaternion[0]),v.SlerpToRef(r,S.Quaternion[0],f.weight,r))}return r},C.prototype._processLateAnimationBindings=function(){if(this._registeredForLateAnimationBindings.length){for(var e=0;e<this._registeredForLateAnimationBindings.length;e++){var n=this._registeredForLateAnimationBindings.data[e];for(var t in n._lateAnimationHolders){var i=n._lateAnimationHolders[t],r=i.animations[0],o=i.originalValue,a=_.AllowMatrixDecomposeForInterpolation&&o.m,s=n[t];if(a)s=this._processLateAnimationBindingsForMatrices(i);else if(void 0!==o.w)s=this._processLateAnimationBindingsForQuaternions(i,s||v.Identity());else{var l=0,c=1;if(i.totalWeight<1)s=r&&o.scale?o.scale(1-i.totalWeight):r?o*(1-i.totalWeight):o.clone?o.clone():o;else if(r){c=i.totalWeight;var f=r.weight/c;s=1!==f?r.currentValue.scale?r.currentValue.scale(f):r.currentValue*f:r.currentValue,l=1}for(var u=l;u<i.animations.length;u++){(p=(h=i.animations[u]).weight/c)&&(h.currentValue.scaleAndAddToRef?h.currentValue.scaleAndAddToRef(p,s):s+=h.currentValue*p)}for(var d=0;d<i.additiveAnimations.length;d++){var h,p;(p=(h=i.additiveAnimations[d]).weight)&&(h.currentValue.scaleAndAddToRef?h.currentValue.scaleAndAddToRef(p,s):s+=h.currentValue*p)}}n[t]=s}n._lateAnimationHolders={}}this._registeredForLateAnimationBindings.reset()}},De.prototype.copyAnimationRange=function(e,n,t,i,r){void 0===i&&(i=!1),void 0===r&&(r=null),0===this.animations.length&&(this.animations.push(new _(this.name,"_matrix",e.animations[0].framePerSecond,_.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));var o=e.animations[0].getRange(n);if(!o)return!1;for(var a,s,l,c=o.from,f=o.to,u=e.animations[0].getKeys(),d=e.length,h=e.getParent(),p=this.getParent(),m=i&&h&&d&&this.length&&d!==this.length,v=m&&p&&h?p.length/h.length:1,A=i&&!p&&r&&(1!==r.x||1!==r.y||1!==r.z),E=this.animations[0].getKeys(),g=0,T=u.length;g<T;g++)(a=u[g]).frame>=c&&a.frame<=f&&(i?(l=a.value.clone(),m?(s=l.getTranslation(),l.setTranslation(s.scaleInPlace(v))):A&&r?(s=l.getTranslation(),l.setTranslation(s.multiplyInPlace(r))):l=a.value):l=a.value,E.push({frame:a.frame+t,value:l}));return this.animations[0].createRange(n,c+t,f+t),!0};var Ue=function(){function e(){}return e.prototype.getClassName=function(){return"TargetedAnimation"},e.prototype.serialize=function(){var e={};return e.animation=this.animation.serialize(),e.targetId=this.target.id,e},e}(),Be=function(){function e(e,n){void 0===n&&(n=null),this.name=e,this._targetedAnimations=new Array,this._animatables=new Array,this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this._loopAnimation=!1,this._isAdditive=!1,this.onAnimationEndObservable=new a,this.onAnimationLoopObservable=new a,this.onAnimationGroupLoopObservable=new a,this.onAnimationGroupEndObservable=new a,this.onAnimationGroupPauseObservable=new a,this.onAnimationGroupPlayObservable=new a,this._scene=n||b.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._scene.addAnimationGroup(this)}return Object.defineProperty(e.prototype,"from",{get:function(){return this._from},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"to",{get:function(){return this._to},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isStarted",{get:function(){return this._isStarted},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isPlaying",{get:function(){return this._isStarted&&!this._isPaused},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(e){if(this._speedRatio!==e){this._speedRatio=e;for(var n=0;n<this._animatables.length;n++){this._animatables[n].speedRatio=this._speedRatio}}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loopAnimation",{get:function(){return this._loopAnimation},set:function(e){if(this._loopAnimation!==e){this._loopAnimation=e;for(var n=0;n<this._animatables.length;n++){this._animatables[n].loopAnimation=this._loopAnimation}}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isAdditive",{get:function(){return this._isAdditive},set:function(e){if(this._isAdditive!==e){this._isAdditive=e;for(var n=0;n<this._animatables.length;n++){this._animatables[n].isAdditive=this._isAdditive}}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"targetedAnimations",{get:function(){return this._targetedAnimations},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"animatables",{get:function(){return this._animatables},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._targetedAnimations},enumerable:!1,configurable:!0}),e.prototype.addTargetedAnimation=function(e,n){var t=new Ue;t.animation=e,t.target=n;var i=e.getKeys();return this._from>i[0].frame&&(this._from=i[0].frame),this._to<i[i.length-1].frame&&(this._to=i[i.length-1].frame),this._targetedAnimations.push(t),t},e.prototype.normalize=function(e,n){void 0===e&&(e=null),void 0===n&&(n=null),null==e&&(e=this._from),null==n&&(n=this._to);for(var t=0;t<this._targetedAnimations.length;t++){var i=this._targetedAnimations[t].animation.getKeys(),r=i[0],o=i[i.length-1];if(r.frame>e){var a={frame:e,value:r.value,inTangent:r.inTangent,outTangent:r.outTangent,interpolation:r.interpolation};i.splice(0,0,a)}if(o.frame<n){a={frame:n,value:o.value,inTangent:o.inTangent,outTangent:o.outTangent,interpolation:o.interpolation};i.push(a)}}return this._from=e,this._to=n,this},e.prototype._processLoop=function(e,n,t){var i=this;e.onAnimationLoop=function(){i.onAnimationLoopObservable.notifyObservers(n),i._animationLoopFlags[t]||(i._animationLoopFlags[t]=!0,i._animationLoopCount++,i._animationLoopCount===i._targetedAnimations.length&&(i.onAnimationGroupLoopObservable.notifyObservers(i),i._animationLoopCount=0,i._animationLoopFlags=[]))}},e.prototype.start=function(e,n,t,i,r){var o=this;if(void 0===e&&(e=!1),void 0===n&&(n=1),this._isStarted||0===this._targetedAnimations.length)return this;this._loopAnimation=e,this._animationLoopCount=0,this._animationLoopFlags=[];for(var a=function(){var a=s._targetedAnimations[l],c=s._scene.beginDirectAnimation(a.target,[a.animation],void 0!==t?t:s._from,void 0!==i?i:s._to,e,n,void 0,void 0,void 0!==r?r:s._isAdditive);c.onAnimationEnd=function(){o.onAnimationEndObservable.notifyObservers(a),o._checkAnimationGroupEnded(c)},s._processLoop(c,a,l),s._animatables.push(c)},s=this,l=0;l<this._targetedAnimations.length;l++)a();if(this._speedRatio=n,void 0!==t&&void 0!==i)if(t<i&&this._speedRatio<0){var c=i;i=t,t=c}else t>i&&this._speedRatio>0&&(this._speedRatio=-n);return this._isStarted=!0,this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this},e.prototype.pause=function(){if(!this._isStarted)return this;this._isPaused=!0;for(var e=0;e<this._animatables.length;e++){this._animatables[e].pause()}return this.onAnimationGroupPauseObservable.notifyObservers(this),this},e.prototype.play=function(e){return this.isStarted&&this._animatables.length===this._targetedAnimations.length?(void 0!==e&&(this.loopAnimation=e),this.restart()):(this.stop(),this.start(e,this._speedRatio)),this._isPaused=!1,this},e.prototype.reset=function(){if(!this._isStarted)return this.play(),this.goToFrame(0),this.stop(),this;for(var e=0;e<this._animatables.length;e++){this._animatables[e].reset()}return this},e.prototype.restart=function(){if(!this._isStarted)return this;for(var e=0;e<this._animatables.length;e++){this._animatables[e].restart()}return this.onAnimationGroupPlayObservable.notifyObservers(this),this},e.prototype.stop=function(){if(!this._isStarted)return this;for(var e=this._animatables.slice(),n=0;n<e.length;n++)e[n].stop();return this._isStarted=!1,this},e.prototype.setWeightForAllAnimatables=function(e){for(var n=0;n<this._animatables.length;n++){this._animatables[n].weight=e}return this},e.prototype.syncAllAnimationsWith=function(e){for(var n=0;n<this._animatables.length;n++){this._animatables[n].syncWith(e)}return this},e.prototype.goToFrame=function(e){if(!this._isStarted)return this;for(var n=0;n<this._animatables.length;n++){this._animatables[n].goToFrame(e)}return this},e.prototype.dispose=function(){this._targetedAnimations=[],this._animatables=[];var e=this._scene.animationGroups.indexOf(this);e>-1&&this._scene.animationGroups.splice(e,1),this.onAnimationEndObservable.clear(),this.onAnimationGroupEndObservable.clear(),this.onAnimationGroupPauseObservable.clear(),this.onAnimationGroupPlayObservable.clear(),this.onAnimationLoopObservable.clear(),this.onAnimationGroupLoopObservable.clear()},e.prototype._checkAnimationGroupEnded=function(e){var n=this._animatables.indexOf(e);n>-1&&this._animatables.splice(n,1),0===this._animatables.length&&(this._isStarted=!1,this.onAnimationGroupEndObservable.notifyObservers(this))},e.prototype.clone=function(n,t){for(var i=new e(n||this.name,this._scene),r=0,o=this._targetedAnimations;r<o.length;r++){var a=o[r];i.addTargetedAnimation(a.animation.clone(),t?t(a.target):a.target)}return i},e.prototype.serialize=function(){var e={};e.name=this.name,e.from=this.from,e.to=this.to,e.targetedAnimations=[];for(var n=0;n<this.targetedAnimations.length;n++){var t=this.targetedAnimations[n];e.targetedAnimations[n]=t.serialize()}return e},e.Parse=function(n,t){for(var i=new e(n.name,t),r=0;r<n.targetedAnimations.length;r++){var o=n.targetedAnimations[r],a=_.Parse(o.animation),s=o.targetId;if("influence"===o.animation.property){var l=t.getMorphTargetById(s);l&&i.addTargetedAnimation(a,l)}else{var c=t.getNodeByID(s);null!=c&&i.addTargetedAnimation(a,c)}}return null!==n.from&&null!==n.to&&i.normalize(n.from,n.to),i},e.MakeAnimationAdditive=function(e,n,t,i,r){void 0===n&&(n=0),void 0===i&&(i=!1);var o=e;i&&(o=e.clone(r||o.name));for(var a=o.targetedAnimations,s=0;s<a.length;s++){var l=a[s];_.MakeAnimationAdditive(l.animation,n,t)}return o.isAdditive=!0,o},e.prototype.getClassName=function(){return"AnimationGroup"},e.prototype.toString=function(e){var n="Name: "+this.name;return n+=", type: "+this.getClassName(),e&&(n+=", from: "+this._from,n+=", to: "+this._to,n+=", isStarted: "+this._isStarted,n+=", speedRatio: "+this._speedRatio,n+=", targetedAnimations length: "+this._targetedAnimations.length,n+=", animatables length: "+this._animatables),n},e}();function we(e,n,t,i){var r;r=1===i?new Float32Array(n*t*4):new Uint32Array(n*t*4);for(var o=0;o<n;o++)for(var a=0;a<t;a++){var s=3*(a*n+o),l=4*(a*n+o);r[l+0]=e[s+0],r[l+1]=e[s+1],r[l+2]=e[s+2],r[l+3]=1}return r}function Ve(e){return function(n,t,i,r,o,a,s,l,c,f){void 0===c&&(c=null),void 0===f&&(f=0);var u=e?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,d=e?M.Raw3D:M.Raw2DArray,h=new O(this,d);h.baseWidth=t,h.baseHeight=i,h.baseDepth=r,h.width=t,h.height=i,h.depth=r,h.format=o,h.type=f,h.generateMipMaps=a,h.samplingMode=l,e?h.is3D=!0:h.is2DArray=!0,this._doNotHandleContextLost||(h._bufferView=n),e?this.updateRawTexture3D(h,n,o,s,c,f):this.updateRawTexture2DArray(h,n,o,s,c,f),this._bindTextureDirectly(u,h,!0);var p=this._getSamplingParameters(l,a);return this._gl.texParameteri(u,this._gl.TEXTURE_MAG_FILTER,p.mag),this._gl.texParameteri(u,this._gl.TEXTURE_MIN_FILTER,p.min),a&&this._gl.generateMipmap(u),this._bindTextureDirectly(u,null),this._internalTexturesCache.push(h),h}}function Ge(e){return function(n,t,i,r,o,a){void 0===o&&(o=null),void 0===a&&(a=0);var s=e?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,l=this._getWebGLTextureType(a),c=this._getInternalFormat(i),f=this._getRGBABufferInternalSizedFormat(a,i);this._bindTextureDirectly(s,n,!0),this._unpackFlipY(void 0===r||!!r),this._doNotHandleContextLost||(n._bufferView=t,n.format=i,n.invertY=r,n._compression=o),n.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),o&&t?this._gl.compressedTexImage3D(s,0,this.getCaps().s3tc[o],n.width,n.height,n.depth,0,t):this._gl.texImage3D(s,0,f,n.width,n.height,n.depth,0,c,l,t),n.generateMipMaps&&this._gl.generateMipmap(s),this._bindTextureDirectly(s,null),n.isReady=!0}}I.prototype.updateRawTexture=function(e,n,t,i,r,o){if(void 0===r&&(r=null),void 0===o&&(o=0),e){var a=this._getRGBABufferInternalSizedFormat(o,t),s=this._getInternalFormat(t),l=this._getWebGLTextureType(o);this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),this._unpackFlipY(void 0===i||!!i),this._doNotHandleContextLost||(e._bufferView=n,e.format=t,e.type=o,e.invertY=i,e._compression=r),e.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),r&&n?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[r],e.width,e.height,0,n):this._gl.texImage2D(this._gl.TEXTURE_2D,0,a,e.width,e.height,0,s,l,n),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),e.isReady=!0}},I.prototype.createRawTexture=function(e,n,t,i,r,o,a,s,l){void 0===s&&(s=null),void 0===l&&(l=0);var c=new O(this,M.Raw);c.baseWidth=n,c.baseHeight=t,c.width=n,c.height=t,c.format=i,c.generateMipMaps=r,c.samplingMode=a,c.invertY=o,c._compression=s,c.type=l,this._doNotHandleContextLost||(c._bufferView=e),this.updateRawTexture(c,e,i,o,s,l),this._bindTextureDirectly(this._gl.TEXTURE_2D,c,!0);var f=this._getSamplingParameters(a,r);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,f.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,f.min),r&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(c),c},I.prototype.createRawCubeTexture=function(e,n,i,r,o,a,s,l){void 0===l&&(l=null);var c=this._gl,f=new O(this,M.CubeRaw);f.isCube=!0,f.format=i,f.type=r,this._doNotHandleContextLost||(f._bufferViewArray=e);var u=this._getWebGLTextureType(r),d=this._getInternalFormat(i);d===c.RGB&&(d=c.RGBA),(u!==c.FLOAT||this._caps.textureFloatLinearFiltering)&&(u!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering)?(u!==c.FLOAT||this._caps.textureFloatRender)&&(u!==c.HALF_FLOAT||this._caps.colorBufferFloat)||(o=!1):(o=!1,s=1);var h=n,p=h;f.width=h,f.height=p,!this.needPOTTextures||t.IsExponentOfTwo(f.width)&&t.IsExponentOfTwo(f.height)||(o=!1),e&&this.updateRawCubeTexture(f,e,i,r,a,l),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,f,!0),e&&o&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);var m=this._getSamplingParameters(s,o);return c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MAG_FILTER,m.mag),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MIN_FILTER,m.min),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,null),f.generateMipMaps=o,f},I.prototype.updateRawCubeTexture=function(e,n,i,r,o,a,s){void 0===a&&(a=null),void 0===s&&(s=0),e._bufferViewArray=n,e.format=i,e.type=r,e.invertY=o,e._compression=a;var l=this._gl,c=this._getWebGLTextureType(r),f=this._getInternalFormat(i),u=this._getRGBABufferInternalSizedFormat(r),d=!1;f===l.RGB&&(f=l.RGBA,d=!0),this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,e,!0),this._unpackFlipY(void 0===o||!!o),e.width%4!=0&&l.pixelStorei(l.UNPACK_ALIGNMENT,1);for(var h=0;h<6;h++){var p=n[h];a?l.compressedTexImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+h,s,this.getCaps().s3tc[a],e.width,e.height,0,p):(d&&(p=we(p,e.width,e.height,r)),l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+h,s,u,e.width,e.height,0,f,c,p))}(!this.needPOTTextures||t.IsExponentOfTwo(e.width)&&t.IsExponentOfTwo(e.height))&&e.generateMipMaps&&0===s&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),e.isReady=!0},I.prototype.createRawCubeTextureFromUrl=function(e,n,t,i,r,o,a,s,l,c,f,u){var d=this;void 0===l&&(l=null),void 0===c&&(c=null),void 0===f&&(f=3),void 0===u&&(u=!1);var h=this._gl,p=this.createRawCubeTexture(null,t,i,r,!o,u,f,null);null==n||n._addPendingData(p),p.url=e,this._internalTexturesCache.push(p);return this._loadFile(e,(function(e){!function(e){var t=p.width,o=a(e);if(o){if(s){var c=d._getWebGLTextureType(r),f=d._getInternalFormat(i),m=d._getRGBABufferInternalSizedFormat(r),v=!1;f===h.RGB&&(f=h.RGBA,v=!0),d._bindTextureDirectly(h.TEXTURE_CUBE_MAP,p,!0),d._unpackFlipY(!1);for(var A=s(o),E=0;E<A.length;E++)for(var _=t>>E,g=0;g<6;g++){var T=A[E][g];v&&(T=we(T,_,_,r)),h.texImage2D(g,E,m,_,_,0,f,c,T)}d._bindTextureDirectly(h.TEXTURE_CUBE_MAP,null)}else d.updateRawCubeTexture(p,o,i,r,u);p.isReady=!0,null==n||n._removePendingData(p),l&&l()}}(e)}),void 0,null==n?void 0:n.offlineProvider,!0,(function(e,t){null==n||n._removePendingData(p),c&&e&&c(e.status+" "+e.statusText,t)})),p},I.prototype.createRawTexture2DArray=Ve(!1),I.prototype.createRawTexture3D=Ve(!0),I.prototype.updateRawTexture2DArray=Ge(!1),I.prototype.updateRawTexture3D=Ge(!0);var He=function(e){function n(n,t,i,r,o,a,s,l,c){void 0===a&&(a=!0),void 0===s&&(s=!1),void 0===l&&(l=3),void 0===c&&(c=0);var f=e.call(this,null,o,!a,s)||this;return f.format=r,f._engine?(f._texture=f._engine.createRawTexture(n,t,i,r,a,s,l,null,c),f.wrapU=ce.CLAMP_ADDRESSMODE,f.wrapV=ce.CLAMP_ADDRESSMODE,f):f}return l(n,e),n.prototype.update=function(e){this._getEngine().updateRawTexture(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type)},n.CreateLuminanceTexture=function(e,t,i,r,o,a,s){return void 0===o&&(o=!0),void 0===a&&(a=!1),void 0===s&&(s=3),new n(e,t,i,1,r,o,a,s)},n.CreateLuminanceAlphaTexture=function(e,t,i,r,o,a,s){return void 0===o&&(o=!0),void 0===a&&(a=!1),void 0===s&&(s=3),new n(e,t,i,2,r,o,a,s)},n.CreateAlphaTexture=function(e,t,i,r,o,a,s){return void 0===o&&(o=!0),void 0===a&&(a=!1),void 0===s&&(s=3),new n(e,t,i,0,r,o,a,s)},n.CreateRGBTexture=function(e,t,i,r,o,a,s,l){return void 0===o&&(o=!0),void 0===a&&(a=!1),void 0===s&&(s=3),void 0===l&&(l=0),new n(e,t,i,4,r,o,a,s,l)},n.CreateRGBATexture=function(e,t,i,r,o,a,s,l){return void 0===o&&(o=!0),void 0===a&&(a=!1),void 0===s&&(s=3),void 0===l&&(l=0),new n(e,t,i,5,r,o,a,s,l)},n.CreateRTexture=function(e,t,i,r,o,a,s,l){return void 0===o&&(o=!0),void 0===a&&(a=!1),void 0===s&&(s=ce.TRILINEAR_SAMPLINGMODE),void 0===l&&(l=1),new n(e,t,i,6,r,o,a,s,l)},n}(ce),ke=function(){function e(e,n,t){this.name=e,this.id=n,this.bones=new Array,this.needInitialSkinMatrix=!1,this.overrideMesh=null,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=c.Identity(),this._ranges={},this._lastAbsoluteTransformsUpdateId=-1,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._waitingOverrideMeshId=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new a,this.bones=[],this._scene=t||b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;var i=this._scene.getEngine().getCaps();this._canUseTextureForBones=i.textureFloat&&i.maxVertexTextureImageUnits>0}return Object.defineProperty(e.prototype,"useTextureToStoreBoneMatrices",{get:function(){return this._useTextureToStoreBoneMatrices},set:function(e){this._useTextureToStoreBoneMatrices=e,this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isUsingTextureForMatrices",{get:function(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"Skeleton"},e.prototype.getChildren=function(){return this.bones.filter((function(e){return!e.getParent()}))},e.prototype.getTransformMatrices=function(e){return this.needInitialSkinMatrix&&e._bonesTransformMatrices?e._bonesTransformMatrices:(this._transformMatrices||this.prepare(),this._transformMatrices)},e.prototype.getTransformMatrixTexture=function(e){return this.needInitialSkinMatrix&&e._transformMatrixTexture?e._transformMatrixTexture:this._transformMatrixTexture},e.prototype.getScene=function(){return this._scene},e.prototype.toString=function(e){var n="Name: "+this.name+", nBones: "+this.bones.length;if(n+=", nAnimationRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){n+=", Ranges: {";var t=!0;for(var i in this._ranges)t&&(n+=", ",t=!1),n+=i;n+="}"}return n},e.prototype.getBoneIndexByName=function(e){for(var n=0,t=this.bones.length;n<t;n++)if(this.bones[n].name===e)return n;return-1},e.prototype.createAnimationRange=function(e,n,t){if(!this._ranges[e]){this._ranges[e]=new N(e,n,t);for(var i=0,r=this.bones.length;i<r;i++)this.bones[i].animations[0]&&this.bones[i].animations[0].createRange(e,n,t)}},e.prototype.deleteAnimationRange=function(e,n){void 0===n&&(n=!0);for(var t=0,i=this.bones.length;t<i;t++)this.bones[t].animations[0]&&this.bones[t].animations[0].deleteRange(e,n);this._ranges[e]=null},e.prototype.getAnimationRange=function(e){return this._ranges[e]||null},e.prototype.getAnimationRanges=function(){var e,n=[];for(e in this._ranges)n.push(this._ranges[e]);return n},e.prototype.copyAnimationRange=function(e,n,t){if(void 0===t&&(t=!1),this._ranges[n]||!e.getAnimationRange(n))return!1;var i,r,o=!0,a=this._getHighestAnimationFrame()+1,s={},l=e.bones;for(r=0,i=l.length;r<i;r++)s[l[r].name]=l[r];this.bones.length!==l.length&&(this.bones.length,l.length,o=!1);var c=t&&this.dimensionsAtRest&&e.dimensionsAtRest?this.dimensionsAtRest.divide(e.dimensionsAtRest):null;for(r=0,i=this.bones.length;r<i;r++){var f=this.bones[r].name,u=s[f];o=!!u&&(o&&this.bones[r].copyAnimationRange(u,n,a,t,c))}var d=e.getAnimationRange(n);return d&&(this._ranges[n]=new N(n,d.from+a,d.to+a)),o},e.prototype.returnToRest=function(){for(var e=S.Vector3[0],n=S.Quaternion[0],t=S.Vector3[1],i=0;i<this.bones.length;i++){var r=this.bones[i];-1!==r._index&&(r.returnToRest(),r._linkedTransformNode&&(r.getRestPose().decompose(e,n,t),r._linkedTransformNode.position=t.clone(),r._linkedTransformNode.rotationQuaternion=n.clone(),r._linkedTransformNode.scaling=e.clone()))}},e.prototype._getHighestAnimationFrame=function(){for(var e=0,n=0,t=this.bones.length;n<t;n++)if(this.bones[n].animations[0]){var i=this.bones[n].animations[0].getHighestFrame();e<i&&(e=i)}return e},e.prototype.beginAnimation=function(e,n,t,i){var r=this.getAnimationRange(e);return r?this._scene.beginAnimation(this,r.from,r.to,n,t,i):null},e.MakeAnimationAdditive=function(e,n,t){void 0===n&&(n=0);var i=e.getAnimationRange(t);if(!i)return null;for(var r=e._scene.getAllAnimatablesByTarget(e),o=null,a=0;a<r.length;a++){var s=r[a];if(s.fromFrame===(null==i?void 0:i.from)&&s.toFrame===(null==i?void 0:i.to)){o=s;break}}var l=e.getAnimatables();for(a=0;a<l.length;a++){var c=l[a].animations;if(c)for(var f=0;f<c.length;f++)_.MakeAnimationAdditive(c[f],n,t)}return o&&(o.isAdditive=!0),e},e.prototype._markAsDirty=function(){this._isDirty=!0},e.prototype._registerMeshWithPoseMatrix=function(e){this._meshesWithPoseMatrix.push(e)},e.prototype._unregisterMeshWithPoseMatrix=function(e){var n=this._meshesWithPoseMatrix.indexOf(e);n>-1&&this._meshesWithPoseMatrix.splice(n,1)},e.prototype._computeTransformMatrices=function(e,n){this.onBeforeComputeObservable.notifyObservers(this);for(var t=0;t<this.bones.length;t++){var i=this.bones[t];i._childUpdateId++;var r=i.getParent();if(r?i.getLocalMatrix().multiplyToRef(r.getWorldMatrix(),i.getWorldMatrix()):n?i.getLocalMatrix().multiplyToRef(n,i.getWorldMatrix()):i.getWorldMatrix().copyFrom(i.getLocalMatrix()),-1!==i._index){var o=null===i._index?t:i._index;i.getInvertedAbsoluteTransform().multiplyToArray(i.getWorldMatrix(),e,16*o)}}this._identity.copyToArray(e,16*this.bones.length)},e.prototype.prepare=function(){if(this._numBonesWithLinkedTransformNode>0)for(var e=0,n=this.bones;e<n.length;e++){var t=n[e];t._linkedTransformNode&&(t._linkedTransformNode.computeWorldMatrix(),t._matrix=t._linkedTransformNode._localMatrix,t.markAsDirty())}if(this._isDirty){if(this.needInitialSkinMatrix)for(var i=0;i<this._meshesWithPoseMatrix.length;i++){var r=this._meshesWithPoseMatrix[i],o=r.getPoseMatrix();if(r._bonesTransformMatrices&&r._bonesTransformMatrices.length===16*(this.bones.length+1)||(r._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1))),this._synchronizedWithMesh!==r){this._synchronizedWithMesh=r;for(var a=0;a<this.bones.length;a++){var s=this.bones[a];if(!s.getParent())s.getBaseMatrix().multiplyToRef(o,S.Matrix[1]),s._updateDifferenceMatrix(S.Matrix[1])}if(this.isUsingTextureForMatrices){var l=4*(this.bones.length+1);r._transformMatrixTexture&&r._transformMatrixTexture.getSize().width===l||(r._transformMatrixTexture&&r._transformMatrixTexture.dispose(),r._transformMatrixTexture=He.CreateRGBATexture(r._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(r._bonesTransformMatrices,o),this.isUsingTextureForMatrices&&r._transformMatrixTexture&&r._transformMatrixTexture.update(r._bonesTransformMatrices)}else this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=He.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices);this._isDirty=!1,this._scene._activeBones.addCount(this.bones.length,!1)}},e.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(var e=0;e<this.bones.length;e++)this._animatables.push(this.bones[e])}return this._animatables},e.prototype.clone=function(n,t){var i=new e(n,t||n,this._scene);i.needInitialSkinMatrix=this.needInitialSkinMatrix,i.overrideMesh=this.overrideMesh;for(var r=0;r<this.bones.length;r++){var o=this.bones[r],a=null,s=o.getParent();if(s){var l=this.bones.indexOf(s);a=i.bones[l]}var c=new De(o.name,i,a,o.getBaseMatrix().clone(),o.getRestPose().clone());c._index=o._index,o._linkedTransformNode&&c.linkTransformNode(o._linkedTransformNode),P.DeepCopy(o.animations,c.animations)}if(this._ranges)for(var f in i._ranges={},this._ranges){var u=this._ranges[f];u&&(i._ranges[f]=u.clone())}return this._isDirty=!0,i},e.prototype.enableBlending=function(e){void 0===e&&(e=.01),this.bones.forEach((function(n){n.animations.forEach((function(n){n.enableBlending=!0,n.blendingSpeed=e}))}))},e.prototype.dispose=function(){this._meshesWithPoseMatrix=[],this.getScene().stopAnimation(this),this.getScene().removeSkeleton(this),this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)},e.prototype.serialize=function(){var e,n,t={};t.name=this.name,t.id=this.id,this.dimensionsAtRest&&(t.dimensionsAtRest=this.dimensionsAtRest.asArray()),t.bones=[],t.needInitialSkinMatrix=this.needInitialSkinMatrix,t.overrideMeshId=null===(e=this.overrideMesh)||void 0===e?void 0:e.id;for(var i=0;i<this.bones.length;i++){var r=this.bones[i],o=r.getParent(),a={parentBoneIndex:o?this.bones.indexOf(o):-1,index:r.getIndex(),name:r.name,matrix:r.getBaseMatrix().toArray(),rest:r.getRestPose().toArray(),linkedTransformNodeId:null===(n=r.getTransformNode())||void 0===n?void 0:n.id};for(var s in t.bones.push(a),r.length&&(a.length=r.length),r.metadata&&(a.metadata=r.metadata),r.animations&&r.animations.length>0&&(a.animation=r.animations[0].serialize()),t.ranges=[],this._ranges){var l=this._ranges[s];if(l){var c={};c.name=s,c.from=l.from,c.to=l.to,t.ranges.push(c)}}}return t},e.Parse=function(n,t){var i,o=new e(n.name,n.id,t);for(n.dimensionsAtRest&&(o.dimensionsAtRest=r.FromArray(n.dimensionsAtRest)),o.needInitialSkinMatrix=n.needInitialSkinMatrix,n.overrideMeshId&&(o._hasWaitingData=!0,o._waitingOverrideMeshId=n.overrideMeshId),i=0;i<n.bones.length;i++){var a=n.bones[i],s=n.bones[i].index,l=null;a.parentBoneIndex>-1&&(l=o.bones[a.parentBoneIndex]);var f=a.rest?c.FromArray(a.rest):null,u=new De(a.name,o,l,c.FromArray(a.matrix),f,null,s);void 0!==a.id&&null!==a.id&&(u.id=a.id),a.length&&(u.length=a.length),a.metadata&&(u.metadata=a.metadata),a.animation&&u.animations.push(_.Parse(a.animation)),void 0!==a.linkedTransformNodeId&&null!==a.linkedTransformNodeId&&(o._hasWaitingData=!0,u._waitingTransformNodeId=a.linkedTransformNodeId)}if(n.ranges)for(i=0;i<n.ranges.length;i++){var d=n.ranges[i];o.createAnimationRange(d.name,d.from,d.to)}return o},e.prototype.computeAbsoluteTransforms=function(e){void 0===e&&(e=!1);var n=this._scene.getRenderId();(this._lastAbsoluteTransformsUpdateId!=n||e)&&(this.bones[0].computeAbsoluteTransforms(),this._lastAbsoluteTransformsUpdateId=n)},e.prototype.getPoseMatrix=function(){var e=null;return this._meshesWithPoseMatrix.length>0&&(e=this._meshesWithPoseMatrix[0].getPoseMatrix()),e},e.prototype.sortBones=function(){for(var e=new Array,n=new Array(this.bones.length),t=0;t<this.bones.length;t++)this._sortBones(t,e,n);this.bones=e},e.prototype._sortBones=function(e,n,t){if(!t[e]){t[e]=!0;var i=this.bones[e];void 0===i._index&&(i._index=e);var r=i.getParent();r&&this._sortBones(this.bones.indexOf(r),n,t),n.push(i)}},e.prototype.setCurrentPoseAsRest=function(){this.bones.forEach((function(e){e.setCurrentPoseAsRest()}))},e}();x.ShadersStore.rgbdDecodePixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<helperFunctions>\nvoid main(void)\n{\ngl_FragColor=vec4(fromRGBD(texture2D(textureSampler,vUV)),1.0);\n}";var Xe=function(){function e(){}return e.ExpandRGBDTexture=function(e){var n=e._texture;if(n&&e.isRGBD){var t=n.getEngine(),i=t.getCaps(),r=!1;i.textureHalfFloatRender&&i.textureHalfFloatLinearFiltering?(r=!0,n.type=2):i.textureFloatRender&&i.textureFloatLinearFiltering&&(r=!0,n.type=1),r&&(n.isReady=!1,n._isRGBD=!1,n.invertY=!1),e.onLoadObservable.addOnce((function(){if(r){var i=new fe("rgbdDecode","rgbdDecode",null,null,1,null,3,t,!1,void 0,n.type,void 0,null,!1),o=t.createRenderTargetTexture(n.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:n.samplingMode,type:n.type,format:5});i.getEffect().executeWhenCompiled((function(){i.onApply=function(e){e._bindTexture("textureSampler",n),e.setFloat2("scale",1,1)},e.getScene().postProcessManager.directRender([i],o,!0),t.restoreDefaultFramebuffer(),t._releaseTexture(n),t._releaseFramebufferObjects(o),i&&i.dispose(),o._swapAndDie(n),n.isReady=!0}))}}))}},e}(),Ye=function(){function e(){}return e.GetEnvironmentBRDFTexture=function(e){if(!e.environmentBRDFTexture){var n=e.useDelayedTextureLoading;e.useDelayedTextureLoading=!1;var t=e._blockEntityCollection;e._blockEntityCollection=!1;var i=ce.CreateFromBase64String(this._environmentBRDFBase64Texture,"EnvironmentBRDFTexture"+this._instanceNumber++,e,!0,!1,ce.BILINEAR_SAMPLINGMODE);e._blockEntityCollection=t;var r=e.getEngine().getLoadedTexturesCache(),o=r.indexOf(i.getInternalTexture());-1!==o&&r.splice(o,1),i.isRGBD=!0,i.wrapU=ce.CLAMP_ADDRESSMODE,i.wrapV=ce.CLAMP_ADDRESSMODE,e.environmentBRDFTexture=i,e.useDelayedTextureLoading=n,Xe.ExpandRGBDTexture(i)}return e.environmentBRDFTexture},e._instanceNumber=0,e._environmentBRDFBase64Texture="data:image/png;base64,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",e}(),We=function(){function t(e){this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.roughness=0,this._indexOfRefraction=t._DefaultIndexOfRefraction,this.indexOfRefraction=t._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=E.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=e}return t.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},t.prototype.isReadyForSubMesh=function(e,n,t,i){if(e._areTexturesDirty&&n.texturesEnabled){if(this._texture&&ue.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&ue.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(t.getCaps().standardDerivatives&&this._bumpTexture&&ue.ClearCoatBumpTextureEnabled&&!i&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&ue.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0},t.prototype.prepareDefines=function(e,n){var i;this._isEnabled?(e.CLEARCOAT=!0,e.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,e.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=null!==this._texture&&this._texture._texture===(null===(i=this._textureRoughness)||void 0===i?void 0:i._texture)&&this._texture.checkTransformsAreIdentical(this._textureRoughness),e.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,e._areTexturesDirty&&n.texturesEnabled&&(this._texture&&ue.ClearCoatTextureEnabled?de.PrepareDefinesForMergedUV(this._texture,e,"CLEARCOAT_TEXTURE"):e.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&ue.ClearCoatTextureEnabled?de.PrepareDefinesForMergedUV(this._textureRoughness,e,"CLEARCOAT_TEXTURE_ROUGHNESS"):e.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&ue.ClearCoatBumpTextureEnabled?de.PrepareDefinesForMergedUV(this._bumpTexture,e,"CLEARCOAT_BUMP"):e.CLEARCOAT_BUMP=!1,e.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===t._DefaultIndexOfRefraction,this._isTintEnabled?(e.CLEARCOAT_TINT=!0,this._tintTexture&&ue.ClearCoatTintTextureEnabled?de.PrepareDefinesForMergedUV(this._tintTexture,e,"CLEARCOAT_TINT_TEXTURE"):e.CLEARCOAT_TINT_TEXTURE=!1):(e.CLEARCOAT_TINT=!1,e.CLEARCOAT_TINT_TEXTURE=!1))):(e.CLEARCOAT=!1,e.CLEARCOAT_TEXTURE=!1,e.CLEARCOAT_TEXTURE_ROUGHNESS=!1,e.CLEARCOAT_BUMP=!1,e.CLEARCOAT_TINT=!1,e.CLEARCOAT_TINT_TEXTURE=!1,e.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,e.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=!1)},t.prototype.bindForSubMesh=function(e,n,t,i,r,o,a,s){var l,c,f,u,d,h,p,m,v=s._materialDefines,A=v.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL;if(!e.useUbo||!r||!e.isSync){A&&ue.ClearCoatTextureEnabled?(e.updateFloat4("vClearCoatInfos",this._texture.coordinatesIndex,this._texture.level,-1,-1),de.BindTextureMatrix(this._texture,e,"clearCoat")):(this._texture||this._textureRoughness)&&ue.ClearCoatTextureEnabled&&(e.updateFloat4("vClearCoatInfos",null!==(c=null===(l=this._texture)||void 0===l?void 0:l.coordinatesIndex)&&void 0!==c?c:0,null!==(u=null===(f=this._texture)||void 0===f?void 0:f.level)&&void 0!==u?u:0,null!==(h=null===(d=this._textureRoughness)||void 0===d?void 0:d.coordinatesIndex)&&void 0!==h?h:0,null!==(m=null===(p=this._textureRoughness)||void 0===p?void 0:p.level)&&void 0!==m?m:0),this._texture&&de.BindTextureMatrix(this._texture,e,"clearCoat"),!this._textureRoughness||A||v.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE||de.BindTextureMatrix(this._textureRoughness,e,"clearCoatRoughness")),this._bumpTexture&&t.getCaps().standardDerivatives&&ue.ClearCoatTextureEnabled&&!i&&(e.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),de.BindTextureMatrix(this._bumpTexture,e,"clearCoatBump"),n._mirroredCameraPosition?e.updateFloat2("vClearCoatTangentSpaceParams",o?1:-1,a?1:-1):e.updateFloat2("vClearCoatTangentSpaceParams",o?-1:1,a?-1:1)),this._tintTexture&&ue.ClearCoatTintTextureEnabled&&(e.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),de.BindTextureMatrix(this._tintTexture,e,"clearCoatTint")),e.updateFloat2("vClearCoatParams",this.intensity,this.roughness);var E=1-this._indexOfRefraction,_=1+this._indexOfRefraction,g=Math.pow(-E/_,2),T=1/this._indexOfRefraction;e.updateFloat4("vClearCoatRefractionParams",g,T,E,_),this._isTintEnabled&&(e.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),e.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}n.texturesEnabled&&(this._texture&&ue.ClearCoatTextureEnabled&&e.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!A&&!v.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&ue.ClearCoatTextureEnabled&&e.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&t.getCaps().standardDerivatives&&ue.ClearCoatBumpTextureEnabled&&!i&&e.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&ue.ClearCoatTintTextureEnabled&&e.setTexture("clearCoatTintSampler",this._tintTexture))},t.prototype.hasTexture=function(e){return this._texture===e||(this._textureRoughness===e||(this._bumpTexture===e||this._tintTexture===e))},t.prototype.getActiveTextures=function(e){this._texture&&e.push(this._texture),this._textureRoughness&&e.push(this._textureRoughness),this._bumpTexture&&e.push(this._bumpTexture),this._tintTexture&&e.push(this._tintTexture)},t.prototype.getAnimatables=function(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&e.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&e.push(this._tintTexture)},t.prototype.dispose=function(e){var n,t,i,r;e&&(null===(n=this._texture)||void 0===n||n.dispose(),null===(t=this._textureRoughness)||void 0===t||t.dispose(),null===(i=this._bumpTexture)||void 0===i||i.dispose(),null===(r=this._tintTexture)||void 0===r||r.dispose())},t.prototype.getClassName=function(){return"PBRClearCoatConfiguration"},t.AddFallbacks=function(e,n,t){return e.CLEARCOAT_BUMP&&n.addFallback(t++,"CLEARCOAT_BUMP"),e.CLEARCOAT_TINT&&n.addFallback(t++,"CLEARCOAT_TINT"),e.CLEARCOAT&&n.addFallback(t++,"CLEARCOAT"),t},t.AddUniforms=function(e){e.push("vClearCoatTangentSpaceParams","vClearCoatParams","vClearCoatRefractionParams","vClearCoatTintParams","clearCoatColorAtDistance","clearCoatMatrix","clearCoatRoughnessMatrix","clearCoatBumpMatrix","clearCoatTintMatrix","vClearCoatInfos","vClearCoatBumpInfos","vClearCoatTintInfos")},t.AddSamplers=function(e){e.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")},t.PrepareUniformBuffer=function(e){e.addUniform("vClearCoatParams",2),e.addUniform("vClearCoatRefractionParams",4),e.addUniform("vClearCoatInfos",4),e.addUniform("clearCoatMatrix",16),e.addUniform("clearCoatRoughnessMatrix",16),e.addUniform("vClearCoatBumpInfos",2),e.addUniform("vClearCoatTangentSpaceParams",2),e.addUniform("clearCoatBumpMatrix",16),e.addUniform("vClearCoatTintParams",4),e.addUniform("clearCoatColorAtDistance",1),e.addUniform("vClearCoatTintInfos",2),e.addUniform("clearCoatTintMatrix",16)},t.prototype.copyTo=function(e){B.Clone((function(){return e}),this)},t.prototype.serialize=function(){return B.Serialize(this)},t.prototype.parse=function(e,n,t){var i=this;B.Parse((function(){return i}),e,n,t)},t._DefaultIndexOfRefraction=1.5,e([n(),D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"isEnabled",void 0),e([n()],t.prototype,"intensity",void 0),e([n()],t.prototype,"roughness",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"indexOfRefraction",void 0),e([F(),D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"texture",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRoughnessFromMainTexture",void 0),e([F(),D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"textureRoughness",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"remapF0OnInterfaceChange",void 0),e([F(),D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"bumpTexture",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"isTintEnabled",void 0),e([U()],t.prototype,"tintColor",void 0),e([n()],t.prototype,"tintColorAtDistance",void 0),e([n()],t.prototype,"tintThickness",void 0),e([F(),D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"tintTexture",void 0),t}(),ze=function(){function t(e){this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.direction=new d(1,0),this._texture=null,this.texture=null,this._internalMarkAllSubMeshesAsTexturesDirty=e}return t.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},t.prototype.isReadyForSubMesh=function(e,n){return!(e._areTexturesDirty&&n.texturesEnabled&&this._texture&&ue.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())},t.prototype.prepareDefines=function(e,n,t){this._isEnabled?(e.ANISOTROPIC=this._isEnabled,this._isEnabled&&!n.isVerticesDataPresent(V.TangentKind)&&(e._needUVs=!0,e.MAINUV1=!0),e._areTexturesDirty&&t.texturesEnabled&&(this._texture&&ue.AnisotropicTextureEnabled?de.PrepareDefinesForMergedUV(this._texture,e,"ANISOTROPIC_TEXTURE"):e.ANISOTROPIC_TEXTURE=!1)):(e.ANISOTROPIC=!1,e.ANISOTROPIC_TEXTURE=!1)},t.prototype.bindForSubMesh=function(e,n,t){e.useUbo&&t&&e.isSync||(this._texture&&ue.AnisotropicTextureEnabled&&(e.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),de.BindTextureMatrix(this._texture,e,"anisotropy")),e.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.intensity)),n.texturesEnabled&&this._texture&&ue.AnisotropicTextureEnabled&&e.setTexture("anisotropySampler",this._texture)},t.prototype.hasTexture=function(e){return this._texture===e},t.prototype.getActiveTextures=function(e){this._texture&&e.push(this._texture)},t.prototype.getAnimatables=function(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture)},t.prototype.dispose=function(e){e&&this._texture&&this._texture.dispose()},t.prototype.getClassName=function(){return"PBRAnisotropicConfiguration"},t.AddFallbacks=function(e,n,t){return e.ANISOTROPIC&&n.addFallback(t++,"ANISOTROPIC"),t},t.AddUniforms=function(e){e.push("vAnisotropy","vAnisotropyInfos","anisotropyMatrix")},t.PrepareUniformBuffer=function(e){e.addUniform("vAnisotropy",3),e.addUniform("vAnisotropyInfos",2),e.addUniform("anisotropyMatrix",16)},t.AddSamplers=function(e){e.push("anisotropySampler")},t.prototype.copyTo=function(e){B.Clone((function(){return e}),this)},t.prototype.serialize=function(){return B.Serialize(this)},t.prototype.parse=function(e,n,t){var i=this;B.Parse((function(){return i}),e,n,t)},e([n(),D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"isEnabled",void 0),e([n()],t.prototype,"intensity",void 0),e([w()],t.prototype,"direction",void 0),e([F(),D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"texture",void 0),t}(),Qe=function(){function t(e){this._useEnergyConservation=t.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=t.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=t.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=t.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=t.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=t.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=t.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=t.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=e}return t.prototype._markAllSubMeshesAsMiscDirty=function(){this._internalMarkAllSubMeshesAsMiscDirty()},t.prototype.prepareDefines=function(e){e.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,e.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,e.SPHERICAL_HARMONICS=this._useSphericalHarmonics,e.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation},t.prototype.getClassName=function(){return"PBRBRDFConfiguration"},t.prototype.copyTo=function(e){B.Clone((function(){return e}),this)},t.prototype.serialize=function(){return B.Serialize(this)},t.prototype.parse=function(e,n,t){var i=this;B.Parse((function(){return i}),e,n,t)},t.DEFAULT_USE_ENERGY_CONSERVATION=!0,t.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,t.DEFAULT_USE_SPHERICAL_HARMONICS=!0,t.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,e([n(),D("_markAllSubMeshesAsMiscDirty")],t.prototype,"useEnergyConservation",void 0),e([n(),D("_markAllSubMeshesAsMiscDirty")],t.prototype,"useSmithVisibilityHeightCorrelated",void 0),e([n(),D("_markAllSubMeshesAsMiscDirty")],t.prototype,"useSphericalHarmonics",void 0),e([n(),D("_markAllSubMeshesAsMiscDirty")],t.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),t}(),Ke=function(){function t(e){this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.intensity=1,this.color=E.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=e}return t.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},t.prototype.isReadyForSubMesh=function(e,n){if(e._areTexturesDirty&&n.texturesEnabled){if(this._texture&&ue.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&ue.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0},t.prototype.prepareDefines=function(e,n){var t;this._isEnabled?(e.SHEEN=this._isEnabled,e.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,e.SHEEN_ROUGHNESS=null!==this._roughness,e.SHEEN_ALBEDOSCALING=this._albedoScaling,e.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,e.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=null!==this._texture&&this._texture._texture===(null===(t=this._textureRoughness)||void 0===t?void 0:t._texture)&&this._texture.checkTransformsAreIdentical(this._textureRoughness),e._areTexturesDirty&&n.texturesEnabled&&(this._texture&&ue.SheenTextureEnabled?de.PrepareDefinesForMergedUV(this._texture,e,"SHEEN_TEXTURE"):e.SHEEN_TEXTURE=!1,this._textureRoughness&&ue.SheenTextureEnabled?de.PrepareDefinesForMergedUV(this._textureRoughness,e,"SHEEN_TEXTURE_ROUGHNESS"):e.SHEEN_TEXTURE_ROUGHNESS=!1)):(e.SHEEN=!1,e.SHEEN_TEXTURE=!1,e.SHEEN_TEXTURE_ROUGHNESS=!1,e.SHEEN_LINKWITHALBEDO=!1,e.SHEEN_ROUGHNESS=!1,e.SHEEN_ALBEDOSCALING=!1,e.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,e.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=!1)},t.prototype.bindForSubMesh=function(e,n,t,i){var r,o,a,s,l,c,f,u,d=i._materialDefines,h=d.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL;e.useUbo&&t&&e.isSync||(h&&ue.SheenTextureEnabled?(e.updateFloat4("vSheenInfos",this._texture.coordinatesIndex,this._texture.level,-1,-1),de.BindTextureMatrix(this._texture,e,"sheen")):(this._texture||this._textureRoughness)&&ue.SheenTextureEnabled&&(e.updateFloat4("vSheenInfos",null!==(o=null===(r=this._texture)||void 0===r?void 0:r.coordinatesIndex)&&void 0!==o?o:0,null!==(s=null===(a=this._texture)||void 0===a?void 0:a.level)&&void 0!==s?s:0,null!==(c=null===(l=this._textureRoughness)||void 0===l?void 0:l.coordinatesIndex)&&void 0!==c?c:0,null!==(u=null===(f=this._textureRoughness)||void 0===f?void 0:f.level)&&void 0!==u?u:0),this._texture&&de.BindTextureMatrix(this._texture,e,"sheen"),!this._textureRoughness||h||d.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE||de.BindTextureMatrix(this._textureRoughness,e,"sheenRoughness")),e.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.intensity),null!==this._roughness&&e.updateFloat("vSheenRoughness",this._roughness)),n.texturesEnabled&&(this._texture&&ue.SheenTextureEnabled&&e.setTexture("sheenSampler",this._texture),this._textureRoughness&&!h&&!d.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&ue.SheenTextureEnabled&&e.setTexture("sheenRoughnessSampler",this._textureRoughness))},t.prototype.hasTexture=function(e){return this._texture===e||this._textureRoughness===e},t.prototype.getActiveTextures=function(e){this._texture&&e.push(this._texture),this._textureRoughness&&e.push(this._textureRoughness)},t.prototype.getAnimatables=function(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&e.push(this._textureRoughness)},t.prototype.dispose=function(e){var n,t;e&&(null===(n=this._texture)||void 0===n||n.dispose(),null===(t=this._textureRoughness)||void 0===t||t.dispose())},t.prototype.getClassName=function(){return"PBRSheenConfiguration"},t.AddFallbacks=function(e,n,t){return e.SHEEN&&n.addFallback(t++,"SHEEN"),t},t.AddUniforms=function(e){e.push("vSheenColor","vSheenRoughness","vSheenInfos","sheenMatrix","sheenRoughnessMatrix")},t.PrepareUniformBuffer=function(e){e.addUniform("vSheenColor",4),e.addUniform("vSheenRoughness",1),e.addUniform("vSheenInfos",4),e.addUniform("sheenMatrix",16),e.addUniform("sheenRoughnessMatrix",16)},t.AddSamplers=function(e){e.push("sheenSampler"),e.push("sheenRoughnessSampler")},t.prototype.copyTo=function(e){B.Clone((function(){return e}),this)},t.prototype.serialize=function(){return B.Serialize(this)},t.prototype.parse=function(e,n,t){var i=this;B.Parse((function(){return i}),e,n,t)},e([n(),D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"isEnabled",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"linkSheenWithAlbedo",void 0),e([n()],t.prototype,"intensity",void 0),e([U()],t.prototype,"color",void 0),e([F(),D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"texture",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRoughnessFromMainTexture",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"roughness",void 0),e([F(),D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"textureRoughness",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"albedoScaling",void 0),t}(),je=function(){function t(e,n,t){this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.tintColor=E.White(),this.tintColorAtDistance=1,this.diffusionDistance=E.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._useMaskFromThicknessTextureGltf=!1,this.useMaskFromThicknessTextureGltf=!1,this._internalMarkAllSubMeshesAsTexturesDirty=e,this._internalMarkScenePrePassDirty=n,this._scene=t}return Object.defineProperty(t.prototype,"scatteringDiffusionProfile",{get:function(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null},set:function(e){this._scene.enableSubSurfaceForPrePass()&&e&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"volumeIndexOfRefraction",{get:function(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction},set:function(e){this._volumeIndexOfRefraction=e>=1?e:-1},enumerable:!1,configurable:!0}),t.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},t.prototype._markScenePrePassDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()},t.prototype.isReadyForSubMesh=function(e,n){if(e._areTexturesDirty&&n.texturesEnabled){if(this._thicknessTexture&&ue.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;var t=this._getRefractionTexture(n);if(t&&ue.RefractionTextureEnabled&&!t.isReadyOrNotBlocking())return!1}return!0},t.prototype.prepareDefines=function(e,n){if(e._areTexturesDirty&&(e.SUBSURFACE=!1,e.SS_TRANSLUCENCY=this._isTranslucencyEnabled,e.SS_SCATTERING=this._isScatteringEnabled,e.SS_THICKNESSANDMASK_TEXTURE=!1,e.SS_MASK_FROM_THICKNESS_TEXTURE=!1,e.SS_MASK_FROM_THICKNESS_TEXTURE_GLTF=!1,e.SS_REFRACTION=!1,e.SS_REFRACTIONMAP_3D=!1,e.SS_GAMMAREFRACTION=!1,e.SS_RGBDREFRACTION=!1,e.SS_LINEARSPECULARREFRACTION=!1,e.SS_REFRACTIONMAP_OPPOSITEZ=!1,e.SS_LODINREFRACTIONALPHA=!1,e.SS_LINKREFRACTIONTOTRANSPARENCY=!1,e.SS_ALBEDOFORREFRACTIONTINT=!1,(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)&&(e.SUBSURFACE=!0,e._areTexturesDirty&&n.texturesEnabled&&this._thicknessTexture&&ue.ThicknessTextureEnabled&&de.PrepareDefinesForMergedUV(this._thicknessTexture,e,"SS_THICKNESSANDMASK_TEXTURE"),e.SS_MASK_FROM_THICKNESS_TEXTURE=this._useMaskFromThicknessTexture,e.SS_MASK_FROM_THICKNESS_TEXTURE_GLTF=this._useMaskFromThicknessTextureGltf),this._isRefractionEnabled&&n.texturesEnabled)){var t=this._getRefractionTexture(n);t&&ue.RefractionTextureEnabled&&(e.SS_REFRACTION=!0,e.SS_REFRACTIONMAP_3D=t.isCube,e.SS_GAMMAREFRACTION=t.gammaSpace,e.SS_RGBDREFRACTION=t.isRGBD,e.SS_LINEARSPECULARREFRACTION=t.linearSpecularLOD,e.SS_REFRACTIONMAP_OPPOSITEZ=t.invertZ,e.SS_LODINREFRACTIONALPHA=t.lodLevelInAlpha,e.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,e.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction)}},t.prototype.bindForSubMesh=function(e,n,t,i,r,o){var a=this._getRefractionTexture(n);if(!e.useUbo||!i||!e.isSync){if(this._thicknessTexture&&ue.ThicknessTextureEnabled&&(e.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),de.BindTextureMatrix(this._thicknessTexture,e,"thickness")),e.updateFloat2("vThicknessParam",this.minimumThickness,this.maximumThickness-this.minimumThickness),a&&ue.RefractionTextureEnabled){e.updateMatrix("refractionMatrix",a.getReflectionTextureMatrix());var s=1;a.isCube||a.depth&&(s=a.depth);var l=a.getSize().width,c=this.volumeIndexOfRefraction;e.updateFloat4("vRefractionInfos",a.level,1/c,s,this._invertRefractionY?-1:1),e.updateFloat3("vRefractionMicrosurfaceInfos",l,a.lodGenerationScale,a.lodGenerationOffset),o&&e.updateFloat2("vRefractionFilteringInfo",l,G.Log2(l))}this.isScatteringEnabled&&e.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),e.updateColor3("vDiffusionDistance",this.diffusionDistance),e.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,this.tintColorAtDistance),e.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0)}n.texturesEnabled&&(this._thicknessTexture&&ue.ThicknessTextureEnabled&&e.setTexture("thicknessSampler",this._thicknessTexture),a&&ue.RefractionTextureEnabled&&(r?e.setTexture("refractionSampler",a):(e.setTexture("refractionSampler",a._lodTextureMid||a),e.setTexture("refractionSamplerLow",a._lodTextureLow||a),e.setTexture("refractionSamplerHigh",a._lodTextureHigh||a))))},t.prototype.unbind=function(e){return!(!this._refractionTexture||!this._refractionTexture.isRenderTarget)&&(e.setTexture("refractionSampler",null),!0)},t.prototype._getRefractionTexture=function(e){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?e.environmentTexture:null},Object.defineProperty(t.prototype,"disableAlphaBlending",{get:function(){return this.isRefractionEnabled&&this._linkRefractionWithTransparency},enumerable:!1,configurable:!0}),t.prototype.fillRenderTargetTextures=function(e){ue.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&e.push(this._refractionTexture)},t.prototype.hasTexture=function(e){return this._thicknessTexture===e||this._refractionTexture===e},t.prototype.hasRenderTargetTextures=function(){return!!(ue.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},t.prototype.getActiveTextures=function(e){this._thicknessTexture&&e.push(this._thicknessTexture),this._refractionTexture&&e.push(this._refractionTexture)},t.prototype.getAnimatables=function(e){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&e.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture)},t.prototype.dispose=function(e){e&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose())},t.prototype.getClassName=function(){return"PBRSubSurfaceConfiguration"},t.AddFallbacks=function(e,n,t){return e.SS_SCATTERING&&n.addFallback(t++,"SS_SCATTERING"),e.SS_TRANSLUCENCY&&n.addFallback(t++,"SS_TRANSLUCENCY"),t},t.AddUniforms=function(e){e.push("vDiffusionDistance","vTintColor","vSubSurfaceIntensity","vRefractionMicrosurfaceInfos","vRefractionFilteringInfo","vRefractionInfos","vThicknessInfos","vThicknessParam","refractionMatrix","thicknessMatrix","scatteringDiffusionProfile")},t.AddSamplers=function(e){e.push("thicknessSampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh")},t.PrepareUniformBuffer=function(e){e.addUniform("vRefractionMicrosurfaceInfos",3),e.addUniform("vRefractionFilteringInfo",2),e.addUniform("vRefractionInfos",4),e.addUniform("refractionMatrix",16),e.addUniform("vThicknessInfos",2),e.addUniform("thicknessMatrix",16),e.addUniform("vThicknessParam",2),e.addUniform("vDiffusionDistance",3),e.addUniform("vTintColor",4),e.addUniform("vSubSurfaceIntensity",3),e.addUniform("scatteringDiffusionProfile",1)},t.prototype.copyTo=function(e){B.Clone((function(){return e}),this)},t.prototype.serialize=function(){return B.Serialize(this)},t.prototype.parse=function(e,n,t){var i=this;B.Parse((function(){return i}),e,n,t)},e([n(),D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"isRefractionEnabled",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"isTranslucencyEnabled",void 0),e([n(),D("_markScenePrePassDirty")],t.prototype,"isScatteringEnabled",void 0),e([n()],t.prototype,"_scatteringDiffusionProfileIndex",void 0),e([n()],t.prototype,"refractionIntensity",void 0),e([n()],t.prototype,"translucencyIntensity",void 0),e([n()],t.prototype,"useAlbedoToTintRefraction",void 0),e([F(),D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"thicknessTexture",void 0),e([F(),D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"refractionTexture",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"indexOfRefraction",void 0),e([n()],t.prototype,"_volumeIndexOfRefraction",void 0),e([D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"volumeIndexOfRefraction",null),e([n(),D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertRefractionY",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"linkRefractionWithTransparency",void 0),e([n()],t.prototype,"minimumThickness",void 0),e([n()],t.prototype,"maximumThickness",void 0),e([U()],t.prototype,"tintColor",void 0),e([n()],t.prototype,"tintColorAtDistance",void 0),e([U()],t.prototype,"diffusionDistance",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useMaskFromThicknessTexture",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useMaskFromThicknessTextureGltf",void 0),t}(),qe=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],Ze=[function(e){return 1},function(e){return e.y},function(e){return e.z},function(e){return e.x},function(e){return e.x*e.y},function(e){return e.y*e.z},function(e){return 3*e.z*e.z-1},function(e){return e.x*e.z},function(e){return e.x*e.x-e.y*e.y}],Je=function(e,n){return qe[e]*Ze[e](n)},$e=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4],en=function(){function e(){this.preScaled=!1,this.l00=r.Zero(),this.l1_1=r.Zero(),this.l10=r.Zero(),this.l11=r.Zero(),this.l2_2=r.Zero(),this.l2_1=r.Zero(),this.l20=r.Zero(),this.l21=r.Zero(),this.l22=r.Zero()}return e.prototype.addLight=function(e,n,t){var i=new r(n.r,n.g,n.b).scale(t);this.l00=this.l00.add(i.scale(Je(0,e))),this.l1_1=this.l1_1.add(i.scale(Je(1,e))),this.l10=this.l10.add(i.scale(Je(2,e))),this.l11=this.l11.add(i.scale(Je(3,e))),this.l2_2=this.l2_2.add(i.scale(Je(4,e))),this.l2_1=this.l2_1.add(i.scale(Je(5,e))),this.l20=this.l20.add(i.scale(Je(6,e))),this.l21=this.l21.add(i.scale(Je(7,e))),this.l22=this.l22.add(i.scale(Je(8,e)))},e.prototype.scaleInPlace=function(e){this.l00.scaleInPlace(e),this.l1_1.scaleInPlace(e),this.l10.scaleInPlace(e),this.l11.scaleInPlace(e),this.l2_2.scaleInPlace(e),this.l2_1.scaleInPlace(e),this.l20.scaleInPlace(e),this.l21.scaleInPlace(e),this.l22.scaleInPlace(e)},e.prototype.convertIncidentRadianceToIrradiance=function(){this.l00.scaleInPlace($e[0]),this.l1_1.scaleInPlace($e[1]),this.l10.scaleInPlace($e[2]),this.l11.scaleInPlace($e[3]),this.l2_2.scaleInPlace($e[4]),this.l2_1.scaleInPlace($e[5]),this.l20.scaleInPlace($e[6]),this.l21.scaleInPlace($e[7]),this.l22.scaleInPlace($e[8])},e.prototype.convertIrradianceToLambertianRadiance=function(){this.scaleInPlace(1/Math.PI)},e.prototype.preScaleForRendering=function(){this.preScaled=!0,this.l00.scaleInPlace(qe[0]),this.l1_1.scaleInPlace(qe[1]),this.l10.scaleInPlace(qe[2]),this.l11.scaleInPlace(qe[3]),this.l2_2.scaleInPlace(qe[4]),this.l2_1.scaleInPlace(qe[5]),this.l20.scaleInPlace(qe[6]),this.l21.scaleInPlace(qe[7]),this.l22.scaleInPlace(qe[8])},e.FromArray=function(n){var t=new e;return r.FromArrayToRef(n[0],0,t.l00),r.FromArrayToRef(n[1],0,t.l1_1),r.FromArrayToRef(n[2],0,t.l10),r.FromArrayToRef(n[3],0,t.l11),r.FromArrayToRef(n[4],0,t.l2_2),r.FromArrayToRef(n[5],0,t.l2_1),r.FromArrayToRef(n[6],0,t.l20),r.FromArrayToRef(n[7],0,t.l21),r.FromArrayToRef(n[8],0,t.l22),t},e.FromPolynomial=function(n){var t=new e;return t.l00=n.xx.scale(.376127).add(n.yy.scale(.376127)).add(n.zz.scale(.376126)),t.l1_1=n.y.scale(.977204),t.l10=n.z.scale(.977204),t.l11=n.x.scale(.977204),t.l2_2=n.xy.scale(1.16538),t.l2_1=n.yz.scale(1.16538),t.l20=n.zz.scale(1.34567).subtract(n.xx.scale(.672834)).subtract(n.yy.scale(.672834)),t.l21=n.zx.scale(1.16538),t.l22=n.xx.scale(1.16538).subtract(n.yy.scale(1.16538)),t.l1_1.scaleInPlace(-1),t.l11.scaleInPlace(-1),t.l2_1.scaleInPlace(-1),t.l21.scaleInPlace(-1),t.scaleInPlace(Math.PI),t},e}(),nn=function(){function e(){this.x=r.Zero(),this.y=r.Zero(),this.z=r.Zero(),this.xx=r.Zero(),this.yy=r.Zero(),this.zz=r.Zero(),this.xy=r.Zero(),this.yz=r.Zero(),this.zx=r.Zero()}return Object.defineProperty(e.prototype,"preScaledHarmonics",{get:function(){return this._harmonics||(this._harmonics=en.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics},enumerable:!1,configurable:!0}),e.prototype.addAmbient=function(e){var n=new r(e.r,e.g,e.b);this.xx=this.xx.add(n),this.yy=this.yy.add(n),this.zz=this.zz.add(n)},e.prototype.scaleInPlace=function(e){this.x.scaleInPlace(e),this.y.scaleInPlace(e),this.z.scaleInPlace(e),this.xx.scaleInPlace(e),this.yy.scaleInPlace(e),this.zz.scaleInPlace(e),this.yz.scaleInPlace(e),this.zx.scaleInPlace(e),this.xy.scaleInPlace(e)},e.FromHarmonics=function(n){var t=new e;return t._harmonics=n,t.x=n.l11.scale(1.02333).scale(-1),t.y=n.l1_1.scale(1.02333).scale(-1),t.z=n.l10.scale(1.02333),t.xx=n.l00.scale(.886277).subtract(n.l20.scale(.247708)).add(n.l22.scale(.429043)),t.yy=n.l00.scale(.886277).subtract(n.l20.scale(.247708)).subtract(n.l22.scale(.429043)),t.zz=n.l00.scale(.886277).add(n.l20.scale(.495417)),t.yz=n.l2_1.scale(.858086).scale(-1),t.zx=n.l21.scale(.858086).scale(-1),t.xy=n.l2_2.scale(.858086),t.scaleInPlace(1/Math.PI),t},e.FromArray=function(n){var t=new e;return r.FromArrayToRef(n[0],0,t.x),r.FromArrayToRef(n[1],0,t.y),r.FromArrayToRef(n[2],0,t.z),r.FromArrayToRef(n[3],0,t.xx),r.FromArrayToRef(n[4],0,t.yy),r.FromArrayToRef(n[5],0,t.zz),r.FromArrayToRef(n[6],0,t.yz),r.FromArrayToRef(n[7],0,t.zx),r.FromArrayToRef(n[8],0,t.xy),t},e}(),tn=function(e,n,t,i){this.name=e,this.worldAxisForNormal=n,this.worldAxisForFileX=t,this.worldAxisForFileY=i},rn=function(){function e(){}return e.ConvertCubeMapTextureToSphericalPolynomial=function(e){if(!e.isCube)return null;var n,t,i=e.getSize().width,r=e.readPixels(0),o=e.readPixels(1);e.isRenderTarget?(n=e.readPixels(3),t=e.readPixels(2)):(n=e.readPixels(2),t=e.readPixels(3));var a=e.readPixels(4),s=e.readPixels(5),l=e.gammaSpace,c=0;1!=e.textureType&&2!=e.textureType||(c=1);var f={size:i,right:r,left:o,up:n,down:t,front:a,back:s,format:5,type:c,gammaSpace:l};return this.ConvertCubeMapToSphericalPolynomial(f)},e.ConvertCubeMapToSphericalPolynomial=function(e){for(var n=new en,t=0,i=2/e.size,r=i,o=.5*i-1,a=0;a<6;a++)for(var s=this.FileFaces[a],l=e[s.name],c=o,f=5===e.format?4:3,u=0;u<e.size;u++){for(var d=o,h=0;h<e.size;h++){var p=s.worldAxisForFileX.scale(d).add(s.worldAxisForFileY.scale(c)).add(s.worldAxisForNormal);p.normalize();var m=Math.pow(1+d*d+c*c,-1.5),v=l[u*e.size*f+h*f+0],A=l[u*e.size*f+h*f+1],_=l[u*e.size*f+h*f+2];isNaN(v)&&(v=0),isNaN(A)&&(A=0),isNaN(_)&&(_=0),0===e.type&&(v/=255,A/=255,_/=255),e.gammaSpace&&(v=Math.pow(G.Clamp(v),H),A=Math.pow(G.Clamp(A),H),_=Math.pow(G.Clamp(_),H));var g=4096;v=G.Clamp(v,0,g),A=G.Clamp(A,0,g),_=G.Clamp(_,0,g);var T=new E(v,A,_);n.addLight(p,T,m),t+=m,d+=i}c+=r}var R=6*(4*Math.PI)/6/t;return n.scaleInPlace(R),n.convertIncidentRadianceToIrradiance(),n.convertIrradianceToLambertianRadiance(),nn.FromHarmonics(n)},e.FileFaces=[new tn("right",new r(1,0,0),new r(0,0,-1),new r(0,-1,0)),new tn("left",new r(-1,0,0),new r(0,0,1),new r(0,-1,0)),new tn("up",new r(0,1,0),new r(1,0,0),new r(0,0,1)),new tn("down",new r(0,-1,0),new r(1,0,0),new r(0,0,-1)),new tn("front",new r(0,0,1),new r(1,0,0),new r(0,-1,0)),new tn("back",new r(0,0,-1),new r(-1,0,0),new r(0,-1,0))],e}();Object.defineProperty(he.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomial=rn.ConvertCubeMapTextureToSphericalPolynomial(this),this._texture._sphericalPolynomial}return null},set:function(e){this._texture&&(this._texture._sphericalPolynomial=e)},enumerable:!0,configurable:!0});x.IncludesShadersStore.pbrFragmentDeclaration="uniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\n\nuniform vec4 vLightingIntensity;\nuniform vec4 vReflectivityColor;\nuniform vec4 vMetallicReflectanceFactors;\nuniform vec3 vEmissiveColor;\nuniform float visibility;\n\n#ifdef ALBEDO\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform vec4 vAmbientInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#ifdef OPACITY\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef REFLECTIVITY\nuniform vec3 vReflectivityInfos;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\n#endif\n\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(SS_REFRACTION)\nuniform mat4 view;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#ifdef REALTIME_FILTERING\nuniform vec2 vReflectionFilteringInfo;\n#endif\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize;\n#endif\n#endif\n\n#ifdef CLEARCOAT\nuniform vec2 vClearCoatParams;\nuniform vec4 vClearCoatRefractionParams;\n#if defined(CLEARCOAT_TEXTURE) || defined(CLEARCOAT_TEXTURE_ROUGHNESS)\nuniform vec4 vClearCoatInfos;\n#endif\n#ifdef CLEARCOAT_TEXTURE\nuniform mat4 clearCoatMatrix;\n#endif\n#ifdef CLEARCOAT_TEXTURE_ROUGHNESS\nuniform mat4 clearCoatRoughnessMatrix;\n#endif\n#ifdef CLEARCOAT_BUMP\nuniform vec2 vClearCoatBumpInfos;\nuniform vec2 vClearCoatTangentSpaceParams;\nuniform mat4 clearCoatBumpMatrix;\n#endif\n#ifdef CLEARCOAT_TINT\nuniform vec4 vClearCoatTintParams;\nuniform float clearCoatColorAtDistance;\n#ifdef CLEARCOAT_TINT_TEXTURE\nuniform vec2 vClearCoatTintInfos;\nuniform mat4 clearCoatTintMatrix;\n#endif\n#endif\n#endif\n\n#ifdef ANISOTROPIC\nuniform vec3 vAnisotropy;\n#ifdef ANISOTROPIC_TEXTURE\nuniform vec2 vAnisotropyInfos;\nuniform mat4 anisotropyMatrix;\n#endif\n#endif\n\n#ifdef SHEEN\nuniform vec4 vSheenColor;\n#ifdef SHEEN_ROUGHNESS\nuniform float vSheenRoughness;\n#endif\n#if defined(SHEEN_TEXTURE) || defined(SHEEN_TEXTURE_ROUGHNESS)\nuniform vec4 vSheenInfos;\n#endif\n#ifdef SHEEN_TEXTURE\nuniform mat4 sheenMatrix;\n#endif\n#ifdef SHEEN_TEXTURE_ROUGHNESS\nuniform mat4 sheenRoughnessMatrix;\n#endif\n#endif\n\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\nuniform vec3 vRefractionMicrosurfaceInfos;\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\n#ifdef REALTIME_FILTERING\nuniform vec2 vRefractionFilteringInfo;\n#endif\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nuniform vec2 vThicknessInfos;\nuniform mat4 thicknessMatrix;\n#endif\nuniform vec2 vThicknessParam;\nuniform vec3 vDiffusionDistance;\nuniform vec4 vTintColor;\nuniform vec3 vSubSurfaceIntensity;\n#endif\n#ifdef PREPASS\n#ifdef PREPASS_IRRADIANCE\nuniform float scatteringDiffusionProfile;\n#endif\n#endif";x.IncludesShadersStore.pbrUboDeclaration="layout(std140,column_major) uniform;\nuniform Material\n{\nuniform vec2 vAlbedoInfos;\nuniform vec4 vAmbientInfos;\nuniform vec2 vOpacityInfos;\nuniform vec2 vEmissiveInfos;\nuniform vec2 vLightmapInfos;\nuniform vec3 vReflectivityInfos;\nuniform vec2 vMicroSurfaceSamplerInfos;\nuniform vec2 vReflectionInfos;\nuniform vec2 vReflectionFilteringInfo;\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize;\nuniform vec3 vBumpInfos;\nuniform mat4 albedoMatrix;\nuniform mat4 ambientMatrix;\nuniform mat4 opacityMatrix;\nuniform mat4 emissiveMatrix;\nuniform mat4 lightmapMatrix;\nuniform mat4 reflectivityMatrix;\nuniform mat4 microSurfaceSamplerMatrix;\nuniform mat4 bumpMatrix;\nuniform vec2 vTangentSpaceParams;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\nuniform vec4 vLightingIntensity;\nuniform vec3 vReflectionMicrosurfaceInfos;\nuniform float pointSize;\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\nuniform float visibility;\nuniform vec4 vMetallicReflectanceFactors;\nuniform vec2 vMetallicReflectanceInfos;\nuniform mat4 metallicReflectanceMatrix;\nuniform vec2 vClearCoatParams;\nuniform vec4 vClearCoatRefractionParams;\nuniform vec4 vClearCoatInfos;\nuniform mat4 clearCoatMatrix;\nuniform mat4 clearCoatRoughnessMatrix;\nuniform vec2 vClearCoatBumpInfos;\nuniform vec2 vClearCoatTangentSpaceParams;\nuniform mat4 clearCoatBumpMatrix;\nuniform vec4 vClearCoatTintParams;\nuniform float clearCoatColorAtDistance;\nuniform vec2 vClearCoatTintInfos;\nuniform mat4 clearCoatTintMatrix;\nuniform vec3 vAnisotropy;\nuniform vec2 vAnisotropyInfos;\nuniform mat4 anisotropyMatrix;\nuniform vec4 vSheenColor;\nuniform float vSheenRoughness;\nuniform vec4 vSheenInfos;\nuniform mat4 sheenMatrix;\nuniform mat4 sheenRoughnessMatrix;\nuniform vec3 vRefractionMicrosurfaceInfos;\nuniform vec2 vRefractionFilteringInfo;\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\nuniform vec2 vThicknessInfos;\nuniform mat4 thicknessMatrix;\nuniform vec2 vThicknessParam;\nuniform vec3 vDiffusionDistance;\nuniform vec4 vTintColor;\nuniform vec3 vSubSurfaceIntensity;\nuniform float scatteringDiffusionProfile;\nuniform vec4 vDetailInfos;\nuniform mat4 detailMatrix;\n};\nuniform Scene {\nmat4 viewProjection;\n#ifdef MULTIVIEW\nmat4 viewProjectionR;\n#endif\nmat4 view;\n};";x.IncludesShadersStore.pbrFragmentExtraDeclaration="uniform vec4 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vCameraInfos;\n\nvarying vec3 vPositionW;\n#if DEBUGMODE>0\nuniform vec2 vDebugMode;\nvarying vec4 vClipSpacePosition;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#endif\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif";x.IncludesShadersStore.pbrFragmentSamplersDeclaration="#ifdef ALBEDO\n#if ALBEDODIRECTUV == 1\n#define vAlbedoUV vMainUV1\n#elif ALBEDODIRECTUV == 2\n#define vAlbedoUV vMainUV2\n#else\nvarying vec2 vAlbedoUV;\n#endif\nuniform sampler2D albedoSampler;\n#endif\n#ifdef AMBIENT\n#if AMBIENTDIRECTUV == 1\n#define vAmbientUV vMainUV1\n#elif AMBIENTDIRECTUV == 2\n#define vAmbientUV vMainUV2\n#else\nvarying vec2 vAmbientUV;\n#endif\nuniform sampler2D ambientSampler;\n#endif\n#ifdef OPACITY\n#if OPACITYDIRECTUV == 1\n#define vOpacityUV vMainUV1\n#elif OPACITYDIRECTUV == 2\n#define vOpacityUV vMainUV2\n#else\nvarying vec2 vOpacityUV;\n#endif\nuniform sampler2D opacitySampler;\n#endif\n#ifdef EMISSIVE\n#if EMISSIVEDIRECTUV == 1\n#define vEmissiveUV vMainUV1\n#elif EMISSIVEDIRECTUV == 2\n#define vEmissiveUV vMainUV2\n#else\nvarying vec2 vEmissiveUV;\n#endif\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\n#if LIGHTMAPDIRECTUV == 1\n#define vLightmapUV vMainUV1\n#elif LIGHTMAPDIRECTUV == 2\n#define vLightmapUV vMainUV2\n#else\nvarying vec2 vLightmapUV;\n#endif\nuniform sampler2D lightmapSampler;\n#endif\n#ifdef REFLECTIVITY\n#if REFLECTIVITYDIRECTUV == 1\n#define vReflectivityUV vMainUV1\n#elif REFLECTIVITYDIRECTUV == 2\n#define vReflectivityUV vMainUV2\n#else\nvarying vec2 vReflectivityUV;\n#endif\nuniform sampler2D reflectivitySampler;\n#endif\n#ifdef MICROSURFACEMAP\n#if MICROSURFACEMAPDIRECTUV == 1\n#define vMicroSurfaceSamplerUV vMainUV1\n#elif MICROSURFACEMAPDIRECTUV == 2\n#define vMicroSurfaceSamplerUV vMainUV2\n#else\nvarying vec2 vMicroSurfaceSamplerUV;\n#endif\nuniform sampler2D microSurfaceSampler;\n#endif\n#ifdef METALLIC_REFLECTANCE\n#if METALLIC_REFLECTANCEDIRECTUV == 1\n#define vMetallicReflectanceUV vMainUV1\n#elif METALLIC_REFLECTANCEDIRECTUV == 2\n#define vMetallicReflectanceUV vMainUV2\n#else\nvarying vec2 vMetallicReflectanceUV;\n#endif\nuniform sampler2D metallicReflectanceSampler;\n#endif\n#ifdef CLEARCOAT\n#if defined(CLEARCOAT_TEXTURE)\n#if CLEARCOAT_TEXTUREDIRECTUV == 1\n#define vClearCoatUV vMainUV1\n#elif CLEARCOAT_TEXTUREDIRECTUV == 2\n#define vClearCoatUV vMainUV2\n#else\nvarying vec2 vClearCoatUV;\n#endif\n#endif\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS)\n#if CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV == 1\n#define vClearCoatRoughnessUV vMainUV1\n#elif CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV == 2\n#define vClearCoatRoughnessUV vMainUV2\n#else\nvarying vec2 vClearCoatRoughnessUV;\n#endif\n#endif\n#ifdef CLEARCOAT_TEXTURE\nuniform sampler2D clearCoatSampler;\n#endif\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL)\nuniform sampler2D clearCoatRoughnessSampler;\n#endif\n#ifdef CLEARCOAT_BUMP\n#if CLEARCOAT_BUMPDIRECTUV == 1\n#define vClearCoatBumpUV vMainUV1\n#elif CLEARCOAT_BUMPDIRECTUV == 2\n#define vClearCoatBumpUV vMainUV2\n#else\nvarying vec2 vClearCoatBumpUV;\n#endif\nuniform sampler2D clearCoatBumpSampler;\n#endif\n#ifdef CLEARCOAT_TINT_TEXTURE\n#if CLEARCOAT_TINT_TEXTUREDIRECTUV == 1\n#define vClearCoatTintUV vMainUV1\n#elif CLEARCOAT_TINT_TEXTUREDIRECTUV == 2\n#define vClearCoatTintUV vMainUV2\n#else\nvarying vec2 vClearCoatTintUV;\n#endif\nuniform sampler2D clearCoatTintSampler;\n#endif\n#endif\n#ifdef SHEEN\n#ifdef SHEEN_TEXTURE\n#if SHEEN_TEXTUREDIRECTUV == 1\n#define vSheenUV vMainUV1\n#elif SHEEN_TEXTUREDIRECTUV == 2\n#define vSheenUV vMainUV2\n#else\nvarying vec2 vSheenUV;\n#endif\n#endif\n#ifdef SHEEN_TEXTURE_ROUGHNESS\n#if SHEEN_TEXTURE_ROUGHNESSDIRECTUV == 1\n#define vSheenRoughnessUV vMainUV1\n#elif SHEEN_TEXTURE_ROUGHNESSDIRECTUV == 2\n#define vSheenRoughnessUV vMainUV2\n#else\nvarying vec2 vSheenRoughnessUV;\n#endif\n#endif\n#ifdef SHEEN_TEXTURE\nuniform sampler2D sheenSampler;\n#endif\n#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL)\nuniform sampler2D sheenRoughnessSampler;\n#endif\n#endif\n#ifdef ANISOTROPIC\n#ifdef ANISOTROPIC_TEXTURE\n#if ANISOTROPIC_TEXTUREDIRECTUV == 1\n#define vAnisotropyUV vMainUV1\n#elif ANISOTROPIC_TEXTUREDIRECTUV == 2\n#define vAnisotropyUV vMainUV2\n#else\nvarying vec2 vAnisotropyUV;\n#endif\nuniform sampler2D anisotropySampler;\n#endif\n#endif\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\n#define sampleReflection(s,c) textureCube(s,c)\nuniform samplerCube reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#ifdef USEIRRADIANCEMAP\nuniform samplerCube irradianceSampler;\n#endif\n#else\n#define sampleReflection(s,c) texture2D(s,c)\nuniform sampler2D reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform sampler2D reflectionSamplerLow;\nuniform sampler2D reflectionSamplerHigh;\n#endif\n#ifdef USEIRRADIANCEMAP\nuniform sampler2D irradianceSampler;\n#endif\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#endif\n#ifdef ENVIRONMENTBRDF\nuniform sampler2D environmentBrdfSampler;\n#endif\n\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\n#ifdef SS_REFRACTIONMAP_3D\n#define sampleRefraction(s,c) textureCube(s,c)\nuniform samplerCube refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube refractionSamplerLow;\nuniform samplerCube refractionSamplerHigh;\n#endif\n#else\n#define sampleRefraction(s,c) texture2D(s,c)\nuniform sampler2D refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform sampler2D refractionSamplerLow;\nuniform sampler2D refractionSamplerHigh;\n#endif\n#endif\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\n#if SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 1\n#define vThicknessUV vMainUV1\n#elif SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 2\n#define vThicknessUV vMainUV2\n#else\nvarying vec2 vThicknessUV;\n#endif\nuniform sampler2D thicknessSampler;\n#endif\n#endif";x.IncludesShadersStore.subSurfaceScatteringFunctions="bool testLightingForSSS(float diffusionProfile)\n{\nreturn diffusionProfile<1.;\n}";x.IncludesShadersStore.importanceSampling="\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvec3 hemisphereCosSample(vec2 u) {\n\nfloat phi=2.*PI*u.x;\nfloat cosTheta2=1.-u.y;\nfloat cosTheta=sqrt(cosTheta2);\nfloat sinTheta=sqrt(1.-cosTheta2);\nreturn vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvec3 hemisphereImportanceSampleDggx(vec2 u,float a) {\n\nfloat phi=2.*PI*u.x;\n\nfloat cosTheta2=(1.-u.y)/(1.+(a+1.)*((a-1.)*u.y));\nfloat cosTheta=sqrt(cosTheta2);\nfloat sinTheta=sqrt(1.-cosTheta2);\nreturn vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvec3 hemisphereImportanceSampleDCharlie(vec2 u,float a) {\n\nfloat phi=2.*PI*u.x;\nfloat sinTheta=pow(u.y,a/(2.*a+1.));\nfloat cosTheta=sqrt(1.-sinTheta*sinTheta);\nreturn vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);\n}";x.IncludesShadersStore.pbrHelperFunctions="\n#define RECIPROCAL_PI2 0.15915494\n#define RECIPROCAL_PI 0.31830988618\n\n#define MINIMUMVARIANCE 0.0005\nfloat convertRoughnessToAverageSlope(float roughness)\n{\n\nreturn square(roughness)+MINIMUMVARIANCE;\n}\nfloat fresnelGrazingReflectance(float reflectance0) {\n\n\nfloat reflectance90=saturate(reflectance0*25.0);\nreturn reflectance90;\n}\nvec2 getAARoughnessFactors(vec3 normalVector) {\n#ifdef SPECULARAA\nvec3 nDfdx=dFdx(normalVector.xyz);\nvec3 nDfdy=dFdy(normalVector.xyz);\nfloat slopeSquare=max(dot(nDfdx,nDfdx),dot(nDfdy,nDfdy));\n\nfloat geometricRoughnessFactor=pow(saturate(slopeSquare),0.333);\n\nfloat geometricAlphaGFactor=sqrt(slopeSquare);\n\ngeometricAlphaGFactor*=0.75;\nreturn vec2(geometricRoughnessFactor,geometricAlphaGFactor);\n#else\nreturn vec2(0.);\n#endif\n}\n#ifdef ANISOTROPIC\n\n\nvec2 getAnisotropicRoughness(float alphaG,float anisotropy) {\nfloat alphaT=max(alphaG*(1.0+anisotropy),MINIMUMVARIANCE);\nfloat alphaB=max(alphaG*(1.0-anisotropy),MINIMUMVARIANCE);\nreturn vec2(alphaT,alphaB);\n}\n\n\nvec3 getAnisotropicBentNormals(const vec3 T,const vec3 B,const vec3 N,const vec3 V,float anisotropy) {\nvec3 anisotropicFrameDirection=anisotropy>=0.0 ? B : T;\nvec3 anisotropicFrameTangent=cross(normalize(anisotropicFrameDirection),V);\nvec3 anisotropicFrameNormal=cross(anisotropicFrameTangent,anisotropicFrameDirection);\nvec3 anisotropicNormal=normalize(mix(N,anisotropicFrameNormal,abs(anisotropy)));\nreturn anisotropicNormal;\n\n}\n#endif\n#if defined(CLEARCOAT) || defined(SS_REFRACTION)\n\n\n\nvec3 cocaLambert(vec3 alpha,float distance) {\nreturn exp(-alpha*distance);\n}\n\nvec3 cocaLambert(float NdotVRefract,float NdotLRefract,vec3 alpha,float thickness) {\nreturn cocaLambert(alpha,(thickness*((NdotLRefract+NdotVRefract)/(NdotLRefract*NdotVRefract))));\n}\n\nvec3 computeColorAtDistanceInMedia(vec3 color,float distance) {\nreturn -log(color)/distance;\n}\nvec3 computeClearCoatAbsorption(float NdotVRefract,float NdotLRefract,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {\nvec3 clearCoatAbsorption=mix(vec3(1.0),\ncocaLambert(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness),\nclearCoatIntensity);\nreturn clearCoatAbsorption;\n}\n#endif\n\n\n\n\n#ifdef MICROSURFACEAUTOMATIC\nfloat computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)\n{\nconst float kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;\nfloat reflectivityLuminance=getLuminance(reflectivityColor);\nfloat reflectivityLuma=sqrt(reflectivityLuminance);\nmicroSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;\nreturn microSurface;\n}\n#endif";x.IncludesShadersStore.harmonicsFunctions="#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nuniform vec3 vSphericalL00;\nuniform vec3 vSphericalL1_1;\nuniform vec3 vSphericalL10;\nuniform vec3 vSphericalL11;\nuniform vec3 vSphericalL2_2;\nuniform vec3 vSphericalL2_1;\nuniform vec3 vSphericalL20;\nuniform vec3 vSphericalL21;\nuniform vec3 vSphericalL22;\n\n\n\n\n\n\n\nvec3 computeEnvironmentIrradiance(vec3 normal) {\nreturn vSphericalL00\n+vSphericalL1_1*(normal.y)\n+vSphericalL10*(normal.z)\n+vSphericalL11*(normal.x)\n+vSphericalL2_2*(normal.y*normal.x)\n+vSphericalL2_1*(normal.y*normal.z)\n+vSphericalL20*((3.0*normal.z*normal.z)-1.0)\n+vSphericalL21*(normal.z*normal.x)\n+vSphericalL22*(normal.x*normal.x-(normal.y*normal.y));\n}\n#else\nuniform vec3 vSphericalX;\nuniform vec3 vSphericalY;\nuniform vec3 vSphericalZ;\nuniform vec3 vSphericalXX_ZZ;\nuniform vec3 vSphericalYY_ZZ;\nuniform vec3 vSphericalZZ;\nuniform vec3 vSphericalXY;\nuniform vec3 vSphericalYZ;\nuniform vec3 vSphericalZX;\n\nvec3 computeEnvironmentIrradiance(vec3 normal) {\n\n\n\n\n\n\n\n\n\nfloat Nx=normal.x;\nfloat Ny=normal.y;\nfloat Nz=normal.z;\nvec3 C1=vSphericalZZ.rgb;\nvec3 Cx=vSphericalX.rgb;\nvec3 Cy=vSphericalY.rgb;\nvec3 Cz=vSphericalZ.rgb;\nvec3 Cxx_zz=vSphericalXX_ZZ.rgb;\nvec3 Cyy_zz=vSphericalYY_ZZ.rgb;\nvec3 Cxy=vSphericalXY.rgb;\nvec3 Cyz=vSphericalYZ.rgb;\nvec3 Czx=vSphericalZX.rgb;\nvec3 a1=Cyy_zz*Ny+Cy;\nvec3 a2=Cyz*Nz+a1;\nvec3 b1=Czx*Nz+Cx;\nvec3 b2=Cxy*Ny+b1;\nvec3 b3=Cxx_zz*Nx+b2;\nvec3 t1=Cz*Nz+C1;\nvec3 t2=a2*Ny+t1;\nvec3 t3=b3*Nx+t2;\nreturn t3;\n}\n#endif\n#endif";x.IncludesShadersStore.pbrDirectLightingSetupFunctions="\nstruct preLightingInfo\n{\n\nvec3 lightOffset;\nfloat lightDistanceSquared;\nfloat lightDistance;\n\nfloat attenuation;\n\nvec3 L;\nvec3 H;\nfloat NdotV;\nfloat NdotLUnclamped;\nfloat NdotL;\nfloat VdotH;\nfloat roughness;\n};\npreLightingInfo computePointAndSpotPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {\npreLightingInfo result;\n\nresult.lightOffset=lightData.xyz-vPositionW;\nresult.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);\n\nresult.lightDistance=sqrt(result.lightDistanceSquared);\n\nresult.L=normalize(result.lightOffset);\nresult.H=normalize(V+result.L);\nresult.VdotH=saturate(dot(V,result.H));\nresult.NdotLUnclamped=dot(N,result.L);\nresult.NdotL=saturateEps(result.NdotLUnclamped);\nreturn result;\n}\npreLightingInfo computeDirectionalPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {\npreLightingInfo result;\n\nresult.lightDistance=length(-lightData.xyz);\n\nresult.L=normalize(-lightData.xyz);\nresult.H=normalize(V+result.L);\nresult.VdotH=saturate(dot(V,result.H));\nresult.NdotLUnclamped=dot(N,result.L);\nresult.NdotL=saturateEps(result.NdotLUnclamped);\nreturn result;\n}\npreLightingInfo computeHemisphericPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {\npreLightingInfo result;\n\n\nresult.NdotL=dot(N,lightData.xyz)*0.5+0.5;\nresult.NdotL=saturateEps(result.NdotL);\nresult.NdotLUnclamped=result.NdotL;\n#ifdef SPECULARTERM\nresult.L=normalize(lightData.xyz);\nresult.H=normalize(V+result.L);\nresult.VdotH=saturate(dot(V,result.H));\n#endif\nreturn result;\n}";x.IncludesShadersStore.pbrDirectLightingFalloffFunctions="float computeDistanceLightFalloff_Standard(vec3 lightOffset,float range)\n{\nreturn max(0.,1.0-length(lightOffset)/range);\n}\nfloat computeDistanceLightFalloff_Physical(float lightDistanceSquared)\n{\nreturn 1.0/maxEps(lightDistanceSquared);\n}\nfloat computeDistanceLightFalloff_GLTF(float lightDistanceSquared,float inverseSquaredRange)\n{\nfloat lightDistanceFalloff=1.0/maxEps(lightDistanceSquared);\nfloat factor=lightDistanceSquared*inverseSquaredRange;\nfloat attenuation=saturate(1.0-factor*factor);\nattenuation*=attenuation;\n\nlightDistanceFalloff*=attenuation;\nreturn lightDistanceFalloff;\n}\nfloat computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range,float inverseSquaredRange)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDistanceLightFalloff_Physical(lightDistanceSquared);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDistanceLightFalloff_GLTF(lightDistanceSquared,inverseSquaredRange);\n#else\nreturn computeDistanceLightFalloff_Standard(lightOffset,range);\n#endif\n}\nfloat computeDirectionalLightFalloff_Standard(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent)\n{\nfloat falloff=0.0;\nfloat cosAngle=maxEps(dot(-lightDirection,directionToLightCenterW));\nif (cosAngle>=cosHalfAngle)\n{\nfalloff=max(0.,pow(cosAngle,exponent));\n}\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff_Physical(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle)\n{\nconst float kMinusLog2ConeAngleIntensityRatio=6.64385618977;\n\n\n\n\n\nfloat concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);\n\n\nvec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);\nfloat falloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff_GLTF(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngleScale,float lightAngleOffset)\n{\n\n\n\nfloat cd=dot(-lightDirection,directionToLightCenterW);\nfloat falloff=saturate(cd*lightAngleScale+lightAngleOffset);\n\nfalloff*=falloff;\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent,float lightAngleScale,float lightAngleOffset)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDirectionalLightFalloff_Physical(lightDirection,directionToLightCenterW,cosHalfAngle);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDirectionalLightFalloff_GLTF(lightDirection,directionToLightCenterW,lightAngleScale,lightAngleOffset);\n#else\nreturn computeDirectionalLightFalloff_Standard(lightDirection,directionToLightCenterW,cosHalfAngle,exponent);\n#endif\n}";x.IncludesShadersStore.pbrBRDFFunctions="\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n\n\n\n\n#ifdef MS_BRDF_ENERGY_CONSERVATION\n\n\nvec3 getEnergyConservationFactor(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {\nreturn 1.0+specularEnvironmentR0*(1.0/environmentBrdf.y-1.0);\n}\n#endif\n#ifdef ENVIRONMENTBRDF\nvec3 getBRDFLookup(float NdotV,float perceptualRoughness) {\n\nvec2 UV=vec2(NdotV,perceptualRoughness);\n\nvec4 brdfLookup=texture2D(environmentBrdfSampler,UV);\n#ifdef ENVIRONMENTBRDF_RGBD\nbrdfLookup.rgb=fromRGBD(brdfLookup.rgba);\n#endif\nreturn brdfLookup.rgb;\n}\nvec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 specularEnvironmentR90,const vec3 environmentBrdf) {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvec3 reflectance=(specularEnvironmentR90-specularEnvironmentR0)*environmentBrdf.x+specularEnvironmentR0*environmentBrdf.y;\n\n#else\nvec3 reflectance=specularEnvironmentR0*environmentBrdf.x+specularEnvironmentR90*environmentBrdf.y;\n#endif\nreturn reflectance;\n}\nvec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvec3 reflectance=mix(environmentBrdf.xxx,environmentBrdf.yyy,specularEnvironmentR0);\n#else\nvec3 reflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;\n#endif\nreturn reflectance;\n}\n#endif\n\n#if !defined(ENVIRONMENTBRDF) || defined(REFLECTIONMAP_SKYBOX) || defined(ALPHAFRESNEL)\nvec3 getReflectanceFromAnalyticalBRDFLookup_Jones(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\n\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));\n}\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF)\n\nvec3 getSheenReflectanceFromBRDFLookup(const vec3 reflectance0,const vec3 environmentBrdf) {\nvec3 sheenEnvironmentReflectance=reflectance0*environmentBrdf.b;\nreturn sheenEnvironmentReflectance;\n}\n#endif\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);\n}\nfloat fresnelSchlickGGX(float VdotH,float reflectance0,float reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);\n}\n#ifdef CLEARCOAT\n\n\n\n\n\nvec3 getR0RemappedForClearCoat(vec3 f0) {\n#ifdef CLEARCOAT_DEFAULTIOR\n#ifdef MOBILE\nreturn saturate(f0*(f0*0.526868+0.529324)-0.0482256);\n#else\nreturn saturate(f0*(f0*(0.941892-0.263008*f0)+0.346479)-0.0285998);\n#endif\n#else\nvec3 s=sqrt(f0);\nvec3 t=(vClearCoatRefractionParams.z+vClearCoatRefractionParams.w*s)/(vClearCoatRefractionParams.w+vClearCoatRefractionParams.z*s);\nreturn t*t;\n#endif\n}\n#endif\n\n\n\n\n\n\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)\n{\n\n\n\nfloat a2=square(alphaG);\nfloat d=NdotH*NdotH*(a2-1.0)+1.0;\nreturn a2/(PI*d*d);\n}\n#ifdef SHEEN\n\n\nfloat normalDistributionFunction_CharlieSheen(float NdotH,float alphaG)\n{\nfloat invR=1./alphaG;\nfloat cos2h=NdotH*NdotH;\nfloat sin2h=1.-cos2h;\nreturn (2.+invR)*pow(sin2h,invR*.5)/(2.*PI);\n}\n#endif\n#ifdef ANISOTROPIC\n\n\nfloat normalDistributionFunction_BurleyGGX_Anisotropic(float NdotH,float TdotH,float BdotH,const vec2 alphaTB) {\nfloat a2=alphaTB.x*alphaTB.y;\nvec3 v=vec3(alphaTB.y*TdotH,alphaTB.x*BdotH,a2*NdotH);\nfloat v2=dot(v,v);\nfloat w2=a2/v2;\nreturn a2*w2*w2*RECIPROCAL_PI;\n}\n#endif\n\n\n\n\n#ifdef BRDF_V_HEIGHT_CORRELATED\n\n\n\nfloat smithVisibility_GGXCorrelated(float NdotL,float NdotV,float alphaG) {\n#ifdef MOBILE\n\nfloat GGXV=NdotL*(NdotV*(1.0-alphaG)+alphaG);\nfloat GGXL=NdotV*(NdotL*(1.0-alphaG)+alphaG);\nreturn 0.5/(GGXV+GGXL);\n#else\nfloat a2=alphaG*alphaG;\nfloat GGXV=NdotL*sqrt(NdotV*(NdotV-a2*NdotV)+a2);\nfloat GGXL=NdotV*sqrt(NdotL*(NdotL-a2*NdotL)+a2);\nreturn 0.5/(GGXV+GGXL);\n#endif\n}\n#else\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfloat smithVisibilityG1_TrowbridgeReitzGGXFast(float dot,float alphaG)\n{\n#ifdef MOBILE\n\nreturn 1.0/(dot+alphaG+(1.0-alphaG)*dot ));\n#else\nfloat alphaSquared=alphaG*alphaG;\nreturn 1.0/(dot+sqrt(alphaSquared+(1.0-alphaSquared)*dot*dot));\n#endif\n}\nfloat smithVisibility_TrowbridgeReitzGGXFast(float NdotL,float NdotV,float alphaG)\n{\nfloat visibility=smithVisibilityG1_TrowbridgeReitzGGXFast(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGXFast(NdotV,alphaG);\n\nreturn visibility;\n}\n#endif\n#ifdef ANISOTROPIC\n\n\nfloat smithVisibility_GGXCorrelated_Anisotropic(float NdotL,float NdotV,float TdotV,float BdotV,float TdotL,float BdotL,const vec2 alphaTB) {\nfloat lambdaV=NdotL*length(vec3(alphaTB.x*TdotV,alphaTB.y*BdotV,NdotV));\nfloat lambdaL=NdotV*length(vec3(alphaTB.x*TdotL,alphaTB.y*BdotL,NdotL));\nfloat v=0.5/(lambdaV+lambdaL);\nreturn v;\n}\n#endif\n#ifdef CLEARCOAT\nfloat visibility_Kelemen(float VdotH) {\n\n\n\nreturn 0.25/(VdotH*VdotH);\n}\n#endif\n#ifdef SHEEN\n\n\n\nfloat visibility_Ashikhmin(float NdotL,float NdotV)\n{\nreturn 1./(4.*(NdotL+NdotV-NdotL*NdotV));\n}\n\n#endif\n\n\n\n\n\n\n\nfloat diffuseBRDF_Burley(float NdotL,float NdotV,float VdotH,float roughness) {\n\n\nfloat diffuseFresnelNV=pow5(saturateEps(1.0-NdotL));\nfloat diffuseFresnelNL=pow5(saturateEps(1.0-NdotV));\nfloat diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;\nfloat fresnel =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);\nreturn fresnel/PI;\n}\n#ifdef SS_TRANSLUCENCY\n\n\nvec3 transmittanceBRDF_Burley(const vec3 tintColor,const vec3 diffusionDistance,float thickness) {\nvec3 S=1./maxEps(diffusionDistance);\nvec3 temp=exp((-0.333333333*thickness)*S);\nreturn tintColor.rgb*0.25*(temp*temp*temp+3.0*temp);\n}\n\n\nfloat computeWrappedDiffuseNdotL(float NdotL,float w) {\nfloat t=1.0+w;\nfloat invt2=1.0/square(t);\nreturn saturate((NdotL+w)*invt2);\n}\n#endif\n";x.IncludesShadersStore.hdrFilteringFunctions="#ifdef NUM_SAMPLES\n#if NUM_SAMPLES>0\n#ifdef WEBGL2\n\n\nfloat radicalInverse_VdC(uint bits)\n{\nbits=(bits << 16u) | (bits >> 16u);\nbits=((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);\nbits=((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);\nbits=((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);\nbits=((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);\nreturn float(bits)*2.3283064365386963e-10;\n}\nvec2 hammersley(uint i,uint N)\n{\nreturn vec2(float(i)/float(N),radicalInverse_VdC(i));\n}\n#else\nfloat vanDerCorpus(int n,int base)\n{\nfloat invBase=1.0/float(base);\nfloat denom=1.0;\nfloat result=0.0;\nfor(int i=0; i<32; ++i)\n{\nif(n>0)\n{\ndenom=mod(float(n),2.0);\nresult+=denom*invBase;\ninvBase=invBase/2.0;\nn=int(float(n)/2.0);\n}\n}\nreturn result;\n}\nvec2 hammersley(int i,int N)\n{\nreturn vec2(float(i)/float(N),vanDerCorpus(i,2));\n}\n#endif\nfloat log4(float x) {\nreturn log2(x)/2.;\n}\nconst float NUM_SAMPLES_FLOAT=float(NUM_SAMPLES);\nconst float NUM_SAMPLES_FLOAT_INVERSED=1./NUM_SAMPLES_FLOAT;\nconst float K=4.;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n#define inline\nvec3 irradiance(samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)\n{\nvec3 n=normalize(inputN);\nvec3 result=vec3(0.0);\nvec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);\ntangent=normalize(cross(tangent,n));\nvec3 bitangent=cross(n,tangent);\nmat3 tbn=mat3(tangent,bitangent,n);\nfloat maxLevel=filteringInfo.y;\nfloat dim0=filteringInfo.x;\nfloat omegaP=(4.*PI)/(6.*dim0*dim0);\n#ifdef WEBGL2\nfor(uint i=0u; i<NUM_SAMPLES; ++i)\n#else\nfor(int i=0; i<NUM_SAMPLES; ++i)\n#endif\n{\nvec2 Xi=hammersley(i,NUM_SAMPLES);\nvec3 Ls=hemisphereCosSample(Xi);\nLs=normalize(Ls);\nvec3 Ns=vec3(0.,0.,1.);\nfloat NoL=dot(Ns,Ls);\nif (NoL>0.) {\nfloat pdf_inversed=PI/NoL;\nfloat omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;\nfloat l=log4(omegaS)-log4(omegaP)+log4(K);\nfloat mipLevel=clamp(l,0.0,maxLevel);\nvec3 c=textureCubeLodEXT(inputTexture,tbn*Ls,mipLevel).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nresult+=c;\n}\n}\nresult=result*NUM_SAMPLES_FLOAT_INVERSED;\nreturn result;\n}\n#define inline\nvec3 radiance(float alphaG,samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)\n{\nvec3 n=normalize(inputN);\nif (alphaG == 0.) {\nvec3 c=textureCube(inputTexture,n).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nreturn c;\n}\nvec3 result=vec3(0.);\nvec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);\ntangent=normalize(cross(tangent,n));\nvec3 bitangent=cross(n,tangent);\nmat3 tbn=mat3(tangent,bitangent,n);\nfloat maxLevel=filteringInfo.y;\nfloat dim0=filteringInfo.x;\nfloat omegaP=(4.*PI)/(6.*dim0*dim0);\nfloat weight=0.;\n#ifdef WEBGL2\nfor(uint i=0u; i<NUM_SAMPLES; ++i)\n#else\nfor(int i=0; i<NUM_SAMPLES; ++i)\n#endif\n{\nvec2 Xi=hammersley(i,NUM_SAMPLES);\nvec3 H=hemisphereImportanceSampleDggx(Xi,alphaG);\nfloat NoV=1.;\nfloat NoH=H.z;\nfloat NoH2=H.z*H.z;\nfloat NoL=2.*NoH2-1.;\nvec3 L=vec3(2.*NoH*H.x,2.*NoH*H.y,NoL);\nL=normalize(L);\nif (NoL>0.) {\nfloat pdf_inversed=4./normalDistributionFunction_TrowbridgeReitzGGX(NoH,alphaG);\nfloat omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;\nfloat l=log4(omegaS)-log4(omegaP)+log4(K);\nfloat mipLevel=clamp(float(l),0.0,maxLevel);\nweight+=NoL;\nvec3 c=textureCubeLodEXT(inputTexture,tbn*L,mipLevel).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nresult+=c*NoL;\n}\n}\nresult=result/weight;\nreturn result;\n}\n#endif\n#endif";x.IncludesShadersStore.pbrDirectLightingFunctions="#define CLEARCOATREFLECTANCE90 1.0\n\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef CLEARCOAT\n\n\nvec4 clearCoat;\n#endif\n#ifdef SHEEN\nvec3 sheen;\n#endif\n};\n\nfloat adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance) {\n#if defined(USEPHYSICALLIGHTFALLOFF) || defined(USEGLTFLIGHTFALLOFF)\n\nfloat lightRoughness=lightRadius/lightDistance;\n\nfloat totalRoughness=saturate(lightRoughness+roughness);\nreturn totalRoughness;\n#else\nreturn roughness;\n#endif\n}\nvec3 computeHemisphericDiffuseLighting(preLightingInfo info,vec3 lightColor,vec3 groundColor) {\nreturn mix(groundColor,lightColor,info.NdotL);\n}\nvec3 computeDiffuseLighting(preLightingInfo info,vec3 lightColor) {\nfloat diffuseTerm=diffuseBRDF_Burley(info.NdotL,info.NdotV,info.VdotH,info.roughness);\nreturn diffuseTerm*info.attenuation*info.NdotL*lightColor;\n}\n#define inline\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){\nvec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);\nstrq/=strq.w;\nvec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;\nreturn toLinearSpace(textureColor);\n}\n#ifdef SS_TRANSLUCENCY\nvec3 computeDiffuseAndTransmittedLighting(preLightingInfo info,vec3 lightColor,vec3 transmittance) {\nfloat NdotL=absEps(info.NdotLUnclamped);\n\nfloat wrapNdotL=computeWrappedDiffuseNdotL(NdotL,0.02);\n\nfloat trAdapt=step(0.,info.NdotLUnclamped);\nvec3 transmittanceNdotL=mix(transmittance*wrapNdotL,vec3(wrapNdotL),trAdapt);\nfloat diffuseTerm=diffuseBRDF_Burley(NdotL,info.NdotV,info.VdotH,info.roughness);\nreturn diffuseTerm*transmittanceNdotL*info.attenuation*lightColor;\n}\n#endif\n#ifdef SPECULARTERM\nvec3 computeSpecularLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {\nfloat NdotH=saturateEps(dot(N,info.H));\nfloat roughness=max(info.roughness,geometricRoughnessFactor);\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nvec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);\n#ifdef BRDF_V_HEIGHT_CORRELATED\nfloat smithVisibility=smithVisibility_GGXCorrelated(info.NdotL,info.NdotV,alphaG);\n#else\nfloat smithVisibility=smithVisibility_TrowbridgeReitzGGXFast(info.NdotL,info.NdotV,alphaG);\n#endif\nvec3 specTerm=fresnel*distribution*smithVisibility;\nreturn specTerm*info.attenuation*info.NdotL*lightColor;\n}\n#endif\n#ifdef ANISOTROPIC\nvec3 computeAnisotropicSpecularLighting(preLightingInfo info,vec3 V,vec3 N,vec3 T,vec3 B,float anisotropy,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {\nfloat NdotH=saturateEps(dot(N,info.H));\nfloat TdotH=dot(T,info.H);\nfloat BdotH=dot(B,info.H);\nfloat TdotV=dot(T,V);\nfloat BdotV=dot(B,V);\nfloat TdotL=dot(T,info.L);\nfloat BdotL=dot(B,info.L);\nfloat alphaG=convertRoughnessToAverageSlope(info.roughness);\nvec2 alphaTB=getAnisotropicRoughness(alphaG,anisotropy);\nalphaTB=max(alphaTB,square(geometricRoughnessFactor));\nvec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);\nfloat distribution=normalDistributionFunction_BurleyGGX_Anisotropic(NdotH,TdotH,BdotH,alphaTB);\nfloat smithVisibility=smithVisibility_GGXCorrelated_Anisotropic(info.NdotL,info.NdotV,TdotV,BdotV,TdotL,BdotL,alphaTB);\nvec3 specTerm=fresnel*distribution*smithVisibility;\nreturn specTerm*info.attenuation*info.NdotL*lightColor;\n}\n#endif\n#ifdef CLEARCOAT\nvec4 computeClearCoatLighting(preLightingInfo info,vec3 Ncc,float geometricRoughnessFactor,float clearCoatIntensity,vec3 lightColor) {\nfloat NccdotL=saturateEps(dot(Ncc,info.L));\nfloat NccdotH=saturateEps(dot(Ncc,info.H));\nfloat clearCoatRoughness=max(info.roughness,geometricRoughnessFactor);\nfloat alphaG=convertRoughnessToAverageSlope(clearCoatRoughness);\nfloat fresnel=fresnelSchlickGGX(info.VdotH,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);\nfresnel*=clearCoatIntensity;\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NccdotH,alphaG);\nfloat kelemenVisibility=visibility_Kelemen(info.VdotH);\nfloat clearCoatTerm=fresnel*distribution*kelemenVisibility;\nreturn vec4(\nclearCoatTerm*info.attenuation*NccdotL*lightColor,\n1.0-fresnel\n);\n}\nvec3 computeClearCoatLightingAbsorption(float NdotVRefract,vec3 L,vec3 Ncc,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {\nvec3 LRefract=-refract(L,Ncc,vClearCoatRefractionParams.y);\nfloat NdotLRefract=saturateEps(dot(Ncc,LRefract));\nvec3 absorption=computeClearCoatAbsorption(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness,clearCoatIntensity);\nreturn absorption;\n}\n#endif\n#ifdef SHEEN\nvec3 computeSheenLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {\nfloat NdotH=saturateEps(dot(N,info.H));\nfloat roughness=max(info.roughness,geometricRoughnessFactor);\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\n\n\nfloat fresnel=1.;\nfloat distribution=normalDistributionFunction_CharlieSheen(NdotH,alphaG);\n\nfloat visibility=visibility_Ashikhmin(info.NdotL,info.NdotV);\n\nfloat sheenTerm=fresnel*distribution*visibility;\nreturn sheenTerm*info.attenuation*info.NdotL*lightColor;\n}\n#endif\n";x.IncludesShadersStore.pbrIBLFunctions="#if defined(REFLECTION) || defined(SS_REFRACTION)\nfloat getLodFromAlphaG(float cubeMapDimensionPixels,float microsurfaceAverageSlope) {\nfloat microsurfaceAverageSlopeTexels=cubeMapDimensionPixels*microsurfaceAverageSlope;\nfloat lod=log2(microsurfaceAverageSlopeTexels);\nreturn lod;\n}\nfloat getLinearLodFromRoughness(float cubeMapDimensionPixels,float roughness) {\nfloat lod=log2(cubeMapDimensionPixels)*roughness;\nreturn lod;\n}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(RADIANCEOCCLUSION)\nfloat environmentRadianceOcclusion(float ambientOcclusion,float NdotVUnclamped) {\n\n\nfloat temp=NdotVUnclamped+ambientOcclusion;\nreturn saturate(square(temp)-1.0+ambientOcclusion);\n}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(HORIZONOCCLUSION)\nfloat environmentHorizonOcclusion(vec3 view,vec3 normal,vec3 geometricNormal) {\n\nvec3 reflection=reflect(view,normal);\nfloat temp=saturate(1.0+1.1*dot(reflection,geometricNormal));\nreturn square(temp);\n}\n#endif\n\n\n\n\n#if defined(LODINREFLECTIONALPHA) || defined(SS_LODINREFRACTIONALPHA)\n\n\n#define UNPACK_LOD(x) (1.0-x)*255.0\nfloat getLodFromAlphaG(float cubeMapDimensionPixels,float alphaG,float NdotV) {\nfloat microsurfaceAverageSlope=alphaG;\n\n\n\n\n\n\nmicrosurfaceAverageSlope*=sqrt(abs(NdotV));\nreturn getLodFromAlphaG(cubeMapDimensionPixels,microsurfaceAverageSlope);\n}\n#endif";x.IncludesShadersStore.pbrBlockAlbedoOpacity="struct albedoOpacityOutParams\n{\nvec3 surfaceAlbedo;\nfloat alpha;\n};\n#define pbr_inline\nvoid albedoOpacityBlock(\nconst in vec4 vAlbedoColor,\n#ifdef ALBEDO\nconst in vec4 albedoTexture,\nconst in vec2 albedoInfos,\n#endif\n#ifdef OPACITY\nconst in vec4 opacityMap,\nconst in vec2 vOpacityInfos,\n#endif\n#ifdef DETAIL\nconst in vec4 detailColor,\nconst in vec4 vDetailInfos,\n#endif\nout albedoOpacityOutParams outParams\n)\n{\n\nvec3 surfaceAlbedo=vAlbedoColor.rgb;\nfloat alpha=vAlbedoColor.a;\n#ifdef ALBEDO\n#if defined(ALPHAFROMALBEDO) || defined(ALPHATEST)\nalpha*=albedoTexture.a;\n#endif\n#ifdef GAMMAALBEDO\nsurfaceAlbedo*=toLinearSpace(albedoTexture.rgb);\n#else\nsurfaceAlbedo*=albedoTexture.rgb;\n#endif\nsurfaceAlbedo*=albedoInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nsurfaceAlbedo*=vColor.rgb;\n#endif\n#ifdef DETAIL\nfloat detailAlbedo=2.0*mix(0.5,detailColor.r,vDetailInfos.y);\nsurfaceAlbedo.rgb=surfaceAlbedo.rgb*detailAlbedo*detailAlbedo;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALBEDO\n\n#ifdef OPACITY\n#ifdef OPACITYRGB\nalpha=getLuminance(opacityMap.rgb);\n#else\nalpha*=opacityMap.a;\n#endif\nalpha*=vOpacityInfos.y;\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#if !defined(SS_LINKREFRACTIONTOTRANSPARENCY) && !defined(ALPHAFRESNEL)\n#ifdef ALPHATEST\nif (alpha<ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\n\nalpha=1.0;\n#endif\n#endif\n#endif\noutParams.surfaceAlbedo=surfaceAlbedo;\noutParams.alpha=alpha;\n}\n";x.IncludesShadersStore.pbrBlockReflectivity="struct reflectivityOutParams\n{\nfloat microSurface;\nfloat roughness;\nvec3 surfaceReflectivityColor;\n#ifdef METALLICWORKFLOW\nvec3 surfaceAlbedo;\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\nvec3 ambientOcclusionColor;\n#endif\n#if DEBUGMODE>0\nvec4 surfaceMetallicColorMap;\nvec4 surfaceReflectivityColorMap;\nvec2 metallicRoughness;\nvec3 metallicF0;\n#endif\n};\n#define pbr_inline\nvoid reflectivityBlock(\nconst in vec4 vReflectivityColor,\n#ifdef METALLICWORKFLOW\nconst in vec3 surfaceAlbedo,\nconst in vec4 metallicReflectanceFactors,\n#endif\n#ifdef REFLECTIVITY\nconst in vec3 reflectivityInfos,\nconst in vec4 surfaceMetallicOrReflectivityColorMap,\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\nconst in vec3 ambientOcclusionColorIn,\n#endif\n#ifdef MICROSURFACEMAP\nconst in vec4 microSurfaceTexel,\n#endif\n#ifdef DETAIL\nconst in vec4 detailColor,\nconst in vec4 vDetailInfos,\n#endif\nout reflectivityOutParams outParams\n)\n{\nfloat microSurface=vReflectivityColor.a;\nvec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvec2 metallicRoughness=surfaceReflectivityColor.rg;\n#ifdef REFLECTIVITY\n#if DEBUGMODE>0\noutParams.surfaceMetallicColorMap=surfaceMetallicOrReflectivityColorMap;\n#endif\n#ifdef AOSTOREINMETALMAPRED\nvec3 aoStoreInMetalMap=vec3(surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r);\noutParams.ambientOcclusionColor=mix(ambientOcclusionColorIn,aoStoreInMetalMap,reflectivityInfos.z);\n#endif\n#ifdef METALLNESSSTOREINMETALMAPBLUE\nmetallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.b;\n#else\nmetallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.r;\n#endif\n#ifdef ROUGHNESSSTOREINMETALMAPALPHA\nmetallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.a;\n#else\n#ifdef ROUGHNESSSTOREINMETALMAPGREEN\nmetallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.g;\n#endif\n#endif\n#endif\n#ifdef DETAIL\nfloat detailRoughness=mix(0.5,detailColor.b,vDetailInfos.w);\nfloat loLerp=mix(0.,metallicRoughness.g,detailRoughness*2.);\nfloat hiLerp=mix(metallicRoughness.g,1.,(detailRoughness-0.5)*2.);\nmetallicRoughness.g=mix(loLerp,hiLerp,step(detailRoughness,0.5));\n#endif\n#ifdef MICROSURFACEMAP\nmetallicRoughness.g*=microSurfaceTexel.r;\n#endif\n#if DEBUGMODE>0\noutParams.metallicRoughness=metallicRoughness;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS\n\nmicroSurface=1.0-metallicRoughness.g;\n\nvec3 baseColor=surfaceAlbedo;\n#ifdef FROSTBITE_REFLECTANCE\n\n\n\n\n\n\noutParams.surfaceAlbedo=baseColor.rgb*(1.0-metallicRoughness.r);\n\nsurfaceReflectivityColor=mix(0.16*reflectance*reflectance,baseColor,metallicRoughness.r);\n#else\nvec3 metallicF0=metallicReflectanceFactors.rgb;\n#if DEBUGMODE>0\noutParams.metallicF0=metallicF0;\n#endif\n\noutParams.surfaceAlbedo=mix(baseColor.rgb*(1.0-metallicF0),vec3(0.,0.,0.),metallicRoughness.r);\n\nsurfaceReflectivityColor=mix(metallicF0,baseColor,metallicRoughness.r);\n#endif\n#else\n#ifdef REFLECTIVITY\nsurfaceReflectivityColor*=surfaceMetallicOrReflectivityColorMap.rgb;\n#if DEBUGMODE>0\noutParams.surfaceReflectivityColorMap=surfaceMetallicOrReflectivityColorMap;\n#endif\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface*=surfaceMetallicOrReflectivityColorMap.a;\nmicroSurface*=reflectivityInfos.z;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface*=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#ifdef MICROSURFACEMAP\nmicroSurface*=microSurfaceTexel.r;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE\n#endif\n#endif\n#endif\n\nmicroSurface=saturate(microSurface);\n\nfloat roughness=1.-microSurface;\noutParams.microSurface=microSurface;\noutParams.roughness=roughness;\noutParams.surfaceReflectivityColor=surfaceReflectivityColor;\n}\n";x.IncludesShadersStore.pbrBlockAmbientOcclusion="struct ambientOcclusionOutParams\n{\nvec3 ambientOcclusionColor;\n#if DEBUGMODE>0\nvec3 ambientOcclusionColorMap;\n#endif\n};\n#define pbr_inline\nvoid ambientOcclusionBlock(\n#ifdef AMBIENT\nconst in vec3 ambientOcclusionColorMap_,\nconst in vec4 vAmbientInfos,\n#endif\nout ambientOcclusionOutParams outParams\n)\n{\nvec3 ambientOcclusionColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nvec3 ambientOcclusionColorMap=ambientOcclusionColorMap_*vAmbientInfos.y;\n#ifdef AMBIENTINGRAYSCALE\nambientOcclusionColorMap=vec3(ambientOcclusionColorMap.r,ambientOcclusionColorMap.r,ambientOcclusionColorMap.r);\n#endif\nambientOcclusionColor=mix(ambientOcclusionColor,ambientOcclusionColorMap,vAmbientInfos.z);\n#if DEBUGMODE>0\noutParams.ambientOcclusionColorMap=ambientOcclusionColorMap;\n#endif\n#endif\noutParams.ambientOcclusionColor=ambientOcclusionColor;\n}\n";x.IncludesShadersStore.pbrBlockAlphaFresnel="#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\nstruct alphaFresnelOutParams\n{\nfloat alpha;\n};\n#define pbr_inline\nvoid alphaFresnelBlock(\nconst in vec3 normalW,\nconst in vec3 viewDirectionW,\nconst in float alpha,\nconst in float microSurface,\nout alphaFresnelOutParams outParams\n)\n{\n\n\n\nfloat opacityPerceptual=alpha;\n#ifdef LINEARALPHAFRESNEL\nfloat opacity0=opacityPerceptual;\n#else\nfloat opacity0=opacityPerceptual*opacityPerceptual;\n#endif\nfloat opacity90=fresnelGrazingReflectance(opacity0);\nvec3 normalForward=faceforward(normalW,-viewDirectionW,normalW);\n\noutParams.alpha=getReflectanceFromAnalyticalBRDFLookup_Jones(saturate(dot(viewDirectionW,normalForward)),vec3(opacity0),vec3(opacity90),sqrt(microSurface)).x;\n#ifdef ALPHATEST\nif (outParams.alpha<ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\n\noutParams.alpha=1.0;\n#endif\n#endif\n}\n#endif\n#endif\n";x.IncludesShadersStore.pbrBlockAnisotropic="#ifdef ANISOTROPIC\nstruct anisotropicOutParams\n{\nfloat anisotropy;\nvec3 anisotropicTangent;\nvec3 anisotropicBitangent;\nvec3 anisotropicNormal;\n#if DEBUGMODE>0\nvec3 anisotropyMapData;\n#endif\n};\n#define pbr_inline\nvoid anisotropicBlock(\nconst in vec3 vAnisotropy,\n#ifdef ANISOTROPIC_TEXTURE\nconst in vec3 anisotropyMapData,\n#endif\nconst in mat3 TBN,\nconst in vec3 normalW,\nconst in vec3 viewDirectionW,\nout anisotropicOutParams outParams\n)\n{\nfloat anisotropy=vAnisotropy.b;\nvec3 anisotropyDirection=vec3(vAnisotropy.xy,0.);\n#ifdef ANISOTROPIC_TEXTURE\nanisotropy*=anisotropyMapData.b;\nanisotropyDirection.rg*=anisotropyMapData.rg*2.0-1.0;\n#if DEBUGMODE>0\noutParams.anisotropyMapData=anisotropyMapData;\n#endif\n#endif\nmat3 anisoTBN=mat3(normalize(TBN[0]),normalize(TBN[1]),normalize(TBN[2]));\nvec3 anisotropicTangent=normalize(anisoTBN*anisotropyDirection);\nvec3 anisotropicBitangent=normalize(cross(anisoTBN[2],anisotropicTangent));\noutParams.anisotropy=anisotropy;\noutParams.anisotropicTangent=anisotropicTangent;\noutParams.anisotropicBitangent=anisotropicBitangent;\noutParams.anisotropicNormal=getAnisotropicBentNormals(anisotropicTangent,anisotropicBitangent,normalW,viewDirectionW,anisotropy);\n}\n#endif\n";x.IncludesShadersStore.pbrBlockReflection="#ifdef REFLECTION\nstruct reflectionOutParams\n{\nvec4 environmentRadiance;\nvec3 environmentIrradiance;\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords;\n#else\nvec2 reflectionCoords;\n#endif\n#ifdef SS_TRANSLUCENCY\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nvec3 irradianceVector;\n#endif\n#endif\n#endif\n};\n#define pbr_inline\nvoid createReflectionCoords(\nconst in vec3 vPositionW,\nconst in vec3 normalW,\n#ifdef ANISOTROPIC\nconst in anisotropicOutParams anisotropicOut,\n#endif\n#ifdef REFLECTIONMAP_3D\nout vec3 reflectionCoords\n#else\nout vec2 reflectionCoords\n#endif\n)\n{\n#ifdef ANISOTROPIC\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),anisotropicOut.anisotropicNormal);\n#else\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\n\n#ifdef REFLECTIONMAP_3D\nreflectionCoords=reflectionVector;\n#else\nreflectionCoords=reflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nreflectionCoords/=reflectionVector.z;\n#endif\nreflectionCoords.y=1.0-reflectionCoords.y;\n#endif\n}\n#define pbr_inline\n#define inline\nvoid sampleReflectionTexture(\nconst in float alphaG,\nconst in vec3 vReflectionMicrosurfaceInfos,\nconst in vec2 vReflectionInfos,\nconst in vec3 vReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nconst in float NdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nconst in float roughness,\n#endif\n#ifdef REFLECTIONMAP_3D\nconst in samplerCube reflectionSampler,\nconst vec3 reflectionCoords,\n#else\nconst in sampler2D reflectionSampler,\nconst vec2 reflectionCoords,\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\nconst in samplerCube reflectionSamplerLow,\nconst in samplerCube reflectionSamplerHigh,\n#else\nconst in sampler2D reflectionSamplerLow,\nconst in sampler2D reflectionSamplerHigh,\n#endif\n#endif\n#ifdef REALTIME_FILTERING\nconst in vec2 vReflectionFilteringInfo,\n#endif\nout vec4 environmentRadiance\n)\n{\n\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#elif defined(LINEARSPECULARREFLECTION)\nfloat reflectionLOD=getLinearLodFromRoughness(vReflectionMicrosurfaceInfos.x,roughness);\n#else\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\n\nreflectionLOD=reflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\n#ifdef LODINREFLECTIONALPHA\n\n\n\n\n\n\n\n\n\nfloat automaticReflectionLOD=UNPACK_LOD(sampleReflection(reflectionSampler,reflectionCoords).a);\nfloat requestedReflectionLOD=max(automaticReflectionLOD,reflectionLOD);\n#else\nfloat requestedReflectionLOD=reflectionLOD;\n#endif\n#ifdef REALTIME_FILTERING\nenvironmentRadiance=vec4(radiance(alphaG,reflectionSampler,reflectionCoords,vReflectionFilteringInfo),1.0);\n#else\nenvironmentRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,reflectionLOD);\n#endif\n#else\nfloat lodReflectionNormalized=saturate(reflectionLOD/log2(vReflectionMicrosurfaceInfos.x));\nfloat lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;\nvec4 environmentMid=sampleReflection(reflectionSampler,reflectionCoords);\nif (lodReflectionNormalizedDoubled<1.0){\nenvironmentRadiance=mix(\nsampleReflection(reflectionSamplerHigh,reflectionCoords),\nenvironmentMid,\nlodReflectionNormalizedDoubled\n);\n} else {\nenvironmentRadiance=mix(\nenvironmentMid,\nsampleReflection(reflectionSamplerLow,reflectionCoords),\nlodReflectionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef RGBDREFLECTION\nenvironmentRadiance.rgb=fromRGBD(environmentRadiance);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentRadiance.rgb=toLinearSpace(environmentRadiance.rgb);\n#endif\n\nenvironmentRadiance.rgb*=vReflectionInfos.x;\nenvironmentRadiance.rgb*=vReflectionColor.rgb;\n}\n#define pbr_inline\n#define inline\nvoid reflectionBlock(\nconst in vec3 vPositionW,\nconst in vec3 normalW,\nconst in float alphaG,\nconst in vec3 vReflectionMicrosurfaceInfos,\nconst in vec2 vReflectionInfos,\nconst in vec3 vReflectionColor,\n#ifdef ANISOTROPIC\nconst in anisotropicOutParams anisotropicOut,\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nconst in float NdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nconst in float roughness,\n#endif\n#ifdef REFLECTIONMAP_3D\nconst in samplerCube reflectionSampler,\n#else\nconst in sampler2D reflectionSampler,\n#endif\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nconst in vec3 vEnvironmentIrradiance,\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nconst in mat4 reflectionMatrix,\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n#ifdef REFLECTIONMAP_3D\nconst in samplerCube irradianceSampler,\n#else\nconst in sampler2D irradianceSampler,\n#endif\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\nconst in samplerCube reflectionSamplerLow,\nconst in samplerCube reflectionSamplerHigh,\n#else\nconst in sampler2D reflectionSamplerLow,\nconst in sampler2D reflectionSamplerHigh,\n#endif\n#endif\n#ifdef REALTIME_FILTERING\nconst in vec2 vReflectionFilteringInfo,\n#endif\nout reflectionOutParams outParams\n)\n{\n\nvec4 environmentRadiance=vec4(0.,0.,0.,0.);\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords=vec3(0.);\n#else\nvec2 reflectionCoords=vec2(0.);\n#endif\ncreateReflectionCoords(\nvPositionW,\nnormalW,\n#ifdef ANISOTROPIC\nanisotropicOut,\n#endif\nreflectionCoords\n);\nsampleReflectionTexture(\nalphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nroughness,\n#endif\n#ifdef REFLECTIONMAP_3D\nreflectionSampler,\nreflectionCoords,\n#else\nreflectionSampler,\nreflectionCoords,\n#endif\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nenvironmentRadiance\n);\n\nvec3 environmentIrradiance=vec3(0.,0.,0.);\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nenvironmentIrradiance=vEnvironmentIrradiance;\n#else\n#ifdef ANISOTROPIC\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(anisotropicOut.anisotropicNormal,0)).xyz;\n#else\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\n#ifdef INVERTCUBICMAP\nirradianceVector.y*=-1.0;\n#endif\n#if defined(REALTIME_FILTERING)\nenvironmentIrradiance=irradiance(reflectionSampler,irradianceVector,vReflectionFilteringInfo);\n#else\nenvironmentIrradiance=computeEnvironmentIrradiance(irradianceVector);\n#endif\n#ifdef SS_TRANSLUCENCY\noutParams.irradianceVector=irradianceVector;\n#endif\n#endif\n#elif defined(USEIRRADIANCEMAP)\nvec4 environmentIrradiance4=sampleReflection(irradianceSampler,reflectionCoords);\nenvironmentIrradiance=environmentIrradiance4.rgb;\n#ifdef RGBDREFLECTION\nenvironmentIrradiance.rgb=fromRGBD(environmentIrradiance4);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentIrradiance.rgb=toLinearSpace(environmentIrradiance.rgb);\n#endif\n#endif\nenvironmentIrradiance*=vReflectionColor.rgb;\noutParams.environmentRadiance=environmentRadiance;\noutParams.environmentIrradiance=environmentIrradiance;\noutParams.reflectionCoords=reflectionCoords;\n}\n#endif\n";x.IncludesShadersStore.pbrBlockSheen="#ifdef SHEEN\nstruct sheenOutParams\n{\nfloat sheenIntensity;\nvec3 sheenColor;\nfloat sheenRoughness;\n#ifdef SHEEN_LINKWITHALBEDO\nvec3 surfaceAlbedo;\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfloat sheenAlbedoScaling;\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nvec3 finalSheenRadianceScaled;\n#endif\n#if DEBUGMODE>0\nvec4 sheenMapData;\nvec3 sheenEnvironmentReflectance;\n#endif\n};\n#define pbr_inline\n#define inline\nvoid sheenBlock(\nconst in vec4 vSheenColor,\n#ifdef SHEEN_ROUGHNESS\nconst in float vSheenRoughness,\n#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\nconst in vec4 sheenMapRoughnessData,\n#endif\n#endif\nconst in float roughness,\n#ifdef SHEEN_TEXTURE\nconst in vec4 sheenMapData,\n#endif\nconst in float reflectance,\n#ifdef SHEEN_LINKWITHALBEDO\nconst in vec3 baseColor,\nconst in vec3 surfaceAlbedo,\n#endif\n#ifdef ENVIRONMENTBRDF\nconst in float NdotV,\nconst in vec3 environmentBrdf,\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nconst in vec2 AARoughnessFactors,\nconst in vec3 vReflectionMicrosurfaceInfos,\nconst in vec2 vReflectionInfos,\nconst in vec3 vReflectionColor,\nconst in vec4 vLightingIntensity,\n#ifdef REFLECTIONMAP_3D\nconst in samplerCube reflectionSampler,\nconst in vec3 reflectionCoords,\n#else\nconst in sampler2D reflectionSampler,\nconst in vec2 reflectionCoords,\n#endif\nconst in float NdotVUnclamped,\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\nconst in samplerCube reflectionSamplerLow,\nconst in samplerCube reflectionSamplerHigh,\n#else\nconst in sampler2D reflectionSamplerLow,\nconst in sampler2D reflectionSamplerHigh,\n#endif\n#endif\n#ifdef REALTIME_FILTERING\nconst in vec2 vReflectionFilteringInfo,\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\nconst in float seo,\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\nconst in float eho,\n#endif\n#endif\nout sheenOutParams outParams\n)\n{\nfloat sheenIntensity=vSheenColor.a;\n#ifdef SHEEN_TEXTURE\n#if DEBUGMODE>0\noutParams.sheenMapData=sheenMapData;\n#endif\n#endif\n#ifdef SHEEN_LINKWITHALBEDO\nfloat sheenFactor=pow5(1.0-sheenIntensity);\nvec3 sheenColor=baseColor.rgb*(1.0-sheenFactor);\nfloat sheenRoughness=sheenIntensity;\noutParams.surfaceAlbedo=surfaceAlbedo*sheenFactor;\n#ifdef SHEEN_TEXTURE\nsheenIntensity*=sheenMapData.a;\n#endif\n#else\nvec3 sheenColor=vSheenColor.rgb;\n#ifdef SHEEN_TEXTURE\nsheenColor.rgb*=sheenMapData.rgb;\n#endif\n#ifdef SHEEN_ROUGHNESS\nfloat sheenRoughness=vSheenRoughness;\n#ifdef SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE\n#if defined(SHEEN_TEXTURE)\nsheenRoughness*=sheenMapData.a;\n#endif\n#elif defined(SHEEN_TEXTURE_ROUGHNESS)\n#ifdef SHEEN_TEXTURE_ROUGHNESS_IDENTICAL\nsheenRoughness*=sheenMapData.a;\n#else\nsheenRoughness*=sheenMapRoughnessData.a;\n#endif\n#endif\n#else\nfloat sheenRoughness=roughness;\n#ifdef SHEEN_TEXTURE\nsheenIntensity*=sheenMapData.a;\n#endif\n#endif\n\n#if !defined(SHEEN_ALBEDOSCALING)\nsheenIntensity*=(1.-reflectance);\n#endif\n\nsheenColor*=sheenIntensity;\n#endif\n\n#ifdef ENVIRONMENTBRDF\n\n#ifdef SHEEN_ROUGHNESS\nvec3 environmentSheenBrdf=getBRDFLookup(NdotV,sheenRoughness);\n#else\nvec3 environmentSheenBrdf=environmentBrdf;\n#endif\n\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nfloat sheenAlphaG=convertRoughnessToAverageSlope(sheenRoughness);\n#ifdef SPECULARAA\n\nsheenAlphaG+=AARoughnessFactors.y;\n#endif\nvec4 environmentSheenRadiance=vec4(0.,0.,0.,0.);\nsampleReflectionTexture(\nsheenAlphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nsheenRoughness,\n#endif\nreflectionSampler,\nreflectionCoords,\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nenvironmentSheenRadiance\n);\nvec3 sheenEnvironmentReflectance=getSheenReflectanceFromBRDFLookup(sheenColor,environmentSheenBrdf);\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\nsheenEnvironmentReflectance*=seo;\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\nsheenEnvironmentReflectance*=eho;\n#endif\n#if DEBUGMODE>0\noutParams.sheenEnvironmentReflectance=sheenEnvironmentReflectance;\n#endif\noutParams.finalSheenRadianceScaled=\nenvironmentSheenRadiance.rgb *\nsheenEnvironmentReflectance *\nvLightingIntensity.z;\n\n\n\n\n\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\n\n\n\noutParams.sheenAlbedoScaling=1.0-sheenIntensity*max(max(sheenColor.r,sheenColor.g),sheenColor.b)*environmentSheenBrdf.b;\n#endif\n\noutParams.sheenIntensity=sheenIntensity;\noutParams.sheenColor=sheenColor;\noutParams.sheenRoughness=sheenRoughness;\n}\n#endif\n";x.IncludesShadersStore.pbrBlockClearcoat="struct clearcoatOutParams\n{\nvec3 specularEnvironmentR0;\nfloat conservationFactor;\nvec3 clearCoatNormalW;\nvec2 clearCoatAARoughnessFactors;\nfloat clearCoatIntensity;\nfloat clearCoatRoughness;\n#ifdef REFLECTION\nvec3 finalClearCoatRadianceScaled;\n#endif\n#ifdef CLEARCOAT_TINT\nvec3 absorption;\nfloat clearCoatNdotVRefract;\nvec3 clearCoatColor;\nfloat clearCoatThickness;\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nvec3 energyConservationFactorClearCoat;\n#endif\n#if DEBUGMODE>0\nmat3 TBNClearCoat;\nvec2 clearCoatMapData;\nvec4 clearCoatTintMapData;\nvec4 environmentClearCoatRadiance;\nfloat clearCoatNdotV;\nvec3 clearCoatEnvironmentReflectance;\n#endif\n};\n#ifdef CLEARCOAT\n#define pbr_inline\n#define inline\nvoid clearcoatBlock(\nconst in vec3 vPositionW,\nconst in vec3 geometricNormalW,\nconst in vec3 viewDirectionW,\nconst in vec2 vClearCoatParams,\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\nconst in vec4 clearCoatMapRoughnessData,\n#endif\nconst in vec3 specularEnvironmentR0,\n#ifdef CLEARCOAT_TEXTURE\nconst in vec2 clearCoatMapData,\n#endif\n#ifdef CLEARCOAT_TINT\nconst in vec4 vClearCoatTintParams,\nconst in float clearCoatColorAtDistance,\nconst in vec4 vClearCoatRefractionParams,\n#ifdef CLEARCOAT_TINT_TEXTURE\nconst in vec4 clearCoatTintMapData,\n#endif\n#endif\n#ifdef CLEARCOAT_BUMP\nconst in vec2 vClearCoatBumpInfos,\nconst in vec4 clearCoatBumpMapData,\nconst in vec2 vClearCoatBumpUV,\n#if defined(TANGENT) && defined(NORMAL)\nconst in mat3 vTBN,\n#else\nconst in vec2 vClearCoatTangentSpaceParams,\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nconst in mat4 normalMatrix,\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nconst in vec3 faceNormal,\n#endif\n#ifdef REFLECTION\nconst in vec3 vReflectionMicrosurfaceInfos,\nconst in vec2 vReflectionInfos,\nconst in vec3 vReflectionColor,\nconst in vec4 vLightingIntensity,\n#ifdef REFLECTIONMAP_3D\nconst in samplerCube reflectionSampler,\n#else\nconst in sampler2D reflectionSampler,\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\nconst in samplerCube reflectionSamplerLow,\nconst in samplerCube reflectionSamplerHigh,\n#else\nconst in sampler2D reflectionSamplerLow,\nconst in sampler2D reflectionSamplerHigh,\n#endif\n#endif\n#ifdef REALTIME_FILTERING\nconst in vec2 vReflectionFilteringInfo,\n#endif\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\nconst in float ambientMonochrome,\n#endif\n#endif\nout clearcoatOutParams outParams\n)\n{\n\nfloat clearCoatIntensity=vClearCoatParams.x;\nfloat clearCoatRoughness=vClearCoatParams.y;\n#ifdef CLEARCOAT_TEXTURE\nclearCoatIntensity*=clearCoatMapData.x;\n#ifdef CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE\nclearCoatRoughness*=clearCoatMapData.y;\n#endif\n#if DEBUGMODE>0\noutParams.clearCoatMapData=clearCoatMapData;\n#endif\n#endif\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\n#ifdef CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL\nclearCoatRoughness*=clearCoatMapData.y;\n#else\nclearCoatRoughness*=clearCoatMapRoughnessData.y;\n#endif\n#endif\noutParams.clearCoatIntensity=clearCoatIntensity;\noutParams.clearCoatRoughness=clearCoatRoughness;\n#ifdef CLEARCOAT_TINT\nvec3 clearCoatColor=vClearCoatTintParams.rgb;\nfloat clearCoatThickness=vClearCoatTintParams.a;\n#ifdef CLEARCOAT_TINT_TEXTURE\nclearCoatColor*=clearCoatTintMapData.rgb;\nclearCoatThickness*=clearCoatTintMapData.a;\n#if DEBUGMODE>0\noutParams.clearCoatTintMapData=clearCoatTintMapData;\n#endif\n#endif\noutParams.clearCoatColor=computeColorAtDistanceInMedia(clearCoatColor,clearCoatColorAtDistance);\noutParams.clearCoatThickness=clearCoatThickness;\n#endif\n\n\n\n\n#ifdef CLEARCOAT_REMAP_F0\nvec3 specularEnvironmentR0Updated=getR0RemappedForClearCoat(specularEnvironmentR0);\n#else\nvec3 specularEnvironmentR0Updated=specularEnvironmentR0;\n#endif\noutParams.specularEnvironmentR0=mix(specularEnvironmentR0,specularEnvironmentR0Updated,clearCoatIntensity);\n\nvec3 clearCoatNormalW=geometricNormalW;\n#ifdef CLEARCOAT_BUMP\n#ifdef NORMALXYSCALE\nfloat clearCoatNormalScale=1.0;\n#else\nfloat clearCoatNormalScale=vClearCoatBumpInfos.y;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBNClearCoat=vTBN;\n#else\nmat3 TBNClearCoat=cotangent_frame(clearCoatNormalW*clearCoatNormalScale,vPositionW,vClearCoatBumpUV,vClearCoatTangentSpaceParams);\n#endif\n#if DEBUGMODE>0\noutParams.TBNClearCoat=TBNClearCoat;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nclearCoatNormalW=normalize(clearCoatBumpMapData.xyz*2.0-1.0);\nclearCoatNormalW=normalize(mat3(normalMatrix)*clearCoatNormalW);\n#else\nclearCoatNormalW=perturbNormal(TBNClearCoat,clearCoatBumpMapData.xyz,vClearCoatBumpInfos.y);\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nclearCoatNormalW*=sign(dot(clearCoatNormalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nclearCoatNormalW=gl_FrontFacing ? clearCoatNormalW : -clearCoatNormalW;\n#endif\noutParams.clearCoatNormalW=clearCoatNormalW;\n\noutParams.clearCoatAARoughnessFactors=getAARoughnessFactors(clearCoatNormalW.xyz);\n\nfloat clearCoatNdotVUnclamped=dot(clearCoatNormalW,viewDirectionW);\n\nfloat clearCoatNdotV=absEps(clearCoatNdotVUnclamped);\n#if DEBUGMODE>0\noutParams.clearCoatNdotV=clearCoatNdotV;\n#endif\n#ifdef CLEARCOAT_TINT\n\nvec3 clearCoatVRefract=-refract(vPositionW,clearCoatNormalW,vClearCoatRefractionParams.y);\n\noutParams.clearCoatNdotVRefract=absEps(dot(clearCoatNormalW,clearCoatVRefract));\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n\nvec3 environmentClearCoatBrdf=getBRDFLookup(clearCoatNdotV,clearCoatRoughness);\n#endif\n\n#if defined(REFLECTION)\nfloat clearCoatAlphaG=convertRoughnessToAverageSlope(clearCoatRoughness);\n#ifdef SPECULARAA\n\nclearCoatAlphaG+=outParams.clearCoatAARoughnessFactors.y;\n#endif\nvec4 environmentClearCoatRadiance=vec4(0.,0.,0.,0.);\nvec3 clearCoatReflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),clearCoatNormalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nclearCoatReflectionVector.z*=-1.0;\n#endif\n\n#ifdef REFLECTIONMAP_3D\nvec3 clearCoatReflectionCoords=clearCoatReflectionVector;\n#else\nvec2 clearCoatReflectionCoords=clearCoatReflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nclearCoatReflectionCoords/=clearCoatReflectionVector.z;\n#endif\nclearCoatReflectionCoords.y=1.0-clearCoatReflectionCoords.y;\n#endif\nsampleReflectionTexture(\nclearCoatAlphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nclearCoatNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nclearCoatRoughness,\n#endif\nreflectionSampler,\nclearCoatReflectionCoords,\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nenvironmentClearCoatRadiance\n);\n#if DEBUGMODE>0\noutParams.environmentClearCoatRadiance=environmentClearCoatRadiance;\n#endif\n\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\nvec3 clearCoatEnvironmentReflectance=getReflectanceFromBRDFLookup(vec3(vClearCoatRefractionParams.x),environmentClearCoatBrdf);\n#ifdef RADIANCEOCCLUSION\nfloat clearCoatSeo=environmentRadianceOcclusion(ambientMonochrome,clearCoatNdotVUnclamped);\nclearCoatEnvironmentReflectance*=clearCoatSeo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat clearCoatEho=environmentHorizonOcclusion(-viewDirectionW,clearCoatNormalW,geometricNormalW);\nclearCoatEnvironmentReflectance*=clearCoatEho;\n#endif\n#endif\n#endif\n#else\n\nvec3 clearCoatEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(clearCoatNdotV,vec3(1.),vec3(1.),sqrt(1.-clearCoatRoughness));\n#endif\nclearCoatEnvironmentReflectance*=clearCoatIntensity;\n#if DEBUGMODE>0\noutParams.clearCoatEnvironmentReflectance=clearCoatEnvironmentReflectance;\n#endif\noutParams.finalClearCoatRadianceScaled=\nenvironmentClearCoatRadiance.rgb *\nclearCoatEnvironmentReflectance *\nvLightingIntensity.z;\n#endif\n#if defined(CLEARCOAT_TINT)\n\noutParams.absorption=computeClearCoatAbsorption(outParams.clearCoatNdotVRefract,outParams.clearCoatNdotVRefract,outParams.clearCoatColor,clearCoatThickness,clearCoatIntensity);\n#endif\n\nfloat fresnelIBLClearCoat=fresnelSchlickGGX(clearCoatNdotV,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);\nfresnelIBLClearCoat*=clearCoatIntensity;\noutParams.conservationFactor=(1.-fresnelIBLClearCoat);\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\noutParams.energyConservationFactorClearCoat=getEnergyConservationFactor(outParams.specularEnvironmentR0,environmentClearCoatBrdf);\n#endif\n}\n#endif\n";x.IncludesShadersStore.pbrBlockSubSurface="struct subSurfaceOutParams\n{\nvec3 specularEnvironmentReflectance;\n#ifdef SS_REFRACTION\nvec3 finalRefraction;\nvec3 surfaceAlbedo;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nfloat alpha;\n#endif\n#ifdef REFLECTION\nfloat refractionFactorForIrradiance;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nvec3 transmittance;\nfloat translucencyIntensity;\n#ifdef REFLECTION\nvec3 refractionIrradiance;\n#endif\n#endif\n#if DEBUGMODE>0\nvec4 thicknessMap;\nvec4 environmentRefraction;\nvec3 refractionTransmittance;\n#endif\n};\n#ifdef SUBSURFACE\n#define pbr_inline\n#define inline\nvoid subSurfaceBlock(\nconst in vec3 vSubSurfaceIntensity,\nconst in vec2 vThicknessParam,\nconst in vec4 vTintColor,\nconst in vec3 normalW,\nconst in vec3 specularEnvironmentReflectance,\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nconst in vec4 thicknessMap,\n#endif\n#ifdef REFLECTION\n#ifdef SS_TRANSLUCENCY\nconst in mat4 reflectionMatrix,\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nconst in vec3 irradianceVector_,\n#endif\n#if defined(REALTIME_FILTERING)\nconst in samplerCube reflectionSampler,\nconst in vec2 vReflectionFilteringInfo,\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n#ifdef REFLECTIONMAP_3D\nconst in samplerCube irradianceSampler,\n#else\nconst in sampler2D irradianceSampler,\n#endif\n#endif\n#endif\n#endif\n#ifdef SS_REFRACTION\nconst in vec3 vPositionW,\nconst in vec3 viewDirectionW,\nconst in mat4 view,\nconst in vec3 surfaceAlbedo,\nconst in vec4 vRefractionInfos,\nconst in mat4 refractionMatrix,\nconst in vec3 vRefractionMicrosurfaceInfos,\nconst in vec4 vLightingIntensity,\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nconst in float alpha,\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\nconst in float NdotVUnclamped,\n#endif\n#ifdef SS_LINEARSPECULARREFRACTION\nconst in float roughness,\n#else\nconst in float alphaG,\n#endif\n#ifdef SS_REFRACTIONMAP_3D\nconst in samplerCube refractionSampler,\n#ifndef LODBASEDMICROSFURACE\nconst in samplerCube refractionSamplerLow,\nconst in samplerCube refractionSamplerHigh,\n#endif\n#else\nconst in sampler2D refractionSampler,\n#ifndef LODBASEDMICROSFURACE\nconst in sampler2D refractionSamplerLow,\nconst in sampler2D refractionSamplerHigh,\n#endif\n#endif\n#ifdef ANISOTROPIC\nconst in anisotropicOutParams anisotropicOut,\n#endif\n#ifdef REALTIME_FILTERING\nconst in vec2 vRefractionFilteringInfo,\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nconst in vec3 vDiffusionDistance,\n#endif\nout subSurfaceOutParams outParams\n)\n{\noutParams.specularEnvironmentReflectance=specularEnvironmentReflectance;\n\n\n\n#ifdef SS_REFRACTION\nfloat refractionIntensity=vSubSurfaceIntensity.x;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nrefractionIntensity*=(1.0-alpha);\n\noutParams.alpha=1.0;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nfloat translucencyIntensity=vSubSurfaceIntensity.y;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nfloat thickness=thicknessMap.r*vThicknessParam.y+vThicknessParam.x;\n#if DEBUGMODE>0\noutParams.thicknessMap=thicknessMap;\n#endif\n#ifdef SS_MASK_FROM_THICKNESS_TEXTURE\n#ifdef SS_REFRACTION\nrefractionIntensity*=thicknessMap.g;\n#endif\n#ifdef SS_TRANSLUCENCY\ntranslucencyIntensity*=thicknessMap.b;\n#endif\n#elif defined(SS_MASK_FROM_THICKNESS_TEXTURE_GLTF)\n#ifdef SS_REFRACTION\nrefractionIntensity*=thicknessMap.r;\n#elif defined(SS_TRANSLUCENCY)\ntranslucencyIntensity*=thicknessMap.r;\n#endif\nthickness=thicknessMap.g*vThicknessParam.y+vThicknessParam.x;\n#endif\n#else\nfloat thickness=vThicknessParam.y;\n#endif\n\n\n\n#ifdef SS_TRANSLUCENCY\nthickness=maxEps(thickness);\nvec3 transmittance=transmittanceBRDF_Burley(vTintColor.rgb,vDiffusionDistance,thickness);\ntransmittance*=translucencyIntensity;\noutParams.transmittance=transmittance;\noutParams.translucencyIntensity=translucencyIntensity;\n#endif\n\n\n\n#ifdef SS_REFRACTION\nvec4 environmentRefraction=vec4(0.,0.,0.,0.);\n#ifdef ANISOTROPIC\nvec3 refractionVector=refract(-viewDirectionW,anisotropicOut.anisotropicNormal,vRefractionInfos.y);\n#else\nvec3 refractionVector=refract(-viewDirectionW,normalW,vRefractionInfos.y);\n#endif\n#ifdef SS_REFRACTIONMAP_OPPOSITEZ\nrefractionVector.z*=-1.0;\n#endif\n\n#ifdef SS_REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nvec3 refractionCoords=refractionVector;\nrefractionCoords=vec3(refractionMatrix*vec4(refractionCoords,0));\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#elif defined(SS_LINEARSPECULARREFRACTION)\nfloat refractionLOD=getLinearLodFromRoughness(vRefractionMicrosurfaceInfos.x,roughness);\n#else\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\n\nrefractionLOD=refractionLOD*vRefractionMicrosurfaceInfos.y+vRefractionMicrosurfaceInfos.z;\n#ifdef SS_LODINREFRACTIONALPHA\n\n\n\n\n\n\n\n\n\nfloat automaticRefractionLOD=UNPACK_LOD(sampleRefraction(refractionSampler,refractionCoords).a);\nfloat requestedRefractionLOD=max(automaticRefractionLOD,refractionLOD);\n#else\nfloat requestedRefractionLOD=refractionLOD;\n#endif\n#ifdef REALTIME_FILTERING\nenvironmentRefraction=vec4(radiance(alphaG,refractionSampler,refractionCoords,vRefractionFilteringInfo),1.0);\n#else\nenvironmentRefraction=sampleRefractionLod(refractionSampler,refractionCoords,requestedRefractionLOD);\n#endif\n#else\nfloat lodRefractionNormalized=saturate(refractionLOD/log2(vRefractionMicrosurfaceInfos.x));\nfloat lodRefractionNormalizedDoubled=lodRefractionNormalized*2.0;\nvec4 environmentRefractionMid=sampleRefraction(refractionSampler,refractionCoords);\nif (lodRefractionNormalizedDoubled<1.0){\nenvironmentRefraction=mix(\nsampleRefraction(refractionSamplerHigh,refractionCoords),\nenvironmentRefractionMid,\nlodRefractionNormalizedDoubled\n);\n} else {\nenvironmentRefraction=mix(\nenvironmentRefractionMid,\nsampleRefraction(refractionSamplerLow,refractionCoords),\nlodRefractionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef SS_RGBDREFRACTION\nenvironmentRefraction.rgb=fromRGBD(environmentRefraction);\n#endif\n#ifdef SS_GAMMAREFRACTION\nenvironmentRefraction.rgb=toLinearSpace(environmentRefraction.rgb);\n#endif\n\nenvironmentRefraction.rgb*=vRefractionInfos.x;\n#endif\n\n\n\n#ifdef SS_REFRACTION\nvec3 refractionTransmittance=vec3(refractionIntensity);\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);\n\n\n\n\n\nrefractionTransmittance*=cocaLambert(volumeAlbedo,thickness);\n#elif defined(SS_LINKREFRACTIONTOTRANSPARENCY)\n\nfloat maxChannel=max(max(surfaceAlbedo.r,surfaceAlbedo.g),surfaceAlbedo.b);\nvec3 volumeAlbedo=saturate(maxChannel*surfaceAlbedo);\n\nenvironmentRefraction.rgb*=volumeAlbedo;\n#else\n\nvec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);\nrefractionTransmittance*=cocaLambert(volumeAlbedo,vThicknessParam.y);\n#endif\n#ifdef SS_ALBEDOFORREFRACTIONTINT\n\nenvironmentRefraction.rgb*=surfaceAlbedo.rgb;\n#endif\n\noutParams.surfaceAlbedo=surfaceAlbedo*(1.-refractionIntensity);\n#ifdef REFLECTION\n\noutParams.refractionFactorForIrradiance=(1.-refractionIntensity);\n\n#endif\n\nvec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);\noutParams.specularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,refractionIntensity);\n\nrefractionTransmittance*=1.0-outParams.specularEnvironmentReflectance;\n#if DEBUGMODE>0\noutParams.refractionTransmittance=refractionTransmittance;\n#endif\noutParams.finalRefraction=environmentRefraction.rgb*refractionTransmittance*vLightingIntensity.z;\n#if DEBUGMODE>0\noutParams.environmentRefraction=environmentRefraction;\n#endif\n#endif\n\n\n\n#if defined(REFLECTION) && defined(SS_TRANSLUCENCY)\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX) || !defined(USESPHERICALFROMREFLECTIONMAP)\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\n#ifdef INVERTCUBICMAP\nirradianceVector.y*=-1.0;\n#endif\n#else\nvec3 irradianceVector=irradianceVector_;\n#endif\n#if defined(USESPHERICALFROMREFLECTIONMAP)\n#if defined(REALTIME_FILTERING)\nvec3 refractionIrradiance=irradiance(reflectionSampler,-irradianceVector,vReflectionFilteringInfo);\n#else\nvec3 refractionIrradiance=computeEnvironmentIrradiance(-irradianceVector);\n#endif\n#elif defined(USEIRRADIANCEMAP)\n#ifdef REFLECTIONMAP_3D\nvec3 irradianceCoords=irradianceVector;\n#else\nvec2 irradianceCoords=irradianceVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nirradianceCoords/=irradianceVector.z;\n#endif\nirradianceCoords.y=1.0-irradianceCoords.y;\n#endif\nvec4 refractionIrradiance=sampleReflection(irradianceSampler,-irradianceCoords);\n#ifdef RGBDREFLECTION\nrefractionIrradiance.rgb=fromRGBD(refractionIrradiance);\n#endif\n#ifdef GAMMAREFLECTION\nrefractionIrradiance.rgb=toLinearSpace(refractionIrradiance.rgb);\n#endif\n#else\nvec4 refractionIrradiance=vec4(0.);\n#endif\nrefractionIrradiance.rgb*=transmittance;\noutParams.refractionIrradiance=refractionIrradiance.rgb;\n#endif\n}\n#endif\n";x.IncludesShadersStore.pbrBlockNormalGeometric="vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#endif\nvec3 geometricNormalW=normalW;\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\ngeometricNormalW=gl_FrontFacing ? geometricNormalW : -geometricNormalW;\n#endif\n";x.IncludesShadersStore.pbrBlockNormalFinal="#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nvec3 faceNormal=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#if defined(TWOSIDEDLIGHTING)\nfaceNormal=gl_FrontFacing ? faceNormal : -faceNormal;\n#endif\nnormalW*=sign(dot(normalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n";x.IncludesShadersStore.pbrBlockLightmapInit="#ifdef LIGHTMAP\nvec4 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset);\n#ifdef RGBDLIGHTMAP\nlightmapColor.rgb=fromRGBD(lightmapColor);\n#endif\n#ifdef GAMMALIGHTMAP\nlightmapColor.rgb=toLinearSpace(lightmapColor.rgb);\n#endif\nlightmapColor.rgb*=vLightmapInfos.y;\n#endif\n";x.IncludesShadersStore.pbrBlockGeometryInfo="float NdotVUnclamped=dot(normalW,viewDirectionW);\n\nfloat NdotV=absEps(NdotVUnclamped);\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nvec2 AARoughnessFactors=getAARoughnessFactors(normalW.xyz);\n#ifdef SPECULARAA\n\nalphaG+=AARoughnessFactors.y;\n#endif\n#if defined(ENVIRONMENTBRDF)\n\nvec3 environmentBrdf=getBRDFLookup(NdotV,roughness);\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\n#ifdef AMBIENTINGRAYSCALE\nfloat ambientMonochrome=aoOut.ambientOcclusionColor.r;\n#else\nfloat ambientMonochrome=getLuminance(aoOut.ambientOcclusionColor);\n#endif\nfloat seo=environmentRadianceOcclusion(ambientMonochrome,NdotVUnclamped);\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat eho=environmentHorizonOcclusion(-viewDirectionW,normalW,geometricNormalW);\n#endif\n#endif\n#endif\n#endif\n";x.IncludesShadersStore.pbrBlockReflectance0="float reflectance=max(max(reflectivityOut.surfaceReflectivityColor.r,reflectivityOut.surfaceReflectivityColor.g),reflectivityOut.surfaceReflectivityColor.b);\nvec3 specularEnvironmentR0=reflectivityOut.surfaceReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvec3 specularEnvironmentR90=vec3(metallicReflectanceFactors.a);\n#else\nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0);\n#endif\n\n#ifdef ALPHAFRESNEL\nfloat reflectance90=fresnelGrazingReflectance(reflectance);\nspecularEnvironmentR90=specularEnvironmentR90*reflectance90;\n#endif\n";x.IncludesShadersStore.pbrBlockReflectance="#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\nvec3 specularEnvironmentReflectance=getReflectanceFromBRDFLookup(clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,environmentBrdf);\n#ifdef RADIANCEOCCLUSION\nspecularEnvironmentReflectance*=seo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nspecularEnvironmentReflectance*=eho;\n#endif\n#endif\n#endif\n#else\n\nvec3 specularEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(NdotV,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n#endif\n#ifdef CLEARCOAT\nspecularEnvironmentReflectance*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nspecularEnvironmentReflectance*=clearcoatOut.absorption;\n#endif\n#endif\n";x.IncludesShadersStore.pbrBlockDirectLighting="vec3 diffuseBase=vec3(0.,0.,0.);\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#ifdef CLEARCOAT\nvec3 clearCoatBase=vec3(0.,0.,0.);\n#endif\n#ifdef SHEEN\nvec3 sheenBase=vec3(0.,0.,0.);\n#endif\n\npreLightingInfo preInfo;\nlightingInfo info;\nfloat shadow=1.;\n#if defined(CLEARCOAT) && defined(CLEARCOAT_TINT)\nvec3 absorption=vec3(0.);\n#endif\n";x.IncludesShadersStore.pbrBlockFinalLitComponents="\n\n\n\n#if defined(ENVIRONMENTBRDF)\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nvec3 energyConservationFactor=getEnergyConservationFactor(clearcoatOut.specularEnvironmentR0,environmentBrdf);\n#endif\n#endif\n#ifndef METALLICWORKFLOW\n#ifdef SPECULAR_GLOSSINESS_ENERGY_CONSERVATION\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\n#endif\n#endif\n#if defined(SHEEN) && defined(SHEEN_ALBEDOSCALING) && defined(ENVIRONMENTBRDF)\nsurfaceAlbedo.rgb=sheenOut.sheenAlbedoScaling*surfaceAlbedo.rgb;\n#endif\n\n#ifdef REFLECTION\nvec3 finalIrradiance=reflectionOut.environmentIrradiance;\n#if defined(CLEARCOAT)\nfinalIrradiance*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nfinalIrradiance*=clearcoatOut.absorption;\n#endif\n#endif\n#if defined(SS_REFRACTION)\nfinalIrradiance*=subSurfaceOut.refractionFactorForIrradiance;\n#endif\n#if defined(SS_TRANSLUCENCY)\nfinalIrradiance*=(1.0-subSurfaceOut.translucencyIntensity);\nfinalIrradiance+=subSurfaceOut.refractionIrradiance;\n#endif\nfinalIrradiance*=surfaceAlbedo.rgb;\nfinalIrradiance*=vLightingIntensity.z;\nfinalIrradiance*=aoOut.ambientOcclusionColor;\n#endif\n\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase;\nfinalSpecular=max(finalSpecular,0.0);\nvec3 finalSpecularScaled=finalSpecular*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalSpecularScaled*=energyConservationFactor;\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfinalSpecularScaled*=sheenOut.sheenAlbedoScaling;\n#endif\n#endif\n\n#ifdef REFLECTION\nvec3 finalRadiance=reflectionOut.environmentRadiance.rgb;\nfinalRadiance*=subSurfaceOut.specularEnvironmentReflectance;\nvec3 finalRadianceScaled=finalRadiance*vLightingIntensity.z;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalRadianceScaled*=energyConservationFactor;\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfinalRadianceScaled*=sheenOut.sheenAlbedoScaling;\n#endif\n#endif\n\n#ifdef SHEEN\nvec3 finalSheen=sheenBase*sheenOut.sheenColor;\nfinalSheen=max(finalSheen,0.0);\nvec3 finalSheenScaled=finalSheen*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(CLEARCOAT) && defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nsheenOut.finalSheenRadianceScaled*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nsheenOut.finalSheenRadianceScaled*=clearcoatOut.absorption;\n#endif\n#endif\n#endif\n\n#ifdef CLEARCOAT\nvec3 finalClearCoat=clearCoatBase;\nfinalClearCoat=max(finalClearCoat,0.0);\nvec3 finalClearCoatScaled=finalClearCoat*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalClearCoatScaled*=clearcoatOut.energyConservationFactorClearCoat;\n#endif\n#ifdef SS_REFRACTION\nsubSurfaceOut.finalRefraction*=clearcoatOut.conservationFactor;\n#ifdef CLEARCOAT_TINT\nsubSurfaceOut.finalRefraction*=clearcoatOut.absorption;\n#endif\n#endif\n#endif\n\n#ifdef ALPHABLEND\nfloat luminanceOverAlpha=0.0;\n#if defined(REFLECTION) && defined(RADIANCEOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalRadianceScaled);\n#if defined(CLEARCOAT)\nluminanceOverAlpha+=getLuminance(clearcoatOut.finalClearCoatRadianceScaled);\n#endif\n#endif\n#if defined(SPECULARTERM) && defined(SPECULAROVERALPHA)\nluminanceOverAlpha+=getLuminance(finalSpecularScaled);\n#endif\n#if defined(CLEARCOAT) && defined(CLEARCOATOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalClearCoatScaled);\n#endif\n#if defined(RADIANCEOVERALPHA) || defined(SPECULAROVERALPHA) || defined(CLEARCOATOVERALPHA)\nalpha=saturate(alpha+luminanceOverAlpha*luminanceOverAlpha);\n#endif\n#endif\n";x.IncludesShadersStore.pbrBlockFinalUnlitComponents="\nvec3 finalDiffuse=diffuseBase;\nfinalDiffuse*=surfaceAlbedo.rgb;\nfinalDiffuse=max(finalDiffuse,0.0);\nfinalDiffuse*=vLightingIntensity.x;\n\nvec3 finalAmbient=vAmbientColor;\nfinalAmbient*=surfaceAlbedo.rgb;\n\nvec3 finalEmissive=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb;\nfinalEmissive*=toLinearSpace(emissiveColorTex.rgb);\nfinalEmissive*=vEmissiveInfos.y;\n#endif\nfinalEmissive*=vLightingIntensity.y;\n\n#ifdef AMBIENT\nvec3 ambientOcclusionForDirectDiffuse=mix(vec3(1.),aoOut.ambientOcclusionColor,vAmbientInfos.w);\n#else\nvec3 ambientOcclusionForDirectDiffuse=aoOut.ambientOcclusionColor;\n#endif\nfinalAmbient*=aoOut.ambientOcclusionColor;\nfinalDiffuse*=ambientOcclusionForDirectDiffuse;\n";x.IncludesShadersStore.pbrBlockFinalColorComposition="vec4 finalColor=vec4(\nfinalAmbient +\nfinalDiffuse +\n#ifndef UNLIT\n#ifdef REFLECTION\nfinalIrradiance +\n#endif\n#ifdef SPECULARTERM\nfinalSpecularScaled +\n#endif\n#ifdef SHEEN\nfinalSheenScaled +\n#endif\n#ifdef CLEARCOAT\nfinalClearCoatScaled +\n#endif\n#ifdef REFLECTION\nfinalRadianceScaled +\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF)\nsheenOut.finalSheenRadianceScaled +\n#endif\n#ifdef CLEARCOAT\nclearcoatOut.finalClearCoatRadianceScaled +\n#endif\n#endif\n#ifdef SS_REFRACTION\nsubSurfaceOut.finalRefraction +\n#endif\n#endif\nfinalEmissive,\nalpha);\n\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\nfinalColor.rgb*=lightmapColor.rgb;\n#else\nfinalColor.rgb+=lightmapColor.rgb;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FOG\n\nfinalColor=max(finalColor,0.0);\n";x.IncludesShadersStore.pbrBlockImageProcessing="#ifdef IMAGEPROCESSINGPOSTPROCESS\n\n\nfinalColor.rgb=clamp(finalColor.rgb,0.,30.0);\n#else\n\nfinalColor=applyImageProcessing(finalColor);\n#endif\nfinalColor.a*=visibility;\n#ifdef PREMULTIPLYALPHA\n\nfinalColor.rgb*=finalColor.a;\n#endif\n";x.IncludesShadersStore.pbrDebug="#if DEBUGMODE>0\nif (vClipSpacePosition.x/vClipSpacePosition.w>=vDebugMode.x) {\n\n#if DEBUGMODE == 1\ngl_FragColor.rgb=vPositionW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 2 && defined(NORMAL)\ngl_FragColor.rgb=vNormalW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 3 && defined(BUMP) || DEBUGMODE == 3 && defined(PARALLAX) || DEBUGMODE == 3 && defined(ANISOTROPIC)\n\ngl_FragColor.rgb=TBN[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 4 && defined(BUMP) || DEBUGMODE == 4 && defined(PARALLAX) || DEBUGMODE == 4 && defined(ANISOTROPIC)\n\ngl_FragColor.rgb=TBN[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 5\n\ngl_FragColor.rgb=normalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 6 && defined(MAINUV1)\ngl_FragColor.rgb=vec3(vMainUV1,0.0);\n#elif DEBUGMODE == 7 && defined(MAINUV2)\ngl_FragColor.rgb=vec3(vMainUV2,0.0);\n#elif DEBUGMODE == 8 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\n\ngl_FragColor.rgb=clearcoatOut.TBNClearCoat[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 9 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\n\ngl_FragColor.rgb=clearcoatOut.TBNClearCoat[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 10 && defined(CLEARCOAT)\n\ngl_FragColor.rgb=clearcoatOut.clearCoatNormalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 11 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicOut.anisotropicNormal;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 12 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicOut.anisotropicTangent;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 13 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicOut.anisotropicBitangent;\n#define DEBUGMODE_NORMALIZE\n\n#elif DEBUGMODE == 20 && defined(ALBEDO)\ngl_FragColor.rgb=albedoTexture.rgb;\n#elif DEBUGMODE == 21 && defined(AMBIENT)\ngl_FragColor.rgb=aoOut.ambientOcclusionColorMap.rgb;\n#elif DEBUGMODE == 22 && defined(OPACITY)\ngl_FragColor.rgb=opacityMap.rgb;\n#elif DEBUGMODE == 23 && defined(EMISSIVE)\ngl_FragColor.rgb=emissiveColorTex.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 24 && defined(LIGHTMAP)\ngl_FragColor.rgb=lightmapColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 25 && defined(REFLECTIVITY) && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=reflectivityOut.surfaceMetallicColorMap.rgb;\n#elif DEBUGMODE == 26 && defined(REFLECTIVITY) && !defined(METALLICWORKFLOW)\ngl_FragColor.rgb=reflectivityOut.surfaceReflectivityColorMap.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 27 && defined(CLEARCOAT) && defined(CLEARCOAT_TEXTURE)\ngl_FragColor.rgb=vec3(clearcoatOut.clearCoatMapData.rg,0.0);\n#elif DEBUGMODE == 28 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\ngl_FragColor.rgb=clearcoatOut.clearCoatTintMapData.rgb;\n#elif DEBUGMODE == 29 && defined(SHEEN) && defined(SHEEN_TEXTURE)\ngl_FragColor.rgb=sheenOut.sheenMapData.rgb;\n#elif DEBUGMODE == 30 && defined(ANISOTROPIC) && defined(ANISOTROPIC_TEXTURE)\ngl_FragColor.rgb=anisotropicOut.anisotropyMapData.rgb;\n#elif DEBUGMODE == 31 && defined(SUBSURFACE) && defined(SS_THICKNESSANDMASK_TEXTURE)\ngl_FragColor.rgb=subSurfaceOut.thicknessMap.rgb;\n\n#elif DEBUGMODE == 40 && defined(SS_REFRACTION)\n\ngl_FragColor.rgb=subSurfaceOut.environmentRefraction.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 41 && defined(REFLECTION)\ngl_FragColor.rgb=reflectionOut.environmentRadiance.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 42 && defined(CLEARCOAT) && defined(REFLECTION)\ngl_FragColor.rgb=clearcoatOut.environmentClearCoatRadiance.rgb;\n#define DEBUGMODE_GAMMA\n\n#elif DEBUGMODE == 50\ngl_FragColor.rgb=diffuseBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 51 && defined(SPECULARTERM)\ngl_FragColor.rgb=specularBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 52 && defined(CLEARCOAT)\ngl_FragColor.rgb=clearCoatBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 53 && defined(SHEEN)\ngl_FragColor.rgb=sheenBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 54 && defined(REFLECTION)\ngl_FragColor.rgb=reflectionOut.environmentIrradiance.rgb;\n#define DEBUGMODE_GAMMA\n\n#elif DEBUGMODE == 60\ngl_FragColor.rgb=surfaceAlbedo.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 61\ngl_FragColor.rgb=clearcoatOut.specularEnvironmentR0;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 62 && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=vec3(reflectivityOut.metallicRoughness.r);\n#elif DEBUGMODE == 71 && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=reflectivityOut.metallicF0;\n#elif DEBUGMODE == 63\ngl_FragColor.rgb=vec3(roughness);\n#elif DEBUGMODE == 64\ngl_FragColor.rgb=vec3(alphaG);\n#elif DEBUGMODE == 65\ngl_FragColor.rgb=vec3(NdotV);\n#elif DEBUGMODE == 66 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT)\ngl_FragColor.rgb=clearcoatOut.clearCoatColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 67 && defined(CLEARCOAT)\ngl_FragColor.rgb=vec3(clearcoatOut.clearCoatRoughness);\n#elif DEBUGMODE == 68 && defined(CLEARCOAT)\ngl_FragColor.rgb=vec3(clearcoatOut.clearCoatNdotV);\n#elif DEBUGMODE == 69 && defined(SUBSURFACE) && defined(SS_TRANSLUCENCY)\ngl_FragColor.rgb=subSurfaceOut.transmittance;\n#elif DEBUGMODE == 70 && defined(SUBSURFACE) && defined(SS_REFRACTION)\ngl_FragColor.rgb=subSurfaceOut.refractionTransmittance;\n\n#elif DEBUGMODE == 80 && defined(RADIANCEOCCLUSION)\ngl_FragColor.rgb=vec3(seo);\n#elif DEBUGMODE == 81 && defined(HORIZONOCCLUSION)\ngl_FragColor.rgb=vec3(eho);\n#elif DEBUGMODE == 82 && defined(MS_BRDF_ENERGY_CONSERVATION)\ngl_FragColor.rgb=vec3(energyConservationFactor);\n#elif DEBUGMODE == 83 && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ngl_FragColor.rgb=specularEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 84 && defined(CLEARCOAT) && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ngl_FragColor.rgb=clearcoatOut.clearCoatEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 85 && defined(SHEEN) && defined(REFLECTION)\ngl_FragColor.rgb=sheenOut.sheenEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 86 && defined(ALPHABLEND)\ngl_FragColor.rgb=vec3(luminanceOverAlpha);\n#elif DEBUGMODE == 87\ngl_FragColor.rgb=vec3(alpha);\n#endif\ngl_FragColor.rgb*=vDebugMode.y;\n#ifdef DEBUGMODE_NORMALIZE\ngl_FragColor.rgb=normalize(gl_FragColor.rgb)*0.5+0.5;\n#endif\n#ifdef DEBUGMODE_GAMMA\ngl_FragColor.rgb=toGammaSpace(gl_FragColor.rgb);\n#endif\ngl_FragColor.a=1.0;\n#ifdef PREPASS\ngl_FragData[0]=toLinearSpace(gl_FragColor);\ngl_FragData[1]=vec4(0.,0.,0.,0.);\n#endif\nreturn;\n}\n#endif";x.ShadersStore.pbrPixelShader="#if defined(BUMP) || !defined(NORMAL) || defined(FORCENORMALFORWARD) || defined(SPECULARAA) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LODBASEDMICROSFURACE\n#extension GL_EXT_shader_texture_lod : enable\n#endif\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<prePassDeclaration>[SCENE_MRT_COUNT]\nprecision highp float;\n\n#ifndef FROMLINEARSPACE\n#define FROMLINEARSPACE\n#endif\n\n#include<__decl__pbrFragment>\n#include<pbrFragmentExtraDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<pbrFragmentSamplersDeclaration>\n#include<imageProcessingDeclaration>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n\n#include<helperFunctions>\n#include<subSurfaceScatteringFunctions>\n#include<importanceSampling>\n#include<pbrHelperFunctions>\n#include<imageProcessingFunctions>\n#include<shadowsFragmentFunctions>\n#include<harmonicsFunctions>\n#include<pbrDirectLightingSetupFunctions>\n#include<pbrDirectLightingFalloffFunctions>\n#include<pbrBRDFFunctions>\n#include<hdrFilteringFunctions>\n#include<pbrDirectLightingFunctions>\n#include<pbrIBLFunctions>\n#include<bumpFragmentMainFunctions>\n#include<bumpFragmentFunctions>\n#ifdef REFLECTION\n#include<reflectionFunction>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\n#include<pbrBlockAlbedoOpacity>\n#include<pbrBlockReflectivity>\n#include<pbrBlockAmbientOcclusion>\n#include<pbrBlockAlphaFresnel>\n#include<pbrBlockAnisotropic>\n#include<pbrBlockReflection>\n#include<pbrBlockSheen>\n#include<pbrBlockClearcoat>\n#include<pbrBlockSubSurface>\n\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n\n#include<pbrBlockNormalGeometric>\n#include<bumpFragment>\n#include<pbrBlockNormalFinal>\n\nalbedoOpacityOutParams albedoOpacityOut;\n#ifdef ALBEDO\nvec4 albedoTexture=texture2D(albedoSampler,vAlbedoUV+uvOffset);\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#endif\nalbedoOpacityBlock(\nvAlbedoColor,\n#ifdef ALBEDO\nalbedoTexture,\nvAlbedoInfos,\n#endif\n#ifdef OPACITY\nopacityMap,\nvOpacityInfos,\n#endif\n#ifdef DETAIL\ndetailColor,\nvDetailInfos,\n#endif\nalbedoOpacityOut\n);\nvec3 surfaceAlbedo=albedoOpacityOut.surfaceAlbedo;\nfloat alpha=albedoOpacityOut.alpha;\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\n#include<depthPrePass>\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\n\nambientOcclusionOutParams aoOut;\n#ifdef AMBIENT\nvec3 ambientOcclusionColorMap=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb;\n#endif\nambientOcclusionBlock(\n#ifdef AMBIENT\nambientOcclusionColorMap,\nvAmbientInfos,\n#endif\naoOut\n);\n#include<pbrBlockLightmapInit>\n#ifdef UNLIT\nvec3 diffuseBase=vec3(1.,1.,1.);\n#else\n\nvec3 baseColor=surfaceAlbedo;\nreflectivityOutParams reflectivityOut;\n#if defined(REFLECTIVITY)\nvec4 surfaceMetallicOrReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);\nvec4 baseReflectivity=surfaceMetallicOrReflectivityColorMap;\n#ifndef METALLICWORKFLOW\nsurfaceMetallicOrReflectivityColorMap=toLinearSpace(surfaceMetallicOrReflectivityColorMap);\nsurfaceMetallicOrReflectivityColorMap.rgb*=vReflectivityInfos.y;\n#endif\n#endif\n#if defined(MICROSURFACEMAP)\nvec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;\n#endif\n#ifdef METALLICWORKFLOW\nvec4 metallicReflectanceFactors=vMetallicReflectanceFactors;\n#ifdef METALLIC_REFLECTANCE\nvec4 metallicReflectanceFactorsMap=texture2D(metallicReflectanceSampler,vMetallicReflectanceUV+uvOffset);\nmetallicReflectanceFactorsMap=toLinearSpace(metallicReflectanceFactorsMap);\nmetallicReflectanceFactors*=metallicReflectanceFactorsMap;\n#endif\n#endif\nreflectivityBlock(\nvReflectivityColor,\n#ifdef METALLICWORKFLOW\nsurfaceAlbedo,\nmetallicReflectanceFactors,\n#endif\n#ifdef REFLECTIVITY\nvReflectivityInfos,\nsurfaceMetallicOrReflectivityColorMap,\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\naoOut.ambientOcclusionColor,\n#endif\n#ifdef MICROSURFACEMAP\nmicroSurfaceTexel,\n#endif\n#ifdef DETAIL\ndetailColor,\nvDetailInfos,\n#endif\nreflectivityOut\n);\nfloat microSurface=reflectivityOut.microSurface;\nfloat roughness=reflectivityOut.roughness;\n#ifdef METALLICWORKFLOW\nsurfaceAlbedo=reflectivityOut.surfaceAlbedo;\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\naoOut.ambientOcclusionColor=reflectivityOut.ambientOcclusionColor;\n#endif\n\n#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\nalphaFresnelOutParams alphaFresnelOut;\nalphaFresnelBlock(\nnormalW,\nviewDirectionW,\nalpha,\nmicroSurface,\nalphaFresnelOut\n);\nalpha=alphaFresnelOut.alpha;\n#endif\n#endif\n\n#include<pbrBlockGeometryInfo>\n\n#ifdef ANISOTROPIC\nanisotropicOutParams anisotropicOut;\n#ifdef ANISOTROPIC_TEXTURE\nvec3 anisotropyMapData=texture2D(anisotropySampler,vAnisotropyUV+uvOffset).rgb*vAnisotropyInfos.y;\n#endif\nanisotropicBlock(\nvAnisotropy,\n#ifdef ANISOTROPIC_TEXTURE\nanisotropyMapData,\n#endif\nTBN,\nnormalW,\nviewDirectionW,\nanisotropicOut\n);\n#endif\n\n#ifdef REFLECTION\nreflectionOutParams reflectionOut;\nreflectionBlock(\nvPositionW,\nnormalW,\nalphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#ifdef ANISOTROPIC\nanisotropicOut,\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nroughness,\n#endif\nreflectionSampler,\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nvEnvironmentIrradiance,\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nreflectionMatrix,\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\nirradianceSampler,\n#endif\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nreflectionOut\n);\n#endif\n\n#include<pbrBlockReflectance0>\n\n#ifdef SHEEN\nsheenOutParams sheenOut;\n#ifdef SHEEN_TEXTURE\nvec4 sheenMapData=toLinearSpace(texture2D(sheenSampler,vSheenUV+uvOffset))*vSheenInfos.y;\n#endif\n#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\nvec4 sheenMapRoughnessData=texture2D(sheenRoughnessSampler,vSheenRoughnessUV+uvOffset)*vSheenInfos.w;\n#endif\nsheenBlock(\nvSheenColor,\n#ifdef SHEEN_ROUGHNESS\nvSheenRoughness,\n#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\nsheenMapRoughnessData,\n#endif\n#endif\nroughness,\n#ifdef SHEEN_TEXTURE\nsheenMapData,\n#endif\nreflectance,\n#ifdef SHEEN_LINKWITHALBEDO\nbaseColor,\nsurfaceAlbedo,\n#endif\n#ifdef ENVIRONMENTBRDF\nNdotV,\nenvironmentBrdf,\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nAARoughnessFactors,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\nvLightingIntensity,\nreflectionSampler,\nreflectionOut.reflectionCoords,\nNdotVUnclamped,\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\nseo,\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\neho,\n#endif\n#endif\nsheenOut\n);\n#ifdef SHEEN_LINKWITHALBEDO\nsurfaceAlbedo=sheenOut.surfaceAlbedo;\n#endif\n#endif\n\nclearcoatOutParams clearcoatOut;\n#ifdef CLEARCOAT\n#ifdef CLEARCOAT_TEXTURE\nvec2 clearCoatMapData=texture2D(clearCoatSampler,vClearCoatUV+uvOffset).rg*vClearCoatInfos.y;\n#endif\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\nvec4 clearCoatMapRoughnessData=texture2D(clearCoatRoughnessSampler,vClearCoatRoughnessUV+uvOffset)*vClearCoatInfos.w;\n#endif\n#if defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\nvec4 clearCoatTintMapData=toLinearSpace(texture2D(clearCoatTintSampler,vClearCoatTintUV+uvOffset));\n#endif\n#ifdef CLEARCOAT_BUMP\nvec4 clearCoatBumpMapData=texture2D(clearCoatBumpSampler,vClearCoatBumpUV+uvOffset);\n#endif\nclearcoatBlock(\nvPositionW,\ngeometricNormalW,\nviewDirectionW,\nvClearCoatParams,\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\nclearCoatMapRoughnessData,\n#endif\nspecularEnvironmentR0,\n#ifdef CLEARCOAT_TEXTURE\nclearCoatMapData,\n#endif\n#ifdef CLEARCOAT_TINT\nvClearCoatTintParams,\nclearCoatColorAtDistance,\nvClearCoatRefractionParams,\n#ifdef CLEARCOAT_TINT_TEXTURE\nclearCoatTintMapData,\n#endif\n#endif\n#ifdef CLEARCOAT_BUMP\nvClearCoatBumpInfos,\nclearCoatBumpMapData,\nvClearCoatBumpUV,\n#if defined(TANGENT) && defined(NORMAL)\nvTBN,\n#else\nvClearCoatTangentSpaceParams,\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nnormalMatrix,\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nfaceNormal,\n#endif\n#ifdef REFLECTION\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\nvLightingIntensity,\nreflectionSampler,\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\nambientMonochrome,\n#endif\n#endif\nclearcoatOut\n);\n#else\nclearcoatOut.specularEnvironmentR0=specularEnvironmentR0;\n#endif\n\n#include<pbrBlockReflectance>\n\nsubSurfaceOutParams subSurfaceOut;\n#ifdef SUBSURFACE\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvec4 thicknessMap=texture2D(thicknessSampler,vThicknessUV+uvOffset);\n#endif\nsubSurfaceBlock(\nvSubSurfaceIntensity,\nvThicknessParam,\nvTintColor,\nnormalW,\nspecularEnvironmentReflectance,\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nthicknessMap,\n#endif\n#ifdef REFLECTION\n#ifdef SS_TRANSLUCENCY\nreflectionMatrix,\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nreflectionOut.irradianceVector,\n#endif\n#if defined(REALTIME_FILTERING)\nreflectionSampler,\nvReflectionFilteringInfo,\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\nirradianceSampler,\n#endif\n#endif\n#endif\n#ifdef SS_REFRACTION\nvPositionW,\nviewDirectionW,\nview,\nsurfaceAlbedo,\nvRefractionInfos,\nrefractionMatrix,\nvRefractionMicrosurfaceInfos,\nvLightingIntensity,\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nalpha,\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\nNdotVUnclamped,\n#endif\n#ifdef SS_LINEARSPECULARREFRACTION\nroughness,\n#else\nalphaG,\n#endif\nrefractionSampler,\n#ifndef LODBASEDMICROSFURACE\nrefractionSamplerLow,\nrefractionSamplerHigh,\n#endif\n#ifdef ANISOTROPIC\nanisotropicOut,\n#endif\n#ifdef REALTIME_FILTERING\nvRefractionFilteringInfo,\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nvDiffusionDistance,\n#endif\nsubSurfaceOut\n);\n#ifdef SS_REFRACTION\nsurfaceAlbedo=subSurfaceOut.surfaceAlbedo;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nalpha=subSurfaceOut.alpha;\n#endif\n#endif\n#else\nsubSurfaceOut.specularEnvironmentReflectance=specularEnvironmentReflectance;\n#endif\n\n#include<pbrBlockDirectLighting>\n#include<lightFragment>[0..maxSimultaneousLights]\n\n#include<pbrBlockFinalLitComponents>\n#endif\n#include<pbrBlockFinalUnlitComponents>\n#include<pbrBlockFinalColorComposition>\n#include<logDepthFragment>\n#include<fogFragment>(color,finalColor)\n#include<pbrBlockImageProcessing>\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\n#ifdef PREPASS\n#ifdef PREPASS_POSITION\ngl_FragData[PREPASS_POSITION_INDEX]=vec4(vPositionW,1.0);\n#endif\n#ifdef PREPASS_VELOCITY\nvec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;\nvec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;\nvec2 velocity=abs(a-b);\nvelocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;\ngl_FragData[PREPASS_VELOCITY_INDEX]=vec4(velocity,0.0,1.0);\n#endif\n#ifdef PREPASS_IRRADIANCE\nvec3 irradiance=finalDiffuse;\n#ifndef UNLIT\n#ifdef REFLECTION\nirradiance+=finalIrradiance;\n#endif\n#endif\nvec3 sqAlbedo=sqrt(surfaceAlbedo);\n#ifdef SS_SCATTERING\ngl_FragData[0]=vec4(finalColor.rgb-irradiance,finalColor.a);\nirradiance/=sqAlbedo;\n#else\ngl_FragData[0]=finalColor;\nfloat scatteringDiffusionProfile=255.;\n#endif\ngl_FragData[PREPASS_IRRADIANCE_INDEX]=vec4(irradiance,scatteringDiffusionProfile/255.);\n#else\ngl_FragData[0]=vec4(finalColor.rgb,finalColor.a);\n#endif\n#ifdef PREPASS_DEPTHNORMAL\ngl_FragData[PREPASS_DEPTHNORMAL_INDEX]=vec4(vViewPos.z,(view*vec4(normalW,0.0)).rgb);\n#endif\n#ifdef PREPASS_ALBEDO\ngl_FragData[PREPASS_ALBEDO_INDEX]=vec4(sqAlbedo,1.0);\n#endif\n#ifdef PREPASS_REFLECTIVITY\n#if defined(REFLECTIVITY)\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(baseReflectivity.rgb,1.0);\n#else\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(0.0,0.0,0.0,1.0);\n#endif\n#endif\n#endif\n#if !defined(PREPASS) || defined(WEBGL2)\ngl_FragColor=finalColor;\n#endif\n#include<pbrDebug>\n}\n";x.IncludesShadersStore.pbrVertexDeclaration="uniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef ALBEDO\nuniform mat4 albedoMatrix;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec4 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#ifdef REFLECTIVITY\nuniform vec3 vReflectivityInfos;\nuniform mat4 reflectivityMatrix;\n#endif\n#ifdef METALLIC_REFLECTANCE\nuniform vec2 vMetallicReflectanceInfos;\nuniform mat4 metallicReflectanceMatrix;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\nuniform mat4 microSurfaceSamplerMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\n#endif\n\n#ifdef CLEARCOAT\n#if defined(CLEARCOAT_TEXTURE) || defined(CLEARCOAT_TEXTURE_ROUGHNESS)\nuniform vec4 vClearCoatInfos;\n#endif\n#ifdef CLEARCOAT_TEXTURE\nuniform mat4 clearCoatMatrix;\n#endif\n#ifdef CLEARCOAT_TEXTURE_ROUGHNESS\nuniform mat4 clearCoatRoughnessMatrix;\n#endif\n#ifdef CLEARCOAT_BUMP\nuniform vec2 vClearCoatBumpInfos;\nuniform mat4 clearCoatBumpMatrix;\n#endif\n#ifdef CLEARCOAT_TINT_TEXTURE\nuniform vec2 vClearCoatTintInfos;\nuniform mat4 clearCoatTintMatrix;\n#endif\n#endif\n\n#ifdef ANISOTROPIC\n#ifdef ANISOTROPIC_TEXTURE\nuniform vec2 vAnisotropyInfos;\nuniform mat4 anisotropyMatrix;\n#endif\n#endif\n\n#ifdef SHEEN\n#if defined(SHEEN_TEXTURE) || defined(SHEEN_TEXTURE_ROUGHNESS)\nuniform vec4 vSheenInfos;\n#endif\n#ifdef SHEEN_TEXTURE\nuniform mat4 sheenMatrix;\n#endif\n#ifdef SHEEN_TEXTURE_ROUGHNESS\nuniform mat4 sheenRoughnessMatrix;\n#endif\n#endif\n\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nuniform vec2 vThicknessInfos;\nuniform mat4 thicknessMatrix;\n#endif\n#endif\n";x.ShadersStore.pbrVertexShader="precision highp float;\n#include<__decl__pbrVertex>\n#define CUSTOM_VERTEX_BEGIN\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#include<prePassVertexDeclaration>\n#if defined(ALBEDO) && ALBEDODIRECTUV == 0\nvarying vec2 vAlbedoUV;\n#endif\n#if defined(DETAIL) && DETAILDIRECTUV == 0\nvarying vec2 vDetailUV;\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nvarying vec2 vAmbientUV;\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nvarying vec2 vOpacityUV;\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nvarying vec2 vEmissiveUV;\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nvarying vec2 vLightmapUV;\n#endif\n#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0\nvarying vec2 vReflectivityUV;\n#endif\n#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0\nvarying vec2 vMicroSurfaceSamplerUV;\n#endif\n#if defined(METALLIC_REFLECTANCE) && METALLIC_REFLECTANCEDIRECTUV == 0\nvarying vec2 vMetallicReflectanceUV;\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nvarying vec2 vBumpUV;\n#endif\n#ifdef CLEARCOAT\n#if defined(CLEARCOAT_TEXTURE) && CLEARCOAT_TEXTUREDIRECTUV == 0\nvarying vec2 vClearCoatUV;\n#endif\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV == 0\nvarying vec2 vClearCoatRoughnessUV;\n#endif\n#if defined(CLEARCOAT_BUMP) && CLEARCOAT_BUMPDIRECTUV == 0\nvarying vec2 vClearCoatBumpUV;\n#endif\n#if defined(CLEARCOAT_TINT_TEXTURE) && CLEARCOAT_TINT_TEXTUREDIRECTUV == 0\nvarying vec2 vClearCoatTintUV;\n#endif\n#endif\n#ifdef SHEEN\n#if defined(SHEEN_TEXTURE) && SHEEN_TEXTUREDIRECTUV == 0\nvarying vec2 vSheenUV;\n#endif\n#if defined(SHEEN_TEXTURE_ROUGHNESS) && SHEEN_TEXTURE_ROUGHNESSDIRECTUV == 0\nvarying vec2 vSheenRoughnessUV;\n#endif\n#endif\n#ifdef ANISOTROPIC\n#if defined(ANISOTROPIC_TEXTURE) && ANISOTROPIC_TEXTUREDIRECTUV == 0\nvarying vec2 vAnisotropyUV;\n#endif\n#endif\n#ifdef SUBSURFACE\n#if defined(SS_THICKNESSANDMASK_TEXTURE) && SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 0\nvarying vec2 vThicknessUV;\n#endif\n#endif\n\nvarying vec3 vPositionW;\n#if DEBUGMODE>0\nvarying vec4 vClipSpacePosition;\n#endif\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#include<harmonicsFunctions>\n#endif\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=positionUpdated;\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)\n\nvCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvPreviousPosition=previousViewProjection*previousWorld*vec4(positionUpdated,1.0);\n#endif\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\nvPositionW=vec3(worldPos);\n#include<prePassVertex>\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#if defined(INSTANCES) && defined(THIN_INSTANCES)\nvNormalW=normalUpdated/vec3(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));\nvNormalW=normalize(normalWorld*vNormalW);\n#else\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvec3 reflectionVector=vec3(reflectionMatrix*vec4(vNormalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\nvEnvironmentIrradiance=computeEnvironmentIrradiance(reflectionVector);\n#endif\n#endif\n#define CUSTOM_VERTEX_UPDATE_WORLDPOS\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR == 0u) {\ngl_Position=viewProjection*worldPos;\n} else {\ngl_Position=viewProjectionR*worldPos;\n}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\n#if DEBUGMODE>0\nvClipSpacePosition=gl_Position;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uvUpdated=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uvUpdated;\n#endif\n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif\n#if defined(ALBEDO) && ALBEDODIRECTUV == 0\nif (vAlbedoInfos.x == 0.)\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(DETAIL) && DETAILDIRECTUV == 0\nif (vDetailInfos.x == 0.)\n{\nvDetailUV=vec2(detailMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvDetailUV=vec2(detailMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0\nif (vReflectivityInfos.x == 0.)\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0\nif (vMicroSurfaceSamplerInfos.x == 0.)\n{\nvMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(METALLIC_REFLECTANCE) && METALLIC_REFLECTANCEDIRECTUV == 0\nif (vMetallicReflectanceInfos.x == 0.)\n{\nvMetallicReflectanceUV=vec2(metallicReflectanceMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvMetallicReflectanceUV=vec2(metallicReflectanceMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef CLEARCOAT\n#if defined(CLEARCOAT_TEXTURE) && CLEARCOAT_TEXTUREDIRECTUV == 0\nif (vClearCoatInfos.x == 0.)\n{\nvClearCoatUV=vec2(clearCoatMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvClearCoatUV=vec2(clearCoatMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV == 0\nif (vClearCoatInfos.z == 0.)\n{\nvClearCoatRoughnessUV=vec2(clearCoatRoughnessMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvClearCoatRoughnessUV=vec2(clearCoatRoughnessMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(CLEARCOAT_BUMP) && CLEARCOAT_BUMPDIRECTUV == 0\nif (vClearCoatBumpInfos.x == 0.)\n{\nvClearCoatBumpUV=vec2(clearCoatBumpMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvClearCoatBumpUV=vec2(clearCoatBumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(CLEARCOAT_TINT_TEXTURE) && CLEARCOAT_TINT_TEXTUREDIRECTUV == 0\nif (vClearCoatTintInfos.x == 0.)\n{\nvClearCoatTintUV=vec2(clearCoatTintMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvClearCoatTintUV=vec2(clearCoatTintMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#endif\n#ifdef SHEEN\n#if defined(SHEEN_TEXTURE) && SHEEN_TEXTUREDIRECTUV == 0\nif (vSheenInfos.x == 0.)\n{\nvSheenUV=vec2(sheenMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvSheenUV=vec2(sheenMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SHEEN_TEXTURE_ROUGHNESS) && SHEEN_TEXTURE_ROUGHNESSDIRECTUV == 0\nif (vSheenInfos.z == 0.)\n{\nvSheenRoughnessUV=vec2(sheenRoughnessMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvSheenRoughnessUV=vec2(sheenRoughnessMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#endif\n#ifdef ANISOTROPIC\n#if defined(ANISOTROPIC_TEXTURE) && ANISOTROPIC_TEXTUREDIRECTUV == 0\nif (vAnisotropyInfos.x == 0.)\n{\nvAnisotropyUV=vec2(anisotropyMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvAnisotropyUV=vec2(anisotropyMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#endif\n#ifdef SUBSURFACE\n#if defined(SS_THICKNESSANDMASK_TEXTURE) && SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 0\nif (vThicknessInfos.x == 0.)\n{\nvThicknessUV=vec2(thicknessMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvThicknessUV=vec2(thicknessMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#endif\n\n#include<bumpVertex>\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";var on={effect:null,subMesh:null},an=function(e){function n(){var n=e.call(this)||this;return n.PBR=!0,n.NUM_SAMPLES="0",n.REALTIME_FILTERING=!1,n.MAINUV1=!1,n.MAINUV2=!1,n.UV1=!1,n.UV2=!1,n.ALBEDO=!1,n.GAMMAALBEDO=!1,n.ALBEDODIRECTUV=0,n.VERTEXCOLOR=!1,n.DETAIL=!1,n.DETAILDIRECTUV=0,n.DETAIL_NORMALBLENDMETHOD=0,n.AMBIENT=!1,n.AMBIENTDIRECTUV=0,n.AMBIENTINGRAYSCALE=!1,n.OPACITY=!1,n.VERTEXALPHA=!1,n.OPACITYDIRECTUV=0,n.OPACITYRGB=!1,n.ALPHATEST=!1,n.DEPTHPREPASS=!1,n.ALPHABLEND=!1,n.ALPHAFROMALBEDO=!1,n.ALPHATESTVALUE="0.5",n.SPECULAROVERALPHA=!1,n.RADIANCEOVERALPHA=!1,n.ALPHAFRESNEL=!1,n.LINEARALPHAFRESNEL=!1,n.PREMULTIPLYALPHA=!1,n.EMISSIVE=!1,n.EMISSIVEDIRECTUV=0,n.REFLECTIVITY=!1,n.REFLECTIVITYDIRECTUV=0,n.SPECULARTERM=!1,n.MICROSURFACEFROMREFLECTIVITYMAP=!1,n.MICROSURFACEAUTOMATIC=!1,n.LODBASEDMICROSFURACE=!1,n.MICROSURFACEMAP=!1,n.MICROSURFACEMAPDIRECTUV=0,n.METALLICWORKFLOW=!1,n.ROUGHNESSSTOREINMETALMAPALPHA=!1,n.ROUGHNESSSTOREINMETALMAPGREEN=!1,n.METALLNESSSTOREINMETALMAPBLUE=!1,n.AOSTOREINMETALMAPRED=!1,n.METALLIC_REFLECTANCE=!1,n.METALLIC_REFLECTANCEDIRECTUV=0,n.ENVIRONMENTBRDF=!1,n.ENVIRONMENTBRDF_RGBD=!1,n.NORMAL=!1,n.TANGENT=!1,n.BUMP=!1,n.BUMPDIRECTUV=0,n.OBJECTSPACE_NORMALMAP=!1,n.PARALLAX=!1,n.PARALLAXOCCLUSION=!1,n.NORMALXYSCALE=!0,n.LIGHTMAP=!1,n.LIGHTMAPDIRECTUV=0,n.USELIGHTMAPASSHADOWMAP=!1,n.GAMMALIGHTMAP=!1,n.RGBDLIGHTMAP=!1,n.REFLECTION=!1,n.REFLECTIONMAP_3D=!1,n.REFLECTIONMAP_SPHERICAL=!1,n.REFLECTIONMAP_PLANAR=!1,n.REFLECTIONMAP_CUBIC=!1,n.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,n.REFLECTIONMAP_PROJECTION=!1,n.REFLECTIONMAP_SKYBOX=!1,n.REFLECTIONMAP_EXPLICIT=!1,n.REFLECTIONMAP_EQUIRECTANGULAR=!1,n.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,n.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,n.INVERTCUBICMAP=!1,n.USESPHERICALFROMREFLECTIONMAP=!1,n.USEIRRADIANCEMAP=!1,n.SPHERICAL_HARMONICS=!1,n.USESPHERICALINVERTEX=!1,n.REFLECTIONMAP_OPPOSITEZ=!1,n.LODINREFLECTIONALPHA=!1,n.GAMMAREFLECTION=!1,n.RGBDREFLECTION=!1,n.LINEARSPECULARREFLECTION=!1,n.RADIANCEOCCLUSION=!1,n.HORIZONOCCLUSION=!1,n.INSTANCES=!1,n.THIN_INSTANCES=!1,n.PREPASS=!1,n.PREPASS_IRRADIANCE=!1,n.PREPASS_IRRADIANCE_INDEX=-1,n.PREPASS_ALBEDO=!1,n.PREPASS_ALBEDO_INDEX=-1,n.PREPASS_DEPTHNORMAL=!1,n.PREPASS_DEPTHNORMAL_INDEX=-1,n.PREPASS_POSITION=!1,n.PREPASS_POSITION_INDEX=-1,n.PREPASS_VELOCITY=!1,n.PREPASS_VELOCITY_INDEX=-1,n.PREPASS_REFLECTIVITY=!1,n.PREPASS_REFLECTIVITY_INDEX=-1,n.SCENE_MRT_COUNT=0,n.NUM_BONE_INFLUENCERS=0,n.BonesPerMesh=0,n.BONETEXTURE=!1,n.BONES_VELOCITY_ENABLED=!1,n.NONUNIFORMSCALING=!1,n.MORPHTARGETS=!1,n.MORPHTARGETS_NORMAL=!1,n.MORPHTARGETS_TANGENT=!1,n.MORPHTARGETS_UV=!1,n.NUM_MORPH_INFLUENCERS=0,n.IMAGEPROCESSING=!1,n.VIGNETTE=!1,n.VIGNETTEBLENDMODEMULTIPLY=!1,n.VIGNETTEBLENDMODEOPAQUE=!1,n.TONEMAPPING=!1,n.TONEMAPPING_ACES=!1,n.CONTRAST=!1,n.COLORCURVES=!1,n.COLORGRADING=!1,n.COLORGRADING3D=!1,n.SAMPLER3DGREENDEPTH=!1,n.SAMPLER3DBGRMAP=!1,n.IMAGEPROCESSINGPOSTPROCESS=!1,n.EXPOSURE=!1,n.MULTIVIEW=!1,n.USEPHYSICALLIGHTFALLOFF=!1,n.USEGLTFLIGHTFALLOFF=!1,n.TWOSIDEDLIGHTING=!1,n.SHADOWFLOAT=!1,n.CLIPPLANE=!1,n.CLIPPLANE2=!1,n.CLIPPLANE3=!1,n.CLIPPLANE4=!1,n.CLIPPLANE5=!1,n.CLIPPLANE6=!1,n.POINTSIZE=!1,n.FOG=!1,n.LOGARITHMICDEPTH=!1,n.FORCENORMALFORWARD=!1,n.SPECULARAA=!1,n.CLEARCOAT=!1,n.CLEARCOAT_DEFAULTIOR=!1,n.CLEARCOAT_TEXTURE=!1,n.CLEARCOAT_TEXTURE_ROUGHNESS=!1,n.CLEARCOAT_TEXTUREDIRECTUV=0,n.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,n.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,n.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=!1,n.CLEARCOAT_BUMP=!1,n.CLEARCOAT_BUMPDIRECTUV=0,n.CLEARCOAT_REMAP_F0=!0,n.CLEARCOAT_TINT=!1,n.CLEARCOAT_TINT_TEXTURE=!1,n.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,n.ANISOTROPIC=!1,n.ANISOTROPIC_TEXTURE=!1,n.ANISOTROPIC_TEXTUREDIRECTUV=0,n.BRDF_V_HEIGHT_CORRELATED=!1,n.MS_BRDF_ENERGY_CONSERVATION=!1,n.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,n.SHEEN=!1,n.SHEEN_TEXTURE=!1,n.SHEEN_TEXTURE_ROUGHNESS=!1,n.SHEEN_TEXTUREDIRECTUV=0,n.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,n.SHEEN_LINKWITHALBEDO=!1,n.SHEEN_ROUGHNESS=!1,n.SHEEN_ALBEDOSCALING=!1,n.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,n.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=!1,n.SUBSURFACE=!1,n.SS_REFRACTION=!1,n.SS_TRANSLUCENCY=!1,n.SS_SCATTERING=!1,n.SS_THICKNESSANDMASK_TEXTURE=!1,n.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,n.SS_REFRACTIONMAP_3D=!1,n.SS_REFRACTIONMAP_OPPOSITEZ=!1,n.SS_LODINREFRACTIONALPHA=!1,n.SS_GAMMAREFRACTION=!1,n.SS_RGBDREFRACTION=!1,n.SS_LINEARSPECULARREFRACTION=!1,n.SS_LINKREFRACTIONTOTRANSPARENCY=!1,n.SS_ALBEDOFORREFRACTIONTINT=!1,n.SS_MASK_FROM_THICKNESS_TEXTURE=!1,n.SS_MASK_FROM_THICKNESS_TEXTURE_GLTF=!1,n.UNLIT=!1,n.DEBUGMODE=0,n.rebuild(),n}return l(n,e),n.prototype.reset=function(){e.prototype.reset.call(this),this.ALPHATESTVALUE="0.5",this.PBR=!0},n}(k),sn=function(t){function i(e,n){var r=t.call(this,e,n)||this;return r._directIntensity=1,r._emissiveIntensity=1,r._environmentIntensity=1,r._specularIntensity=1,r._lightingInfos=new K(r._directIntensity,r._emissiveIntensity,r._environmentIntensity,r._specularIntensity),r._disableBumpMap=!1,r._albedoTexture=null,r._ambientTexture=null,r._ambientTextureStrength=1,r._ambientTextureImpactOnAnalyticalLights=i.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,r._opacityTexture=null,r._reflectionTexture=null,r._emissiveTexture=null,r._reflectivityTexture=null,r._metallicTexture=null,r._metallic=null,r._roughness=null,r._metallicF0Factor=1,r._metallicReflectanceColor=E.White(),r._metallicReflectanceTexture=null,r._microSurfaceTexture=null,r._bumpTexture=null,r._lightmapTexture=null,r._ambientColor=new E(0,0,0),r._albedoColor=new E(1,1,1),r._reflectivityColor=new E(1,1,1),r._reflectionColor=new E(1,1,1),r._emissiveColor=new E(0,0,0),r._microSurface=.9,r._useLightmapAsShadowmap=!1,r._useHorizonOcclusion=!0,r._useRadianceOcclusion=!0,r._useAlphaFromAlbedoTexture=!1,r._useSpecularOverAlpha=!0,r._useMicroSurfaceFromReflectivityMapAlpha=!1,r._useRoughnessFromMetallicTextureAlpha=!0,r._useRoughnessFromMetallicTextureGreen=!1,r._useMetallnessFromMetallicTextureBlue=!1,r._useAmbientOcclusionFromMetallicTextureRed=!1,r._useAmbientInGrayScale=!1,r._useAutoMicroSurfaceFromReflectivityMap=!1,r._lightFalloff=i.LIGHTFALLOFF_PHYSICAL,r._useRadianceOverAlpha=!0,r._useObjectSpaceNormalMap=!1,r._useParallax=!1,r._useParallaxOcclusion=!1,r._parallaxScaleBias=.05,r._disableLighting=!1,r._maxSimultaneousLights=4,r._invertNormalMapX=!1,r._invertNormalMapY=!1,r._twoSidedLighting=!1,r._alphaCutOff=.4,r._forceAlphaTest=!1,r._useAlphaFresnel=!1,r._useLinearAlphaFresnel=!1,r._environmentBRDFTexture=null,r._forceIrradianceInFragment=!1,r._realTimeFiltering=!1,r._realTimeFilteringQuality=8,r._forceNormalForward=!1,r._enableSpecularAntiAliasing=!1,r._imageProcessingObserver=null,r._renderTargets=new j(16),r._globalAmbientColor=new E(0,0,0),r._useLogarithmicDepth=!1,r._unlit=!1,r._debugMode=0,r.debugMode=0,r.debugLimit=-1,r.debugFactor=1,r.clearCoat=new We(r._markAllSubMeshesAsTexturesDirty.bind(r)),r.anisotropy=new ze(r._markAllSubMeshesAsTexturesDirty.bind(r)),r.brdf=new Qe(r._markAllSubMeshesAsMiscDirty.bind(r)),r.sheen=new Ke(r._markAllSubMeshesAsTexturesDirty.bind(r)),r.detailMap=new pe(r._markAllSubMeshesAsTexturesDirty.bind(r)),r._rebuildInParallel=!1,r._attachImageProcessingConfiguration(null),r.getRenderTargetTextures=function(){return r._renderTargets.reset(),ue.ReflectionTextureEnabled&&r._reflectionTexture&&r._reflectionTexture.isRenderTarget&&r._renderTargets.push(r._reflectionTexture),r.subSurface.fillRenderTargetTextures(r._renderTargets),r._renderTargets},r._environmentBRDFTexture=Ye.GetEnvironmentBRDFTexture(n),r.subSurface=new je(r._markAllSubMeshesAsTexturesDirty.bind(r),r._markScenePrePassDirty.bind(r),n),r.prePassConfiguration=new me,r}return l(i,t),Object.defineProperty(i.prototype,"realTimeFiltering",{get:function(){return this._realTimeFiltering},set:function(e){this._realTimeFiltering=e,this.markAsDirty(1)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"realTimeFilteringQuality",{get:function(){return this._realTimeFilteringQuality},set:function(e){this._realTimeFilteringQuality=e,this.markAsDirty(1)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"canRenderToMRT",{get:function(){return!0},enumerable:!1,configurable:!0}),i.prototype._attachImageProcessingConfiguration=function(e){var n=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((function(){n._markAllSubMeshesAsImageProcessingDirty()}))))},Object.defineProperty(i.prototype,"hasRenderTargetTextures",{get:function(){return!!(ue.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this.subSurface.hasRenderTargetTextures()},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"PBRBaseMaterial"},Object.defineProperty(i.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"_disableAlphaBlending",{get:function(){return this.subSurface.disableAlphaBlending||this._transparencyMode===i.PBRMATERIAL_OPAQUE||this._transparencyMode===i.PBRMATERIAL_ALPHATEST},enumerable:!1,configurable:!0}),i.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())},i.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest||!this.subSurface.disableAlphaBlending&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===i.PBRMATERIAL_ALPHATEST))},i.prototype._shouldUseAlphaFromAlbedoTexture=function(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==i.PBRMATERIAL_OPAQUE},i.prototype._hasAlphaChannel=function(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha||null!=this._opacityTexture},i.prototype.getAlphaTestTexture=function(){return this._albedoTexture},i.prototype.isReadyForSubMesh=function(e,n,t){if(n.effect&&this.isFrozen&&n.effect._wasPreviouslyReady)return!0;n._materialDefines||(n._materialDefines=new an);var i=n._materialDefines;if(this._isReadyForSubMesh(n))return!0;var r=this.getScene(),o=r.getEngine();if(i._areTexturesDirty&&r.texturesEnabled){if(this._albedoTexture&&ue.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&ue.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&ue.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;var a=this._getReflectionTexture();if(a&&ue.ReflectionTextureEnabled){if(!a.isReadyOrNotBlocking())return!1;if(a.irradianceTexture&&!a.irradianceTexture.isReadyOrNotBlocking())return!1}if(this._lightmapTexture&&ue.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&ue.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(ue.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(o.getCaps().standardDerivatives&&this._bumpTexture&&ue.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&ue.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(!(this.subSurface.isReadyForSubMesh(i,r)&&this.clearCoat.isReadyForSubMesh(i,r,o,this._disableBumpMap)&&this.sheen.isReadyForSubMesh(i,r)&&this.anisotropy.isReadyForSubMesh(i,r)&&this.detailMap.isReadyForSubMesh(i,r)))return!1;if(i._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;o.getCaps().standardDerivatives||e.isVerticesDataPresent(V.NormalKind)||(e.createNormals(!0),e.name);var s=n.effect,l=i._areLightsDisposed,c=this._prepareEffect(e,i,this.onCompiled,this.onError,t,null,n.getRenderingMesh().hasThinInstances);if(c)if(this._onEffectCreatedObservable&&(on.effect=c,on.subMesh=n,this._onEffectCreatedObservable.notifyObservers(on)),this.allowShaderHotSwapping&&s&&!c.isReady()){if(c=s,this._rebuildInParallel=!0,i.markAsUnprocessed(),l)return i._areLightsDisposed=!0,!1}else this._rebuildInParallel=!1,r.resetCachedMaterial(),n.setEffect(c,i),this.buildUniformLayout();return!(!n.effect||!n.effect.isReady())&&(i._renderId=r.getRenderId(),n.effect._wasPreviouslyReady=!0,!0)},i.prototype.isMetallicWorkflow=function(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)},i.prototype._prepareEffect=function(e,n,t,i,r,o,a){if(void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=null),void 0===o&&(o=null),this._prepareDefines(e,n,r,o,a),!n.isDirty)return null;n.markAsProcessed();var s=this.getScene().getEngine(),l=new Ae,c=0;n.USESPHERICALINVERTEX&&l.addFallback(c++,"USESPHERICALINVERTEX"),n.FOG&&l.addFallback(c,"FOG"),n.SPECULARAA&&l.addFallback(c,"SPECULARAA"),n.POINTSIZE&&l.addFallback(c,"POINTSIZE"),n.LOGARITHMICDEPTH&&l.addFallback(c,"LOGARITHMICDEPTH"),n.PARALLAX&&l.addFallback(c,"PARALLAX"),n.PARALLAXOCCLUSION&&l.addFallback(c++,"PARALLAXOCCLUSION"),c=ze.AddFallbacks(n,l,c),c=ze.AddFallbacks(n,l,c),c=je.AddFallbacks(n,l,c),c=Ke.AddFallbacks(n,l,c),n.ENVIRONMENTBRDF&&l.addFallback(c++,"ENVIRONMENTBRDF"),n.TANGENT&&l.addFallback(c++,"TANGENT"),n.BUMP&&l.addFallback(c++,"BUMP"),c=de.HandleFallbacksForShadows(n,l,this._maxSimultaneousLights,c++),n.SPECULARTERM&&l.addFallback(c++,"SPECULARTERM"),n.USESPHERICALFROMREFLECTIONMAP&&l.addFallback(c++,"USESPHERICALFROMREFLECTIONMAP"),n.USEIRRADIANCEMAP&&l.addFallback(c++,"USEIRRADIANCEMAP"),n.LIGHTMAP&&l.addFallback(c++,"LIGHTMAP"),n.NORMAL&&l.addFallback(c++,"NORMAL"),n.AMBIENT&&l.addFallback(c++,"AMBIENT"),n.EMISSIVE&&l.addFallback(c++,"EMISSIVE"),n.VERTEXCOLOR&&l.addFallback(c++,"VERTEXCOLOR"),n.MORPHTARGETS&&l.addFallback(c++,"MORPHTARGETS"),n.MULTIVIEW&&l.addFallback(0,"MULTIVIEW");var f=[V.PositionKind];n.NORMAL&&f.push(V.NormalKind),n.TANGENT&&f.push(V.TangentKind),n.UV1&&f.push(V.UVKind),n.UV2&&f.push(V.UV2Kind),n.VERTEXCOLOR&&f.push(V.ColorKind),de.PrepareAttributesForBones(f,e,n,l),de.PrepareAttributesForInstances(f,n),de.PrepareAttributesForMorphTargets(f,e,n);var u="pbr",d=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode"],h=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler"],p=["Material","Scene"];pe.AddUniforms(d),pe.AddSamplers(h),je.AddUniforms(d),je.AddSamplers(h),We.AddUniforms(d),We.AddSamplers(h),ze.AddUniforms(d),ze.AddSamplers(h),Ke.AddUniforms(d),Ke.AddSamplers(h),me.AddUniforms(d),me.AddSamplers(d),X&&(X.PrepareUniforms(d,n),X.PrepareSamplers(h,n)),de.PrepareUniformsAndSamplersList({uniformsNames:d,uniformBuffersNames:p,samplers:h,defines:n,maxSimultaneousLights:this._maxSimultaneousLights});var m={};this.customShaderNameResolve&&(u=this.customShaderNameResolve(u,d,p,h,n,f,m));var v=n.toString();return s.createEffect(u,{attributes:f,uniformsNames:d,uniformBuffersNames:p,samplers:h,defines:v,fallbacks:l,onCompiled:t,onError:i,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:n.NUM_MORPH_INFLUENCERS},processFinalCode:m.processFinalCode,multiTarget:n.PREPASS},s)},i.prototype._prepareDefines=function(e,n,t,r,o){void 0===t&&(t=null),void 0===r&&(r=null),void 0===o&&(o=!1);var a=this.getScene(),s=a.getEngine();if(de.PrepareDefinesForLights(a,e,n,!0,this._maxSimultaneousLights,this._disableLighting),n._needNormals=!0,de.PrepareDefinesForMultiview(a,n),de.PrepareDefinesForPrePass(a,n,this.canRenderToMRT),n.METALLICWORKFLOW=this.isMetallicWorkflow(),n._areTexturesDirty){if(n._needUVs=!1,a.texturesEnabled){a.getEngine().getCaps().textureLOD&&(n.LODBASEDMICROSFURACE=!0),this._albedoTexture&&ue.DiffuseTextureEnabled?(de.PrepareDefinesForMergedUV(this._albedoTexture,n,"ALBEDO"),n.GAMMAALBEDO=this._albedoTexture.gammaSpace):n.ALBEDO=!1,this._ambientTexture&&ue.AmbientTextureEnabled?(de.PrepareDefinesForMergedUV(this._ambientTexture,n,"AMBIENT"),n.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):n.AMBIENT=!1,this._opacityTexture&&ue.OpacityTextureEnabled?(de.PrepareDefinesForMergedUV(this._opacityTexture,n,"OPACITY"),n.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):n.OPACITY=!1;var l=this._getReflectionTexture();if(l&&ue.ReflectionTextureEnabled){switch(n.REFLECTION=!0,n.GAMMAREFLECTION=l.gammaSpace,n.RGBDREFLECTION=l.isRGBD,n.REFLECTIONMAP_OPPOSITEZ=this.getScene().useRightHandedSystem?!l.invertZ:l.invertZ,n.LODINREFLECTIONALPHA=l.lodLevelInAlpha,n.LINEARSPECULARREFLECTION=l.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(n.NUM_SAMPLES=""+this.realTimeFilteringQuality,s.webGLVersion>1&&(n.NUM_SAMPLES=n.NUM_SAMPLES+"u"),n.REALTIME_FILTERING=!0):n.REALTIME_FILTERING=!1,l.coordinatesMode===ce.INVCUBIC_MODE&&(n.INVERTCUBICMAP=!0),n.REFLECTIONMAP_3D=l.isCube,n.REFLECTIONMAP_CUBIC=!1,n.REFLECTIONMAP_EXPLICIT=!1,n.REFLECTIONMAP_PLANAR=!1,n.REFLECTIONMAP_PROJECTION=!1,n.REFLECTIONMAP_SKYBOX=!1,n.REFLECTIONMAP_SPHERICAL=!1,n.REFLECTIONMAP_EQUIRECTANGULAR=!1,n.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,n.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,l.coordinatesMode){case ce.EXPLICIT_MODE:n.REFLECTIONMAP_EXPLICIT=!0;break;case ce.PLANAR_MODE:n.REFLECTIONMAP_PLANAR=!0;break;case ce.PROJECTION_MODE:n.REFLECTIONMAP_PROJECTION=!0;break;case ce.SKYBOX_MODE:n.REFLECTIONMAP_SKYBOX=!0;break;case ce.SPHERICAL_MODE:n.REFLECTIONMAP_SPHERICAL=!0;break;case ce.EQUIRECTANGULAR_MODE:n.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case ce.FIXED_EQUIRECTANGULAR_MODE:n.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case ce.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:n.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case ce.CUBIC_MODE:case ce.INVCUBIC_MODE:default:n.REFLECTIONMAP_CUBIC=!0,n.USE_LOCAL_REFLECTIONMAP_CUBIC=!!l.boundingBoxSize}l.coordinatesMode!==ce.SKYBOX_MODE&&(l.irradianceTexture?(n.USEIRRADIANCEMAP=!0,n.USESPHERICALFROMREFLECTIONMAP=!1):l.isCube&&(n.USESPHERICALFROMREFLECTIONMAP=!0,n.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||a.getEngine().getCaps().maxVaryingVectors<=8?n.USESPHERICALINVERTEX=!1:n.USESPHERICALINVERTEX=!0))}else n.REFLECTION=!1,n.REFLECTIONMAP_3D=!1,n.REFLECTIONMAP_SPHERICAL=!1,n.REFLECTIONMAP_PLANAR=!1,n.REFLECTIONMAP_CUBIC=!1,n.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,n.REFLECTIONMAP_PROJECTION=!1,n.REFLECTIONMAP_SKYBOX=!1,n.REFLECTIONMAP_EXPLICIT=!1,n.REFLECTIONMAP_EQUIRECTANGULAR=!1,n.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,n.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,n.INVERTCUBICMAP=!1,n.USESPHERICALFROMREFLECTIONMAP=!1,n.USEIRRADIANCEMAP=!1,n.USESPHERICALINVERTEX=!1,n.REFLECTIONMAP_OPPOSITEZ=!1,n.LODINREFLECTIONALPHA=!1,n.GAMMAREFLECTION=!1,n.RGBDREFLECTION=!1,n.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&ue.LightmapTextureEnabled?(de.PrepareDefinesForMergedUV(this._lightmapTexture,n,"LIGHTMAP"),n.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,n.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,n.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):n.LIGHTMAP=!1,this._emissiveTexture&&ue.EmissiveTextureEnabled?de.PrepareDefinesForMergedUV(this._emissiveTexture,n,"EMISSIVE"):n.EMISSIVE=!1,ue.SpecularTextureEnabled?(this._metallicTexture?(de.PrepareDefinesForMergedUV(this._metallicTexture,n,"REFLECTIVITY"),n.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,n.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,n.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,n.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed):this._reflectivityTexture?(de.PrepareDefinesForMergedUV(this._reflectivityTexture,n,"REFLECTIVITY"),n.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,n.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap):n.REFLECTIVITY=!1,this._metallicReflectanceTexture?de.PrepareDefinesForMergedUV(this._metallicReflectanceTexture,n,"METALLIC_REFLECTANCE"):n.METALLIC_REFLECTANCE=!1,this._microSurfaceTexture?de.PrepareDefinesForMergedUV(this._microSurfaceTexture,n,"MICROSURFACEMAP"):n.MICROSURFACEMAP=!1):(n.REFLECTIVITY=!1,n.MICROSURFACEMAP=!1),a.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&ue.BumpTextureEnabled&&!this._disableBumpMap?(de.PrepareDefinesForMergedUV(this._bumpTexture,n,"BUMP"),this._useParallax&&this._albedoTexture&&ue.DiffuseTextureEnabled?(n.PARALLAX=!0,n.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):n.PARALLAX=!1,n.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):n.BUMP=!1,this._environmentBRDFTexture&&ue.ReflectionTextureEnabled?(n.ENVIRONMENTBRDF=!0,n.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(n.ENVIRONMENTBRDF=!1,n.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?n.ALPHAFROMALBEDO=!0:n.ALPHAFROMALBEDO=!1}n.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===i.LIGHTFALLOFF_STANDARD?(n.USEPHYSICALLIGHTFALLOFF=!1,n.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===i.LIGHTFALLOFF_GLTF?(n.USEPHYSICALLIGHTFALLOFF=!1,n.USEGLTFLIGHTFALLOFF=!0):(n.USEPHYSICALLIGHTFALLOFF=!0,n.USEGLTFLIGHTFALLOFF=!1),n.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.backFaceCulling&&this._twoSidedLighting?n.TWOSIDEDLIGHTING=!0:n.TWOSIDEDLIGHTING=!1,n.SPECULARAA=a.getEngine().getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(n._areTexturesDirty||n._areMiscDirty)&&(n.ALPHATESTVALUE=this._alphaCutOff+(this._alphaCutOff%1==0?".":""),n.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,n.ALPHABLEND=this.needAlphaBlendingForMesh(e),n.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,n.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),n._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(n),n.FORCENORMALFORWARD=this._forceNormalForward,n.RADIANCEOCCLUSION=this._useRadianceOcclusion,n.HORIZONOCCLUSION=this._useHorizonOcclusion,n._areMiscDirty&&(de.PrepareDefinesForMisc(e,a,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e)||this._forceAlphaTest,n),n.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!e.isVerticesDataPresent(V.NormalKind),n.DEBUGMODE=this._debugMode),this.detailMap.prepareDefines(n,a),this.subSurface.prepareDefines(n,a),this.clearCoat.prepareDefines(n,a),this.anisotropy.prepareDefines(n,e,a),this.brdf.prepareDefines(n),this.sheen.prepareDefines(n,a),de.PrepareDefinesForFrameBoundValues(a,s,n,!!t,r,o),de.PrepareDefinesForAttributes(e,n,!0,!0,!0,this._transparencyMode!==i.PBRMATERIAL_OPAQUE)},i.prototype.forceCompilation=function(e,n,t){var i=this,r=Y({clipPlane:!1,useInstances:!1},t),o=new an,a=this._prepareEffect(e,o,void 0,void 0,r.useInstances,r.clipPlane,e.hasThinInstances);this._onEffectCreatedObservable&&(on.effect=a,on.subMesh=null,this._onEffectCreatedObservable.notifyObservers(on)),a.isReady()?n&&n(this):a.onCompileObservable.add((function(){n&&n(i)}))},i.prototype.buildUniformLayout=function(){var e=this._uniformBuffer;e.addUniform("vAlbedoInfos",2),e.addUniform("vAmbientInfos",4),e.addUniform("vOpacityInfos",2),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vReflectivityInfos",3),e.addUniform("vMicroSurfaceSamplerInfos",2),e.addUniform("vReflectionInfos",2),e.addUniform("vReflectionFilteringInfo",2),e.addUniform("vReflectionPosition",3),e.addUniform("vReflectionSize",3),e.addUniform("vBumpInfos",3),e.addUniform("albedoMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("reflectivityMatrix",16),e.addUniform("microSurfaceSamplerMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("reflectionMatrix",16),e.addUniform("vReflectionColor",3),e.addUniform("vAlbedoColor",4),e.addUniform("vLightingIntensity",4),e.addUniform("vReflectionMicrosurfaceInfos",3),e.addUniform("pointSize",1),e.addUniform("vReflectivityColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("visibility",1),e.addUniform("vMetallicReflectanceFactors",4),e.addUniform("vMetallicReflectanceInfos",2),e.addUniform("metallicReflectanceMatrix",16),We.PrepareUniformBuffer(e),ze.PrepareUniformBuffer(e),Ke.PrepareUniformBuffer(e),je.PrepareUniformBuffer(e),pe.PrepareUniformBuffer(e),e.create()},i.prototype.unbind=function(){if(this._activeEffect){var e=!1;this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&(this._activeEffect.setTexture("reflection2DSampler",null),e=!0),this.subSurface.unbind(this._activeEffect)&&(e=!0),e&&this._markAllSubMeshesAsTexturesDirty()}t.prototype.unbind.call(this)},i.prototype.bindForSubMesh=function(e,n,t){var i=this.getScene(),r=t._materialDefines;if(r){var o=t.effect;if(o){this._activeEffect=o,r.INSTANCES&&!r.THIN_INSTANCES||this.bindOnlyWorldMatrix(e),this.prePassConfiguration.bindForSubMesh(this._activeEffect,i,n,e,this.isFrozen),r.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var a=this._mustRebind(i,o,n.visibility);de.BindBonesParameters(n,this._activeEffect,this.prePassConfiguration);var s=null,l=this._uniformBuffer;if(a){var c=i.getEngine();if(l.bindToEffect(o,"Material"),this.bindViewProjection(o),s=this._getReflectionTexture(),!l.useUbo||!this.isFrozen||!l.isSync){if(i.texturesEnabled){if(this._albedoTexture&&ue.DiffuseTextureEnabled&&(l.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),de.BindTextureMatrix(this._albedoTexture,l,"albedo")),this._ambientTexture&&ue.AmbientTextureEnabled&&(l.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),de.BindTextureMatrix(this._ambientTexture,l,"ambient")),this._opacityTexture&&ue.OpacityTextureEnabled&&(l.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),de.BindTextureMatrix(this._opacityTexture,l,"opacity")),s&&ue.ReflectionTextureEnabled){if(l.updateMatrix("reflectionMatrix",s.getReflectionTextureMatrix()),l.updateFloat2("vReflectionInfos",s.level,0),s.boundingBoxSize){var f=s;l.updateVector3("vReflectionPosition",f.boundingBoxPosition),l.updateVector3("vReflectionSize",f.boundingBoxSize)}if(this.realTimeFiltering){var u=s.getSize().width;l.updateFloat2("vReflectionFilteringInfo",u,G.Log2(u))}if(!r.USEIRRADIANCEMAP){var d=s.sphericalPolynomial;if(r.USESPHERICALFROMREFLECTIONMAP&&d)if(r.SPHERICAL_HARMONICS){var h=d.preScaledHarmonics;this._activeEffect.setVector3("vSphericalL00",h.l00),this._activeEffect.setVector3("vSphericalL1_1",h.l1_1),this._activeEffect.setVector3("vSphericalL10",h.l10),this._activeEffect.setVector3("vSphericalL11",h.l11),this._activeEffect.setVector3("vSphericalL2_2",h.l2_2),this._activeEffect.setVector3("vSphericalL2_1",h.l2_1),this._activeEffect.setVector3("vSphericalL20",h.l20),this._activeEffect.setVector3("vSphericalL21",h.l21),this._activeEffect.setVector3("vSphericalL22",h.l22)}else this._activeEffect.setFloat3("vSphericalX",d.x.x,d.x.y,d.x.z),this._activeEffect.setFloat3("vSphericalY",d.y.x,d.y.y,d.y.z),this._activeEffect.setFloat3("vSphericalZ",d.z.x,d.z.y,d.z.z),this._activeEffect.setFloat3("vSphericalXX_ZZ",d.xx.x-d.zz.x,d.xx.y-d.zz.y,d.xx.z-d.zz.z),this._activeEffect.setFloat3("vSphericalYY_ZZ",d.yy.x-d.zz.x,d.yy.y-d.zz.y,d.yy.z-d.zz.z),this._activeEffect.setFloat3("vSphericalZZ",d.zz.x,d.zz.y,d.zz.z),this._activeEffect.setFloat3("vSphericalXY",d.xy.x,d.xy.y,d.xy.z),this._activeEffect.setFloat3("vSphericalYZ",d.yz.x,d.yz.y,d.yz.z),this._activeEffect.setFloat3("vSphericalZX",d.zx.x,d.zx.y,d.zx.z)}l.updateFloat3("vReflectionMicrosurfaceInfos",s.getSize().width,s.lodGenerationScale,s.lodGenerationOffset)}this._emissiveTexture&&ue.EmissiveTextureEnabled&&(l.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),de.BindTextureMatrix(this._emissiveTexture,l,"emissive")),this._lightmapTexture&&ue.LightmapTextureEnabled&&(l.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),de.BindTextureMatrix(this._lightmapTexture,l,"lightmap")),ue.SpecularTextureEnabled&&(this._metallicTexture?(l.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),de.BindTextureMatrix(this._metallicTexture,l,"reflectivity")):this._reflectivityTexture&&(l.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),de.BindTextureMatrix(this._reflectivityTexture,l,"reflectivity")),this._metallicReflectanceTexture&&(l.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),de.BindTextureMatrix(this._metallicReflectanceTexture,l,"metallicReflectance")),this._microSurfaceTexture&&(l.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),de.BindTextureMatrix(this._microSurfaceTexture,l,"microSurfaceSampler"))),this._bumpTexture&&c.getCaps().standardDerivatives&&ue.BumpTextureEnabled&&!this._disableBumpMap&&(l.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),de.BindTextureMatrix(this._bumpTexture,l,"bump"),i._mirroredCameraPosition?l.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):l.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&l.updateFloat("pointSize",this.pointSize),r.METALLICWORKFLOW){W.Color3[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,W.Color3[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,l.updateColor4("vReflectivityColor",W.Color3[0],1);var p=this.subSurface.indexOfRefraction,m=Math.pow((p-1)/(p+1),2);this._metallicReflectanceColor.scaleToRef(m*this._metallicF0Factor,W.Color3[0]);var v=this._metallicF0Factor;l.updateColor4("vMetallicReflectanceFactors",W.Color3[0],v)}else l.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);l.updateColor3("vEmissiveColor",ue.EmissiveTextureEnabled?this._emissiveColor:E.BlackReadOnly),l.updateColor3("vReflectionColor",this._reflectionColor),!r.SS_REFRACTION&&this.subSurface.linkRefractionWithTransparency?l.updateColor4("vAlbedoColor",this._albedoColor,1):l.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*i.environmentIntensity,this._lightingInfos.w=this._specularIntensity,l.updateVector4("vLightingIntensity",this._lightingInfos)}l.updateFloat("visibility",n.visibility),i.texturesEnabled&&(this._albedoTexture&&ue.DiffuseTextureEnabled&&l.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&ue.AmbientTextureEnabled&&l.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&ue.OpacityTextureEnabled&&l.setTexture("opacitySampler",this._opacityTexture),s&&ue.ReflectionTextureEnabled&&(r.LODBASEDMICROSFURACE?l.setTexture("reflectionSampler",s):(l.setTexture("reflectionSampler",s._lodTextureMid||s),l.setTexture("reflectionSamplerLow",s._lodTextureLow||s),l.setTexture("reflectionSamplerHigh",s._lodTextureHigh||s)),r.USEIRRADIANCEMAP&&l.setTexture("irradianceSampler",s.irradianceTexture)),r.ENVIRONMENTBRDF&&l.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&ue.EmissiveTextureEnabled&&l.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&ue.LightmapTextureEnabled&&l.setTexture("lightmapSampler",this._lightmapTexture),ue.SpecularTextureEnabled&&(this._metallicTexture?l.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&l.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&l.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._microSurfaceTexture&&l.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&c.getCaps().standardDerivatives&&ue.BumpTextureEnabled&&!this._disableBumpMap&&l.setTexture("bumpSampler",this._bumpTexture)),this.detailMap.bindForSubMesh(l,i,this.isFrozen),this.subSurface.bindForSubMesh(l,i,c,this.isFrozen,r.LODBASEDMICROSFURACE,this.realTimeFiltering),this.clearCoat.bindForSubMesh(l,i,c,this._disableBumpMap,this.isFrozen,this._invertNormalMapX,this._invertNormalMapY,t),this.anisotropy.bindForSubMesh(l,i,this.isFrozen),this.sheen.bindForSubMesh(l,i,this.isFrozen,t),de.BindClipPlane(this._activeEffect,i),i.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor);var A=i._forcedViewPosition?i._forcedViewPosition:i._mirroredCameraPosition?i._mirroredCameraPosition:i.activeCamera.globalPosition,_=i.useRightHandedSystem===(null!=i._mirroredCameraPosition);o.setFloat4("vEyePosition",A.x,A.y,A.z,_?-1:1),o.setColor3("vAmbientColor",this._globalAmbientColor),o.setFloat2("vDebugMode",this.debugLimit,this.debugFactor)}!a&&this.isFrozen||(i.lightsEnabled&&!this._disableLighting&&de.BindLights(i,n,this._activeEffect,r,this._maxSimultaneousLights,this._rebuildInParallel),(i.fogEnabled&&n.applyFog&&i.fogMode!==C.FOGMODE_NONE||s)&&this.bindView(o),de.BindFogParameters(i,n,this._activeEffect,!0),r.NUM_MORPH_INFLUENCERS&&de.BindMorphTargetParameters(n,this._activeEffect),this._imageProcessingConfiguration.bind(this._activeEffect),de.BindLogDepth(r,this._activeEffect,i)),l.update(),this._afterBind(n,this._activeEffect)}}},i.prototype.getAnimatables=function(){var e=[];return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&e.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?e.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&e.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this.detailMap.getAnimatables(e),this.subSurface.getAnimatables(e),this.clearCoat.getAnimatables(e),this.sheen.getAnimatables(e),this.anisotropy.getAnimatables(e),e},i.prototype._getReflectionTexture=function(){return this._reflectionTexture?this._reflectionTexture:this.getScene().environmentTexture},i.prototype.getActiveTextures=function(){var e=t.prototype.getActiveTextures.call(this);return this._albedoTexture&&e.push(this._albedoTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._reflectivityTexture&&e.push(this._reflectivityTexture),this._metallicTexture&&e.push(this._metallicTexture),this._metallicReflectanceTexture&&e.push(this._metallicReflectanceTexture),this._microSurfaceTexture&&e.push(this._microSurfaceTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),this.detailMap.getActiveTextures(e),this.subSurface.getActiveTextures(e),this.clearCoat.getActiveTextures(e),this.sheen.getActiveTextures(e),this.anisotropy.getActiveTextures(e),e},i.prototype.hasTexture=function(e){return!!t.prototype.hasTexture.call(this,e)||(this._albedoTexture===e||(this._ambientTexture===e||(this._opacityTexture===e||(this._reflectionTexture===e||(this._reflectivityTexture===e||(this._metallicTexture===e||(this._metallicReflectanceTexture===e||(this._microSurfaceTexture===e||(this._bumpTexture===e||(this._lightmapTexture===e||(this.detailMap.hasTexture(e)||this.subSurface.hasTexture(e)||this.clearCoat.hasTexture(e)||this.sheen.hasTexture(e)||this.anisotropy.hasTexture(e))))))))))))},i.prototype.setPrePassRenderer=function(e){if(this.subSurface.isScatteringEnabled){var n=this.getScene().enableSubSurfaceForPrePass();return n&&(n.enabled=!0),!0}return!1},i.prototype.dispose=function(e,n){var i,r,o,a,s,l,c,f,u,d,h;n&&(this._environmentBRDFTexture&&this.getScene().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(i=this._albedoTexture)||void 0===i||i.dispose(),null===(r=this._ambientTexture)||void 0===r||r.dispose(),null===(o=this._opacityTexture)||void 0===o||o.dispose(),null===(a=this._reflectionTexture)||void 0===a||a.dispose(),null===(s=this._emissiveTexture)||void 0===s||s.dispose(),null===(l=this._metallicTexture)||void 0===l||l.dispose(),null===(c=this._reflectivityTexture)||void 0===c||c.dispose(),null===(f=this._bumpTexture)||void 0===f||f.dispose(),null===(u=this._lightmapTexture)||void 0===u||u.dispose(),null===(d=this._metallicReflectanceTexture)||void 0===d||d.dispose(),null===(h=this._microSurfaceTexture)||void 0===h||h.dispose()),this.detailMap.dispose(n),this.subSurface.dispose(n),this.clearCoat.dispose(n),this.sheen.dispose(n),this.anisotropy.dispose(n),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),t.prototype.dispose.call(this,e,n)},i.PBRMATERIAL_OPAQUE=z.MATERIAL_OPAQUE,i.PBRMATERIAL_ALPHATEST=z.MATERIAL_ALPHATEST,i.PBRMATERIAL_ALPHABLEND=z.MATERIAL_ALPHABLEND,i.PBRMATERIAL_ALPHATESTANDBLEND=z.MATERIAL_ALPHATESTANDBLEND,i.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,i.LIGHTFALLOFF_PHYSICAL=0,i.LIGHTFALLOFF_GLTF=1,i.LIGHTFALLOFF_STANDARD=2,e([Q()],i.prototype,"_imageProcessingConfiguration",void 0),e([D("_markAllSubMeshesAsMiscDirty")],i.prototype,"debugMode",void 0),e([n()],i.prototype,"useLogarithmicDepth",null),i}(ve),ln=function(t){function i(e,n){var r=t.call(this,e,n)||this;return r.directIntensity=1,r.emissiveIntensity=1,r.environmentIntensity=1,r.specularIntensity=1,r.disableBumpMap=!1,r.ambientTextureStrength=1,r.ambientTextureImpactOnAnalyticalLights=i.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,r.metallicF0Factor=1,r.metallicReflectanceColor=E.White(),r.ambientColor=new E(0,0,0),r.albedoColor=new E(1,1,1),r.reflectivityColor=new E(1,1,1),r.reflectionColor=new E(1,1,1),r.emissiveColor=new E(0,0,0),r.microSurface=1,r.useLightmapAsShadowmap=!1,r.useAlphaFromAlbedoTexture=!1,r.forceAlphaTest=!1,r.alphaCutOff=.4,r.useSpecularOverAlpha=!0,r.useMicroSurfaceFromReflectivityMapAlpha=!1,r.useRoughnessFromMetallicTextureAlpha=!0,r.useRoughnessFromMetallicTextureGreen=!1,r.useMetallnessFromMetallicTextureBlue=!1,r.useAmbientOcclusionFromMetallicTextureRed=!1,r.useAmbientInGrayScale=!1,r.useAutoMicroSurfaceFromReflectivityMap=!1,r.useRadianceOverAlpha=!0,r.useObjectSpaceNormalMap=!1,r.useParallax=!1,r.useParallaxOcclusion=!1,r.parallaxScaleBias=.05,r.disableLighting=!1,r.forceIrradianceInFragment=!1,r.maxSimultaneousLights=4,r.invertNormalMapX=!1,r.invertNormalMapY=!1,r.twoSidedLighting=!1,r.useAlphaFresnel=!1,r.useLinearAlphaFresnel=!1,r.environmentBRDFTexture=null,r.forceNormalForward=!1,r.enableSpecularAntiAliasing=!1,r.useHorizonOcclusion=!0,r.useRadianceOcclusion=!0,r.unlit=!1,r._environmentBRDFTexture=Ye.GetEnvironmentBRDFTexture(n),r}return l(i,t),Object.defineProperty(i.prototype,"refractionTexture",{get:function(){return this.subSurface.refractionTexture},set:function(e){this.subSurface.refractionTexture=e,e?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"indexOfRefraction",{get:function(){return this.subSurface.indexOfRefraction},set:function(e){this.subSurface.indexOfRefraction=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"invertRefractionY",{get:function(){return this.subSurface.invertRefractionY},set:function(e){this.subSurface.invertRefractionY=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"linkRefractionWithTransparency",{get:function(){return this.subSurface.linkRefractionWithTransparency},set:function(e){this.subSurface.linkRefractionWithTransparency=e,e&&(this.subSurface.isRefractionEnabled=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"usePhysicalLightFalloff",{get:function(){return this._lightFalloff===sn.LIGHTFALLOFF_PHYSICAL},set:function(e){e!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=e?sn.LIGHTFALLOFF_PHYSICAL:sn.LIGHTFALLOFF_STANDARD)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useGLTFLightFalloff",{get:function(){return this._lightFalloff===sn.LIGHTFALLOFF_GLTF},set:function(e){e!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=e?sn.LIGHTFALLOFF_GLTF:sn.LIGHTFALLOFF_STANDARD)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this._imageProcessingConfiguration.colorGradingTexture=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(e){this._imageProcessingConfiguration.colorCurves=e},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"PBRMaterial"},i.prototype.clone=function(e){var n=this,t=B.Clone((function(){return new i(e,n.getScene())}),this);return t.id=e,t.name=e,this.clearCoat.copyTo(t.clearCoat),this.anisotropy.copyTo(t.anisotropy),this.brdf.copyTo(t.brdf),this.sheen.copyTo(t.sheen),this.subSurface.copyTo(t.subSurface),t},i.prototype.serialize=function(){var e=B.Serialize(this);return e.customType="BABYLON.PBRMaterial",e.clearCoat=this.clearCoat.serialize(),e.anisotropy=this.anisotropy.serialize(),e.brdf=this.brdf.serialize(),e.sheen=this.sheen.serialize(),e.subSurface=this.subSurface.serialize(),e},i.Parse=function(e,n,t){var r=B.Parse((function(){return new i(e.name,n)}),e,n,t);return e.clearCoat&&r.clearCoat.parse(e.clearCoat,n,t),e.anisotropy&&r.anisotropy.parse(e.anisotropy,n,t),e.brdf&&r.brdf.parse(e.brdf,n,t),e.sheen&&r.sheen.parse(e.sheen,n,t),e.subSurface&&r.subSurface.parse(e.subSurface,n,t),r},i.PBRMATERIAL_OPAQUE=sn.PBRMATERIAL_OPAQUE,i.PBRMATERIAL_ALPHATEST=sn.PBRMATERIAL_ALPHATEST,i.PBRMATERIAL_ALPHABLEND=sn.PBRMATERIAL_ALPHABLEND,i.PBRMATERIAL_ALPHATESTANDBLEND=sn.PBRMATERIAL_ALPHATESTANDBLEND,i.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=sn.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"directIntensity",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"emissiveIntensity",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"environmentIntensity",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"specularIntensity",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"disableBumpMap",void 0),e([F(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"albedoTexture",void 0),e([F(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"ambientTexture",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"ambientTextureStrength",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),e([F(),D("_markAllSubMeshesAsTexturesAndMiscDirty")],i.prototype,"opacityTexture",void 0),e([F(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectionTexture",void 0),e([F(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"emissiveTexture",void 0),e([F(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectivityTexture",void 0),e([F(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"metallicTexture",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"metallic",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"roughness",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"metallicF0Factor",void 0),e([U(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"metallicReflectanceColor",void 0),e([F(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"metallicReflectanceTexture",void 0),e([F(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"microSurfaceTexture",void 0),e([F(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"bumpTexture",void 0),e([F(),D("_markAllSubMeshesAsTexturesDirty",null)],i.prototype,"lightmapTexture",void 0),e([U("ambient"),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"ambientColor",void 0),e([U("albedo"),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"albedoColor",void 0),e([U("reflectivity"),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectivityColor",void 0),e([U("reflection"),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectionColor",void 0),e([U("emissive"),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"emissiveColor",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"microSurface",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useLightmapAsShadowmap",void 0),e([n(),D("_markAllSubMeshesAsTexturesAndMiscDirty")],i.prototype,"useAlphaFromAlbedoTexture",void 0),e([n(),D("_markAllSubMeshesAsTexturesAndMiscDirty")],i.prototype,"forceAlphaTest",void 0),e([n(),D("_markAllSubMeshesAsTexturesAndMiscDirty")],i.prototype,"alphaCutOff",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useSpecularOverAlpha",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRoughnessFromMetallicTextureGreen",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useMetallnessFromMetallicTextureBlue",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useAmbientInGrayScale",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),e([n()],i.prototype,"usePhysicalLightFalloff",null),e([n()],i.prototype,"useGLTFLightFalloff",null),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRadianceOverAlpha",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useObjectSpaceNormalMap",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useParallax",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useParallaxOcclusion",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"parallaxScaleBias",void 0),e([n(),D("_markAllSubMeshesAsLightsDirty")],i.prototype,"disableLighting",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"forceIrradianceInFragment",void 0),e([n(),D("_markAllSubMeshesAsLightsDirty")],i.prototype,"maxSimultaneousLights",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"invertNormalMapX",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"invertNormalMapY",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"twoSidedLighting",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useAlphaFresnel",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useLinearAlphaFresnel",void 0),e([F(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"environmentBRDFTexture",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"forceNormalForward",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"enableSpecularAntiAliasing",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useHorizonOcclusion",void 0),e([n(),D("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRadianceOcclusion",void 0),e([n(),D("_markAllSubMeshesAsMiscDirty")],i.prototype,"unlit",void 0),i}(sn);q.RegisteredTypes["BABYLON.PBRMaterial"]=ln;var cn,fn,un=function(){function t(e,n,t){void 0===n&&(n=0),void 0===t&&(t=null),this.name=e,this.animations=new Array,this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new a,this._onDataLayoutChanged=new a,this._animationPropertiesOverride=null,this._scene=t||b.LastCreatedScene,this.influence=n,this._scene&&(this._uniqueId=this._scene.getUniqueId())}return Object.defineProperty(t.prototype,"influence",{get:function(){return this._influence},set:function(e){if(this._influence!==e){var n=this._influence;this._influence=e,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===n||0===e)}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animationPropertiesOverride",{get:function(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPositions",{get:function(){return!!this._positions},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasNormals",{get:function(){return!!this._normals},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasTangents",{get:function(){return!!this._tangents},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasUVs",{get:function(){return!!this._uvs},enumerable:!1,configurable:!0}),t.prototype.setPositions=function(e){var n=this.hasPositions;this._positions=e,n!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)},t.prototype.getPositions=function(){return this._positions},t.prototype.setNormals=function(e){var n=this.hasNormals;this._normals=e,n!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)},t.prototype.getNormals=function(){return this._normals},t.prototype.setTangents=function(e){var n=this.hasTangents;this._tangents=e,n!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)},t.prototype.getTangents=function(){return this._tangents},t.prototype.setUVs=function(e){var n=this.hasUVs;this._uvs=e,n!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)},t.prototype.getUVs=function(){return this._uvs},t.prototype.clone=function(){var e=this,n=B.Clone((function(){return new t(e.name,e.influence,e._scene)}),this);return n._positions=this._positions,n._normals=this._normals,n._tangents=this._tangents,n._uvs=this._uvs,n},t.prototype.serialize=function(){var e={};return e.name=this.name,e.influence=this.influence,e.positions=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(e.id=this.id),this.hasNormals&&(e.normals=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(e.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(e.uvs=Array.prototype.slice.call(this.getUVs())),B.AppendSerializedAnimations(this,e),e},t.prototype.getClassName=function(){return"MorphTarget"},t.Parse=function(e){var n=new t(e.name,e.influence);if(n.setPositions(e.positions),null!=e.id&&(n.id=e.id),e.normals&&n.setNormals(e.normals),e.tangents&&n.setTangents(e.tangents),e.uvs&&n.setUVs(e.uvs),e.animations)for(var i=0;i<e.animations.length;i++){var r=e.animations[i],o=q.GetClass("BABYLON.Animation");o&&n.animations.push(o.Parse(r))}return n},t.FromMesh=function(e,n,i){n||(n=e.name);var r=new t(n,i,e.getScene());return r.setPositions(e.getVerticesData(V.PositionKind)),e.isVerticesDataPresent(V.NormalKind)&&r.setNormals(e.getVerticesData(V.NormalKind)),e.isVerticesDataPresent(V.TangentKind)&&r.setTangents(e.getVerticesData(V.TangentKind)),e.isVerticesDataPresent(V.UVKind)&&r.setUVs(e.getVerticesData(V.UVKind)),r},e([n()],t.prototype,"id",void 0),t}(),dn=function(){function e(e){void 0===e&&(e=null),this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new j(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,e||(e=b.LastCreatedScene),this._scene=e,this._scene&&(this._scene.morphTargetManagers.push(this),this._uniqueId=this._scene.getUniqueId())}return Object.defineProperty(e.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vertexCount",{get:function(){return this._vertexCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"supportsNormals",{get:function(){return this._supportsNormals&&this.enableNormalMorphing},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"supportsTangents",{get:function(){return this._supportsTangents&&this.enableTangentMorphing},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"supportsUVs",{get:function(){return this._supportsUVs&&this.enableUVMorphing},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"numTargets",{get:function(){return this._targets.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"numInfluencers",{get:function(){return this._activeTargets.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"influences",{get:function(){return this._influences},enumerable:!1,configurable:!0}),e.prototype.getActiveTarget=function(e){return this._activeTargets.data[e]},e.prototype.getTarget=function(e){return this._targets[e]},e.prototype.addTarget=function(e){var n=this;this._targets.push(e),this._targetInfluenceChangedObservers.push(e.onInfluenceChanged.add((function(e){n._syncActiveTargets(e)}))),this._targetDataLayoutChangedObservers.push(e._onDataLayoutChanged.add((function(){n._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)},e.prototype.removeTarget=function(e){var n=this._targets.indexOf(e);n>=0&&(this._targets.splice(n,1),e.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(n,1)[0]),e._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(n,1)[0]),this._syncActiveTargets(!0))},e.prototype.clone=function(){for(var n=new e(this._scene),t=0,i=this._targets;t<i.length;t++){var r=i[t];n.addTarget(r.clone())}return n.enableNormalMorphing=this.enableNormalMorphing,n.enableTangentMorphing=this.enableTangentMorphing,n.enableUVMorphing=this.enableUVMorphing,n},e.prototype.serialize=function(){var e={};e.id=this.uniqueId,e.targets=[];for(var n=0,t=this._targets;n<t.length;n++){var i=t[n];e.targets.push(i.serialize())}return e},e.prototype._syncActiveTargets=function(e){var n=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0;for(var t=0,i=this._targets;t<i.length;t++){var r=i[t];if(0!==r.influence){this._activeTargets.push(r),this._tempInfluences[n++]=r.influence,this._supportsNormals=this._supportsNormals&&r.hasNormals,this._supportsTangents=this._supportsTangents&&r.hasTangents,this._supportsUVs=this._supportsUVs&&r.hasUVs;var o=r.getPositions();if(o){var a=o.length/3;if(0===this._vertexCount)this._vertexCount=a;else if(this._vertexCount!==a)return}}}this._influences&&this._influences.length===n||(this._influences=new Float32Array(n));for(var s=0;s<n;s++)this._influences[s]=this._tempInfluences[s];e&&this.synchronize()},e.prototype.synchronize=function(){if(this._scene)for(var e=0,n=this._scene.meshes;e<n.length;e++){var t=n[e];t.morphTargetManager===this&&t._syncGeometryWithMorphTargetManager()}},e.Parse=function(n,t){var i=new e(t);i._uniqueId=n.id;for(var r=0,o=n.targets;r<o.length;r++){var a=o[r];i.addTarget(un.Parse(a))}return i},e}();(fn=cn||(cn={}))[fn.Clean=0]="Clean",fn[fn.Stop=1]="Stop",fn[fn.Sync=2]="Sync",fn[fn.NoSync=3]="NoSync";var hn=function(){function e(){}return Object.defineProperty(e,"ForceFullSceneLoadingForIncremental",{get:function(){return Z.ForceFullSceneLoadingForIncremental},set:function(e){Z.ForceFullSceneLoadingForIncremental=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ShowLoadingScreen",{get:function(){return Z.ShowLoadingScreen},set:function(e){Z.ShowLoadingScreen=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"loggingLevel",{get:function(){return Z.loggingLevel},set:function(e){Z.loggingLevel=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"CleanBoneMatrixWeights",{get:function(){return Z.CleanBoneMatrixWeights},set:function(e){Z.CleanBoneMatrixWeights=e},enumerable:!1,configurable:!0}),e.GetDefaultPlugin=function(){return e._registeredPlugins[".babylon"]},e._GetPluginForExtension=function(n){var t=e._registeredPlugins[n];return t||e.GetDefaultPlugin()},e._GetPluginForDirectLoad=function(n){for(var t in e._registeredPlugins){var i=e._registeredPlugins[t].plugin;if(i.canDirectLoad&&i.canDirectLoad(n))return e._registeredPlugins[t]}return e.GetDefaultPlugin()},e._GetPluginForFilename=function(n){var t=n.indexOf("?");-1!==t&&(n=n.substring(0,t));var i=n.lastIndexOf("."),r=n.substring(i,n.length).toLowerCase();return e._GetPluginForExtension(r)},e._GetDirectLoad=function(e){return"data:"===e.substr(0,5)?e.substr(5):null},e._LoadData=function(n,t,i,r,o,a,s){var l,c=e._GetDirectLoad(n.name),f=s?e._GetPluginForExtension(s):c?e._GetPluginForDirectLoad(n.name):e._GetPluginForFilename(n.name);if(!(l=void 0!==f.plugin.createPlugin?f.plugin.createPlugin():f.plugin))throw"The loader plugin corresponding to the file type you are trying to load has not been found. If using es6, please import the plugin you wish to use before.";if(e.OnPluginActivatedObservable.notifyObservers(l),c){if(l.directLoad){var u=l.directLoad(t,c);u.then?u.then((function(e){i(l,e)})).catch((function(e){o("Error in directLoad of _loadData: "+e,e)})):i(l,u)}else i(l,c);return l}var d=f.isBinary,h=function(e,n){t.isDisposed?o("Scene has been disposed"):i(l,e,n)},p=null,v=!1,A=l.onDisposeObservable;A&&A.add((function(){v=!0,p&&(p.abort(),p=null),a()}));var E=function(){if(!v){var e=function(e,n){h(e,n?n.responseURL:void 0)},i=function(e){o(e.message,e)};p=l.requestFile?l.requestFile(t,n.url,e,r,d,i):t._requestFile(n.url,e,r,!0,d,i)}},_=n.file||J.FilesToLoad[n.name.toLowerCase()];if(-1===n.rootUrl.indexOf("file:")||-1!==n.rootUrl.indexOf("file:")&&!_){var g=t.getEngine(),T=g.enableOfflineSupport;if(T){for(var R=!1,C=0,S=t.disableOfflineSupportExceptionRules;C<S.length;C++){if(S[C].test(n.url)){R=!0;break}}T=!R}T&&m.OfflineProviderFactory?t.offlineProvider=m.OfflineProviderFactory(n.url,E,g.disableManifestCheck):E()}else if(_){var y=function(e){o(e.message,e)};p=l.readFile?l.readFile(t,_,h,r,d,y):t._readFile(_,h,r,d,y)}else o("Unable to find file named "+n.name);return l},e._GetFileInfo=function(e,n){var i,r,o=null;if(n)if(n.name){var a=n;i=e+a.name,r=a.name,o=a}else{var s=n;if("/"===s.substr(0,1))return null;i=e+s,r=s}else i=e,r=t.GetFilename(e),e=t.GetFolderPath(e);return{url:i,rootUrl:e,name:r,file:o}},e.GetPluginForExtension=function(n){return e._GetPluginForExtension(n).plugin},e.IsPluginForExtensionAvailable=function(n){return!!e._registeredPlugins[n]},e.RegisterPlugin=function(n){if("string"==typeof n.extensions){var t=n.extensions;e._registeredPlugins[t.toLowerCase()]={plugin:n,isBinary:!1}}else{var i=n.extensions;Object.keys(i).forEach((function(t){e._registeredPlugins[t.toLowerCase()]={plugin:n,isBinary:i[t].isBinary}}))}},e.ImportMesh=function(n,t,i,r,o,a,s,l){if(void 0===i&&(i=""),void 0===r&&(r=b.LastCreatedScene),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),void 0===l&&(l=null),!r)return null;var c=e._GetFileInfo(t,i);if(!c)return null;var f={};r._addPendingData(f);var u=function(){r._removePendingData(f)},d=function(e,n){var t="Unable to import meshes from "+c.url+": "+e;s&&s(r,t,n),u()},h=a?function(e){try{a(e)}catch(n){d("Error in onProgress callback: "+n,n)}}:void 0,p=function(e,n,t,i,a,s,l){if(r.importedMeshesFiles.push(c.url),o)try{o(e,n,t,i,a,s,l)}catch(u){d("Error in onSuccess callback: "+u,u)}r._removePendingData(f)};return e._LoadData(c,r,(function(e,t,i){if(e.rewriteRootURL&&(c.rootUrl=e.rewriteRootURL(c.rootUrl,i)),e.importMesh){var o=e,a=new Array,s=new Array,l=new Array;if(!o.importMesh(n,r,t,c.rootUrl,a,s,l,d))return;r.loadingPluginName=e.name,p(a,s,l,[],[],[],[])}else{e.importMeshAsync(n,r,t,c.rootUrl,h,c.name).then((function(n){r.loadingPluginName=e.name,p(n.meshes,n.particleSystems,n.skeletons,n.animationGroups,n.transformNodes,n.geometries,n.lights)})).catch((function(e){d(e.message,e)}))}}),h,d,u,l)},e.ImportMeshAsync=function(n,t,i,r,o,a){return void 0===i&&(i=""),void 0===r&&(r=b.LastCreatedScene),void 0===o&&(o=null),void 0===a&&(a=null),new Promise((function(s,l){e.ImportMesh(n,t,i,r,(function(e,n,t,i,r,o,a){s({meshes:e,particleSystems:n,skeletons:t,animationGroups:i,transformNodes:r,geometries:o,lights:a})}),o,(function(e,n,t){l(t||new Error(n))}),a)}))},e.Load=function(n,t,i,r,o,a,s){return void 0===t&&(t=""),void 0===i&&(i=b.LastCreatedEngine),void 0===r&&(r=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),i?e.Append(n,t,new C(i),r,o,a,s):null},e.LoadAsync=function(n,t,i,r,o){return void 0===t&&(t=""),void 0===i&&(i=b.LastCreatedEngine),void 0===r&&(r=null),void 0===o&&(o=null),new Promise((function(a,s){e.Load(n,t,i,(function(e){a(e)}),r,(function(e,n,t){s(t||new Error(n))}),o)}))},e.Append=function(n,t,i,r,o,a,s){var l=this;if(void 0===t&&(t=""),void 0===i&&(i=b.LastCreatedScene),void 0===r&&(r=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),!i)return null;var c=e._GetFileInfo(n,t);if(!c)return null;e.ShowLoadingScreen&&!this._showingLoadingScreen&&(this._showingLoadingScreen=!0,i.getEngine().displayLoadingUI(),i.executeWhenReady((function(){i.getEngine().hideLoadingUI(),l._showingLoadingScreen=!1})));var f={};i._addPendingData(f);var u=function(){i._removePendingData(f)},d=function(e,n){var t="Unable to load from "+c.url+(e?": "+e:"");a&&a(i,t,n),u()},h=o?function(e){try{o(e)}catch(n){d("Error in onProgress callback",n)}}:void 0,p=function(){if(r)try{r(i)}catch(e){d("Error in onSuccess callback",e)}i._removePendingData(f)};return e._LoadData(c,i,(function(e,n){if(e.load){if(!e.load(i,n,c.rootUrl,d))return;i.loadingPluginName=e.name,p()}else{e.loadAsync(i,n,c.rootUrl,h,c.name).then((function(){i.loadingPluginName=e.name,p()})).catch((function(e){d(e.message,e)}))}}),h,d,u,s)},e.AppendAsync=function(n,t,i,r,o){return void 0===t&&(t=""),void 0===i&&(i=b.LastCreatedScene),void 0===r&&(r=null),void 0===o&&(o=null),new Promise((function(a,s){e.Append(n,t,i,(function(e){a(e)}),r,(function(e,n,t){s(t||new Error(n))}),o)}))},e.LoadAssetContainer=function(n,t,i,r,o,a,s){if(void 0===t&&(t=""),void 0===i&&(i=b.LastCreatedScene),void 0===r&&(r=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),!i)return null;var l=e._GetFileInfo(n,t);if(!l)return null;var c={};i._addPendingData(c);var f=function(){i._removePendingData(c)},u=function(e,n){var t="Unable to load assets from "+l.url+(e?": "+e:"");n&&n.message&&(t+=" ("+n.message+")"),a&&a(i,t,n),f()},d=o?function(e){try{o(e)}catch(n){u("Error in onProgress callback",n)}}:void 0,h=function(e){if(r)try{r(e)}catch(n){u("Error in onSuccess callback",n)}i._removePendingData(c)};return e._LoadData(l,i,(function(e,n){if(e.loadAssetContainer){var t=e.loadAssetContainer(i,n,l.rootUrl,u);if(!t)return;i.loadingPluginName=e.name,h(t)}else if(e.loadAssetContainerAsync){e.loadAssetContainerAsync(i,n,l.rootUrl,d,l.name).then((function(n){i.loadingPluginName=e.name,h(n)})).catch((function(e){u(e.message,e)}))}else u("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),d,u,f,s)},e.LoadAssetContainerAsync=function(n,t,i,r,o){return void 0===t&&(t=""),void 0===i&&(i=b.LastCreatedScene),void 0===r&&(r=null),void 0===o&&(o=null),new Promise((function(a,s){e.LoadAssetContainer(n,t,i,(function(e){a(e)}),r,(function(e,n,t){s(t||new Error(n))}),o)}))},e.ImportAnimations=function(e,n,t,i,r,o,a,s,l,c){if(void 0===n&&(n=""),void 0===t&&(t=b.LastCreatedScene),void 0===i&&(i=!0),void 0===r&&(r=cn.Clean),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),void 0===l&&(l=null),void 0===c&&(c=null),t){if(i){for(var f=0,u=t.animatables;f<u.length;f++){u[f].reset()}t.stopAllAnimations(),t.animationGroups.slice().forEach((function(e){e.dispose()})),t.getNodes().forEach((function(e){e.animations&&(e.animations=[])}))}else switch(r){case cn.Clean:t.animationGroups.slice().forEach((function(e){e.dispose()}));break;case cn.Stop:t.animationGroups.forEach((function(e){e.stop()}));break;case cn.Sync:t.animationGroups.forEach((function(e){e.reset(),e.restart()}));break;case cn.NoSync:break;default:return}var d=t.animatables.length;this.LoadAssetContainer(e,n,t,(function(e){e.mergeAnimationsTo(t,t.animatables.slice(d),o),e.dispose(),t.onAnimationFileImportedObservable.notifyObservers(t),a&&a(t)}),s,l,c)}},e.ImportAnimationsAsync=function(n,t,i,r,o,a,s,l,c,f){return void 0===t&&(t=""),void 0===i&&(i=b.LastCreatedScene),void 0===r&&(r=!0),void 0===o&&(o=cn.Clean),void 0===a&&(a=null),void 0===l&&(l=null),void 0===f&&(f=null),new Promise((function(s,c){e.ImportAnimations(n,t,i,r,o,a,(function(e){s(e)}),l,(function(e,n,t){c(t||new Error(n))}),f)}))},e.NO_LOGGING=0,e.MINIMAL_LOGGING=1,e.SUMMARY_LOGGING=2,e.DETAILED_LOGGING=3,e.OnPluginActivatedObservable=new a,e._registeredPlugins={},e._showingLoadingScreen=!1,e}(),pn=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return l(n,e),n}(ee),mn=function(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]},vn=function(e){function n(n){var t=e.call(this)||this;return t._wasAddedToScene=!1,t.scene=n,t.sounds=[],t.effectLayers=[],t.layers=[],t.lensFlareSystems=[],t.proceduralTextures=[],t.reflectionProbes=[],n.onDisposeObservable.add((function(){t._wasAddedToScene||t.dispose()})),t}return l(n,e),n.prototype.instantiateModelsToScene=function(e,n){var t=this;void 0===n&&(n=!1);var i={},r={},o=new mn,a=[],s=[],l={doNotInstantiate:!0},c=function(n,t){if(i[n.uniqueId]=t.uniqueId,r[t.uniqueId]=t,e&&(t.name=e(n.name)),t instanceof $){var o=t;if(o.morphTargetManager){var a=n.morphTargetManager;o.morphTargetManager=a.clone();for(var s=0;s<a.numTargets;s++){var l=a.getTarget(s),c=o.morphTargetManager.getTarget(s);i[l.uniqueId]=c.uniqueId,r[c.uniqueId]=c}}}};return this.transformNodes.forEach((function(e){if(!e.parent){var n=e.instantiateHierarchy(null,l,(function(e,n){c(e,n)}));n&&o.rootNodes.push(n)}})),this.meshes.forEach((function(a){if(!a.parent){var f=a.instantiateHierarchy(null,l,(function(o,a){if(c(o,a),a.material){var l=a;if(l.material)if(n){var f=o.material;if(-1===s.indexOf(f)){var u=f.clone(e?e(f.name):"Clone of "+f.name);if(s.push(f),i[f.uniqueId]=u.uniqueId,r[u.uniqueId]=u,"MultiMaterial"===f.getClassName()){for(var d=f,h=0,p=d.subMaterials;h<p.length;h++){var m=p[h];m&&(u=m.clone(e?e(m.name):"Clone of "+m.name),s.push(m),i[m.uniqueId]=u.uniqueId,r[u.uniqueId]=u)}d.subMaterials=d.subMaterials.map((function(e){return e&&r[i[e.uniqueId]]}))}}l.material=r[i[f.uniqueId]]}else"MultiMaterial"===l.material.getClassName()?-1===t.scene.multiMaterials.indexOf(l.material)&&t.scene.addMultiMaterial(l.material):-1===t.scene.materials.indexOf(l.material)&&t.scene.addMaterial(l.material)}}));f&&o.rootNodes.push(f)}})),this.skeletons.forEach((function(n){var s=n.clone(e?e(n.name):"Clone of "+n.name);n.overrideMesh&&(s.overrideMesh=r[i[n.overrideMesh.uniqueId]]);for(var l=0,c=t.meshes;l<c.length;l++){var f=c[l];if(f.skeleton===n&&!f.isAnInstance){if(r[i[f.uniqueId]].skeleton=s,-1!==a.indexOf(s))continue;a.push(s);for(var u=0,d=s.bones;u<d.length;u++){var h=d[u];h._linkedTransformNode&&(h._linkedTransformNode=r[i[h._linkedTransformNode.uniqueId]])}}}o.skeletons.push(s)})),this.animationGroups.forEach((function(e){var n=e.clone(e.name,(function(e){return r[i[e.uniqueId]]||e}));o.animationGroups.push(n)})),o},n.prototype.addAllToScene=function(){var e=this;this._wasAddedToScene=!0,this.cameras.forEach((function(n){e.scene.addCamera(n)})),this.lights.forEach((function(n){e.scene.addLight(n)})),this.meshes.forEach((function(n){e.scene.addMesh(n)})),this.skeletons.forEach((function(n){e.scene.addSkeleton(n)})),this.animations.forEach((function(n){e.scene.addAnimation(n)})),this.animationGroups.forEach((function(n){e.scene.addAnimationGroup(n)})),this.multiMaterials.forEach((function(n){e.scene.addMultiMaterial(n)})),this.materials.forEach((function(n){e.scene.addMaterial(n)})),this.morphTargetManagers.forEach((function(n){e.scene.addMorphTargetManager(n)})),this.geometries.forEach((function(n){e.scene.addGeometry(n)})),this.transformNodes.forEach((function(n){e.scene.addTransformNode(n)})),this.actionManagers.forEach((function(n){e.scene.addActionManager(n)})),this.textures.forEach((function(n){e.scene.addTexture(n)})),this.reflectionProbes.forEach((function(n){e.scene.addReflectionProbe(n)})),this.environmentTexture&&(this.scene.environmentTexture=this.environmentTexture);for(var n=0,t=this.scene._serializableComponents;n<t.length;n++){t[n].addFromContainer(this)}},n.prototype.removeAllFromScene=function(){var e=this;this._wasAddedToScene=!1,this.cameras.forEach((function(n){e.scene.removeCamera(n)})),this.lights.forEach((function(n){e.scene.removeLight(n)})),this.meshes.forEach((function(n){e.scene.removeMesh(n)})),this.skeletons.forEach((function(n){e.scene.removeSkeleton(n)})),this.animations.forEach((function(n){e.scene.removeAnimation(n)})),this.animationGroups.forEach((function(n){e.scene.removeAnimationGroup(n)})),this.multiMaterials.forEach((function(n){e.scene.removeMultiMaterial(n)})),this.materials.forEach((function(n){e.scene.removeMaterial(n)})),this.morphTargetManagers.forEach((function(n){e.scene.removeMorphTargetManager(n)})),this.geometries.forEach((function(n){e.scene.removeGeometry(n)})),this.transformNodes.forEach((function(n){e.scene.removeTransformNode(n)})),this.actionManagers.forEach((function(n){e.scene.removeActionManager(n)})),this.textures.forEach((function(n){e.scene.removeTexture(n)})),this.reflectionProbes.forEach((function(n){e.scene.removeReflectionProbe(n)})),this.environmentTexture===this.scene.environmentTexture&&(this.scene.environmentTexture=null);for(var n=0,t=this.scene._serializableComponents;n<t.length;n++){t[n].removeFromContainer(this)}},n.prototype.dispose=function(){this.cameras.forEach((function(e){e.dispose()})),this.cameras=[],this.lights.forEach((function(e){e.dispose()})),this.lights=[],this.meshes.forEach((function(e){e.dispose()})),this.meshes=[],this.skeletons.forEach((function(e){e.dispose()})),this.skeletons=[],this.animationGroups.forEach((function(e){e.dispose()})),this.animationGroups=[],this.multiMaterials.forEach((function(e){e.dispose()})),this.multiMaterials=[],this.materials.forEach((function(e){e.dispose()})),this.materials=[],this.geometries.forEach((function(e){e.dispose()})),this.geometries=[],this.transformNodes.forEach((function(e){e.dispose()})),this.transformNodes=[],this.actionManagers.forEach((function(e){e.dispose()})),this.actionManagers=[],this.textures.forEach((function(e){e.dispose()})),this.textures=[],this.reflectionProbes.forEach((function(e){e.dispose()})),this.reflectionProbes=[],this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(var e=0,n=this.scene._serializableComponents;e<n.length;e++){n[e].removeFromContainer(this,!0)}},n.prototype._moveAssets=function(e,n,t){if(e)for(var i=0,r=e;i<r.length;i++){var o=r[i],a=!0;if(t)for(var s=0,l=t;s<l.length;s++){if(o===l[s]){a=!1;break}}a&&n.push(o)}},n.prototype.moveAllFromScene=function(e){for(var n in this._wasAddedToScene=!1,void 0===e&&(e=new pn),this)this.hasOwnProperty(n)&&(this[n]=this[n]||("environmentTexture"===n?null:[]),this._moveAssets(this.scene[n],this[n],e[n]));this.environmentTexture=this.scene.environmentTexture,this.removeAllFromScene()},n.prototype.createRootMesh=function(){var e=new $("assetContainerRootMesh",this.scene);return this.meshes.forEach((function(n){n.parent||e.addChild(n)})),this.meshes.unshift(e),e},n.prototype.mergeAnimationsTo=function(e,n,t){if(void 0===e&&(e=b.LastCreatedScene),void 0===t&&(t=null),!e)return[];var i=t||function(n){var t=null,i=n.animations.length?n.animations[0].targetProperty:"",r=n.name.split(".").join("").split("_primitive")[0];switch(i){case"position":case"rotationQuaternion":t=e.getTransformNodeByName(n.name)||e.getTransformNodeByName(r);break;case"influence":t=e.getMorphTargetByName(n.name)||e.getMorphTargetByName(r);break;default:t=e.getNodeByName(n.name)||e.getNodeByName(r)}return t};this.getNodes().forEach((function(e){var n=i(e);if(null!==n){for(var t=function(e){for(var t=0,i=n.animations.filter((function(n){return n.targetProperty===e.targetProperty}));t<i.length;t++){var r=i[t],o=n.animations.indexOf(r,0);o>-1&&n.animations.splice(o,1)}},r=0,o=e.animations;r<o.length;r++){t(o[r])}n.animations=n.animations.concat(e.animations)}}));var r=new Array;return this.animationGroups.slice().forEach((function(e){r.push(e.clone(e.name,i)),e.animatables.forEach((function(e){e.stop()}))})),n.forEach((function(n){var t=i(n.target);t&&(e.beginAnimation(t,n.fromFrame,n.toFrame,n.loopAnimation,n.speedRatio,n.onAnimationEnd?n.onAnimationEnd:void 0,void 0,!0,void 0,n.onAnimationLoop?n.onAnimationLoop:void 0),e.stopAnimation(n.target))})),r},n}(ee),An=function(){function e(e){this.byteOffset=0,this.buffer=e}return e.prototype.loadAsync=function(e){var n=this;return this.buffer.readAsync(this.byteOffset,e).then((function(e){n._dataView=new DataView(e.buffer,e.byteOffset,e.byteLength),n._dataByteOffset=0}))},e.prototype.readUint32=function(){var e=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,e},e.prototype.readUint8Array=function(e){var n=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,e);return this._dataByteOffset+=e,this.byteOffset+=e,n},e.prototype.readString=function(e){return ne.Decode(this.readUint8Array(e))},e.prototype.skipBytes=function(e){this._dataByteOffset+=e,this.byteOffset+=e},e}();function En(e,n,t,i){var r={externalResourceFunction:function(e){return i(e).then((function(e){return new Uint8Array(e)}))}};return t&&(r.uri="file:"===n?t:n+t),e instanceof ArrayBuffer?GLTFValidator.validateBytes(new Uint8Array(e),r):GLTFValidator.validateString(e,r)}function _n(){var e=[];onmessage=function(n){var t=n.data;switch(t.id){case"init":importScripts(t.url);break;case"validate":En(t.data,t.rootUrl,t.fileName,(function(n){return new Promise((function(t,i){var r=e.length;e.push({resolve:t,reject:i}),postMessage({id:"getExternalResource",index:r,uri:n})}))})).then((function(e){postMessage({id:"validate.resolve",value:e})}),(function(e){postMessage({id:"validate.reject",reason:e})}));break;case"getExternalResource.resolve":e[t.index].resolve(t.value);break;case"getExternalResource.reject":e[t.index].reject(t.reason)}}}var gn,Tn,Rn,Cn,Sn,yn,bn=function(){function e(){}return e.ValidateAsync=function(e,n,i,r){var o=this;return"function"==typeof Worker?new Promise((function(a,s){var l=En+"("+_n+")()",c=URL.createObjectURL(new Blob([l],{type:"application/javascript"})),f=new Worker(c),u=function(e){f.removeEventListener("error",u),f.removeEventListener("message",d),s(e)},d=function(e){var n=e.data;switch(n.id){case"getExternalResource":r(n.uri).then((function(e){f.postMessage({id:"getExternalResource.resolve",index:n.index,value:e},[e])}),(function(e){f.postMessage({id:"getExternalResource.reject",index:n.index,reason:e})}));break;case"validate.resolve":f.removeEventListener("error",u),f.removeEventListener("message",d),a(n.value);break;case"validate.reject":f.removeEventListener("error",u),f.removeEventListener("message",d),s(n.reason)}};f.addEventListener("error",u),f.addEventListener("message",d),f.postMessage({id:"init",url:t.GetAbsoluteUrl(o.Configuration.url)}),f.postMessage({id:"validate",data:e,rootUrl:n,fileName:i})})):(this._LoadScriptPromise||(this._LoadScriptPromise=t.LoadScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((function(){return En(e,n,i,r)})))},e.Configuration={url:"https://preview.babylonjs.com/gltf_validator.js"},e}();(Tn=gn||(gn={}))[Tn.AUTO=0]="AUTO",Tn[Tn.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED",(Cn=Rn||(Rn={}))[Cn.NONE=0]="NONE",Cn[Cn.FIRST=1]="FIRST",Cn[Cn.ALL=2]="ALL",(yn=Sn||(Sn={}))[yn.LOADING=0]="LOADING",yn[yn.READY=1]="READY",yn[yn.COMPLETE=2]="COMPLETE";var In=function(){function e(){this.onParsedObservable=new a,this.coordinateSystemMode=gn.AUTO,this.animationStartMode=Rn.FIRST,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.preprocessUrlAsync=function(e){return Promise.resolve(e)},this.onMeshLoadedObservable=new a,this.onTextureLoadedObservable=new a,this.onMaterialLoadedObservable=new a,this.onCameraLoadedObservable=new a,this.onCompleteObservable=new a,this.onErrorObservable=new a,this.onDisposeObservable=new a,this.onExtensionLoadedObservable=new a,this.validate=!1,this.onValidatedObservable=new a,this._loader=null,this._requests=new Array,this.name="gltf",this.extensions={".gltf":{isBinary:!1},".glb":{isBinary:!0}},this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled}return Object.defineProperty(e.prototype,"onParsed",{set:function(e){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),this._onParsedObserver=this.onParsedObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMeshLoaded",{set:function(e){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onTextureLoaded",{set:function(e){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMaterialLoaded",{set:function(e){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onCameraLoaded",{set:function(e){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onComplete",{set:function(e){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onError",{set:function(e){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onExtensionLoaded",{set:function(e){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loggingEnabled",{get:function(){return this._loggingEnabled},set:function(e){this._loggingEnabled!==e&&(this._loggingEnabled=e,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"capturePerformanceCounters",{get:function(){return this._capturePerformanceCounters},set:function(e){this._capturePerformanceCounters!==e&&(this._capturePerformanceCounters=e,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onValidated",{set:function(e){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(e)},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){this._loader&&(this._loader.dispose(),this._loader=null);for(var e=0,n=this._requests;e<n.length;e++){n[e].abort()}this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=function(e){return Promise.resolve(e)},this.onMeshLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(void 0),this.onDisposeObservable.clear()},e.prototype.requestFile=function(e,n,i,r,o,s){var l=this;if(this._progressCallback=r,o){if(this.useRangeRequests){this.validate;var c={abort:function(){},onCompleteObservable:new a},f={readAsync:function(t,i){return new Promise((function(r,o){l._requestFile(n,e,(function(e){r(new Uint8Array(e))}),!0,(function(e){o(e)}),(function(e){e.setRequestHeader("Range","bytes="+t+"-"+(t+i-1))}))}))},byteLength:0};return this._unpackBinaryAsync(new An(f)).then((function(e){c.onCompleteObservable.notifyObservers(c),i(e)}),s),c}return this._requestFile(n,e,(function(e,n){var t=e;l._unpackBinaryAsync(new An({readAsync:function(e,n){return Promise.resolve(new Uint8Array(t,e,n))},byteLength:t.byteLength})).then((function(e){i(e,n)}),s)}),!0,s)}return this._requestFile(n,e,(function(r,o){l._validate(e,r,t.GetFolderPath(n),t.GetFilename(n)),i({json:l._parseJson(r)},o)}),o,s)},e.prototype.readFile=function(e,n,t,i,r,o){var a=this;return e._readFile(n,(function(i){if(a._validate(e,i,"file:",n.name),r){var s=i;a._unpackBinaryAsync(new An({readAsync:function(e,n){return Promise.resolve(new Uint8Array(s,e,n))},byteLength:s.byteLength})).then(t,o)}else t({json:a._parseJson(i)})}),i,r,o)},e.prototype.importMeshAsync=function(e,n,t,i,r,o){var a=this;return Promise.resolve().then((function(){return a.onParsedObservable.notifyObservers(t),a.onParsedObservable.clear(),a._log("Loading "+(o||"")),a._loader=a._getLoader(t),a._loader.importMeshAsync(e,n,!1,t,i,r,o)}))},e.prototype.loadAsync=function(e,n,t,i,r){var o=this;return Promise.resolve().then((function(){return o.onParsedObservable.notifyObservers(n),o.onParsedObservable.clear(),o._log("Loading "+(r||"")),o._loader=o._getLoader(n),o._loader.loadAsync(e,n,t,i,r)}))},e.prototype.loadAssetContainerAsync=function(e,n,t,i,r){var o=this;return Promise.resolve().then((function(){o.onParsedObservable.notifyObservers(n),o.onParsedObservable.clear(),o._log("Loading "+(r||"")),o._loader=o._getLoader(n);var a=new vn(e),s=[];o.onMaterialLoadedObservable.add((function(e){s.push(e),e.onDisposeObservable.addOnce((function(){var n=a.materials.indexOf(e);n>-1&&a.materials.splice(n,1),(n=s.indexOf(e))>-1&&s.splice(n,1)}))}));var l=[];o.onTextureLoadedObservable.add((function(e){l.push(e),e.onDisposeObservable.addOnce((function(){var n=a.textures.indexOf(e);n>-1&&a.textures.splice(n,1),(n=l.indexOf(e))>-1&&l.splice(n,1)}))}));var c=[];return o.onCameraLoadedObservable.add((function(e){c.push(e)})),o._loader.importMeshAsync(null,e,!0,n,t,i,r).then((function(e){return Array.prototype.push.apply(a.geometries,e.geometries),Array.prototype.push.apply(a.meshes,e.meshes),Array.prototype.push.apply(a.particleSystems,e.particleSystems),Array.prototype.push.apply(a.skeletons,e.skeletons),Array.prototype.push.apply(a.animationGroups,e.animationGroups),Array.prototype.push.apply(a.materials,s),Array.prototype.push.apply(a.textures,l),Array.prototype.push.apply(a.lights,e.lights),Array.prototype.push.apply(a.transformNodes,e.transformNodes),Array.prototype.push.apply(a.cameras,c),a}))}))},e.prototype.canDirectLoad=function(n){return-1!==n.indexOf("asset")&&-1!==n.indexOf("version")||ne.StartsWith(n,"data:base64,"+e.magicBase64Encoded)||ne.StartsWith(n,"data:application/octet-stream;base64,"+e.magicBase64Encoded)||ne.StartsWith(n,"data:model/gltf-binary;base64,"+e.magicBase64Encoded)},e.prototype.directLoad=function(n,i){if(ne.StartsWith(i,"base64,"+e.magicBase64Encoded)||ne.StartsWith(i,"application/octet-stream;base64,"+e.magicBase64Encoded)||ne.StartsWith(i,"model/gltf-binary;base64,"+e.magicBase64Encoded)){var r=t.DecodeBase64(i);return this._validate(n,r),this._unpackBinaryAsync(new An({readAsync:function(e,n){return Promise.resolve(new Uint8Array(r,e,n))},byteLength:r.byteLength}))}return this._validate(n,i),Promise.resolve({json:this._parseJson(i)})},e.prototype.createPlugin=function(){return new e},Object.defineProperty(e.prototype,"loaderState",{get:function(){return this._loader?this._loader.state:null},enumerable:!1,configurable:!0}),e.prototype.whenCompleteAsync=function(){var e=this;return new Promise((function(n,t){e.onCompleteObservable.addOnce((function(){n()})),e.onErrorObservable.addOnce((function(e){t(e)}))}))},e.prototype._loadFile=function(e,n,t,i,r){var o=this,a=n._loadFile(e,t,(function(e){o._onProgress(e,a)}),void 0,i,r);return a.onCompleteObservable.add((function(e){o._requests.splice(o._requests.indexOf(e),1)})),this._requests.push(a),a},e.prototype._requestFile=function(e,n,t,i,r,o){var a=this,s=n._requestFile(e,t,(function(e){a._onProgress(e,s)}),void 0,i,r,o);return s.onCompleteObservable.add((function(e){a._requests.splice(a._requests.indexOf(e),1)})),this._requests.push(s),s},e.prototype._onProgress=function(e,n){if(this._progressCallback){n._lengthComputable=e.lengthComputable,n._loaded=e.loaded,n._total=e.total;for(var t=!0,i=0,r=0,o=0,a=this._requests;o<a.length;o++){var s=a[o];if(void 0===s._lengthComputable||void 0===s._loaded||void 0===s._total)return;t=t&&s._lengthComputable,i+=s._loaded,r+=s._total}this._progressCallback({lengthComputable:t,loaded:i,total:t?r:0})}},e.prototype._validate=function(e,n,t,i){var r=this;void 0===t&&(t=""),void 0===i&&(i=""),this.validate&&(this._startPerformanceCounter("Validate JSON"),bn.ValidateAsync(n,t,i,(function(n){return r.preprocessUrlAsync(t+n).then((function(n){return e._loadFileAsync(n,void 0,!0,!0)}))})).then((function(e){r._endPerformanceCounter("Validate JSON"),r.onValidatedObservable.notifyObservers(e),r.onValidatedObservable.clear()}),(function(e){r._endPerformanceCounter("Validate JSON"),e.message,r.onValidatedObservable.clear()})))},e.prototype._getLoader=function(n){var t=n.json.asset||{};this._log("Asset version: "+t.version),t.minVersion&&this._log("Asset minimum version: "+t.minVersion),t.generator&&this._log("Asset generator: "+t.generator);var i=e._parseVersion(t.version);if(!i)throw new Error("Invalid version: "+t.version);if(void 0!==t.minVersion){var r=e._parseVersion(t.minVersion);if(!r)throw new Error("Invalid minimum version: "+t.minVersion);if(e._compareVersion(r,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+t.minVersion)}var o={1:e._CreateGLTF1Loader,2:e._CreateGLTF2Loader}[i.major];if(!o)throw new Error("Unsupported version: "+t.version);return o(this)},e.prototype._parseJson=function(e){this._startPerformanceCounter("Parse JSON"),this._log("JSON length: "+e.length);var n=JSON.parse(e);return this._endPerformanceCounter("Parse JSON"),n},e.prototype._unpackBinaryAsync=function(e){var n=this;return this._startPerformanceCounter("Unpack Binary"),e.loadAsync(20).then((function(){var t=e.readUint32();if(1179937895!==t)throw new Error("Unexpected magic: "+t);var i=e.readUint32();n.loggingEnabled&&n._log("Binary version: "+i);var r,o=e.readUint32();if(0!==e.buffer.byteLength&&o!==e.buffer.byteLength)throw new Error("Length in header does not match actual data length: "+o+" != "+e.buffer.byteLength);switch(i){case 1:r=n._unpackBinaryV1Async(e,o);break;case 2:r=n._unpackBinaryV2Async(e,o);break;default:throw new Error("Unsupported version: "+i)}return n._endPerformanceCounter("Unpack Binary"),r}))},e.prototype._unpackBinaryV1Async=function(e,n){var t=e.readUint32(),i=e.readUint32();if(0!==i)throw new Error("Unexpected content format: "+i);var r=n-e.byteOffset,o={json:this._parseJson(e.readString(t)),bin:null};if(0!==r){var a=e.byteOffset;o.bin={readAsync:function(n,t){return e.buffer.readAsync(a+n,t)},byteLength:r}}return Promise.resolve(o)},e.prototype._unpackBinaryV2Async=function(e,n){var t=this,i=1313821514,r=5130562,o=e.readUint32();if(e.readUint32()!==i)throw new Error("First chunk format is not JSON");return e.byteOffset+o===n?e.loadAsync(o).then((function(){return{json:t._parseJson(e.readString(o)),bin:null}})):e.loadAsync(o+8).then((function(){var a={json:t._parseJson(e.readString(o)),bin:null},s=function(){var t=e.readUint32();switch(e.readUint32()){case i:throw new Error("Unexpected JSON chunk");case r:var o=e.byteOffset;a.bin={readAsync:function(n,t){return e.buffer.readAsync(o+n,t)},byteLength:t},e.skipBytes(t);break;default:e.skipBytes(t)}return e.byteOffset!==n?e.loadAsync(8).then(s):Promise.resolve(a)};return s()}))},e._parseVersion=function(e){if("1.0"===e||"1.0.1"===e)return{major:1,minor:0};var n=(e+"").match(/^(\d+)\.(\d+)/);return n?{major:parseInt(n[1]),minor:parseInt(n[2])}:null},e._compareVersion=function(e,n){return e.major>n.major?1:e.major<n.major?-1:e.minor>n.minor?1:e.minor<n.minor?-1:0},e.prototype._logOpen=function(e){this._log(e),this._logIndentLevel++},e.prototype._logClose=function(){--this._logIndentLevel},e.prototype._logEnabled=function(n){e._logSpaces.substr(0,2*this._logIndentLevel)},e.prototype._logDisabled=function(e){},e.prototype._startPerformanceCounterEnabled=function(e){t.StartPerformanceCounter(e)},e.prototype._startPerformanceCounterDisabled=function(e){},e.prototype._endPerformanceCounterEnabled=function(e){t.EndPerformanceCounter(e)},e.prototype._endPerformanceCounterDisabled=function(e){},e.IncrementalLoading=!0,e.HomogeneousCoordinates=!1,e.magicBase64Encoded="Z2xURg",e._logSpaces="                                ",e}();hn&&hn.RegisterPlugin(new In);var On=function(){function e(){}return e.Get=function(e,n,t){if(!n||null==t||!n[t])throw new Error(e+": Failed to find index ("+t+")");return n[t]},e.Assign=function(e){if(e)for(var n=0;n<e.length;n++)e[n].index=n},e}(),Mn=function(){function e(e){this._completePromises=new Array,this._forAssetContainer=!1,this._babylonLights=[],this._disableInstancedMesh=0,this._disposed=!1,this._state=null,this._extensions=new Array,this._defaultBabylonMaterialData={},this._parent=e}return e.RegisterExtension=function(n,t){e.UnregisterExtension(n),e._RegisteredExtensions[n]={factory:t}},e.UnregisterExtension=function(n){return!!e._RegisteredExtensions[n]&&(delete e._RegisteredExtensions[n],!0)},Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"gltf",{get:function(){return this._gltf},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bin",{get:function(){return this._bin},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"babylonScene",{get:function(){return this._babylonScene},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rootBabylonMesh",{get:function(){return this._rootBabylonMesh},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){if(!this._disposed){for(var e in this._disposed=!0,this._completePromises.length=0,this._extensions){var n=this._extensions[e];n.dispose&&n.dispose(),delete this._extensions[e]}this._gltf=null,this._babylonScene=null,this._rootBabylonMesh=null,this._parent.dispose()}},e.prototype.importMeshAsync=function(e,n,t,i,r,o,a){var s=this;return Promise.resolve().then((function(){s._babylonScene=n,s._rootUrl=r,s._fileName=a||"scene",s._forAssetContainer=t,s._loadData(i);var o=null;if(e){var l={};if(s._gltf.nodes)for(var c=0,f=s._gltf.nodes;c<f.length;c++){var u=f[c];u.name&&(l[u.name]=u.index)}o=(e instanceof Array?e:[e]).map((function(e){var n=l[e];if(void 0===n)throw new Error("Failed to find node '"+e+"'");return n}))}return s._loadAsync(o,(function(){return{meshes:s._getMeshes(),particleSystems:[],skeletons:s._getSkeletons(),animationGroups:s._getAnimationGroups(),lights:s._babylonLights,transformNodes:s._getTransformNodes(),geometries:s._getGeometries()}}))}))},e.prototype.loadAsync=function(e,n,t,i,r){var o=this;return Promise.resolve().then((function(){return o._babylonScene=e,o._rootUrl=t,o._fileName=r||"scene",o._loadData(n),o._loadAsync(null,(function(){}))}))},e.prototype._loadAsync=function(e,n){var i=this;return Promise.resolve().then((function(){i._uniqueRootUrl=-1===i._rootUrl.indexOf("file:")&&i._fileName?i._rootUrl:""+i._rootUrl+Date.now()+"/",i._loadExtensions(),i._checkExtensions();var r=Sn[Sn.LOADING]+" => "+Sn[Sn.READY],o=Sn[Sn.LOADING]+" => "+Sn[Sn.COMPLETE];i._parent._startPerformanceCounter(r),i._parent._startPerformanceCounter(o),i._setState(Sn.LOADING),i._extensionsOnLoading();var a=new Array,s=i._babylonScene.blockMaterialDirtyMechanism;if(i._babylonScene.blockMaterialDirtyMechanism=!0,e)a.push(i.loadSceneAsync("/nodes",{nodes:e,index:-1}));else if(null!=i._gltf.scene||i._gltf.scenes&&i._gltf.scenes[0]){var l=On.Get("/scene",i._gltf.scenes,i._gltf.scene||0);a.push(i.loadSceneAsync("/scenes/"+l.index,l))}if(i.parent.loadAllMaterials&&i._gltf.materials)for(var c=0;c<i._gltf.materials.length;++c){var f=i._gltf.materials[c],u="/materials/"+c,d=z.TriangleFillMode;a.push(i._loadMaterialAsync(u,f,null,d,(function(e){})))}i._babylonScene.blockMaterialDirtyMechanism=s,i._parent.compileMaterials&&a.push(i._compileMaterialsAsync()),i._parent.compileShadowGenerators&&a.push(i._compileShadowGeneratorsAsync());var h=Promise.all(a).then((function(){return i._rootBabylonMesh&&i._rootBabylonMesh.setEnabled(!0),i._extensionsOnReady(),i._setState(Sn.READY),i._startAnimations(),n()}));return h.then((function(){i._parent._endPerformanceCounter(r),t.SetImmediate((function(){i._disposed||Promise.all(i._completePromises).then((function(){i._parent._endPerformanceCounter(o),i._setState(Sn.COMPLETE),i._parent.onCompleteObservable.notifyObservers(void 0),i._parent.onCompleteObservable.clear(),i.dispose()}),(function(e){i._parent.onErrorObservable.notifyObservers(e),i._parent.onErrorObservable.clear(),i.dispose()}))}))})),h})).catch((function(e){throw i._disposed||(i._parent.onErrorObservable.notifyObservers(e),i._parent.onErrorObservable.clear(),i.dispose()),e}))},e.prototype._loadData=function(e){if(this._gltf=e.json,this._setupData(),e.bin){var n=this._gltf.buffers;if(n&&n[0]&&!n[0].uri){var t=n[0];(t.byteLength<e.bin.byteLength-3||t.byteLength>e.bin.byteLength)&&(t.byteLength,e.bin.byteLength),this._bin=e.bin}}},e.prototype._setupData=function(){if(On.Assign(this._gltf.accessors),On.Assign(this._gltf.animations),On.Assign(this._gltf.buffers),On.Assign(this._gltf.bufferViews),On.Assign(this._gltf.cameras),On.Assign(this._gltf.images),On.Assign(this._gltf.materials),On.Assign(this._gltf.meshes),On.Assign(this._gltf.nodes),On.Assign(this._gltf.samplers),On.Assign(this._gltf.scenes),On.Assign(this._gltf.skins),On.Assign(this._gltf.textures),this._gltf.nodes){for(var e={},n=0,t=this._gltf.nodes;n<t.length;n++){if((l=t[n]).children)for(var i=0,r=l.children;i<r.length;i++){e[r[i]]=l.index}}for(var o=this._createRootNode(),a=0,s=this._gltf.nodes;a<s.length;a++){var l,c=e[(l=s[a]).index];l.parent=void 0===c?o:this._gltf.nodes[c]}}},e.prototype._loadExtensions=function(){for(var n in e._RegisteredExtensions){var t=e._RegisteredExtensions[n].factory(this);t.name!==n&&t.name,this._extensions.push(t),this._parent.onExtensionLoadedObservable.notifyObservers(t)}this._extensions.sort((function(e,n){return(e.order||Number.MAX_VALUE)-(n.order||Number.MAX_VALUE)})),this._parent.onExtensionLoadedObservable.clear()},e.prototype._checkExtensions=function(){if(this._gltf.extensionsRequired)for(var e=function(e){if(!n._extensions.some((function(n){return n.name===e&&n.enabled})))throw new Error("Require extension "+e+" is not available")},n=this,t=0,i=this._gltf.extensionsRequired;t<i.length;t++){e(i[t])}},e.prototype._setState=function(e){this._state=e,this.log(Sn[this._state])},e.prototype._createRootNode=function(){this._babylonScene._blockEntityCollection=this._forAssetContainer,this._rootBabylonMesh=new $("__root__",this._babylonScene),this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.setEnabled(!1);var n={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case gn.AUTO:this._babylonScene.useRightHandedSystem||(n.rotation=[0,1,0,0],n.scale=[1,1,-1],e._LoadTransform(n,this._rootBabylonMesh));break;case gn.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error("Invalid coordinate system mode ("+this._parent.coordinateSystemMode+")")}return this._parent.onMeshLoadedObservable.notifyObservers(this._rootBabylonMesh),n},e.prototype.loadSceneAsync=function(e,n){var t=this,i=this._extensionsLoadSceneAsync(e,n);if(i)return i;var r=new Array;if(this.logOpen(e+" "+(n.name||"")),n.nodes)for(var o=0,a=n.nodes;o<a.length;o++){var s=a[o],l=On.Get(e+"/nodes/"+s,this._gltf.nodes,s);r.push(this.loadNodeAsync("/nodes/"+l.index,l,(function(e){e.parent=t._rootBabylonMesh})))}if(this._gltf.nodes)for(var c=0,f=this._gltf.nodes;c<f.length;c++){if((l=f[c])._babylonTransformNode&&l._babylonBones)for(var u=0,d=l._babylonBones;u<d.length;u++){d[u].linkTransformNode(l._babylonTransformNode)}}return r.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(r).then((function(){}))},e.prototype._forEachPrimitive=function(e,n){if(e._primitiveBabylonMeshes)for(var t=0,i=e._primitiveBabylonMeshes;t<i.length;t++){n(i[t])}},e.prototype._getGeometries=function(){var e=new Array,n=this._gltf.nodes;if(n)for(var t=0,i=n;t<i.length;t++){var r=i[t];this._forEachPrimitive(r,(function(n){var t=n.geometry;t&&-1===e.indexOf(t)&&e.push(t)}))}return e},e.prototype._getMeshes=function(){var e=new Array;e.push(this._rootBabylonMesh);var n=this._gltf.nodes;if(n)for(var t=0,i=n;t<i.length;t++){var r=i[t];this._forEachPrimitive(r,(function(n){e.push(n)}))}return e},e.prototype._getTransformNodes=function(){var e=new Array,n=this._gltf.nodes;if(n)for(var t=0,i=n;t<i.length;t++){var r=i[t];r._babylonTransformNode&&"TransformNode"===r._babylonTransformNode.getClassName()&&e.push(r._babylonTransformNode)}return e},e.prototype._getSkeletons=function(){var e=new Array,n=this._gltf.skins;if(n)for(var t=0,i=n;t<i.length;t++){var r=i[t];r._data&&e.push(r._data.babylonSkeleton)}return e},e.prototype._getAnimationGroups=function(){var e=new Array,n=this._gltf.animations;if(n)for(var t=0,i=n;t<i.length;t++){var r=i[t];r._babylonAnimationGroup&&e.push(r._babylonAnimationGroup)}return e},e.prototype._startAnimations=function(){switch(this._parent.animationStartMode){case Rn.NONE:break;case Rn.FIRST:0!==(e=this._getAnimationGroups()).length&&e[0].start(!0);break;case Rn.ALL:for(var e,n=0,t=e=this._getAnimationGroups();n<t.length;n++){t[n].start(!0)}break;default:return void this._parent.animationStartMode}},e.prototype.loadNodeAsync=function(n,t,i){var r=this;void 0===i&&(i=function(){});var o=this._extensionsLoadNodeAsync(n,t,i);if(o)return o;if(t._babylonTransformNode)throw new Error(n+": Invalid recursive node hierarchy");var a=new Array;this.logOpen(n+" "+(t.name||""));var s=function(o){if(e.AddPointerMetadata(o,n),e._LoadTransform(t,o),null!=t.camera){var s=On.Get(n+"/camera",r._gltf.cameras,t.camera);a.push(r.loadCameraAsync("/cameras/"+s.index,s,(function(e){e.parent=o})))}if(t.children)for(var l=0,c=t.children;l<c.length;l++){var f=c[l],u=On.Get(n+"/children/"+f,r._gltf.nodes,f);a.push(r.loadNodeAsync("/nodes/"+u.index,u,(function(e){e.parent=o})))}i(o)};if(null==t.mesh){var l=t.name||"node"+t.index;this._babylonScene._blockEntityCollection=this._forAssetContainer,t._babylonTransformNode=new te(l,this._babylonScene),this._babylonScene._blockEntityCollection=!1,s(t._babylonTransformNode)}else{var c=On.Get(n+"/mesh",this._gltf.meshes,t.mesh);a.push(this._loadMeshAsync("/meshes/"+c.index,t,c,s))}return this.logClose(),Promise.all(a).then((function(){return r._forEachPrimitive(t,(function(e){e.geometry&&e.geometry.useBoundingInfoFromGeometry?e._updateBoundingInfo():e.refreshBoundingInfo(!0)})),t._babylonTransformNode}))},e.prototype._loadMeshAsync=function(e,n,t,i){var r=t.primitives;if(!r||!r.length)throw new Error(e+": Primitives are missing");null==r[0].index&&On.Assign(r);var o=new Array;this.logOpen(e+" "+(t.name||""));var a=n.name||"node"+n.index;if(1===r.length){var s=t.primitives[0];o.push(this._loadMeshPrimitiveAsync(e+"/primitives/"+s.index,a,n,t,s,(function(e){n._babylonTransformNode=e,n._primitiveBabylonMeshes=[e]})))}else{this._babylonScene._blockEntityCollection=this._forAssetContainer,n._babylonTransformNode=new te(a,this._babylonScene),this._babylonScene._blockEntityCollection=!1,n._primitiveBabylonMeshes=[];for(var l=0,c=r;l<c.length;l++){s=c[l];o.push(this._loadMeshPrimitiveAsync(e+"/primitives/"+s.index,a+"_primitive"+s.index,n,t,s,(function(e){e.parent=n._babylonTransformNode,n._primitiveBabylonMeshes.push(e)})))}}if(null!=n.skin){var f=On.Get(e+"/skin",this._gltf.skins,n.skin);o.push(this._loadSkinAsync("/skins/"+f.index,n,f))}return i(n._babylonTransformNode),this.logClose(),Promise.all(o).then((function(){return n._babylonTransformNode}))},e.prototype._loadMeshPrimitiveAsync=function(n,t,i,r,o,a){var s=this,l=this._extensionsLoadMeshPrimitiveAsync(n,t,i,r,o,a);if(l)return l;this.logOpen(""+n);var c,f,u=0===this._disableInstancedMesh&&this._parent.createInstances&&null==i.skin&&!r.primitives[0].targets;if(u&&o._instanceData)c=o._instanceData.babylonSourceMesh.createInstance(t),f=o._instanceData.promise;else{var d=new Array;this._babylonScene._blockEntityCollection=this._forAssetContainer;var h=new $(t,this._babylonScene);this._babylonScene._blockEntityCollection=!1,h.overrideMaterialSideOrientation=this._babylonScene.useRightHandedSystem?z.CounterClockWiseSideOrientation:z.ClockWiseSideOrientation,this._createMorphTargets(n,i,r,o,h),d.push(this._loadVertexDataAsync(n,o,h).then((function(e){return s._loadMorphTargetsAsync(n,o,h,e).then((function(){s._babylonScene._blockEntityCollection=s._forAssetContainer,e.applyToMesh(h),s._babylonScene._blockEntityCollection=!1}))})));var p=e._GetDrawMode(n,o.mode);if(null==o.material){var m=this._defaultBabylonMaterialData[p];m||(m=this._createDefaultMaterial("__GLTFLoader._default",p),this._parent.onMaterialLoadedObservable.notifyObservers(m),this._defaultBabylonMaterialData[p]=m),h.material=m}else{var v=On.Get(n+"/material",this._gltf.materials,o.material);d.push(this._loadMaterialAsync("/materials/"+v.index,v,h,p,(function(e){h.material=e})))}f=Promise.all(d),u&&(o._instanceData={babylonSourceMesh:h,promise:f}),c=h}return e.AddPointerMetadata(c,n),this._parent.onMeshLoadedObservable.notifyObservers(c),a(c),this.logClose(),f.then((function(){return c}))},e.prototype._loadVertexDataAsync=function(e,n,t){var i=this,r=this._extensionsLoadVertexDataAsync(e,n,t);if(r)return r;var o=n.attributes;if(!o)throw new Error(e+": Attributes are missing");var a=new Array,s=new ie(t.name,this._babylonScene);if(null==n.indices)t.isUnIndexed=!0;else{var l=On.Get(e+"/indices",this._gltf.accessors,n.indices);a.push(this._loadIndicesAccessorAsync("/accessors/"+l.index,l).then((function(e){s.setIndices(e)})))}var c=function(n,r,l){if(null!=o[n]){t._delayInfo=t._delayInfo||[],-1===t._delayInfo.indexOf(r)&&t._delayInfo.push(r);var c=On.Get(e+"/attributes/"+n,i._gltf.accessors,o[n]);a.push(i._loadVertexAccessorAsync("/accessors/"+c.index,c,r).then((function(e){if(e.getKind()===V.PositionKind&&!i.parent.alwaysComputeBoundingBox&&!t.skeleton){var n=c.min,r=c.max;if(void 0!==n&&void 0!==r){var o=S.Vector3[0],a=S.Vector3[1];o.copyFromFloats.apply(o,n),a.copyFromFloats.apply(a,r),s._boundingInfo=new se(o,a),s.useBoundingInfoFromGeometry=!0}}s.setVerticesBuffer(e,c.count)}))),r==V.MatricesIndicesExtraKind&&(t.numBoneInfluencers=8),l&&l(c)}};return c("POSITION",V.PositionKind),c("NORMAL",V.NormalKind),c("TANGENT",V.TangentKind),c("TEXCOORD_0",V.UVKind),c("TEXCOORD_1",V.UV2Kind),c("JOINTS_0",V.MatricesIndicesKind),c("WEIGHTS_0",V.MatricesWeightsKind),c("JOINTS_1",V.MatricesIndicesExtraKind),c("WEIGHTS_1",V.MatricesWeightsExtraKind),c("COLOR_0",V.ColorKind,(function(e){"VEC4"===e.type&&(t.hasVertexAlpha=!0)})),Promise.all(a).then((function(){return s}))},e.prototype._createMorphTargets=function(e,n,t,i,r){if(i.targets){if(null==n._numMorphTargets)n._numMorphTargets=i.targets.length;else if(i.targets.length!==n._numMorphTargets)throw new Error(e+": Primitives do not have the same number of targets");var o=t.extras?t.extras.targetNames:null;r.morphTargetManager=new dn(r.getScene());for(var a=0;a<i.targets.length;a++){var s=n.weights?n.weights[a]:t.weights?t.weights[a]:0,l=o?o[a]:"morphTarget"+a;r.morphTargetManager.addTarget(new un(l,s,r.getScene()))}}},e.prototype._loadMorphTargetsAsync=function(e,n,t,i){if(!n.targets)return Promise.resolve();for(var r=new Array,o=t.morphTargetManager,a=0;a<o.numTargets;a++){var s=o.getTarget(a);r.push(this._loadMorphTargetVertexDataAsync(e+"/targets/"+a,i,n.targets[a],s))}return Promise.all(r).then((function(){}))},e.prototype._loadMorphTargetVertexDataAsync=function(e,n,t,i){var r=this,o=new Array,a=function(i,a,s){if(null!=t[i]){var l=n.getVertexBuffer(a);if(l){var c=On.Get(e+"/"+i,r._gltf.accessors,t[i]);o.push(r._loadFloatAccessorAsync("/accessors/"+c.index,c).then((function(e){s(l,e)})))}}};return a("POSITION",V.PositionKind,(function(e,n){var t=new Float32Array(n.length);e.forEach(n.length,(function(e,i){t[i]=n[i]+e})),i.setPositions(t)})),a("NORMAL",V.NormalKind,(function(e,n){var t=new Float32Array(n.length);e.forEach(t.length,(function(e,i){t[i]=n[i]+e})),i.setNormals(t)})),a("TANGENT",V.TangentKind,(function(e,n){var t=new Float32Array(n.length/3*4),r=0;e.forEach(n.length/3*4,(function(e,i){(i+1)%4!=0&&(t[r]=n[r]+e,r++)})),i.setTangents(t)})),Promise.all(o).then((function(){}))},e._LoadTransform=function(e,n){if(null==e.skin){var t=r.Zero(),i=v.Identity(),o=r.One();if(e.matrix)c.FromArray(e.matrix).decompose(o,i,t);else e.translation&&(t=r.FromArray(e.translation)),e.rotation&&(i=v.FromArray(e.rotation)),e.scale&&(o=r.FromArray(e.scale));n.position=t,n.rotationQuaternion=i,n.scaling=o}},e.prototype._loadSkinAsync=function(e,n,t){var i=this,r=this._extensionsLoadSkinAsync(e,n,t);if(r)return r;var o=function(e){i._forEachPrimitive(n,(function(n){n.skeleton=e}))};if(t._data)return o(t._data.babylonSkeleton),t._data.promise;var a="skeleton"+t.index;this._babylonScene._blockEntityCollection=this._forAssetContainer;var s=new ke(t.name||a,a,this._babylonScene);this._babylonScene._blockEntityCollection=!1,s.overrideMesh=this._rootBabylonMesh,this._loadBones(e,t,s),o(s);var l=this._loadSkinInverseBindMatricesDataAsync(e,t).then((function(e){i._updateBoneMatrices(s,e)}));return t._data={babylonSkeleton:s,promise:l},l},e.prototype._loadBones=function(e,n,t){for(var i={},r=0,o=n.joints;r<o.length;r++){var a=o[r],s=On.Get(e+"/joints/"+a,this._gltf.nodes,a);this._loadBone(s,n,t,i)}},e.prototype._loadBone=function(e,n,t,i){var r=i[e.index];if(r)return r;var o=null;e.parent&&e.parent._babylonTransformNode!==this._rootBabylonMesh&&(o=this._loadBone(e.parent,n,t,i));var a=n.joints.indexOf(e.index);return r=new De(e.name||"joint"+e.index,t,o,this._getNodeMatrix(e),null,null,a),i[e.index]=r,e._babylonBones=e._babylonBones||[],e._babylonBones.push(r),r},e.prototype._loadSkinInverseBindMatricesDataAsync=function(e,n){if(null==n.inverseBindMatrices)return Promise.resolve(null);var t=On.Get(e+"/inverseBindMatrices",this._gltf.accessors,n.inverseBindMatrices);return this._loadFloatAccessorAsync("/accessors/"+t.index,t)},e.prototype._updateBoneMatrices=function(e,n){for(var t=0,i=e.bones;t<i.length;t++){var r=i[t],o=c.Identity(),a=r._index;n&&-1!==a&&(c.FromArrayToRef(n,16*a,o),o.invertToRef(o));var s=r.getParent();s&&o.multiplyToRef(s.getInvertedAbsoluteTransform(),o),r.setBindPose(o),r.updateMatrix(o,!1,!1),r._updateDifferenceMatrix(void 0,!1)}},e.prototype._getNodeMatrix=function(e){return e.matrix?c.FromArray(e.matrix):c.Compose(e.scale?r.FromArray(e.scale):r.One(),e.rotation?v.FromArray(e.rotation):v.Identity(),e.translation?r.FromArray(e.translation):r.Zero())},e.prototype.loadCameraAsync=function(n,t,i){void 0===i&&(i=function(){});var o=this._extensionsLoadCameraAsync(n,t,i);if(o)return o;var a=new Array;this.logOpen(n+" "+(t.name||"")),this._babylonScene._blockEntityCollection=this._forAssetContainer;var s=new Ie(t.name||"camera"+t.index,r.Zero(),this._babylonScene,!1);switch(this._babylonScene._blockEntityCollection=!1,s.ignoreParentScaling=!0,s.rotation=new r(0,Math.PI,0),t.type){case"perspective":var l=t.perspective;if(!l)throw new Error(n+": Camera perspective properties are missing");s.fov=l.yfov,s.minZ=l.znear,s.maxZ=l.zfar||Number.MAX_VALUE;break;case"orthographic":if(!t.orthographic)throw new Error(n+": Camera orthographic properties are missing");s.mode=re.ORTHOGRAPHIC_CAMERA,s.orthoLeft=-t.orthographic.xmag,s.orthoRight=t.orthographic.xmag,s.orthoBottom=-t.orthographic.ymag,s.orthoTop=t.orthographic.ymag,s.minZ=t.orthographic.znear,s.maxZ=t.orthographic.zfar;break;default:throw new Error(n+": Invalid camera type ("+t.type+")")}return e.AddPointerMetadata(s,n),this._parent.onCameraLoadedObservable.notifyObservers(s),i(s),this.logClose(),Promise.all(a).then((function(){return s}))},e.prototype._loadAnimationsAsync=function(){var e=this._gltf.animations;if(!e)return Promise.resolve();for(var n=new Array,t=0;t<e.length;t++){var i=e[t];n.push(this.loadAnimationAsync("/animations/"+i.index,i))}return Promise.all(n).then((function(){}))},e.prototype.loadAnimationAsync=function(e,n){var t=this._extensionsLoadAnimationAsync(e,n);if(t)return t;this._babylonScene._blockEntityCollection=this._forAssetContainer;var i=new Be(n.name||"animation"+n.index,this._babylonScene);this._babylonScene._blockEntityCollection=!1,n._babylonAnimationGroup=i;var r=new Array;On.Assign(n.channels),On.Assign(n.samplers);for(var o=0,a=n.channels;o<a.length;o++){var s=a[o];r.push(this._loadAnimationChannelAsync(e+"/channels/"+s.index,e,n,s,i))}return Promise.all(r).then((function(){return i.normalize(0),i}))},e.prototype._loadAnimationChannelAsync=function(e,n,t,i,o,a){var s=this;if(void 0===a&&(a=null),null==i.target.node)return Promise.resolve();var l=On.Get(e+"/target/node",this._gltf.nodes,i.target.node);if("weights"===i.target.path&&!l._numMorphTargets||"weights"!==i.target.path&&!l._babylonTransformNode)return Promise.resolve();var c=On.Get(e+"/sampler",t.samplers,i.sampler);return this._loadAnimationSamplerAsync(n+"/samplers/"+i.sampler,c).then((function(n){var t,c;switch(i.target.path){case"translation":t="position",c=_.ANIMATIONTYPE_VECTOR3;break;case"rotation":t="rotationQuaternion",c=_.ANIMATIONTYPE_QUATERNION;break;case"scale":t="scaling",c=_.ANIMATIONTYPE_VECTOR3;break;case"weights":t="influence",c=_.ANIMATIONTYPE_FLOAT;break;default:throw new Error(e+"/target/path: Invalid value ("+i.target.path+")")}var f,u,d=0;switch(t){case"position":f=function(){var e=r.FromArray(n.output,d);return d+=3,e};break;case"rotationQuaternion":f=function(){var e=v.FromArray(n.output,d);return d+=4,e};break;case"scaling":f=function(){var e=r.FromArray(n.output,d);return d+=3,e};break;case"influence":f=function(){for(var e=new Array(l._numMorphTargets),t=0;t<l._numMorphTargets;t++)e[t]=n.output[d++];return e}}switch(n.interpolation){case"STEP":u=function(e){return{frame:n.input[e],value:f(),interpolation:le.STEP}};break;case"LINEAR":u=function(e){return{frame:n.input[e],value:f()}};break;case"CUBICSPLINE":u=function(e){return{frame:n.input[e],inTangent:f(),value:f(),outTangent:f()}}}for(var h=new Array(n.input.length),p=0;p<n.input.length;p++)h[p]=u(p);if("influence"===t)for(var m=function(e){var n=o.name+"_channel"+o.targetedAnimations.length,i=new _(n,t,1,c);i.setKeys(h.map((function(n){return{frame:n.frame,inTangent:n.inTangent?n.inTangent[e]:void 0,value:n.value[e],outTangent:n.outTangent?n.outTangent[e]:void 0}}))),s._forEachPrimitive(l,(function(n){var t=n.morphTargetManager.getTarget(e),r=i.clone();t.animations.push(r),o.addTargetedAnimation(r,t)}))},A=0;A<l._numMorphTargets;A++)m(A);else{var E=o.name+"_channel"+o.targetedAnimations.length,g=new _(E,t,1,c);g.setKeys(h),null!=a&&null!=a.animations?(a.animations.push(g),o.addTargetedAnimation(g,a)):(l._babylonTransformNode.animations.push(g),o.addTargetedAnimation(g,l._babylonTransformNode))}}))},e.prototype._loadAnimationSamplerAsync=function(e,n){if(n._data)return n._data;var t=n.interpolation||"LINEAR";switch(t){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(e+"/interpolation: Invalid value ("+n.interpolation+")")}var i=On.Get(e+"/input",this._gltf.accessors,n.input),r=On.Get(e+"/output",this._gltf.accessors,n.output);return n._data=Promise.all([this._loadFloatAccessorAsync("/accessors/"+i.index,i),this._loadFloatAccessorAsync("/accessors/"+r.index,r)]).then((function(e){var n=e[0],i=e[1];return{input:n,interpolation:t,output:i}})),n._data},e.prototype._loadBufferAsync=function(e,n,t,i){var r=this._extensionsLoadBufferAsync(e,n,t,i);if(r)return r;if(!n._data)if(n.uri)n._data=this.loadUriAsync(e+"/uri",n,n.uri);else{if(!this._bin)throw new Error(e+": Uri is missing or the binary glTF is missing its binary chunk");n._data=this._bin.readAsync(0,n.byteLength)}return n._data.then((function(n){try{return new Uint8Array(n.buffer,n.byteOffset+t,i)}catch(r){throw new Error(e+": "+r.message)}}))},e.prototype.loadBufferViewAsync=function(e,n){var t=this._extensionsLoadBufferViewAsync(e,n);if(t)return t;if(n._data)return n._data;var i=On.Get(e+"/buffer",this._gltf.buffers,n.buffer);return n._data=this._loadBufferAsync("/buffers/"+i.index,i,n.byteOffset||0,n.byteLength),n._data},e.prototype._loadAccessorAsync=function(n,t,i){var r=this;if(t._data)return t._data;var o=e._GetNumComponents(n,t.type),a=o*V.GetTypeByteLength(t.componentType),s=o*t.count;if(null==t.bufferView)t._data=Promise.resolve(new i(s));else{var l=On.Get(n+"/bufferView",this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync("/bufferViews/"+l.index,l).then((function(r){if(5126!==t.componentType||t.normalized||l.byteStride&&l.byteStride!==a){var c=new i(s);return V.ForEach(r,t.byteOffset||0,l.byteStride||a,o,t.componentType,c.length,t.normalized||!1,(function(e,n){c[n]=e})),c}return e._GetTypedArray(n,t.componentType,r,t.byteOffset,s)}))}if(t.sparse){var c=t.sparse;t._data=t._data.then((function(s){var l=s,f=On.Get(n+"/sparse/indices/bufferView",r._gltf.bufferViews,c.indices.bufferView),u=On.Get(n+"/sparse/values/bufferView",r._gltf.bufferViews,c.values.bufferView);return Promise.all([r.loadBufferViewAsync("/bufferViews/"+f.index,f),r.loadBufferViewAsync("/bufferViews/"+u.index,u)]).then((function(r){var s,f=r[0],u=r[1],d=e._GetTypedArray(n+"/sparse/indices",c.indices.componentType,f,c.indices.byteOffset,c.count),h=o*c.count;if(5126!==t.componentType||t.normalized){var p=e._GetTypedArray(n+"/sparse/values",t.componentType,u,c.values.byteOffset,h);s=new i(h),V.ForEach(p,0,a,o,t.componentType,s.length,t.normalized||!1,(function(e,n){s[n]=e}))}else s=e._GetTypedArray(n+"/sparse/values",t.componentType,u,c.values.byteOffset,h);for(var m=0,v=0;v<d.length;v++)for(var A=d[v]*o,E=0;E<o;E++)l[A++]=s[m++];return l}))}))}return t._data},e.prototype._loadFloatAccessorAsync=function(e,n){return this._loadAccessorAsync(e,n,Float32Array)},e.prototype._loadIndicesAccessorAsync=function(n,t){if("SCALAR"!==t.type)throw new Error(n+"/type: Invalid value "+t.type);if(5121!==t.componentType&&5123!==t.componentType&&5125!==t.componentType)throw new Error(n+"/componentType: Invalid value "+t.componentType);if(t._data)return t._data;if(t.sparse){var i=e._GetTypedArrayConstructor(n+"/componentType",t.componentType);t._data=this._loadAccessorAsync(n,t,i)}else{var r=On.Get(n+"/bufferView",this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync("/bufferViews/"+r.index,r).then((function(i){return e._GetTypedArray(n,t.componentType,i,t.byteOffset,t.count)}))}return t._data},e.prototype._loadVertexBufferViewAsync=function(e,n){var t=this;return e._babylonBuffer||(e._babylonBuffer=this.loadBufferViewAsync("/bufferViews/"+e.index,e).then((function(e){return new oe(t._babylonScene.getEngine(),e,!1)}))),e._babylonBuffer},e.prototype._loadVertexAccessorAsync=function(n,t,i){var r=this;if(t._babylonVertexBuffer)return t._babylonVertexBuffer;if(t.sparse)t._babylonVertexBuffer=this._loadFloatAccessorAsync("/accessors/"+t.index,t).then((function(e){return new V(r._babylonScene.getEngine(),e,i,!1)}));else if(t.byteOffset&&t.byteOffset%V.GetTypeByteLength(t.componentType)!=0)t._babylonVertexBuffer=this._loadFloatAccessorAsync("/accessors/"+t.index,t).then((function(e){return new V(r._babylonScene.getEngine(),e,i,!1)}));else if(i===V.MatricesIndicesKind||i===V.MatricesIndicesExtraKind)t._babylonVertexBuffer=this._loadFloatAccessorAsync("/accessors/"+t.index,t).then((function(e){return new V(r._babylonScene.getEngine(),e,i,!1)}));else{var o=On.Get(n+"/bufferView",this._gltf.bufferViews,t.bufferView);t._babylonVertexBuffer=this._loadVertexBufferViewAsync(o,i).then((function(a){var s=e._GetNumComponents(n,t.type);return new V(r._babylonScene.getEngine(),a,i,!1,!1,o.byteStride,!1,t.byteOffset,s,t.componentType,t.normalized,!0,1,!0)}))}return t._babylonVertexBuffer},e.prototype._loadMaterialMetallicRoughnessPropertiesAsync=function(e,n,t){if(!(t instanceof ln))throw new Error(e+": Material type not supported");var i=new Array;return n&&(n.baseColorFactor?(t.albedoColor=E.FromArray(n.baseColorFactor),t.alpha=n.baseColorFactor[3]):t.albedoColor=E.White(),t.metallic=null==n.metallicFactor?1:n.metallicFactor,t.roughness=null==n.roughnessFactor?1:n.roughnessFactor,n.baseColorTexture&&i.push(this.loadTextureInfoAsync(e+"/baseColorTexture",n.baseColorTexture,(function(e){e.name=t.name+" (Base Color)",t.albedoTexture=e}))),n.metallicRoughnessTexture&&(n.metallicRoughnessTexture.nonColorData=!0,i.push(this.loadTextureInfoAsync(e+"/metallicRoughnessTexture",n.metallicRoughnessTexture,(function(e){e.name=t.name+" (Metallic Roughness)",t.metallicTexture=e}))),t.useMetallnessFromMetallicTextureBlue=!0,t.useRoughnessFromMetallicTextureGreen=!0,t.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(i).then((function(){}))},e.prototype._loadMaterialAsync=function(n,t,i,r,o){void 0===o&&(o=function(){});var a=this._extensionsLoadMaterialAsync(n,t,i,r,o);if(a)return a;t._data=t._data||{};var s=t._data[r];if(!s){this.logOpen(n+" "+(t.name||""));var l=this.createMaterial(n,t,r);s={babylonMaterial:l,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(n,t,l)},t._data[r]=s,e.AddPointerMetadata(l,n),this._parent.onMaterialLoadedObservable.notifyObservers(l),this.logClose()}return i&&(s.babylonMeshes.push(i),i.onDisposeObservable.addOnce((function(){var e=s.babylonMeshes.indexOf(i);-1!==e&&s.babylonMeshes.splice(e,1)}))),o(s.babylonMaterial),s.promise.then((function(){return s.babylonMaterial}))},e.prototype._createDefaultMaterial=function(e,n){this._babylonScene._blockEntityCollection=this._forAssetContainer;var t=new ln(e,this._babylonScene);return this._babylonScene._blockEntityCollection=!1,t.fillMode=n,t.enableSpecularAntiAliasing=!0,t.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,t.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,t.transparencyMode=ln.PBRMATERIAL_OPAQUE,t.metallic=1,t.roughness=1,t},e.prototype.createMaterial=function(e,n,t){var i=this._extensionsCreateMaterial(e,n,t);if(i)return i;var r=n.name||"material"+n.index;return this._createDefaultMaterial(r,t)},e.prototype.loadMaterialPropertiesAsync=function(e,n,t){var i=this._extensionsLoadMaterialPropertiesAsync(e,n,t);if(i)return i;var r=new Array;return r.push(this.loadMaterialBasePropertiesAsync(e,n,t)),n.pbrMetallicRoughness&&r.push(this._loadMaterialMetallicRoughnessPropertiesAsync(e+"/pbrMetallicRoughness",n.pbrMetallicRoughness,t)),this.loadMaterialAlphaProperties(e,n,t),Promise.all(r).then((function(){}))},e.prototype.loadMaterialBasePropertiesAsync=function(e,n,t){if(!(t instanceof ln))throw new Error(e+": Material type not supported");var i=new Array;return t.emissiveColor=n.emissiveFactor?E.FromArray(n.emissiveFactor):new E(0,0,0),n.doubleSided&&(t.backFaceCulling=!1,t.twoSidedLighting=!0),n.normalTexture&&(n.normalTexture.nonColorData=!0,i.push(this.loadTextureInfoAsync(e+"/normalTexture",n.normalTexture,(function(e){e.name=t.name+" (Normal)",t.bumpTexture=e}))),t.invertNormalMapX=!this._babylonScene.useRightHandedSystem,t.invertNormalMapY=this._babylonScene.useRightHandedSystem,null!=n.normalTexture.scale&&(t.bumpTexture.level=n.normalTexture.scale),t.forceIrradianceInFragment=!0),n.occlusionTexture&&(n.occlusionTexture.nonColorData=!0,i.push(this.loadTextureInfoAsync(e+"/occlusionTexture",n.occlusionTexture,(function(e){e.name=t.name+" (Occlusion)",t.ambientTexture=e}))),t.useAmbientInGrayScale=!0,null!=n.occlusionTexture.strength&&(t.ambientTextureStrength=n.occlusionTexture.strength)),n.emissiveTexture&&i.push(this.loadTextureInfoAsync(e+"/emissiveTexture",n.emissiveTexture,(function(e){e.name=t.name+" (Emissive)",t.emissiveTexture=e}))),Promise.all(i).then((function(){}))},e.prototype.loadMaterialAlphaProperties=function(e,n,t){if(!(t instanceof ln))throw new Error(e+": Material type not supported");switch(n.alphaMode||"OPAQUE"){case"OPAQUE":t.transparencyMode=ln.PBRMATERIAL_OPAQUE;break;case"MASK":t.transparencyMode=ln.PBRMATERIAL_ALPHATEST,t.alphaCutOff=null==n.alphaCutoff?.5:n.alphaCutoff,t.albedoTexture&&(t.albedoTexture.hasAlpha=!0);break;case"BLEND":t.transparencyMode=ln.PBRMATERIAL_ALPHABLEND,t.albedoTexture&&(t.albedoTexture.hasAlpha=!0,t.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(e+"/alphaMode: Invalid value ("+n.alphaMode+")")}},e.prototype.loadTextureInfoAsync=function(n,t,i){var r=this;void 0===i&&(i=function(){});var o=this._extensionsLoadTextureInfoAsync(n,t,i);if(o)return o;if(this.logOpen(""+n),t.texCoord>=2)throw new Error(n+"/texCoord: Invalid value ("+t.texCoord+")");var a=On.Get(n+"/index",this._gltf.textures,t.index);a._textureInfo=t;var s=this._loadTextureAsync("/textures/"+t.index,a,(function(o){o.coordinatesIndex=t.texCoord||0,e.AddPointerMetadata(o,n),r._parent.onTextureLoadedObservable.notifyObservers(o),i(o)}));return this.logClose(),s},e.prototype._loadTextureAsync=function(n,t,i){void 0===i&&(i=function(){});var r=this._extensionsLoadTextureAsync(n,t,i);if(r)return r;this.logOpen(n+" "+(t.name||""));var o=null==t.sampler?e.DefaultSampler:On.Get(n+"/sampler",this._gltf.samplers,t.sampler),a=On.Get(n+"/source",this._gltf.images,t.source),s=this._createTextureAsync(n,o,a,i);return this.logClose(),s},e.prototype._createTextureAsync=function(e,n,t,i,r){var o=this;void 0===i&&(i=function(){});var a=this._loadSampler("/samplers/"+n.index,n),s=new Array,l=new Ee;this._babylonScene._blockEntityCollection=this._forAssetContainer;var c=new ce(null,this._babylonScene,a.noMipMaps,!1,a.samplingMode,(function(){o._disposed||l.resolve()}),(function(n,t){o._disposed||l.reject(new Error(e+": "+(t&&t.message?t.message:n||"Failed to load texture")))}),void 0,void 0,void 0,t.mimeType,r);return this._babylonScene._blockEntityCollection=!1,s.push(l.promise),s.push(this.loadImageAsync("/images/"+t.index,t).then((function(e){var n=t.uri||o._fileName+"#image"+t.index,i="data:"+o._uniqueRootUrl+n;c.updateURL(i,e)}))),c.wrapU=a.wrapU,c.wrapV=a.wrapV,i(c),Promise.all(s).then((function(){return c}))},e.prototype._loadSampler=function(n,t){return t._data||(t._data={noMipMaps:9728===t.minFilter||9729===t.minFilter,samplingMode:e._GetTextureSamplingMode(n,t),wrapU:e._GetTextureWrapMode(n+"/wrapS",t.wrapS),wrapV:e._GetTextureWrapMode(n+"/wrapT",t.wrapT)}),t._data},e.prototype.loadImageAsync=function(e,n){if(!n._data){if(this.logOpen(e+" "+(n.name||"")),n.uri)n._data=this.loadUriAsync(e+"/uri",n,n.uri);else{var t=On.Get(e+"/bufferView",this._gltf.bufferViews,n.bufferView);n._data=this.loadBufferViewAsync("/bufferViews/"+t.index,t)}this.logClose()}return n._data},e.prototype.loadUriAsync=function(n,i,r){var o=this,a=this._extensionsLoadUriAsync(n,i,r);if(a)return a;if(!e._ValidateUri(r))throw new Error(n+": '"+r+"' is invalid");if(t.IsBase64(r)){var s=new Uint8Array(t.DecodeBase64(r));return this.log("Decoded "+r.substr(0,64)+"... ("+s.length+" bytes)"),Promise.resolve(s)}return this.log("Loading "+r),this._parent.preprocessUrlAsync(this._rootUrl+r).then((function(e){return new Promise((function(t,i){o._parent._loadFile(e,o._babylonScene,(function(e){o._disposed||(o.log("Loaded "+r+" ("+e.byteLength+" bytes)"),t(new Uint8Array(e)))}),!0,(function(e){i(new ae(n+": Failed to load '"+r+"'"+(e?": "+e.status+" "+e.statusText:""),e))}))}))}))},e.AddPointerMetadata=function(e,n){var t=e.metadata=e.metadata||{},i=t.gltf=t.gltf||{};(i.pointers=i.pointers||[]).push(n)},e._GetTextureWrapMode=function(e,n){switch(n=null==n?10497:n){case 33071:return ce.CLAMP_ADDRESSMODE;case 33648:return ce.MIRROR_ADDRESSMODE;case 10497:default:return ce.WRAP_ADDRESSMODE}},e._GetTextureSamplingMode=function(e,n){var t=null==n.magFilter?9729:n.magFilter,i=null==n.minFilter?9987:n.minFilter;if(9729===t)switch(i){case 9728:return ce.LINEAR_NEAREST;case 9729:return ce.LINEAR_LINEAR;case 9984:return ce.LINEAR_NEAREST_MIPNEAREST;case 9985:return ce.LINEAR_LINEAR_MIPNEAREST;case 9986:return ce.LINEAR_NEAREST_MIPLINEAR;case 9987:default:return ce.LINEAR_LINEAR_MIPLINEAR}else switch(i){case 9728:return ce.NEAREST_NEAREST;case 9729:return ce.NEAREST_LINEAR;case 9984:return ce.NEAREST_NEAREST_MIPNEAREST;case 9985:return ce.NEAREST_LINEAR_MIPNEAREST;case 9986:return ce.NEAREST_NEAREST_MIPLINEAR;case 9987:return ce.NEAREST_LINEAR_MIPLINEAR;default:return ce.NEAREST_NEAREST_MIPNEAREST}},e._GetTypedArrayConstructor=function(e,n){switch(n){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(e+": Invalid component type "+n)}},e._GetTypedArray=function(n,t,i,r,o){var a=i.buffer;r=i.byteOffset+(r||0);var s=e._GetTypedArrayConstructor(n+"/componentType",t);try{return new s(a,r,o)}catch(l){throw new Error(n+": "+l)}},e._GetNumComponents=function(e,n){switch(n){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(e+": Invalid type ("+n+")")},e._ValidateUri=function(e){return t.IsBase64(e)||-1===e.indexOf("..")},e._GetDrawMode=function(e,n){switch(null==n&&(n=4),n){case 0:return z.PointListDrawMode;case 1:return z.LineListDrawMode;case 2:return z.LineLoopDrawMode;case 3:return z.LineStripDrawMode;case 4:return z.TriangleFillMode;case 5:return z.TriangleStripDrawMode;case 6:return z.TriangleFanDrawMode}throw new Error(e+": Invalid mesh primitive mode ("+n+")")},e.prototype._compileMaterialsAsync=function(){var e=this;this._parent._startPerformanceCounter("Compile materials");var n=new Array;if(this._gltf.materials)for(var t=0,i=this._gltf.materials;t<i.length;t++){var r=i[t];if(r._data)for(var o in r._data)for(var a=r._data[o],s=0,l=a.babylonMeshes;s<l.length;s++){var c=l[s];c.computeWorldMatrix(!0);var f=a.babylonMaterial;n.push(f.forceCompilationAsync(c)),n.push(f.forceCompilationAsync(c,{useInstances:!0})),this._parent.useClipPlane&&(n.push(f.forceCompilationAsync(c,{clipPlane:!0})),n.push(f.forceCompilationAsync(c,{clipPlane:!0,useInstances:!0})))}}return Promise.all(n).then((function(){e._parent._endPerformanceCounter("Compile materials")}))},e.prototype._compileShadowGeneratorsAsync=function(){var e=this;this._parent._startPerformanceCounter("Compile shadow generators");for(var n=new Array,t=0,i=this._babylonScene.lights;t<i.length;t++){var r=i[t].getShadowGenerator();r&&n.push(r.forceCompilationAsync())}return Promise.all(n).then((function(){e._parent._endPerformanceCounter("Compile shadow generators")}))},e.prototype._forEachExtensions=function(e){for(var n=0,t=this._extensions;n<t.length;n++){var i=t[n];i.enabled&&e(i)}},e.prototype._applyExtensions=function(e,n,t){for(var i=0,r=this._extensions;i<r.length;i++){var o=r[i];if(o.enabled){var a=o.name+"."+n,s=e;s._activeLoaderExtensionFunctions=s._activeLoaderExtensionFunctions||{};var l=s._activeLoaderExtensionFunctions;if(!l[a]){l[a]=!0;try{var c=t(o);if(c)return c}finally{delete l[a]}}}}return null},e.prototype._extensionsOnLoading=function(){this._forEachExtensions((function(e){return e.onLoading&&e.onLoading()}))},e.prototype._extensionsOnReady=function(){this._forEachExtensions((function(e){return e.onReady&&e.onReady()}))},e.prototype._extensionsLoadSceneAsync=function(e,n){return this._applyExtensions(n,"loadScene",(function(t){return t.loadSceneAsync&&t.loadSceneAsync(e,n)}))},e.prototype._extensionsLoadNodeAsync=function(e,n,t){return this._applyExtensions(n,"loadNode",(function(i){return i.loadNodeAsync&&i.loadNodeAsync(e,n,t)}))},e.prototype._extensionsLoadCameraAsync=function(e,n,t){return this._applyExtensions(n,"loadCamera",(function(i){return i.loadCameraAsync&&i.loadCameraAsync(e,n,t)}))},e.prototype._extensionsLoadVertexDataAsync=function(e,n,t){return this._applyExtensions(n,"loadVertexData",(function(i){return i._loadVertexDataAsync&&i._loadVertexDataAsync(e,n,t)}))},e.prototype._extensionsLoadMeshPrimitiveAsync=function(e,n,t,i,r,o){return this._applyExtensions(r,"loadMeshPrimitive",(function(a){return a._loadMeshPrimitiveAsync&&a._loadMeshPrimitiveAsync(e,n,t,i,r,o)}))},e.prototype._extensionsLoadMaterialAsync=function(e,n,t,i,r){return this._applyExtensions(n,"loadMaterial",(function(o){return o._loadMaterialAsync&&o._loadMaterialAsync(e,n,t,i,r)}))},e.prototype._extensionsCreateMaterial=function(e,n,t){return this._applyExtensions(n,"createMaterial",(function(i){return i.createMaterial&&i.createMaterial(e,n,t)}))},e.prototype._extensionsLoadMaterialPropertiesAsync=function(e,n,t){return this._applyExtensions(n,"loadMaterialProperties",(function(i){return i.loadMaterialPropertiesAsync&&i.loadMaterialPropertiesAsync(e,n,t)}))},e.prototype._extensionsLoadTextureInfoAsync=function(e,n,t){return this._applyExtensions(n,"loadTextureInfo",(function(i){return i.loadTextureInfoAsync&&i.loadTextureInfoAsync(e,n,t)}))},e.prototype._extensionsLoadTextureAsync=function(e,n,t){return this._applyExtensions(n,"loadTexture",(function(i){return i._loadTextureAsync&&i._loadTextureAsync(e,n,t)}))},e.prototype._extensionsLoadAnimationAsync=function(e,n){return this._applyExtensions(n,"loadAnimation",(function(t){return t.loadAnimationAsync&&t.loadAnimationAsync(e,n)}))},e.prototype._extensionsLoadSkinAsync=function(e,n,t){return this._applyExtensions(t,"loadSkin",(function(i){return i._loadSkinAsync&&i._loadSkinAsync(e,n,t)}))},e.prototype._extensionsLoadUriAsync=function(e,n,t){return this._applyExtensions(n,"loadUri",(function(i){return i._loadUriAsync&&i._loadUriAsync(e,n,t)}))},e.prototype._extensionsLoadBufferViewAsync=function(e,n){return this._applyExtensions(n,"loadBufferView",(function(t){return t.loadBufferViewAsync&&t.loadBufferViewAsync(e,n)}))},e.prototype._extensionsLoadBufferAsync=function(e,n,t,i){return this._applyExtensions(n,"loadBuffer",(function(r){return r.loadBufferAsync&&r.loadBufferAsync(e,n,t,i)}))},e.LoadExtensionAsync=function(e,n,t,i){if(!n.extensions)return null;var r=n.extensions[t];return r?i(e+"/extensions/"+t,r):null},e.LoadExtraAsync=function(e,n,t,i){if(!n.extras)return null;var r=n.extras[t];return r?i(e+"/extras/"+t,r):null},e.prototype.isExtensionUsed=function(e){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(e)},e.prototype.logOpen=function(e){this._parent._logOpen(e)},e.prototype.logClose=function(){this._parent._logClose()},e.prototype.log=function(e){this._parent._log(e)},e.prototype.startPerformanceCounter=function(e){this._parent._startPerformanceCounter(e)},e.prototype.endPerformanceCounter=function(e){this._parent._endPerformanceCounter(e)},e._RegisteredExtensions={},e.DefaultSampler={index:-1},e}();In._CreateGLTF2Loader=function(e){return new Mn(e)};const Ln={},Nn=Promise.all(["bowl","dice"].map((async e=>{const n=await hn.ImportMeshAsync("","/npodice/",`${e}.gltf`);Ln[e]=n})));export{Ln as models,Nn as ready};
