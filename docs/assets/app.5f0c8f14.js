import{V as t,f as e,_ as i,p as s,v as n,L as r,ap as o,O as h,ah as a,a3 as l,a5 as u,a6 as c,t as p,q as _,F as f,z as d,u as y,E as g,as as m,n as b,M as E,$ as T,g as P,C as O,at as v,Y as A,ao as R,aq as I,ar as M}from"./babylon.86bef7cb.js";import{T as C,S as w,D as N,c as S,B as x,f as L,g as D,a as B}from"./scene.0b110e13.js";import{m as k,r as U}from"./index.67fce72c.js";var j=function(){function i(e,s){if(void 0===s&&(s=i.DefaultPluginFactory()),this._physicsPlugin=s,this._impostors=[],this._joints=[],this._subTimeStep=0,!this._physicsPlugin.isSupported())throw new Error("Physics Engine "+this._physicsPlugin.name+" cannot be found. Please make sure it is included.");e=e||new t(0,-9.807,0),this.setGravity(e),this.setTimeStep()}return i.DefaultPluginFactory=function(){throw e.WarnImport("CannonJSPlugin")},i.prototype.setGravity=function(t){this.gravity=t,this._physicsPlugin.setGravity(this.gravity)},i.prototype.setTimeStep=function(t){void 0===t&&(t=1/60),this._physicsPlugin.setTimeStep(t)},i.prototype.getTimeStep=function(){return this._physicsPlugin.getTimeStep()},i.prototype.setSubTimeStep=function(t){void 0===t&&(t=0),this._subTimeStep=t},i.prototype.getSubTimeStep=function(){return this._subTimeStep},i.prototype.dispose=function(){this._impostors.forEach((function(t){t.dispose()})),this._physicsPlugin.dispose()},i.prototype.getPhysicsPluginName=function(){return this._physicsPlugin.name},i.prototype.addImpostor=function(t){t.uniqueId=this._impostors.push(t),t.parent||this._physicsPlugin.generatePhysicsBody(t)},i.prototype.removeImpostor=function(t){var e=this._impostors.indexOf(t);e>-1&&(this._impostors.splice(e,1).length&&this.getPhysicsPlugin().removePhysicsBody(t))},i.prototype.addJoint=function(t,e,i){var s={mainImpostor:t,connectedImpostor:e,joint:i};i.physicsPlugin=this._physicsPlugin,this._joints.push(s),this._physicsPlugin.generateJoint(s)},i.prototype.removeJoint=function(t,e,i){var s=this._joints.filter((function(s){return s.connectedImpostor===e&&s.joint===i&&s.mainImpostor===t}));s.length&&this._physicsPlugin.removeJoint(s[0])},i.prototype._step=function(t){var e=this;this._impostors.forEach((function(t){t.isBodyInitRequired()&&e._physicsPlugin.generatePhysicsBody(t)})),t>.1?t=.1:t<=0&&(t=1/60),this._physicsPlugin.executeStep(t,this._impostors)},i.prototype.getPhysicsPlugin=function(){return this._physicsPlugin},i.prototype.getImpostors=function(){return this._impostors},i.prototype.getImpostorForPhysicsObject=function(t){for(var e=0;e<this._impostors.length;++e)if(this._impostors[e].object===t)return this._impostors[e];return null},i.prototype.getImpostorWithPhysicsBody=function(t){for(var e=0;e<this._impostors.length;++e)if(this._impostors[e].physicsBody===t)return this._impostors[e];return null},i.prototype.raycast=function(t,e){return this._physicsPlugin.raycast(t,e)},i.Epsilon=.001,i}(),F=function(){function t(t,e){this.type=t,this.jointData=e,e.nativeParams=e.nativeParams||{}}return Object.defineProperty(t.prototype,"physicsJoint",{get:function(){return this._physicsJoint},set:function(t){this._physicsJoint,this._physicsJoint=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"physicsPlugin",{set:function(t){this._physicsPlugin=t},enumerable:!1,configurable:!0}),t.prototype.executeNativeFunction=function(t){t(this._physicsPlugin.world,this._physicsJoint)},t.DistanceJoint=0,t.HingeJoint=1,t.BallAndSocketJoint=2,t.WheelJoint=3,t.SliderJoint=4,t.PrismaticJoint=5,t.UniversalJoint=6,t.Hinge2Joint=t.WheelJoint,t.PointToPointJoint=8,t.SpringJoint=9,t.LockJoint=10,t}();!function(t){function e(e){return t.call(this,F.DistanceJoint,e)||this}i(e,t),e.prototype.updateDistance=function(t,e){this._physicsPlugin.updateDistanceJoint(this,t,e)}}(F);var V=function(t){function e(e,i){return t.call(this,e,i)||this}return i(e,t),e.prototype.setMotor=function(t,e){this._physicsPlugin.setMotor(this,t||0,e)},e.prototype.setLimit=function(t,e){this._physicsPlugin.setLimit(this,t,e)},e}(F);!function(t){function e(e){return t.call(this,F.HingeJoint,e)||this}i(e,t),e.prototype.setMotor=function(t,e){this._physicsPlugin.setMotor(this,t||0,e)},e.prototype.setLimit=function(t,e){this._physicsPlugin.setLimit(this,t,e)}}(V),function(t){function e(e){return t.call(this,F.Hinge2Joint,e)||this}i(e,t),e.prototype.setMotor=function(t,e,i){void 0===i&&(i=0),this._physicsPlugin.setMotor(this,t||0,e,i)},e.prototype.setLimit=function(t,e,i){void 0===i&&(i=0),this._physicsPlugin.setLimit(this,t,e,i)}}(V),s.prototype.getPhysicsEngine=function(){return this._physicsEngine},s.prototype.enablePhysics=function(t,e){if(void 0===t&&(t=null),this._physicsEngine)return!0;var i=this._getComponent(n.NAME_PHYSICSENGINE);i||(i=new G(this),this._addComponent(i));try{return this._physicsEngine=new j(t,e),this._physicsTimeAccumulator=0,!0}catch(s){return r.Error(s.message),!1}},s.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=null)},s.prototype.isPhysicsEnabled=function(){return void 0!==this._physicsEngine},s.prototype.deleteCompoundImpostor=function(t){var e=t.parts[0].mesh;e.physicsImpostor&&(e.physicsImpostor.dispose(),e.physicsImpostor=null)},s.prototype._advancePhysicsEngineStep=function(t){if(this._physicsEngine){var e=this._physicsEngine.getSubTimeStep();if(e>0)for(this._physicsTimeAccumulator+=t;this._physicsTimeAccumulator>e;)this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(e/1e3),this.onAfterPhysicsObservable.notifyObservers(this),this._physicsTimeAccumulator-=e;else this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(t/1e3),this.onAfterPhysicsObservable.notifyObservers(this)}},Object.defineProperty(o.prototype,"physicsImpostor",{get:function(){return this._physicsImpostor},set:function(t){var e=this;this._physicsImpostor!==t&&(this._disposePhysicsObserver&&this.onDisposeObservable.remove(this._disposePhysicsObserver),this._physicsImpostor=t,t&&(this._disposePhysicsObserver=this.onDisposeObservable.add((function(){e.physicsImpostor&&(e.physicsImpostor.dispose(),e.physicsImpostor=null)}))))},enumerable:!0,configurable:!0}),o.prototype.getPhysicsImpostor=function(){return this.physicsImpostor},o.prototype.applyImpulse=function(t,e){return this.physicsImpostor?(this.physicsImpostor.applyImpulse(t,e),this):this},o.prototype.setPhysicsLinkWith=function(t,e,i,s){return this.physicsImpostor&&t.physicsImpostor?(this.physicsImpostor.createJoint(t.physicsImpostor,F.HingeJoint,{mainPivot:e,connectedPivot:i,nativeParams:s}),this):this};var G=function(){function t(t){var e=this;this.name=n.NAME_PHYSICSENGINE,this.scene=t,this.scene.onBeforePhysicsObservable=new h,this.scene.onAfterPhysicsObservable=new h,this.scene.getDeterministicFrameTime=function(){return e.scene._physicsEngine?1e3*e.scene._physicsEngine.getTimeStep():1e3/60}}return t.prototype.register=function(){},t.prototype.rebuild=function(){},t.prototype.dispose=function(){this.scene.onBeforePhysicsObservable.clear(),this.scene.onAfterPhysicsObservable.clear(),this.scene._physicsEngine&&this.scene.disablePhysicsEngine()},t}();a._PhysicsImpostorParser=function(t,e,i){return new H(e,i.physicsImpostor,{mass:i.physicsMass,friction:i.physicsFriction,restitution:i.physicsRestitution},t)};var H=function(){function e(e,i,s,n){var o=this;void 0===s&&(s={mass:0}),this.object=e,this.type=i,this._options=s,this._scene=n,this._pluginData={},this._bodyUpdateRequired=!1,this._onBeforePhysicsStepCallbacks=new Array,this._onAfterPhysicsStepCallbacks=new Array,this._onPhysicsCollideCallbacks=[],this._deltaPosition=t.Zero(),this._isDisposed=!1,this.soft=!1,this.segments=0,this._tmpQuat=new l,this._tmpQuat2=new l,this.beforeStep=function(){o._physicsEngine&&(o.object.translate(o._deltaPosition,-1),o._deltaRotationConjugated&&o.object.rotationQuaternion&&o.object.rotationQuaternion.multiplyToRef(o._deltaRotationConjugated,o.object.rotationQuaternion),o.object.computeWorldMatrix(!1),o.object.parent&&o.object.rotationQuaternion?(o.getParentsRotation(),o._tmpQuat.multiplyToRef(o.object.rotationQuaternion,o._tmpQuat)):o._tmpQuat.copyFrom(o.object.rotationQuaternion||new l),o._options.disableBidirectionalTransformation||o.object.rotationQuaternion&&o._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(o,o.object.getAbsolutePosition(),o._tmpQuat),o._onBeforePhysicsStepCallbacks.forEach((function(t){t(o)})))},this.afterStep=function(){o._physicsEngine&&(o._onAfterPhysicsStepCallbacks.forEach((function(t){t(o)})),o._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(o),o.object.parent&&o.object.rotationQuaternion&&(o.getParentsRotation(),o._tmpQuat.conjugateInPlace(),o._tmpQuat.multiplyToRef(o.object.rotationQuaternion,o.object.rotationQuaternion)),o.object.setAbsolutePosition(o.object.position),o._deltaRotation&&o.object.rotationQuaternion&&o.object.rotationQuaternion.multiplyToRef(o._deltaRotation,o.object.rotationQuaternion),o.object.translate(o._deltaPosition,1))},this.onCollideEvent=null,this.onCollide=function(t){if((o._onPhysicsCollideCallbacks.length||o.onCollideEvent)&&o._physicsEngine){var e=o._physicsEngine.getImpostorWithPhysicsBody(t.body);e&&(o.onCollideEvent&&o.onCollideEvent(o,e),o._onPhysicsCollideCallbacks.filter((function(t){return-1!==t.otherImpostors.indexOf(e)})).forEach((function(i){i.callback(o,e,t.point)})))}},this.object?(this.object.parent&&0!==s.mass&&r.Warn("A physics impostor has been created for an object which has a parent. Babylon physics currently works in local space so unexpected issues may occur."),!this._scene&&e.getScene&&(this._scene=e.getScene()),this._scene&&(this.type>100&&(this.soft=!0),this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine?(this.object.rotationQuaternion||(this.object.rotation?this.object.rotationQuaternion=l.RotationYawPitchRoll(this.object.rotation.y,this.object.rotation.x,this.object.rotation.z):this.object.rotationQuaternion=new l),this._options.mass=void 0===s.mass?0:s.mass,this._options.friction=void 0===s.friction?.2:s.friction,this._options.restitution=void 0===s.restitution?.2:s.restitution,this.soft&&(this._options.mass=this._options.mass>0?this._options.mass:1,this._options.pressure=void 0===s.pressure?200:s.pressure,this._options.stiffness=void 0===s.stiffness?1:s.stiffness,this._options.velocityIterations=void 0===s.velocityIterations?20:s.velocityIterations,this._options.positionIterations=void 0===s.positionIterations?20:s.positionIterations,this._options.fixedPoints=void 0===s.fixedPoints?0:s.fixedPoints,this._options.margin=void 0===s.margin?0:s.margin,this._options.damping=void 0===s.damping?0:s.damping,this._options.path=void 0===s.path?null:s.path,this._options.shape=void 0===s.shape?null:s.shape),this._joints=[],!this.object.parent||this._options.ignoreParent?this._init():this.object.parent.physicsImpostor&&r.Warn("You must affect impostors to children before affecting impostor to parent.")):r.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))):r.Error("No object was provided. A physics object is obligatory")}return Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mass",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyMass(this):0},set:function(t){this.setMass(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"friction",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyFriction(this):0},set:function(t){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyFriction(this,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"restitution",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyRestitution(this):0},set:function(t){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyRestitution(this,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pressure",{get:function(){if(!this._physicsEngine)return 0;var t=this._physicsEngine.getPhysicsPlugin();return t.setBodyPressure?t.getBodyPressure(this):0},set:function(t){if(this._physicsEngine){var e=this._physicsEngine.getPhysicsPlugin();e.setBodyPressure&&e.setBodyPressure(this,t)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stiffness",{get:function(){if(!this._physicsEngine)return 0;var t=this._physicsEngine.getPhysicsPlugin();return t.getBodyStiffness?t.getBodyStiffness(this):0},set:function(t){if(this._physicsEngine){var e=this._physicsEngine.getPhysicsPlugin();e.setBodyStiffness&&e.setBodyStiffness(this,t)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"velocityIterations",{get:function(){if(!this._physicsEngine)return 0;var t=this._physicsEngine.getPhysicsPlugin();return t.getBodyVelocityIterations?t.getBodyVelocityIterations(this):0},set:function(t){if(this._physicsEngine){var e=this._physicsEngine.getPhysicsPlugin();e.setBodyVelocityIterations&&e.setBodyVelocityIterations(this,t)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"positionIterations",{get:function(){if(!this._physicsEngine)return 0;var t=this._physicsEngine.getPhysicsPlugin();return t.getBodyPositionIterations?t.getBodyPositionIterations(this):0},set:function(t){if(this._physicsEngine){var e=this._physicsEngine.getPhysicsPlugin();e.setBodyPositionIterations&&e.setBodyPositionIterations(this,t)}},enumerable:!1,configurable:!0}),e.prototype._init=function(){this._physicsEngine&&(this._physicsEngine.removeImpostor(this),this.physicsBody=null,this._parent=this._parent||this._getPhysicsParent(),this._isDisposed||this.parent&&!this._options.ignoreParent||this._physicsEngine.addImpostor(this))},e.prototype._getPhysicsParent=function(){return this.object.parent instanceof o?this.object.parent.physicsImpostor:null},e.prototype.isBodyInitRequired=function(){return this._bodyUpdateRequired||!this._physicsBody&&!this._parent},e.prototype.setScalingUpdated=function(){this.forceUpdate()},e.prototype.forceUpdate=function(){this._init(),this.parent&&!this._options.ignoreParent&&this.parent.forceUpdate()},Object.defineProperty(e.prototype,"physicsBody",{get:function(){return this._parent&&!this._options.ignoreParent?this._parent.physicsBody:this._physicsBody},set:function(t){this._physicsBody&&this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this),this._physicsBody=t,this.resetUpdateFlags()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return!this._options.ignoreParent&&this._parent?this._parent:null},set:function(t){this._parent=t},enumerable:!1,configurable:!0}),e.prototype.resetUpdateFlags=function(){this._bodyUpdateRequired=!1},e.prototype.getObjectExtendSize=function(){if(this.object.getBoundingInfo){var t=this.object.rotationQuaternion,i=this.object.scaling.clone();this.object.rotationQuaternion=e.IDENTITY_QUATERNION;var s=this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0);s&&s.decompose(i,void 0,void 0);var n=this.object.getBoundingInfo().boundingBox.extendSize.scale(2).multiplyInPlace(i);return this.object.rotationQuaternion=t,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0),n}return e.DEFAULT_OBJECT_SIZE},e.prototype.getObjectCenter=function(){return this.object.getBoundingInfo?this.object.getBoundingInfo().boundingBox.centerWorld:this.object.position},e.prototype.getParam=function(t){return this._options[t]},e.prototype.setParam=function(t,e){this._options[t]=e,this._bodyUpdateRequired=!0},e.prototype.setMass=function(t){this.getParam("mass")!==t&&this.setParam("mass",t),this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyMass(this,t)},e.prototype.getLinearVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this):t.Zero()},e.prototype.setLinearVelocity=function(t){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this,t)},e.prototype.getAngularVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this):t.Zero()},e.prototype.setAngularVelocity=function(t){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this,t)},e.prototype.executeNativeFunction=function(t){this._physicsEngine&&t(this._physicsEngine.getPhysicsPlugin().world,this.physicsBody)},e.prototype.registerBeforePhysicsStep=function(t){this._onBeforePhysicsStepCallbacks.push(t)},e.prototype.unregisterBeforePhysicsStep=function(t){var e=this._onBeforePhysicsStepCallbacks.indexOf(t);e>-1?this._onBeforePhysicsStepCallbacks.splice(e,1):r.Warn("Function to remove was not found")},e.prototype.registerAfterPhysicsStep=function(t){this._onAfterPhysicsStepCallbacks.push(t)},e.prototype.unregisterAfterPhysicsStep=function(t){var e=this._onAfterPhysicsStepCallbacks.indexOf(t);e>-1?this._onAfterPhysicsStepCallbacks.splice(e,1):r.Warn("Function to remove was not found")},e.prototype.registerOnPhysicsCollide=function(t,e){var i=t instanceof Array?t:[t];this._onPhysicsCollideCallbacks.push({callback:e,otherImpostors:i})},e.prototype.unregisterOnPhysicsCollide=function(t,e){var i=t instanceof Array?t:[t],s=-1;this._onPhysicsCollideCallbacks.some((function(t,n){if(t.callback===e&&t.otherImpostors.length===i.length){var r=t.otherImpostors.every((function(t){return i.indexOf(t)>-1}));return r&&(s=n),r}return!1}))?this._onPhysicsCollideCallbacks.splice(s,1):r.Warn("Function to remove was not found")},e.prototype.getParentsRotation=function(){var t=this.object.parent;for(this._tmpQuat.copyFromFloats(0,0,0,1);t;)t.rotationQuaternion?this._tmpQuat2.copyFrom(t.rotationQuaternion):l.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,t.rotation.z,this._tmpQuat2),this._tmpQuat.multiplyToRef(this._tmpQuat2,this._tmpQuat),t=t.parent;return this._tmpQuat},e.prototype.applyForce=function(t,e){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyForce(this,t,e),this},e.prototype.applyImpulse=function(t,e){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyImpulse(this,t,e),this},e.prototype.createJoint=function(t,e,i){var s=new F(e,i);return this.addJoint(t,s),this},e.prototype.addJoint=function(t,e){return this._joints.push({otherImpostor:t,joint:e}),this._physicsEngine&&this._physicsEngine.addJoint(this,t,e),this},e.prototype.addAnchor=function(t,e,i,s,n){if(!this._physicsEngine)return this;var r=this._physicsEngine.getPhysicsPlugin();return r.appendAnchor?(this._physicsEngine&&r.appendAnchor(this,t,e,i,s,n),this):this},e.prototype.addHook=function(t,e,i,s){if(!this._physicsEngine)return this;var n=this._physicsEngine.getPhysicsPlugin();return n.appendAnchor?(this._physicsEngine&&n.appendHook(this,t,e,i,s),this):this},e.prototype.sleep=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().sleepBody(this),this},e.prototype.wakeUp=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().wakeUpBody(this),this},e.prototype.clone=function(t){return t?new e(t,this.type,this._options,this._scene):null},e.prototype.dispose=function(){var t=this;this._physicsEngine&&(this._joints.forEach((function(e){t._physicsEngine&&t._physicsEngine.removeJoint(t,e.otherImpostor,e.joint)})),this._physicsEngine.removeImpostor(this),this.parent&&this.parent.forceUpdate(),this._isDisposed=!0)},e.prototype.setDeltaPosition=function(t){this._deltaPosition.copyFrom(t)},e.prototype.setDeltaRotation=function(t){this._deltaRotation||(this._deltaRotation=new l),this._deltaRotation.copyFrom(t),this._deltaRotationConjugated=this._deltaRotation.conjugate()},e.prototype.getBoxSizeToRef=function(t){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().getBoxSizeToRef(this,t),this},e.prototype.getRadius=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getRadius(this):0},e.prototype.syncBoneWithImpostor=function(t,i,s,n,r){var o=e._tmpVecs[0],h=this.object;if(h.rotationQuaternion)if(r){var a=e._tmpQuat;h.rotationQuaternion.multiplyToRef(r,a),t.setRotationQuaternion(a,u.WORLD,i)}else t.setRotationQuaternion(h.rotationQuaternion,u.WORLD,i);o.x=0,o.y=0,o.z=0,s&&(o.x=s.x,o.y=s.y,o.z=s.z,t.getDirectionToRef(o,i,o),null==n&&(n=s.length()),o.x*=n,o.y*=n,o.z*=n),t.getParent()?(o.addInPlace(h.getAbsolutePosition()),t.setAbsolutePosition(o,i)):(i.setAbsolutePosition(h.getAbsolutePosition()),i.position.x-=o.x,i.position.y-=o.y,i.position.z-=o.z)},e.prototype.syncImpostorWithBone=function(t,i,s,n,r,o){var h=this.object;if(h.rotationQuaternion)if(r){var a=e._tmpQuat;t.getRotationQuaternionToRef(u.WORLD,i,a),a.multiplyToRef(r,h.rotationQuaternion)}else t.getRotationQuaternionToRef(u.WORLD,i,h.rotationQuaternion);var l=e._tmpVecs[0],c=e._tmpVecs[1];o||((o=e._tmpVecs[2]).x=0,o.y=1,o.z=0),t.getDirectionToRef(o,i,c),t.getAbsolutePositionToRef(i,l),null==n&&s&&(n=s.length()),null!=n&&(l.x+=c.x*n,l.y+=c.y*n,l.z+=c.z*n),h.setAbsolutePosition(l)},e.DEFAULT_OBJECT_SIZE=new t(1,1,1),e.IDENTITY_QUATERNION=l.Identity(),e._tmpVecs=c.BuildArray(3,t.Zero),e._tmpQuat=l.Identity(),e.NoImpostor=0,e.SphereImpostor=1,e.BoxImpostor=2,e.PlaneImpostor=3,e.MeshImpostor=4,e.CapsuleImpostor=6,e.CylinderImpostor=7,e.ParticleImpostor=8,e.HeightmapImpostor=9,e.ConvexHullImpostor=10,e.CustomImpostor=100,e.RopeImpostor=101,e.ClothImpostor=102,e.SoftbodyImpostor=103,e}(),W=function(){function t(){}return t.COPY=1,t.CUT=2,t.PASTE=3,t}(),X=function(){function t(t,e){this.type=t,this.event=e}return t.GetTypeFromCharacter=function(t){switch(t){case 67:return W.COPY;case 86:return W.PASTE;case 88:return W.CUT;default:return-1}},t}(),z=function(){function t(t){this.name=n.NAME_LAYER,this.scene=t,this._engine=t.getEngine(),t.layers=new Array}return t.prototype.register=function(){this.scene._beforeCameraDrawStage.registerStep(n.STEP_BEFORECAMERADRAW_LAYER,this,this._drawCameraBackground),this.scene._afterCameraDrawStage.registerStep(n.STEP_AFTERCAMERADRAW_LAYER,this,this._drawCameraForeground),this.scene._beforeRenderTargetDrawStage.registerStep(n.STEP_BEFORERENDERTARGETDRAW_LAYER,this,this._drawRenderTargetBackground),this.scene._afterRenderTargetDrawStage.registerStep(n.STEP_AFTERRENDERTARGETDRAW_LAYER,this,this._drawRenderTargetForeground)},t.prototype.rebuild=function(){for(var t=0,e=this.scene.layers;t<e.length;t++){e[t]._rebuild()}},t.prototype.dispose=function(){for(var t=this.scene.layers;t.length;)t[0].dispose()},t.prototype._draw=function(t){var e=this.scene.layers;if(e.length){this._engine.setDepthBuffer(!1);for(var i=0,s=e;i<s.length;i++){var n=s[i];t(n)&&n.render()}this._engine.setDepthBuffer(!0)}},t.prototype._drawCameraPredicate=function(t,e,i){return!t.renderOnlyInRenderTargetTextures&&t.isBackground===e&&0!=(t.layerMask&i)},t.prototype._drawCameraBackground=function(t){var e=this;this._draw((function(i){return e._drawCameraPredicate(i,!0,t.layerMask)}))},t.prototype._drawCameraForeground=function(t){var e=this;this._draw((function(i){return e._drawCameraPredicate(i,!1,t.layerMask)}))},t.prototype._drawRenderTargetPredicate=function(t,e,i,s){return t.renderTargetTextures.length>0&&t.isBackground===e&&t.renderTargetTextures.indexOf(s)>-1&&0!=(t.layerMask&i)},t.prototype._drawRenderTargetBackground=function(t){var e=this;this._draw((function(i){return e._drawRenderTargetPredicate(i,!0,e.scene.activeCamera.layerMask,t)}))},t.prototype._drawRenderTargetForeground=function(t){var e=this;this._draw((function(i){return e._drawRenderTargetPredicate(i,!1,e.scene.activeCamera.layerMask,t)}))},t.prototype.addFromContainer=function(t){var e=this;t.layers&&t.layers.forEach((function(t){e.scene.layers.push(t)}))},t.prototype.removeFromContainer=function(t,e){var i=this;void 0===e&&(e=!1),t.layers&&t.layers.forEach((function(t){var s=i.scene.layers.indexOf(t);-1!==s&&i.scene.layers.splice(s,1),e&&t.dispose()}))},t}();p.ShadersStore.layerPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\n\n#include<helperFunctions>\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\n#ifdef LINEAR\nbaseColor.rgb=toGammaSpace(baseColor.rgb);\n#endif\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=baseColor*color;\n}";p.ShadersStore.layerVertexShader="\nattribute vec2 position;\n\nuniform vec2 scale;\nuniform vec2 offset;\nuniform mat4 textureMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvec2 shiftedPosition=position*scale+offset;\nvUV=vec2(textureMatrix*vec4(shiftedPosition*madd+madd,1.0,0.0));\ngl_Position=vec4(shiftedPosition,0.0,1.0);\n}";var Y=function(){function t(t,e,i,s,r){this.name=t,this.scale=new d(1,1),this.offset=new d(0,0),this.alphaBlendingMode=2,this.layerMask=268435455,this.renderTargetTextures=[],this.renderOnlyInRenderTargetTextures=!1,this._vertexBuffers={},this.onDisposeObservable=new h,this.onBeforeRenderObservable=new h,this.onAfterRenderObservable=new h,this.texture=e?new C(e,i,!0):null,this.isBackground=void 0===s||s,this.color=void 0===r?new y(1,1,1,1):r,this._scene=i||g.LastCreatedScene;var o=this._scene._getComponent(n.NAME_LAYER);o||(o=new z(this._scene),this._scene._addComponent(o)),this._scene.layers.push(this);var a=this._scene.getEngine(),l=[];l.push(1,1),l.push(-1,1),l.push(-1,-1),l.push(1,-1);var u=new _(a,l,_.PositionKind,!1,!1,2);this._vertexBuffers[_.PositionKind]=u,this._createIndexBuffer()}return Object.defineProperty(t.prototype,"onDispose",{set:function(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeRender",{set:function(t){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onAfterRender",{set:function(t){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(t)},enumerable:!1,configurable:!0}),t.prototype._createIndexBuffer=function(){var t=this._scene.getEngine(),e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=t.createIndexBuffer(e)},t.prototype._rebuild=function(){var t=this._vertexBuffers[_.PositionKind];t&&t._rebuild(),this._createIndexBuffer()},t.prototype.render=function(){var t=this._scene.getEngine(),e="";this.alphaTest&&(e="#define ALPHATEST"),this.texture&&!this.texture.gammaSpace&&(e+="\r\n#define LINEAR"),this._previousDefines!==e&&(this._previousDefines=e,this._effect=t.createEffect("layer",[_.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],e));var i=this._effect;if(i&&i.isReady()&&this.texture&&this.texture.isReady()){t=this._scene.getEngine();this.onBeforeRenderObservable.notifyObservers(this),t.enableEffect(i),t.setState(!1),i.setTexture("textureSampler",this.texture),i.setMatrix("textureMatrix",this.texture.getTextureMatrix()),i.setFloat4("color",this.color.r,this.color.g,this.color.b,this.color.a),i.setVector2("offset",this.offset),i.setVector2("scale",this.scale),t.bindBuffers(this._vertexBuffers,this._indexBuffer,i),this.alphaTest?t.drawElementsType(f.TriangleFillMode,0,6):(t.setAlphaMode(this.alphaBlendingMode),t.drawElementsType(f.TriangleFillMode,0,6),t.setAlphaMode(0)),this.onAfterRenderObservable.notifyObservers(this)}},t.prototype.dispose=function(){var t=this._vertexBuffers[_.PositionKind];t&&(t.dispose(),this._vertexBuffers[_.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.texture&&(this.texture.dispose(),this.texture=null),this.renderTargetTextures=[];var e=this._scene.layers.indexOf(this);this._scene.layers.splice(e,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderObservable.clear()},t}(),Q=function(){function t(e,i,s){void 0===i&&(i=t.UNITMODE_PIXEL),void 0===s&&(s=!0),this.unit=i,this.negativeValueAllowed=s,this._value=1,this.ignoreAdaptiveScaling=!1,this._value=e,this._originalUnit=i}return Object.defineProperty(t.prototype,"isPercentage",{get:function(){return this.unit===t.UNITMODE_PERCENTAGE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPixel",{get:function(){return this.unit===t.UNITMODE_PIXEL},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"internalValue",{get:function(){return this._value},enumerable:!1,configurable:!0}),t.prototype.getValueInPixel=function(t,e){return this.isPixel?this.getValue(t):this.getValue(t)*e},t.prototype.updateInPlace=function(e,i){return void 0===i&&(i=t.UNITMODE_PIXEL),this._value=e,this.unit=i,this},t.prototype.getValue=function(e){if(e&&!this.ignoreAdaptiveScaling&&this.unit!==t.UNITMODE_PERCENTAGE){var i=0,s=0;if(e.idealWidth&&(i=this._value*e.getSize().width/e.idealWidth),e.idealHeight&&(s=this._value*e.getSize().height/e.idealHeight),e.useSmallestIdeal&&e.idealWidth&&e.idealHeight)return window.innerWidth<window.innerHeight?i:s;if(e.idealWidth)return i;if(e.idealHeight)return s}return this._value},t.prototype.toString=function(e,i){switch(this.unit){case t.UNITMODE_PERCENTAGE:var s=100*this.getValue(e);return(i?s.toFixed(i):s)+"%";case t.UNITMODE_PIXEL:var n=this.getValue(e);return(i?n.toFixed(i):n)+"px"}return this.unit.toString()},t.prototype.fromString=function(e){var i=t._Regex.exec(e.toString());if(!i||0===i.length)return!1;var s=parseFloat(i[1]),n=this._originalUnit;if(this.negativeValueAllowed||s<0&&(s=0),4===i.length)switch(i[3]){case"px":n=t.UNITMODE_PIXEL;break;case"%":n=t.UNITMODE_PERCENTAGE,s/=100}return(s!==this._value||n!==this.unit)&&(this._value=s,this.unit=n,!0)},Object.defineProperty(t,"UNITMODE_PERCENTAGE",{get:function(){return t._UNITMODE_PERCENTAGE},enumerable:!1,configurable:!0}),Object.defineProperty(t,"UNITMODE_PIXEL",{get:function(){return t._UNITMODE_PIXEL},enumerable:!1,configurable:!0}),t._Regex=/(^-?\d*(\.\d+)?)(%|px)?/,t._UNITMODE_PERCENTAGE=0,t._UNITMODE_PIXEL=1,t}(),J=[new d(0,0),new d(0,0),new d(0,0),new d(0,0)],Z=[new d(0,0),new d(0,0),new d(0,0),new d(0,0)],q=new d(0,0),K=new d(0,0),$=function(){function t(t,e,i,s){this.left=t,this.top=e,this.width=i,this.height=s}return t.prototype.copyFrom=function(t){this.left=t.left,this.top=t.top,this.width=t.width,this.height=t.height},t.prototype.copyFromFloats=function(t,e,i,s){this.left=t,this.top=e,this.width=i,this.height=s},t.CombineToRef=function(t,e,i){var s=Math.min(t.left,e.left),n=Math.min(t.top,e.top),r=Math.max(t.left+t.width,e.left+e.width),o=Math.max(t.top+t.height,e.top+e.height);i.left=s,i.top=n,i.width=r-s,i.height=o-n},t.prototype.addAndTransformToRef=function(t,e,i,s,n,r){var o=this.left+e,h=this.top+i,a=this.width+s,l=this.height+n;J[0].copyFromFloats(o,h),J[1].copyFromFloats(o+a,h),J[2].copyFromFloats(o+a,h+l),J[3].copyFromFloats(o,h+l),q.copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE),K.copyFromFloats(0,0);for(var u=0;u<4;u++)t.transformCoordinates(J[u].x,J[u].y,Z[u]),q.x=Math.floor(Math.min(q.x,Z[u].x)),q.y=Math.floor(Math.min(q.y,Z[u].y)),K.x=Math.ceil(Math.max(K.x,Z[u].x)),K.y=Math.ceil(Math.max(K.y,Z[u].y));r.left=q.x,r.top=q.y,r.width=K.x-q.x,r.height=K.y-q.y},t.prototype.transformToRef=function(t,e){this.addAndTransformToRef(t,0,0,0,0,e)},t.prototype.isEqualsTo=function(t){return this.left===t.left&&(this.top===t.top&&(this.width===t.width&&this.height===t.height))},t.Empty=function(){return new t(0,0,0,0)},t}(),tt=function(t){function e(e,i){void 0===i&&(i=0);var s=t.call(this,e.x,e.y)||this;return s.buttonIndex=i,s}return i(e,t),e}(d),et=function(){function t(t,e,i,s,n,r){this.m=new Float32Array(6),this.fromValues(t,e,i,s,n,r)}return t.prototype.fromValues=function(t,e,i,s,n,r){return this.m[0]=t,this.m[1]=e,this.m[2]=i,this.m[3]=s,this.m[4]=n,this.m[5]=r,this},t.prototype.determinant=function(){return this.m[0]*this.m[3]-this.m[1]*this.m[2]},t.prototype.invertToRef=function(t){var e=this.m[0],i=this.m[1],s=this.m[2],n=this.m[3],r=this.m[4],o=this.m[5],h=this.determinant();if(h<m*m)return t.m[0]=0,t.m[1]=0,t.m[2]=0,t.m[3]=0,t.m[4]=0,t.m[5]=0,this;var a=1/h,l=s*o-n*r,u=i*r-e*o;return t.m[0]=n*a,t.m[1]=-i*a,t.m[2]=-s*a,t.m[3]=e*a,t.m[4]=l*a,t.m[5]=u*a,this},t.prototype.multiplyToRef=function(t,e){var i=this.m[0],s=this.m[1],n=this.m[2],r=this.m[3],o=this.m[4],h=this.m[5],a=t.m[0],l=t.m[1],u=t.m[2],c=t.m[3],p=t.m[4],_=t.m[5];return e.m[0]=i*a+s*u,e.m[1]=i*l+s*c,e.m[2]=n*a+r*u,e.m[3]=n*l+r*c,e.m[4]=o*a+h*u+p,e.m[5]=o*l+h*c+_,this},t.prototype.transformCoordinates=function(t,e,i){return i.x=t*this.m[0]+e*this.m[2]+this.m[4],i.y=t*this.m[1]+e*this.m[3]+this.m[5],this},t.Identity=function(){return new t(1,0,0,1,0,0)},t.TranslationToRef=function(t,e,i){i.fromValues(1,0,0,1,t,e)},t.ScalingToRef=function(t,e,i){i.fromValues(t,0,0,e,0,0)},t.RotationToRef=function(t,e){var i=Math.sin(t),s=Math.cos(t);e.fromValues(s,i,-i,s,0,0)},t.ComposeToRef=function(e,i,s,n,r,o,h){t.TranslationToRef(e,i,t._TempPreTranslationMatrix),t.ScalingToRef(n,r,t._TempScalingMatrix),t.RotationToRef(s,t._TempRotationMatrix),t.TranslationToRef(-e,-i,t._TempPostTranslationMatrix),t._TempPreTranslationMatrix.multiplyToRef(t._TempScalingMatrix,t._TempCompose0),t._TempCompose0.multiplyToRef(t._TempRotationMatrix,t._TempCompose1),o?(t._TempCompose1.multiplyToRef(t._TempPostTranslationMatrix,t._TempCompose2),t._TempCompose2.multiplyToRef(o,h)):t._TempCompose1.multiplyToRef(t._TempPostTranslationMatrix,h)},t._TempPreTranslationMatrix=t.Identity(),t._TempPostTranslationMatrix=t.Identity(),t._TempRotationMatrix=t.Identity(),t._TempScalingMatrix=t.Identity(),t._TempCompose0=t.Identity(),t._TempCompose1=t.Identity(),t._TempCompose2=t.Identity(),t}(),it=function(){function e(t){this.name=t,this._alpha=1,this._alphaSet=!1,this._zIndex=0,this._currentMeasure=$.Empty(),this._fontFamily="Arial",this._fontStyle="",this._fontWeight="",this._fontSize=new Q(18,Q.UNITMODE_PIXEL,!1),this._width=new Q(1,Q.UNITMODE_PERCENTAGE,!1),this._height=new Q(1,Q.UNITMODE_PERCENTAGE,!1),this._color="",this._style=null,this._horizontalAlignment=e.HORIZONTAL_ALIGNMENT_CENTER,this._verticalAlignment=e.VERTICAL_ALIGNMENT_CENTER,this._isDirty=!0,this._wasDirty=!1,this._tempParentMeasure=$.Empty(),this._prevCurrentMeasureTransformedIntoGlobalSpace=$.Empty(),this._cachedParentMeasure=$.Empty(),this._paddingLeft=new Q(0),this._paddingRight=new Q(0),this._paddingTop=new Q(0),this._paddingBottom=new Q(0),this._left=new Q(0),this._top=new Q(0),this._scaleX=1,this._scaleY=1,this._rotation=0,this._transformCenterX=.5,this._transformCenterY=.5,this._transformMatrix=et.Identity(),this._invertTransformMatrix=et.Identity(),this._transformedPosition=d.Zero(),this._isMatrixDirty=!0,this._isVisible=!0,this._isHighlighted=!1,this._fontSet=!1,this._dummyVector2=d.Zero(),this._downCount=0,this._enterCount=-1,this._doNotRender=!1,this._downPointerIds={},this._isEnabled=!0,this._disabledColor="#9a9a9a",this._disabledColorItem="#6a6a6a",this._rebuildLayout=!1,this._customData={},this._isClipped=!1,this._automaticSize=!1,this.metadata=null,this.isHitTestVisible=!0,this.isPointerBlocker=!1,this.isFocusInvisible=!1,this.clipChildren=!0,this.clipContent=!0,this.useBitmapCache=!1,this._shadowOffsetX=0,this._shadowOffsetY=0,this._shadowBlur=0,this._shadowColor="black",this.hoverCursor="",this._linkOffsetX=new Q(0),this._linkOffsetY=new Q(0),this.onWheelObservable=new h,this.onPointerMoveObservable=new h,this.onPointerOutObservable=new h,this.onPointerDownObservable=new h,this.onPointerUpObservable=new h,this.onPointerClickObservable=new h,this.onPointerEnterObservable=new h,this.onDirtyObservable=new h,this.onBeforeDrawObservable=new h,this.onAfterDrawObservable=new h,this.onDisposeObservable=new h,this.fixedRatio=0,this._fixedRatioMasterIsWidth=!0,this._tmpMeasureA=new $(0,0,0,0)}return Object.defineProperty(e.prototype,"shadowOffsetX",{get:function(){return this._shadowOffsetX},set:function(t){this._shadowOffsetX!==t&&(this._shadowOffsetX=t,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowOffsetY",{get:function(){return this._shadowOffsetY},set:function(t){this._shadowOffsetY!==t&&(this._shadowOffsetY=t,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowBlur",{get:function(){return this._shadowBlur},set:function(t){this._shadowBlur!==t&&(this._shadowBlur=t,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowColor",{get:function(){return this._shadowColor},set:function(t){this._shadowColor!==t&&(this._shadowColor=t,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"typeName",{get:function(){return this._getTypeName()},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return this._getTypeName()},Object.defineProperty(e.prototype,"host",{get:function(){return this._host},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontOffset",{get:function(){return this._fontOffset},set:function(t){this._fontOffset=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha!==t&&(this._alphaSet=!0,this._alpha=t,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isHighlighted",{get:function(){return this._isHighlighted},set:function(t){this._isHighlighted!==t&&(this._isHighlighted=t,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scaleX",{get:function(){return this._scaleX},set:function(t){this._scaleX!==t&&(this._scaleX=t,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scaleY",{get:function(){return this._scaleY},set:function(t){this._scaleY!==t&&(this._scaleY=t,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation!==t&&(this._rotation=t,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transformCenterY",{get:function(){return this._transformCenterY},set:function(t){this._transformCenterY!==t&&(this._transformCenterY=t,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transformCenterX",{get:function(){return this._transformCenterX},set:function(t){this._transformCenterX!==t&&(this._transformCenterX=t,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"horizontalAlignment",{get:function(){return this._horizontalAlignment},set:function(t){this._horizontalAlignment!==t&&(this._horizontalAlignment=t,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"verticalAlignment",{get:function(){return this._verticalAlignment},set:function(t){this._verticalAlignment!==t&&(this._verticalAlignment=t,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(t){this._fixedRatioMasterIsWidth=!0,this._width.toString(this._host)!==t&&this._width.fromString(t)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"widthInPixels",{get:function(){return this._width.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(t){isNaN(t)||(this._fixedRatioMasterIsWidth=!0,this.width=t+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height.toString(this._host)},set:function(t){this._fixedRatioMasterIsWidth=!1,this._height.toString(this._host)!==t&&this._height.fromString(t)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"heightInPixels",{get:function(){return this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(t){isNaN(t)||(this._fixedRatioMasterIsWidth=!1,this.height=t+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontFamily",{get:function(){return this._fontSet?this._fontFamily:""},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this._resetFontCache())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(t){this._fontStyle!==t&&(this._fontStyle=t,this._resetFontCache())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(t){this._fontWeight!==t&&(this._fontWeight=t,this._resetFontCache())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this._style},set:function(t){var e=this;this._style&&(this._style.onChangedObservable.remove(this._styleObserver),this._styleObserver=null),this._style=t,this._style&&(this._styleObserver=this._style.onChangedObservable.add((function(){e._markAsDirty(),e._resetFontCache()}))),this._markAsDirty(),this._resetFontCache()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_isFontSizeInPercentage",{get:function(){return this._fontSize.isPercentage},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSizeInPixels",{get:function(){var t=this._style?this._style._fontSize:this._fontSize;return t.isPixel?t.getValue(this._host):t.getValueInPixel(this._host,this._tempParentMeasure.height||this._cachedParentMeasure.height)},set:function(t){isNaN(t)||(this.fontSize=t+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize.toString(this._host)},set:function(t){this._fontSize.toString(this._host)!==t&&this._fontSize.fromString(t)&&(this._markAsDirty(),this._resetFontCache())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){this._color!==t&&(this._color=t,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zIndex",{get:function(){return this._zIndex},set:function(t){this.zIndex!==t&&(this._zIndex=t,this.parent&&this.parent._reOrderControl(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"notRenderable",{get:function(){return this._doNotRender},set:function(t){this._doNotRender!==t&&(this._doNotRender=t,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isVisible",{get:function(){return this._isVisible},set:function(t){this._isVisible!==t&&(this._isVisible=t,this._markAsDirty(!0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"linkedMesh",{get:function(){return this._linkedMesh},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingLeft",{get:function(){return this._paddingLeft.toString(this._host)},set:function(t){this._paddingLeft.fromString(t)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingLeftInPixels",{get:function(){return this._paddingLeft.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(t){isNaN(t)||(this.paddingLeft=t+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingRight",{get:function(){return this._paddingRight.toString(this._host)},set:function(t){this._paddingRight.fromString(t)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingRightInPixels",{get:function(){return this._paddingRight.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(t){isNaN(t)||(this.paddingRight=t+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingTop",{get:function(){return this._paddingTop.toString(this._host)},set:function(t){this._paddingTop.fromString(t)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingTopInPixels",{get:function(){return this._paddingTop.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(t){isNaN(t)||(this.paddingTop=t+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingBottom",{get:function(){return this._paddingBottom.toString(this._host)},set:function(t){this._paddingBottom.fromString(t)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingBottomInPixels",{get:function(){return this._paddingBottom.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(t){isNaN(t)||(this.paddingBottom=t+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this._left.toString(this._host)},set:function(t){this._left.fromString(t)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftInPixels",{get:function(){return this._left.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(t){isNaN(t)||(this.left=t+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this._top.toString(this._host)},set:function(t){this._top.fromString(t)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"topInPixels",{get:function(){return this._top.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(t){isNaN(t)||(this.top=t+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"linkOffsetX",{get:function(){return this._linkOffsetX.toString(this._host)},set:function(t){this._linkOffsetX.fromString(t)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"linkOffsetXInPixels",{get:function(){return this._linkOffsetX.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(t){isNaN(t)||(this.linkOffsetX=t+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"linkOffsetY",{get:function(){return this._linkOffsetY.toString(this._host)},set:function(t){this._linkOffsetY.fromString(t)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"linkOffsetYInPixels",{get:function(){return this._linkOffsetY.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(t){isNaN(t)||(this.linkOffsetY=t+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"centerX",{get:function(){return this._currentMeasure.left+this._currentMeasure.width/2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"centerY",{get:function(){return this._currentMeasure.top+this._currentMeasure.height/2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(t){this._isEnabled!==t&&(this._isEnabled=t,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"disabledColor",{get:function(){return this._disabledColor},set:function(t){this._disabledColor!==t&&(this._disabledColor=t,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"disabledColorItem",{get:function(){return this._disabledColorItem},set:function(t){this._disabledColorItem!==t&&(this._disabledColorItem=t,this._markAsDirty())},enumerable:!1,configurable:!0}),e.prototype._getTypeName=function(){return"Control"},e.prototype.getAscendantOfClass=function(t){return this.parent?this.parent.getClassName()===t?this.parent:this.parent.getAscendantOfClass(t):null},e.prototype._resetFontCache=function(){this._fontSet=!0,this._markAsDirty()},e.prototype.isAscendant=function(t){return!!this.parent&&(this.parent===t||this.parent.isAscendant(t))},e.prototype.getLocalCoordinates=function(t){var e=d.Zero();return this.getLocalCoordinatesToRef(t,e),e},e.prototype.getLocalCoordinatesToRef=function(t,e){return e.x=t.x-this._currentMeasure.left,e.y=t.y-this._currentMeasure.top,this},e.prototype.getParentLocalCoordinates=function(t){var e=d.Zero();return e.x=t.x-this._cachedParentMeasure.left,e.y=t.y-this._cachedParentMeasure.top,e},e.prototype.moveToVector3=function(i,s){if(this._host&&this.parent===this._host._rootContainer){this.horizontalAlignment=e.HORIZONTAL_ALIGNMENT_LEFT,this.verticalAlignment=e.VERTICAL_ALIGNMENT_TOP;var n=this._host._getGlobalViewport(s),r=t.Project(i,E.Identity(),s.getTransformMatrix(),n);this._moveToProjectedPosition(r),r.z<0||r.z>1?this.notRenderable=!0:this.notRenderable=!1}else b.Error("Cannot move a control to a vector3 if the control is not at root level")},e.prototype.getDescendantsToRef=function(t,e,i){},e.prototype.getDescendants=function(t,e){var i=new Array;return this.getDescendantsToRef(i,t,e),i},e.prototype.linkWithMesh=function(t){if(!this._host||this.parent&&this.parent!==this._host._rootContainer)t&&b.Error("Cannot link a control to a mesh if the control is not at root level");else{var i=this._host._linkedControls.indexOf(this);if(-1!==i)return this._linkedMesh=t,void(t||this._host._linkedControls.splice(i,1));t&&(this.horizontalAlignment=e.HORIZONTAL_ALIGNMENT_LEFT,this.verticalAlignment=e.VERTICAL_ALIGNMENT_TOP,this._linkedMesh=t,this._host._linkedControls.push(this))}},e.prototype._moveToProjectedPosition=function(t){var e=this._left.getValue(this._host),i=this._top.getValue(this._host),s=t.x+this._linkOffsetX.getValue(this._host)-this._currentMeasure.width/2,n=t.y+this._linkOffsetY.getValue(this._host)-this._currentMeasure.height/2;this._left.ignoreAdaptiveScaling&&this._top.ignoreAdaptiveScaling&&(Math.abs(s-e)<.5&&(s=e),Math.abs(n-i)<.5&&(n=i)),this.left=s+"px",this.top=n+"px",this._left.ignoreAdaptiveScaling=!0,this._top.ignoreAdaptiveScaling=!0,this._markAsDirty()},e.prototype._offsetLeft=function(t){this._isDirty=!0,this._currentMeasure.left+=t},e.prototype._offsetTop=function(t){this._isDirty=!0,this._currentMeasure.top+=t},e.prototype._markMatrixAsDirty=function(){this._isMatrixDirty=!0,this._flagDescendantsAsMatrixDirty()},e.prototype._flagDescendantsAsMatrixDirty=function(){},e.prototype._intersectsRect=function(t){return this._currentMeasure.transformToRef(this._transformMatrix,this._tmpMeasureA),!(this._tmpMeasureA.left>=t.left+t.width)&&(!(this._tmpMeasureA.top>=t.top+t.height)&&(!(this._tmpMeasureA.left+this._tmpMeasureA.width<=t.left)&&!(this._tmpMeasureA.top+this._tmpMeasureA.height<=t.top)))},e.prototype.invalidateRect=function(){if(this._transform(),this.host&&this.host.useInvalidateRectOptimization)if(this._currentMeasure.transformToRef(this._transformMatrix,this._tmpMeasureA),$.CombineToRef(this._tmpMeasureA,this._prevCurrentMeasureTransformedIntoGlobalSpace,this._tmpMeasureA),this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY){var t=this.shadowOffsetX,e=this.shadowOffsetY,i=this.shadowBlur,s=Math.min(Math.min(t,0)-2*i,0),n=Math.max(Math.max(t,0)+2*i,0),r=Math.min(Math.min(e,0)-2*i,0),o=Math.max(Math.max(e,0)+2*i,0);this.host.invalidateRect(Math.floor(this._tmpMeasureA.left+s),Math.floor(this._tmpMeasureA.top+r),Math.ceil(this._tmpMeasureA.left+this._tmpMeasureA.width+n),Math.ceil(this._tmpMeasureA.top+this._tmpMeasureA.height+o))}else this.host.invalidateRect(Math.floor(this._tmpMeasureA.left),Math.floor(this._tmpMeasureA.top),Math.ceil(this._tmpMeasureA.left+this._tmpMeasureA.width),Math.ceil(this._tmpMeasureA.top+this._tmpMeasureA.height))},e.prototype._markAsDirty=function(t){void 0===t&&(t=!1),(this._isVisible||t)&&(this._isDirty=!0,this._host&&this._host.markAsDirty())},e.prototype._markAllAsDirty=function(){this._markAsDirty(),this._font&&this._prepareFont()},e.prototype._link=function(t){this._host=t,this._host&&(this.uniqueId=this._host.getScene().getUniqueId())},e.prototype._transform=function(t){if(this._isMatrixDirty||1!==this._scaleX||1!==this._scaleY||0!==this._rotation){var e=this._currentMeasure.width*this._transformCenterX+this._currentMeasure.left,i=this._currentMeasure.height*this._transformCenterY+this._currentMeasure.top;t&&(t.translate(e,i),t.rotate(this._rotation),t.scale(this._scaleX,this._scaleY),t.translate(-e,-i)),(this._isMatrixDirty||this._cachedOffsetX!==e||this._cachedOffsetY!==i)&&(this._cachedOffsetX=e,this._cachedOffsetY=i,this._isMatrixDirty=!1,this._flagDescendantsAsMatrixDirty(),et.ComposeToRef(-e,-i,this._rotation,this._scaleX,this._scaleY,this.parent?this.parent._transformMatrix:null,this._transformMatrix),this._transformMatrix.invertToRef(this._invertTransformMatrix))}},e.prototype._renderHighlight=function(t){this.isHighlighted&&(t.save(),t.strokeStyle="#4affff",t.lineWidth=2,this._renderHighlightSpecific(t),t.restore())},e.prototype._renderHighlightSpecific=function(t){t.strokeRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)},e.prototype._applyStates=function(t){this._isFontSizeInPercentage&&(this._fontSet=!0),this._fontSet&&(this._prepareFont(),this._fontSet=!1),this._font&&(t.font=this._font),this._color&&(t.fillStyle=this._color),e.AllowAlphaInheritance?t.globalAlpha*=this._alpha:this._alphaSet&&(t.globalAlpha=this.parent?this.parent.alpha*this._alpha:this._alpha)},e.prototype._layout=function(t,e){if(!this.isDirty&&(!this.isVisible||this.notRenderable))return!1;if(this._isDirty||!this._cachedParentMeasure.isEqualsTo(t)){this.host._numLayoutCalls++,this._currentMeasure.addAndTransformToRef(this._transformMatrix,0|-this.paddingLeftInPixels,0|-this.paddingTopInPixels,0|this.paddingRightInPixels,0|this.paddingBottomInPixels,this._prevCurrentMeasureTransformedIntoGlobalSpace),e.save(),this._applyStates(e);var i=0;do{this._rebuildLayout=!1,this._processMeasures(t,e),i++}while(this._rebuildLayout&&i<3);i>=3&&r.Error("Layout cycle detected in GUI (Control name="+this.name+", uniqueId="+this.uniqueId+")"),e.restore(),this.invalidateRect(),this._evaluateClippingState(t)}return this._wasDirty=this._isDirty,this._isDirty=!1,!0},e.prototype._processMeasures=function(t,e){this._currentMeasure.copyFrom(t),this._preMeasure(t,e),this._measure(),this._computeAlignment(t,e),this._currentMeasure.left=0|this._currentMeasure.left,this._currentMeasure.top=0|this._currentMeasure.top,this._currentMeasure.width=0|this._currentMeasure.width,this._currentMeasure.height=0|this._currentMeasure.height,this._additionalProcessing(t,e),this._cachedParentMeasure.copyFrom(t),this.onDirtyObservable.hasObservers()&&this.onDirtyObservable.notifyObservers(this)},e.prototype._evaluateClippingState=function(t){if(this.parent&&this.parent.clipChildren){if(this._currentMeasure.left>t.left+t.width)return void(this._isClipped=!0);if(this._currentMeasure.left+this._currentMeasure.width<t.left)return void(this._isClipped=!0);if(this._currentMeasure.top>t.top+t.height)return void(this._isClipped=!0);if(this._currentMeasure.top+this._currentMeasure.height<t.top)return void(this._isClipped=!0)}this._isClipped=!1},e.prototype._measure=function(){this._width.isPixel?this._currentMeasure.width=this._width.getValue(this._host):this._currentMeasure.width*=this._width.getValue(this._host),this._height.isPixel?this._currentMeasure.height=this._height.getValue(this._host):this._currentMeasure.height*=this._height.getValue(this._host),0!==this.fixedRatio&&(this._fixedRatioMasterIsWidth?this._currentMeasure.height=this._currentMeasure.width*this.fixedRatio:this._currentMeasure.width=this._currentMeasure.height*this.fixedRatio)},e.prototype._computeAlignment=function(t,i){var s=this._currentMeasure.width,n=this._currentMeasure.height,r=t.width,o=t.height,h=0,a=0;switch(this.horizontalAlignment){case e.HORIZONTAL_ALIGNMENT_LEFT:h=0;break;case e.HORIZONTAL_ALIGNMENT_RIGHT:h=r-s;break;case e.HORIZONTAL_ALIGNMENT_CENTER:h=(r-s)/2}switch(this.verticalAlignment){case e.VERTICAL_ALIGNMENT_TOP:a=0;break;case e.VERTICAL_ALIGNMENT_BOTTOM:a=o-n;break;case e.VERTICAL_ALIGNMENT_CENTER:a=(o-n)/2}this._paddingLeft.isPixel?(this._currentMeasure.left+=this._paddingLeft.getValue(this._host),this._currentMeasure.width-=this._paddingLeft.getValue(this._host)):(this._currentMeasure.left+=r*this._paddingLeft.getValue(this._host),this._currentMeasure.width-=r*this._paddingLeft.getValue(this._host)),this._paddingRight.isPixel?this._currentMeasure.width-=this._paddingRight.getValue(this._host):this._currentMeasure.width-=r*this._paddingRight.getValue(this._host),this._paddingTop.isPixel?(this._currentMeasure.top+=this._paddingTop.getValue(this._host),this._currentMeasure.height-=this._paddingTop.getValue(this._host)):(this._currentMeasure.top+=o*this._paddingTop.getValue(this._host),this._currentMeasure.height-=o*this._paddingTop.getValue(this._host)),this._paddingBottom.isPixel?this._currentMeasure.height-=this._paddingBottom.getValue(this._host):this._currentMeasure.height-=o*this._paddingBottom.getValue(this._host),this._left.isPixel?this._currentMeasure.left+=this._left.getValue(this._host):this._currentMeasure.left+=r*this._left.getValue(this._host),this._top.isPixel?this._currentMeasure.top+=this._top.getValue(this._host):this._currentMeasure.top+=o*this._top.getValue(this._host),this._currentMeasure.left+=h,this._currentMeasure.top+=a},e.prototype._preMeasure=function(t,e){},e.prototype._additionalProcessing=function(t,e){},e.prototype._clipForChildren=function(t){},e.prototype._clip=function(t,i){if(t.beginPath(),e._ClipMeasure.copyFrom(this._currentMeasure),i){i.transformToRef(this._invertTransformMatrix,this._tmpMeasureA);var s=new $(0,0,0,0);s.left=Math.max(this._tmpMeasureA.left,this._currentMeasure.left),s.top=Math.max(this._tmpMeasureA.top,this._currentMeasure.top),s.width=Math.min(this._tmpMeasureA.left+this._tmpMeasureA.width,this._currentMeasure.left+this._currentMeasure.width)-s.left,s.height=Math.min(this._tmpMeasureA.top+this._tmpMeasureA.height,this._currentMeasure.top+this._currentMeasure.height)-s.top,e._ClipMeasure.copyFrom(s)}if(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY){var n=this.shadowOffsetX,r=this.shadowOffsetY,o=this.shadowBlur,h=Math.min(Math.min(n,0)-2*o,0),a=Math.max(Math.max(n,0)+2*o,0),l=Math.min(Math.min(r,0)-2*o,0),u=Math.max(Math.max(r,0)+2*o,0);t.rect(e._ClipMeasure.left+h,e._ClipMeasure.top+l,e._ClipMeasure.width+a-h,e._ClipMeasure.height+u-l)}else t.rect(e._ClipMeasure.left,e._ClipMeasure.top,e._ClipMeasure.width,e._ClipMeasure.height);t.clip()},e.prototype._render=function(t,e){return!this.isVisible||this.notRenderable||this._isClipped?(this._isDirty=!1,!1):(this.host._numRenderCalls++,t.save(),this._applyStates(t),this._transform(t),this.clipContent&&this._clip(t,e),this.onBeforeDrawObservable.hasObservers()&&this.onBeforeDrawObservable.notifyObservers(this),this.useBitmapCache&&!this._wasDirty&&this._cacheData?t.putImageData(this._cacheData,this._currentMeasure.left,this._currentMeasure.top):this._draw(t,e),this.useBitmapCache&&this._wasDirty&&(this._cacheData=t.getImageData(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._renderHighlight(t),this.onAfterDrawObservable.hasObservers()&&this.onAfterDrawObservable.notifyObservers(this),t.restore(),!0)},e.prototype._draw=function(t,e){},e.prototype.contains=function(t,e){return this._invertTransformMatrix.transformCoordinates(t,e,this._transformedPosition),t=this._transformedPosition.x,e=this._transformedPosition.y,!(t<this._currentMeasure.left)&&(!(t>this._currentMeasure.left+this._currentMeasure.width)&&(!(e<this._currentMeasure.top)&&(!(e>this._currentMeasure.top+this._currentMeasure.height)&&(this.isPointerBlocker&&(this._host._shouldBlockPointer=!0),!0))))},e.prototype._processPicking=function(t,e,i,s,n,r,o,h){return!!this._isEnabled&&(!(!this.isHitTestVisible||!this.isVisible||this._doNotRender)&&(!!this.contains(t,e)&&(this._processObservables(s,t,e,i,n,r,o,h),!0)))},e.prototype._onPointerMove=function(t,e,i,s){this.onPointerMoveObservable.notifyObservers(e,-1,t,this,s)&&null!=this.parent&&this.parent._onPointerMove(t,e,i,s)},e.prototype._onPointerEnter=function(t,e){return!!this._isEnabled&&(!(this._enterCount>0)&&(-1===this._enterCount&&(this._enterCount=0),this._enterCount++,this.onPointerEnterObservable.notifyObservers(this,-1,t,this,e)&&null!=this.parent&&this.parent._onPointerEnter(t,e),!0))},e.prototype._onPointerOut=function(t,e,i){if(void 0===i&&(i=!1),i||this._isEnabled&&t!==this){this._enterCount=0;var s=!0;t.isAscendant(this)||(s=this.onPointerOutObservable.notifyObservers(this,-1,t,this,e)),s&&null!=this.parent&&this.parent._onPointerOut(t,e,i)}},e.prototype._onPointerDown=function(t,e,i,s,n){return this._onPointerEnter(this,n),0===this._downCount&&(this._downCount++,this._downPointerIds[i]=!0,this.onPointerDownObservable.notifyObservers(new tt(e,s),-1,t,this,n)&&null!=this.parent&&this.parent._onPointerDown(t,e,i,s,n),!0)},e.prototype._onPointerUp=function(t,e,i,s,n,r){if(this._isEnabled){this._downCount=0,delete this._downPointerIds[i];var o=n;n&&(this._enterCount>0||-1===this._enterCount)&&(o=this.onPointerClickObservable.notifyObservers(new tt(e,s),-1,t,this,r)),this.onPointerUpObservable.notifyObservers(new tt(e,s),-1,t,this,r)&&null!=this.parent&&this.parent._onPointerUp(t,e,i,s,o,r)}},e.prototype._forcePointerUp=function(t){if(void 0===t&&(t=null),null!==t)this._onPointerUp(this,d.Zero(),t,0,!0);else for(var e in this._downPointerIds)this._onPointerUp(this,d.Zero(),+e,0,!0)},e.prototype._onWheelScroll=function(t,e){this._isEnabled&&(this.onWheelObservable.notifyObservers(new d(t,e))&&null!=this.parent&&this.parent._onWheelScroll(t,e))},e.prototype._onCanvasBlur=function(){},e.prototype._processObservables=function(t,e,i,s,n,r,o,h){if(!this._isEnabled)return!1;if(this._dummyVector2.copyFromFloats(e,i),t===T.POINTERMOVE){this._onPointerMove(this,this._dummyVector2,n,s);var a=this._host._lastControlOver[n];return a&&a!==this&&a._onPointerOut(this,s),a!==this&&this._onPointerEnter(this,s),this._host._lastControlOver[n]=this,!0}return t===T.POINTERDOWN?(this._onPointerDown(this,this._dummyVector2,n,r,s),this._host._registerLastControlDown(this,n),this._host._lastPickedControl=this,!0):t===T.POINTERUP?(this._host._lastControlDown[n]&&this._host._lastControlDown[n]._onPointerUp(this,this._dummyVector2,n,r,!0,s),delete this._host._lastControlDown[n],!0):!(t!==T.POINTERWHEEL||!this._host._lastControlOver[n])&&(this._host._lastControlOver[n]._onWheelScroll(o,h),!0)},e.prototype._prepareFont=function(){(this._font||this._fontSet)&&(this._style?this._font=this._style.fontStyle+" "+this._style.fontWeight+" "+this.fontSizeInPixels+"px "+this._style.fontFamily:this._font=this._fontStyle+" "+this._fontWeight+" "+this.fontSizeInPixels+"px "+this._fontFamily,this._fontOffset=e._GetFontOffset(this._font))},e.prototype.dispose=function(){(this.onDirtyObservable.clear(),this.onBeforeDrawObservable.clear(),this.onAfterDrawObservable.clear(),this.onPointerDownObservable.clear(),this.onPointerEnterObservable.clear(),this.onPointerMoveObservable.clear(),this.onPointerOutObservable.clear(),this.onPointerUpObservable.clear(),this.onPointerClickObservable.clear(),this.onWheelObservable.clear(),this._styleObserver&&this._style&&(this._style.onChangedObservable.remove(this._styleObserver),this._styleObserver=null),this.parent&&(this.parent.removeControl(this),this.parent=null),this._host)&&(this._host._linkedControls.indexOf(this)>-1&&this.linkWithMesh(null));this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},Object.defineProperty(e,"HORIZONTAL_ALIGNMENT_LEFT",{get:function(){return e._HORIZONTAL_ALIGNMENT_LEFT},enumerable:!1,configurable:!0}),Object.defineProperty(e,"HORIZONTAL_ALIGNMENT_RIGHT",{get:function(){return e._HORIZONTAL_ALIGNMENT_RIGHT},enumerable:!1,configurable:!0}),Object.defineProperty(e,"HORIZONTAL_ALIGNMENT_CENTER",{get:function(){return e._HORIZONTAL_ALIGNMENT_CENTER},enumerable:!1,configurable:!0}),Object.defineProperty(e,"VERTICAL_ALIGNMENT_TOP",{get:function(){return e._VERTICAL_ALIGNMENT_TOP},enumerable:!1,configurable:!0}),Object.defineProperty(e,"VERTICAL_ALIGNMENT_BOTTOM",{get:function(){return e._VERTICAL_ALIGNMENT_BOTTOM},enumerable:!1,configurable:!0}),Object.defineProperty(e,"VERTICAL_ALIGNMENT_CENTER",{get:function(){return e._VERTICAL_ALIGNMENT_CENTER},enumerable:!1,configurable:!0}),e._GetFontOffset=function(t){if(e._FontHeightSizes[t])return e._FontHeightSizes[t];var i=document.createElement("span");i.innerHTML="Hg",i.style.font=t;var s=document.createElement("div");s.style.display="inline-block",s.style.width="1px",s.style.height="0px",s.style.verticalAlign="bottom";var n=document.createElement("div");n.style.whiteSpace="nowrap",n.appendChild(i),n.appendChild(s),document.body.appendChild(n);var r=0,o=0;try{o=s.getBoundingClientRect().top-i.getBoundingClientRect().top,s.style.verticalAlign="baseline",r=s.getBoundingClientRect().top-i.getBoundingClientRect().top}finally{document.body.removeChild(n)}var h={ascent:r,height:o,descent:o-r};return e._FontHeightSizes[t]=h,h},e.drawEllipse=function(t,e,i,s,n){n.translate(t,e),n.scale(i,s),n.beginPath(),n.arc(0,0,1,0,2*Math.PI),n.closePath(),n.scale(1/i,1/s),n.translate(-t,-e)},e.AllowAlphaInheritance=!1,e._ClipMeasure=new $(0,0,0,0),e._HORIZONTAL_ALIGNMENT_LEFT=0,e._HORIZONTAL_ALIGNMENT_RIGHT=1,e._HORIZONTAL_ALIGNMENT_CENTER=2,e._VERTICAL_ALIGNMENT_TOP=0,e._VERTICAL_ALIGNMENT_BOTTOM=1,e._VERTICAL_ALIGNMENT_CENTER=2,e._FontHeightSizes={},e.AddHeader=function(){},e}();P.RegisteredTypes["BABYLON.GUI.Control"]=it;var st=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._children=new Array,i._measureForChildren=$.Empty(),i._background="",i._adaptWidthToChildren=!1,i._adaptHeightToChildren=!1,i.logLayoutCycleErrors=!1,i.maxLayoutCycle=3,i}return i(e,t),Object.defineProperty(e.prototype,"adaptHeightToChildren",{get:function(){return this._adaptHeightToChildren},set:function(t){this._adaptHeightToChildren!==t&&(this._adaptHeightToChildren=t,t&&(this.height="100%"),this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"adaptWidthToChildren",{get:function(){return this._adaptWidthToChildren},set:function(t){this._adaptWidthToChildren!==t&&(this._adaptWidthToChildren=t,t&&(this.width="100%"),this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._background},set:function(t){this._background!==t&&(this._background=t,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:!1,configurable:!0}),e.prototype._getTypeName=function(){return"Container"},e.prototype._flagDescendantsAsMatrixDirty=function(){for(var t=0,e=this.children;t<e.length;t++){e[t]._markMatrixAsDirty()}},e.prototype.getChildByName=function(t){for(var e=0,i=this.children;e<i.length;e++){var s=i[e];if(s.name===t)return s}return null},e.prototype.getChildByType=function(t,e){for(var i=0,s=this.children;i<s.length;i++){var n=s[i];if(n.typeName===e)return n}return null},e.prototype.containsControl=function(t){return-1!==this.children.indexOf(t)},e.prototype.addControl=function(t){return t?(-1!==this._children.indexOf(t)||(t._link(this._host),t._markAllAsDirty(),this._reOrderControl(t),this._markAsDirty()),this):this},e.prototype.clearControls=function(){for(var t=0,e=this.children.slice();t<e.length;t++){var i=e[t];this.removeControl(i)}return this},e.prototype.removeControl=function(t){var e=this._children.indexOf(t);return-1!==e&&(this._children.splice(e,1),t.parent=null),t.linkWithMesh(null),this._host&&this._host._cleanControlAfterRemoval(t),this._markAsDirty(),this},e.prototype._reOrderControl=function(t){this.removeControl(t);for(var e=!1,i=0;i<this._children.length;i++)if(this._children[i].zIndex>t.zIndex){this._children.splice(i,0,t),e=!0;break}e||this._children.push(t),t.parent=this,this._markAsDirty()},e.prototype._offsetLeft=function(e){t.prototype._offsetLeft.call(this,e);for(var i=0,s=this._children;i<s.length;i++){s[i]._offsetLeft(e)}},e.prototype._offsetTop=function(e){t.prototype._offsetTop.call(this,e);for(var i=0,s=this._children;i<s.length;i++){s[i]._offsetTop(e)}},e.prototype._markAllAsDirty=function(){t.prototype._markAllAsDirty.call(this);for(var e=0;e<this._children.length;e++)this._children[e]._markAllAsDirty()},e.prototype._localDraw=function(t){this._background&&(t.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fillStyle=this._background,t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height),t.restore())},e.prototype._link=function(e){t.prototype._link.call(this,e);for(var i=0,s=this._children;i<s.length;i++){s[i]._link(e)}},e.prototype._beforeLayout=function(){},e.prototype._processMeasures=function(e,i){!this._isDirty&&this._cachedParentMeasure.isEqualsTo(e)||(t.prototype._processMeasures.call(this,e,i),this._evaluateClippingState(e))},e.prototype._layout=function(t,e){if(!this.isDirty&&(!this.isVisible||this.notRenderable))return!1;this.host._numLayoutCalls++,this._isDirty&&this._currentMeasure.transformToRef(this._transformMatrix,this._prevCurrentMeasureTransformedIntoGlobalSpace);var i=0;e.save(),this._applyStates(e),this._beforeLayout();do{var s=-1,n=-1;if(this._rebuildLayout=!1,this._processMeasures(t,e),!this._isClipped){for(var o=0,h=this._children;o<h.length;o++){var a=h[o];a._tempParentMeasure.copyFrom(this._measureForChildren),a._layout(this._measureForChildren,e)&&(this.adaptWidthToChildren&&a._width.isPixel&&(s=Math.max(s,a._currentMeasure.width+a.paddingLeftInPixels+a.paddingRightInPixels)),this.adaptHeightToChildren&&a._height.isPixel&&(n=Math.max(n,a._currentMeasure.height+a.paddingTopInPixels+a.paddingBottomInPixels)))}this.adaptWidthToChildren&&s>=0&&(s+=this.paddingLeftInPixels+this.paddingRightInPixels,this.width!==s+"px"&&(this.width=s+"px",this._rebuildLayout=!0)),this.adaptHeightToChildren&&n>=0&&(n+=this.paddingTopInPixels+this.paddingBottomInPixels,this.height!==n+"px"&&(this.height=n+"px",this._rebuildLayout=!0)),this._postMeasure()}i++}while(this._rebuildLayout&&i<this.maxLayoutCycle);return i>=3&&this.logLayoutCycleErrors&&r.Error("Layout cycle detected in GUI (Container name="+this.name+", uniqueId="+this.uniqueId+")"),e.restore(),this._isDirty&&(this.invalidateRect(),this._isDirty=!1),!0},e.prototype._postMeasure=function(){},e.prototype._draw=function(t,e){this._localDraw(t),this.clipChildren&&this._clipForChildren(t);for(var i=0,s=this._children;i<s.length;i++){var n=s[i];e&&!n._intersectsRect(e)||n._render(t,e)}},e.prototype.getDescendantsToRef=function(t,e,i){if(void 0===e&&(e=!1),this.children)for(var s=0;s<this.children.length;s++){var n=this.children[s];i&&!i(n)||t.push(n),e||n.getDescendantsToRef(t,!1,i)}},e.prototype._processPicking=function(e,i,s,n,r,o,h,a){if(!this._isEnabled||!this.isVisible||this.notRenderable)return!1;if(!t.prototype.contains.call(this,e,i))return!1;for(var l=this._children.length-1;l>=0;l--){var u=this._children[l];if(u._processPicking(e,i,s,n,r,o,h,a))return u.hoverCursor&&this._host._changeCursor(u.hoverCursor),!0}return!!this.isHitTestVisible&&this._processObservables(n,e,i,s,r,o,h,a)},e.prototype._additionalProcessing=function(e,i){t.prototype._additionalProcessing.call(this,e,i),this._measureForChildren.copyFrom(this._currentMeasure)},e.prototype.dispose=function(){t.prototype.dispose.call(this);for(var e=this.children.length-1;e>=0;e--)this.children[e].dispose()},e}(it);P.RegisteredTypes["BABYLON.GUI.Container"]=st;var nt,rt,ot=function(){function t(t){this._fontFamily="Arial",this._fontStyle="",this._fontWeight="",this._fontSize=new Q(18,Q.UNITMODE_PIXEL,!1),this.onChangedObservable=new h,this._host=t}return Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize.toString(this._host)},set:function(t){this._fontSize.toString(this._host)!==t&&this._fontSize.fromString(t)&&this.onChangedObservable.notifyObservers(this)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this.onChangedObservable.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(t){this._fontStyle!==t&&(this._fontStyle=t,this.onChangedObservable.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(t){this._fontWeight!==t&&(this._fontWeight=t,this.onChangedObservable.notifyObservers(this))},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.onChangedObservable.clear()},t}(),ht=function(){function t(){}return t.ALPHA_DISABLE=0,t.ALPHA_ADD=1,t.ALPHA_COMBINE=2,t.ALPHA_SUBTRACT=3,t.ALPHA_MULTIPLY=4,t.ALPHA_MAXIMIZED=5,t.ALPHA_ONEONE=6,t.ALPHA_PREMULTIPLIED=7,t.ALPHA_PREMULTIPLIED_PORTERDUFF=8,t.ALPHA_INTERPOLATE=9,t.ALPHA_SCREENMODE=10,t.ALPHA_ONEONE_ONEONE=11,t.ALPHA_ALPHATOCOLOR=12,t.ALPHA_REVERSEONEMINUS=13,t.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,t.ALPHA_ONEONE_ONEZERO=15,t.ALPHA_EXCLUSION=16,t.ALPHA_EQUATION_ADD=0,t.ALPHA_EQUATION_SUBSTRACT=1,t.ALPHA_EQUATION_REVERSE_SUBTRACT=2,t.ALPHA_EQUATION_MAX=3,t.ALPHA_EQUATION_MIN=4,t.ALPHA_EQUATION_DARKEN=5,t.DELAYLOADSTATE_NONE=0,t.DELAYLOADSTATE_LOADED=1,t.DELAYLOADSTATE_LOADING=2,t.DELAYLOADSTATE_NOTLOADED=4,t.NEVER=512,t.ALWAYS=519,t.LESS=513,t.EQUAL=514,t.LEQUAL=515,t.GREATER=516,t.GEQUAL=518,t.NOTEQUAL=517,t.KEEP=7680,t.REPLACE=7681,t.INCR=7682,t.DECR=7683,t.INVERT=5386,t.INCR_WRAP=34055,t.DECR_WRAP=34056,t.TEXTURE_CLAMP_ADDRESSMODE=0,t.TEXTURE_WRAP_ADDRESSMODE=1,t.TEXTURE_MIRROR_ADDRESSMODE=2,t.TEXTUREFORMAT_ALPHA=0,t.TEXTUREFORMAT_LUMINANCE=1,t.TEXTUREFORMAT_LUMINANCE_ALPHA=2,t.TEXTUREFORMAT_RGB=4,t.TEXTUREFORMAT_RGBA=5,t.TEXTUREFORMAT_RED=6,t.TEXTUREFORMAT_R=6,t.TEXTUREFORMAT_RG=7,t.TEXTUREFORMAT_RED_INTEGER=8,t.TEXTUREFORMAT_R_INTEGER=8,t.TEXTUREFORMAT_RG_INTEGER=9,t.TEXTUREFORMAT_RGB_INTEGER=10,t.TEXTUREFORMAT_RGBA_INTEGER=11,t.TEXTURETYPE_UNSIGNED_BYTE=0,t.TEXTURETYPE_UNSIGNED_INT=0,t.TEXTURETYPE_FLOAT=1,t.TEXTURETYPE_HALF_FLOAT=2,t.TEXTURETYPE_BYTE=3,t.TEXTURETYPE_SHORT=4,t.TEXTURETYPE_UNSIGNED_SHORT=5,t.TEXTURETYPE_INT=6,t.TEXTURETYPE_UNSIGNED_INTEGER=7,t.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,t.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,t.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,t.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,t.TEXTURETYPE_UNSIGNED_INT_24_8=12,t.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,t.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,t.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,t.TEXTURE_NEAREST_SAMPLINGMODE=1,t.TEXTURE_NEAREST_NEAREST=1,t.TEXTURE_BILINEAR_SAMPLINGMODE=2,t.TEXTURE_LINEAR_LINEAR=2,t.TEXTURE_TRILINEAR_SAMPLINGMODE=3,t.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,t.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,t.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,t.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,t.TEXTURE_NEAREST_LINEAR=7,t.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,t.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,t.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,t.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,t.TEXTURE_LINEAR_NEAREST=12,t.TEXTURE_EXPLICIT_MODE=0,t.TEXTURE_SPHERICAL_MODE=1,t.TEXTURE_PLANAR_MODE=2,t.TEXTURE_CUBIC_MODE=3,t.TEXTURE_PROJECTION_MODE=4,t.TEXTURE_SKYBOX_MODE=5,t.TEXTURE_INVCUBIC_MODE=6,t.TEXTURE_EQUIRECTANGULAR_MODE=7,t.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,t.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,t.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,t.TEXTURE_FILTERING_QUALITY_HIGH=64,t.TEXTURE_FILTERING_QUALITY_MEDIUM=16,t.TEXTURE_FILTERING_QUALITY_LOW=8,t.SCALEMODE_FLOOR=1,t.SCALEMODE_NEAREST=2,t.SCALEMODE_CEILING=3,t.MATERIAL_TextureDirtyFlag=1,t.MATERIAL_LightDirtyFlag=2,t.MATERIAL_FresnelDirtyFlag=4,t.MATERIAL_AttributesDirtyFlag=8,t.MATERIAL_MiscDirtyFlag=16,t.MATERIAL_PrePassDirtyFlag=32,t.MATERIAL_AllDirtyFlag=63,t.MATERIAL_TriangleFillMode=0,t.MATERIAL_WireFrameFillMode=1,t.MATERIAL_PointFillMode=2,t.MATERIAL_PointListDrawMode=3,t.MATERIAL_LineListDrawMode=4,t.MATERIAL_LineLoopDrawMode=5,t.MATERIAL_LineStripDrawMode=6,t.MATERIAL_TriangleStripDrawMode=7,t.MATERIAL_TriangleFanDrawMode=8,t.MATERIAL_ClockWiseSideOrientation=0,t.MATERIAL_CounterClockWiseSideOrientation=1,t.ACTION_NothingTrigger=0,t.ACTION_OnPickTrigger=1,t.ACTION_OnLeftPickTrigger=2,t.ACTION_OnRightPickTrigger=3,t.ACTION_OnCenterPickTrigger=4,t.ACTION_OnPickDownTrigger=5,t.ACTION_OnDoublePickTrigger=6,t.ACTION_OnPickUpTrigger=7,t.ACTION_OnPickOutTrigger=16,t.ACTION_OnLongPressTrigger=8,t.ACTION_OnPointerOverTrigger=9,t.ACTION_OnPointerOutTrigger=10,t.ACTION_OnEveryFrameTrigger=11,t.ACTION_OnIntersectionEnterTrigger=12,t.ACTION_OnIntersectionExitTrigger=13,t.ACTION_OnKeyDownTrigger=14,t.ACTION_OnKeyUpTrigger=15,t.PARTICLES_BILLBOARDMODE_Y=2,t.PARTICLES_BILLBOARDMODE_ALL=7,t.PARTICLES_BILLBOARDMODE_STRETCHED=8,t.MESHES_CULLINGSTRATEGY_STANDARD=0,t.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,t.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,t.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,t.SCENELOADER_NO_LOGGING=0,t.SCENELOADER_MINIMAL_LOGGING=1,t.SCENELOADER_SUMMARY_LOGGING=2,t.SCENELOADER_DETAILED_LOGGING=3,t.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,t.PREPASS_POSITION_TEXTURE_TYPE=1,t.PREPASS_VELOCITY_TEXTURE_TYPE=2,t.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,t.PREPASS_COLOR_TEXTURE_TYPE=4,t.PREPASS_DEPTHNORMAL_TEXTURE_TYPE=5,t.PREPASS_ALBEDO_TEXTURE_TYPE=6,t}(),at=function(e){function s(t,i,s,n,r,o,a){void 0===i&&(i=0),void 0===s&&(s=0),void 0===r&&(r=!1),void 0===o&&(o=C.NEAREST_SAMPLINGMODE);var l=e.call(this,t,{width:i,height:s},n,r,o,ht.TEXTUREFORMAT_RGBA,a)||this;return l._isDirty=!1,l._rootContainer=new st("root"),l._lastControlOver={},l._lastControlDown={},l._capturingControl={},l._linkedControls=new Array,l._isFullscreen=!1,l._fullscreenViewport=new v(0,0,1,1),l._idealWidth=0,l._idealHeight=0,l._useSmallestIdeal=!1,l._renderAtIdealSize=!1,l._blockNextFocusCheck=!1,l._renderScale=1,l._cursorChanged=!1,l._defaultMousePointerId=0,l._numLayoutCalls=0,l._numRenderCalls=0,l._clipboardData="",l.onClipboardObservable=new h,l.onControlPickedObservable=new h,l.onBeginLayoutObservable=new h,l.onEndLayoutObservable=new h,l.onBeginRenderObservable=new h,l.onEndRenderObservable=new h,l.premulAlpha=!1,l.applyYInversionOnUpdate=!0,l._useInvalidateRectOptimization=!0,l._invalidatedRectangle=null,l._clearMeasure=new $(0,0,0,0),l.onClipboardCopy=function(t){var e=t,i=new X(W.COPY,e);l.onClipboardObservable.notifyObservers(i),e.preventDefault()},l.onClipboardCut=function(t){var e=t,i=new X(W.CUT,e);l.onClipboardObservable.notifyObservers(i),e.preventDefault()},l.onClipboardPaste=function(t){var e=t,i=new X(W.PASTE,e);l.onClipboardObservable.notifyObservers(i),e.preventDefault()},(n=l.getScene())&&l._texture?(l._rootElement=n.getEngine().getInputElement(),l._renderObserver=n.onBeforeCameraRenderObservable.add((function(t){return l._checkUpdate(t)})),l._preKeyboardObserver=n.onPreKeyboardObservable.add((function(t){l._focusedControl&&(t.type===A.KEYDOWN&&l._focusedControl.processKeyboard(t.event),t.skipOnPointerObservable=!0)})),l._rootContainer._link(l),l.hasAlpha=!0,i&&s||(l._resizeObserver=n.getEngine().onResizeObservable.add((function(){return l._onResize()})),l._onResize()),l._texture.isReady=!0,l):l}return i(s,e),Object.defineProperty(s.prototype,"numLayoutCalls",{get:function(){return this._numLayoutCalls},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"numRenderCalls",{get:function(){return this._numRenderCalls},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"renderScale",{get:function(){return this._renderScale},set:function(t){t!==this._renderScale&&(this._renderScale=t,this._onResize())},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"background",{get:function(){return this._background},set:function(t){this._background!==t&&(this._background=t,this.markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"idealWidth",{get:function(){return this._idealWidth},set:function(t){this._idealWidth!==t&&(this._idealWidth=t,this.markAsDirty(),this._rootContainer._markAllAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"idealHeight",{get:function(){return this._idealHeight},set:function(t){this._idealHeight!==t&&(this._idealHeight=t,this.markAsDirty(),this._rootContainer._markAllAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"useSmallestIdeal",{get:function(){return this._useSmallestIdeal},set:function(t){this._useSmallestIdeal!==t&&(this._useSmallestIdeal=t,this.markAsDirty(),this._rootContainer._markAllAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"renderAtIdealSize",{get:function(){return this._renderAtIdealSize},set:function(t){this._renderAtIdealSize!==t&&(this._renderAtIdealSize=t,this._onResize())},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"idealRatio",{get:function(){var t=0,e=0;return this._idealWidth&&(t=this.getSize().width/this._idealWidth),this._idealHeight&&(e=this.getSize().height/this._idealHeight),this._useSmallestIdeal&&this._idealWidth&&this._idealHeight?window.innerWidth<window.innerHeight?t:e:this._idealWidth?t:this._idealHeight?e:1},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"layer",{get:function(){return this._layerToDispose},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"rootContainer",{get:function(){return this._rootContainer},enumerable:!1,configurable:!0}),s.prototype.getChildren=function(){return[this._rootContainer]},s.prototype.getDescendants=function(t,e){return this._rootContainer.getDescendants(t,e)},Object.defineProperty(s.prototype,"focusedControl",{get:function(){return this._focusedControl},set:function(t){this._focusedControl!=t&&(this._focusedControl&&this._focusedControl.onBlur(),t&&t.onFocus(),this._focusedControl=t)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"isForeground",{get:function(){return!this.layer||!this.layer.isBackground},set:function(t){this.layer&&this.layer.isBackground!==!t&&(this.layer.isBackground=!t)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"clipboardData",{get:function(){return this._clipboardData},set:function(t){this._clipboardData=t},enumerable:!1,configurable:!0}),s.prototype.getClassName=function(){return"AdvancedDynamicTexture"},s.prototype.executeOnAllControls=function(t,e){e||(e=this._rootContainer),t(e);for(var i=0,s=e.children;i<s.length;i++){var n=s[i];n.children?this.executeOnAllControls(t,n):t(n)}},Object.defineProperty(s.prototype,"useInvalidateRectOptimization",{get:function(){return this._useInvalidateRectOptimization},set:function(t){this._useInvalidateRectOptimization=t},enumerable:!1,configurable:!0}),s.prototype.invalidateRect=function(t,e,i,s){if(this._useInvalidateRectOptimization)if(this._invalidatedRectangle){var n=Math.ceil(Math.max(this._invalidatedRectangle.left+this._invalidatedRectangle.width-1,i)),r=Math.ceil(Math.max(this._invalidatedRectangle.top+this._invalidatedRectangle.height-1,s));this._invalidatedRectangle.left=Math.floor(Math.min(this._invalidatedRectangle.left,t)),this._invalidatedRectangle.top=Math.floor(Math.min(this._invalidatedRectangle.top,e)),this._invalidatedRectangle.width=n-this._invalidatedRectangle.left+1,this._invalidatedRectangle.height=r-this._invalidatedRectangle.top+1}else this._invalidatedRectangle=new $(t,e,i-t+1,s-e+1)},s.prototype.markAsDirty=function(){this._isDirty=!0},s.prototype.createStyle=function(){return new ot(this)},s.prototype.addControl=function(t){return this._rootContainer.addControl(t),this},s.prototype.removeControl=function(t){return this._rootContainer.removeControl(t),this},s.prototype.dispose=function(){var t=this.getScene();t&&(this._rootElement=null,t.onBeforeCameraRenderObservable.remove(this._renderObserver),this._resizeObserver&&t.getEngine().onResizeObservable.remove(this._resizeObserver),this._pointerMoveObserver&&t.onPrePointerObservable.remove(this._pointerMoveObserver),this._pointerObserver&&t.onPointerObservable.remove(this._pointerObserver),this._preKeyboardObserver&&t.onPreKeyboardObservable.remove(this._preKeyboardObserver),this._canvasPointerOutObserver&&t.getEngine().onCanvasPointerOutObservable.remove(this._canvasPointerOutObserver),this._canvasBlurObserver&&t.getEngine().onCanvasBlurObservable.remove(this._canvasBlurObserver),this._layerToDispose&&(this._layerToDispose.texture=null,this._layerToDispose.dispose(),this._layerToDispose=null),this._rootContainer.dispose(),this.onClipboardObservable.clear(),this.onControlPickedObservable.clear(),this.onBeginRenderObservable.clear(),this.onEndRenderObservable.clear(),this.onBeginLayoutObservable.clear(),this.onEndLayoutObservable.clear(),e.prototype.dispose.call(this))},s.prototype._onResize=function(){var t=this.getScene();if(t){var e=t.getEngine(),i=this.getSize(),s=e.getRenderWidth()*this._renderScale,n=e.getRenderHeight()*this._renderScale;this._renderAtIdealSize&&(this._idealWidth?(n=n*this._idealWidth/s,s=this._idealWidth):this._idealHeight&&(s=s*this._idealHeight/n,n=this._idealHeight)),i.width===s&&i.height===n||(this.scaleTo(s,n),this.markAsDirty(),(this._idealWidth||this._idealHeight)&&this._rootContainer._markAllAsDirty()),this.invalidateRect(0,0,i.width-1,i.height-1)}},s.prototype._getGlobalViewport=function(t){var e=t.getEngine();return this._fullscreenViewport.toGlobal(e.getRenderWidth(),e.getRenderHeight())},s.prototype.getProjectedPosition=function(e,i){var s=this.getScene();if(!s)return d.Zero();var n=this._getGlobalViewport(s),r=t.Project(e,i,s.getTransformMatrix(),n);return r.scaleInPlace(this.renderScale),new d(r.x,r.y)},s.prototype.getProjectedPositionWithZ=function(e,i){var s=this.getScene();if(!s)return t.Zero();var n=this._getGlobalViewport(s),r=t.Project(e,i,s.getTransformMatrix(),n);return r.scaleInPlace(this.renderScale),new t(r.x,r.y,r.z)},s.prototype._checkUpdate=function(e){if(!this._layerToDispose||0!=(e.layerMask&this._layerToDispose.layerMask)){if(this._isFullscreen&&this._linkedControls.length){var i=this.getScene();if(!i)return;for(var s=this._getGlobalViewport(i),n=function(e){if(!e.isVisible)return"continue";var n=e._linkedMesh;if(!n||n.isDisposed())return b.SetImmediate((function(){e.linkWithMesh(null)})),"continue";var o=n.getBoundingInfo?n.getBoundingInfo().boundingSphere.center:t.ZeroReadOnly,h=t.Project(o,n.getWorldMatrix(),i.getTransformMatrix(),s);if(h.z<0||h.z>1)return e.notRenderable=!0,"continue";e.notRenderable=!1,h.scaleInPlace(r.renderScale),e._moveToProjectedPosition(h)},r=this,o=0,h=this._linkedControls;o<h.length;o++){n(h[o])}}(this._isDirty||this._rootContainer.isDirty)&&(this._isDirty=!1,this._render(),this.update(this.applyYInversionOnUpdate,this.premulAlpha))}},s.prototype._render=function(){var t=this.getSize(),e=t.width,i=t.height,s=this.getContext();s.font="18px Arial",s.strokeStyle="white",this.onBeginLayoutObservable.notifyObservers(this);var n=new $(0,0,e,i);this._numLayoutCalls=0,this._rootContainer._layout(n,s),this.onEndLayoutObservable.notifyObservers(this),this._isDirty=!1,this._invalidatedRectangle?this._clearMeasure.copyFrom(this._invalidatedRectangle):this._clearMeasure.copyFromFloats(0,0,e,i),s.clearRect(this._clearMeasure.left,this._clearMeasure.top,this._clearMeasure.width,this._clearMeasure.height),this._background&&(s.save(),s.fillStyle=this._background,s.fillRect(this._clearMeasure.left,this._clearMeasure.top,this._clearMeasure.width,this._clearMeasure.height),s.restore()),this.onBeginRenderObservable.notifyObservers(this),this._numRenderCalls=0,this._rootContainer._render(s,this._invalidatedRectangle),this.onEndRenderObservable.notifyObservers(this),this._invalidatedRectangle=null},s.prototype._changeCursor=function(t){this._rootElement&&(this._rootElement.style.cursor=t,this._cursorChanged=!0)},s.prototype._registerLastControlDown=function(t,e){this._lastControlDown[e]=t,this.onControlPickedObservable.notifyObservers(t)},s.prototype._doPicking=function(t,e,i,s,n,r,o,h){var a=this.getScene();if(a){var l=a.getEngine(),u=this.getSize();if(this._isFullscreen){var c=(a.cameraToUseForPointers||a.activeCamera).viewport;t*=u.width/(l.getRenderWidth()*c.width),e*=u.height/(l.getRenderHeight()*c.height)}this._capturingControl[n]?this._capturingControl[n]._processObservables(s,t,e,i,n,r):(this._cursorChanged=!1,this._rootContainer._processPicking(t,e,i,s,n,r,o,h)||(this._changeCursor(""),s===T.POINTERMOVE&&this._lastControlOver[n]&&(this._lastControlOver[n]._onPointerOut(this._lastControlOver[n],i),delete this._lastControlOver[n])),this._cursorChanged||this._changeCursor(""),this._manageFocus())}},s.prototype._cleanControlAfterRemovalFromList=function(t,e){for(var i in t){if(t.hasOwnProperty(i))t[i]===e&&delete t[i]}},s.prototype._cleanControlAfterRemoval=function(t){this._cleanControlAfterRemovalFromList(this._lastControlDown,t),this._cleanControlAfterRemovalFromList(this._lastControlOver,t)},s.prototype.attach=function(){var t=this,e=this.getScene();if(e){var i=new v(0,0,0,0);this._pointerMoveObserver=e.onPrePointerObservable.add((function(s,n){if(!e.isPointerCaptured(s.event.pointerId)&&(s.type===T.POINTERMOVE||s.type===T.POINTERUP||s.type===T.POINTERDOWN||s.type===T.POINTERWHEEL)&&e){s.type===T.POINTERMOVE&&s.event.pointerId&&(t._defaultMousePointerId=s.event.pointerId);var r=e.cameraToUseForPointers||e.activeCamera,o=e.getEngine();r?r.viewport.toGlobalToRef(o.getRenderWidth(),o.getRenderHeight(),i):(i.x=0,i.y=0,i.width=o.getRenderWidth(),i.height=o.getRenderHeight());var h=e.pointerX/o.getHardwareScalingLevel()-i.x,a=e.pointerY/o.getHardwareScalingLevel()-(o.getRenderHeight()-i.y-i.height);t._shouldBlockPointer=!1;var l=s.event.pointerId||t._defaultMousePointerId;t._doPicking(h,a,s,s.type,l,s.event.button,s.event.deltaX,s.event.deltaY),t._shouldBlockPointer&&(s.skipOnPointerObservable=t._shouldBlockPointer)}})),this._attachToOnPointerOut(e),this._attachToOnBlur(e)}},s.prototype.registerClipboardEvents=function(){self.addEventListener("copy",this.onClipboardCopy,!1),self.addEventListener("cut",this.onClipboardCut,!1),self.addEventListener("paste",this.onClipboardPaste,!1)},s.prototype.unRegisterClipboardEvents=function(){self.removeEventListener("copy",this.onClipboardCopy),self.removeEventListener("cut",this.onClipboardCut),self.removeEventListener("paste",this.onClipboardPaste)},s.prototype.attachToMesh=function(t,e){var i=this;void 0===e&&(e=!0);var s=this.getScene();s&&(this._pointerObserver=s.onPointerObservable.add((function(e,s){if(e.type===T.POINTERMOVE||e.type===T.POINTERUP||e.type===T.POINTERDOWN){var n=e.event.pointerId||i._defaultMousePointerId;if(e.pickInfo&&e.pickInfo.hit&&e.pickInfo.pickedMesh===t){var r=e.pickInfo.getTextureCoordinates();if(r){var o=i.getSize();i._doPicking(r.x*o.width,(i.applyYInversionOnUpdate?1-r.y:r.y)*o.height,e,e.type,n,e.event.button)}}else if(e.type===T.POINTERUP){if(i._lastControlDown[n]&&i._lastControlDown[n]._forcePointerUp(n),delete i._lastControlDown[n],i.focusedControl){var h=i.focusedControl.keepsFocusWith(),a=!0;if(h)for(var l=0,u=h;l<u.length;l++){var c=u[l];if(i!==c._host){var p=c._host;if(p._lastControlOver[n]&&p._lastControlOver[n].isAscendant(c)){a=!1;break}}}a&&(i.focusedControl=null)}}else e.type===T.POINTERMOVE&&(i._lastControlOver[n]&&i._lastControlOver[n]._onPointerOut(i._lastControlOver[n],e,!0),delete i._lastControlOver[n])}})),t.enablePointerMoveEvents=e,this._attachToOnPointerOut(s),this._attachToOnBlur(s))},s.prototype.moveFocusToControl=function(t){this.focusedControl=t,this._lastPickedControl=t,this._blockNextFocusCheck=!0},s.prototype._manageFocus=function(){if(this._blockNextFocusCheck)return this._blockNextFocusCheck=!1,void(this._lastPickedControl=this._focusedControl);if(this._focusedControl&&this._focusedControl!==this._lastPickedControl){if(this._lastPickedControl.isFocusInvisible)return;this.focusedControl=null}},s.prototype._attachToOnPointerOut=function(t){var e=this;this._canvasPointerOutObserver=t.getEngine().onCanvasPointerOutObservable.add((function(t){e._lastControlOver[t.pointerId]&&e._lastControlOver[t.pointerId]._onPointerOut(e._lastControlOver[t.pointerId],null),delete e._lastControlOver[t.pointerId],e._lastControlDown[t.pointerId]&&e._lastControlDown[t.pointerId]!==e._capturingControl[t.pointerId]&&(e._lastControlDown[t.pointerId]._forcePointerUp(),delete e._lastControlDown[t.pointerId])}))},s.prototype._attachToOnBlur=function(t){var e=this;this._canvasBlurObserver=t.getEngine().onCanvasBlurObservable.add((function(t){Object.entries(e._lastControlDown).forEach((function(t){t[0],t[1]._onCanvasBlur()})),e._lastControlDown={}}))},s.CreateForMesh=function(t,e,i,n,r,o){void 0===e&&(e=1024),void 0===i&&(i=1024),void 0===n&&(n=!0),void 0===r&&(r=!1);var h=new s(t.name+" AdvancedDynamicTexture",e,i,t.getScene(),!0,C.TRILINEAR_SAMPLINGMODE,o),a=new w("AdvancedDynamicTextureMaterial",t.getScene());return a.backFaceCulling=!1,a.diffuseColor=O.Black(),a.specularColor=O.Black(),r?(a.diffuseTexture=h,a.emissiveTexture=h,h.hasAlpha=!0):(a.emissiveTexture=h,a.opacityTexture=h),t.material=a,h.attachToMesh(t,n),h},s.CreateForMeshTexture=function(t,e,i,n,r){void 0===e&&(e=1024),void 0===i&&(i=1024),void 0===n&&(n=!0);var o=new s(t.name+" AdvancedDynamicTexture",e,i,t.getScene(),!0,C.TRILINEAR_SAMPLINGMODE,r);return o.attachToMesh(t,n),o},s.CreateFullscreenUI=function(t,e,i,n){void 0===e&&(e=!0),void 0===i&&(i=null),void 0===n&&(n=C.BILINEAR_SAMPLINGMODE);var r=new s(t,0,0,i,!1,n),o=new Y(t+"_layer",null,i,!e);return o.texture=r,r._layerToDispose=o,r._isFullscreen=!0,r.attach(),r},s}(N);(rt=nt||(nt={}))[rt.Clip=0]="Clip",rt[rt.WordWrap=1]="WordWrap",rt[rt.Ellipsis=2]="Ellipsis";var lt=function(t){function e(e,i){void 0===i&&(i="");var s=t.call(this,e)||this;return s.name=e,s._text="",s._textWrapping=nt.Clip,s._textHorizontalAlignment=it.HORIZONTAL_ALIGNMENT_CENTER,s._textVerticalAlignment=it.VERTICAL_ALIGNMENT_CENTER,s._resizeToFit=!1,s._lineSpacing=new Q(0),s._outlineWidth=0,s._outlineColor="white",s._underline=!1,s._lineThrough=!1,s.onTextChangedObservable=new h,s.onLinesReadyObservable=new h,s.text=i,s}return i(e,t),Object.defineProperty(e.prototype,"lines",{get:function(){return this._lines},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resizeToFit",{get:function(){return this._resizeToFit},set:function(t){this._resizeToFit!==t&&(this._resizeToFit=t,this._resizeToFit&&(this._width.ignoreAdaptiveScaling=!0,this._height.ignoreAdaptiveScaling=!0),this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textWrapping",{get:function(){return this._textWrapping},set:function(t){this._textWrapping!==t&&(this._textWrapping=+t,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){this._text!==t&&(this._text=t,this._markAsDirty(),this.onTextChangedObservable.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textHorizontalAlignment",{get:function(){return this._textHorizontalAlignment},set:function(t){this._textHorizontalAlignment!==t&&(this._textHorizontalAlignment=t,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textVerticalAlignment",{get:function(){return this._textVerticalAlignment},set:function(t){this._textVerticalAlignment!==t&&(this._textVerticalAlignment=t,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lineSpacing",{get:function(){return this._lineSpacing.toString(this._host)},set:function(t){this._lineSpacing.fromString(t)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"outlineWidth",{get:function(){return this._outlineWidth},set:function(t){this._outlineWidth!==t&&(this._outlineWidth=t,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"underline",{get:function(){return this._underline},set:function(t){this._underline!==t&&(this._underline=t,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lineThrough",{get:function(){return this._lineThrough},set:function(t){this._lineThrough!==t&&(this._lineThrough=t,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"outlineColor",{get:function(){return this._outlineColor},set:function(t){this._outlineColor!==t&&(this._outlineColor=t,this._markAsDirty())},enumerable:!1,configurable:!0}),e.prototype._getTypeName=function(){return"TextBlock"},e.prototype._processMeasures=function(e,i){this._fontOffset||(this._fontOffset=it._GetFontOffset(i.font)),t.prototype._processMeasures.call(this,e,i),this._lines=this._breakLines(this._currentMeasure.width,i),this.onLinesReadyObservable.notifyObservers(this);for(var s=0,n=0;n<this._lines.length;n++){var r=this._lines[n];r.width>s&&(s=r.width)}if(this._resizeToFit){if(this._textWrapping===nt.Clip){var o=this.paddingLeftInPixels+this.paddingRightInPixels+s|0;o!==this._width.internalValue&&(this._width.updateInPlace(o,Q.UNITMODE_PIXEL),this._rebuildLayout=!0)}var h=this.paddingTopInPixels+this.paddingBottomInPixels+this._fontOffset.height*this._lines.length|0;if(this._lines.length>0&&0!==this._lineSpacing.internalValue){var a=0;a=this._lineSpacing.isPixel?this._lineSpacing.getValue(this._host):this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height),h+=(this._lines.length-1)*a}h!==this._height.internalValue&&(this._height.updateInPlace(h,Q.UNITMODE_PIXEL),this._rebuildLayout=!0)}},e.prototype._drawText=function(t,e,i,s){var n=this._currentMeasure.width,r=0;switch(this._textHorizontalAlignment){case it.HORIZONTAL_ALIGNMENT_LEFT:r=0;break;case it.HORIZONTAL_ALIGNMENT_RIGHT:r=n-e;break;case it.HORIZONTAL_ALIGNMENT_CENTER:r=(n-e)/2}(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(s.shadowColor=this.shadowColor,s.shadowBlur=this.shadowBlur,s.shadowOffsetX=this.shadowOffsetX,s.shadowOffsetY=this.shadowOffsetY),this.outlineWidth&&s.strokeText(t,this._currentMeasure.left+r,i),s.fillText(t,this._currentMeasure.left+r,i),this._underline&&(s.beginPath(),s.lineWidth=Math.round(.05*this.fontSizeInPixels),s.moveTo(this._currentMeasure.left+r,i+3),s.lineTo(this._currentMeasure.left+r+e,i+3),s.stroke(),s.closePath()),this._lineThrough&&(s.beginPath(),s.lineWidth=Math.round(.05*this.fontSizeInPixels),s.moveTo(this._currentMeasure.left+r,i-this.fontSizeInPixels/3),s.lineTo(this._currentMeasure.left+r+e,i-this.fontSizeInPixels/3),s.stroke(),s.closePath())},e.prototype._draw=function(t,e){t.save(),this._applyStates(t),this._renderLines(t),t.restore()},e.prototype._applyStates=function(e){t.prototype._applyStates.call(this,e),this.outlineWidth&&(e.lineWidth=this.outlineWidth,e.strokeStyle=this.outlineColor,e.lineJoin="miter",e.miterLimit=2)},e.prototype._breakLines=function(t,e){var i=[],s=this.text.split("\n");if(this._textWrapping===nt.Ellipsis)for(var n=0,r=s;n<r.length;n++){var o=r[n];i.push(this._parseLineEllipsis(o,t,e))}else if(this._textWrapping===nt.WordWrap)for(var h=0,a=s;h<a.length;h++){o=a[h];i.push.apply(i,this._parseLineWordWrap(o,t,e))}else for(var l=0,u=s;l<u.length;l++){o=u[l];i.push(this._parseLine(o,e))}return i},e.prototype._parseLine=function(t,e){return void 0===t&&(t=""),{text:t,width:e.measureText(t).width}},e.prototype._parseLineEllipsis=function(t,e,i){void 0===t&&(t="");var s=i.measureText(t).width;s>e&&(t+="");var n=Array.from&&Array.from(t);if(n)for(;n.length&&s>e;)n.pop(),t=n.join("")+"...",s=i.measureText(t).width;else for(;t.length>2&&s>e;)t=t.slice(0,-2)+"",s=i.measureText(t).width;return{text:t,width:s}},e.prototype._parseLineWordWrap=function(t,e,i){void 0===t&&(t="");for(var s=[],n=this.wordSplittingFunction?this.wordSplittingFunction(t):t.split(" "),r=0,o=0;o<n.length;o++){var h=o>0?t+" "+n[o]:n[0],a=i.measureText(h).width;a>e&&o>0?(s.push({text:t,width:r}),t=n[o],r=i.measureText(t).width):(r=a,t=h)}return s.push({text:t,width:r}),s},e.prototype._renderLines=function(t){var e=this._currentMeasure.height,i=0;switch(this._textVerticalAlignment){case it.VERTICAL_ALIGNMENT_TOP:i=this._fontOffset.ascent;break;case it.VERTICAL_ALIGNMENT_BOTTOM:i=e-this._fontOffset.height*(this._lines.length-1)-this._fontOffset.descent;break;case it.VERTICAL_ALIGNMENT_CENTER:i=this._fontOffset.ascent+(e-this._fontOffset.height*this._lines.length)/2}i+=this._currentMeasure.top;for(var s=0;s<this._lines.length;s++){var n=this._lines[s];0!==s&&0!==this._lineSpacing.internalValue&&(this._lineSpacing.isPixel?i+=this._lineSpacing.getValue(this._host):i+=this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)),this._drawText(n.text,n.width,i,t),i+=this._fontOffset.height}},e.prototype.computeExpectedHeight=function(){if(this.text&&this.widthInPixels){var t=document.createElement("canvas").getContext("2d");if(t){this._applyStates(t),this._fontOffset||(this._fontOffset=it._GetFontOffset(t.font));var e=this._lines?this._lines:this._breakLines(this.widthInPixels-this.paddingLeftInPixels-this.paddingRightInPixels,t),i=this.paddingTopInPixels+this.paddingBottomInPixels+this._fontOffset.height*e.length;if(e.length>0&&0!==this._lineSpacing.internalValue){var s=0;s=this._lineSpacing.isPixel?this._lineSpacing.getValue(this._host):this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height),i+=(e.length-1)*s}return i}}return 0},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.onTextChangedObservable.clear()},e}(it);P.RegisteredTypes["BABYLON.GUI.TextBlock"]=lt,R.CreatePlane=function(t){var e=[],i=[],s=[],n=[],r=t.width||t.size||1,o=t.height||t.size||1,h=0===t.sideOrientation?0:t.sideOrientation||R.DEFAULTSIDE,a=r/2,l=o/2;i.push(-a,-l,0),s.push(0,0,-1),n.push(0,0),i.push(a,-l,0),s.push(0,0,-1),n.push(1,0),i.push(a,l,0),s.push(0,0,-1),n.push(1,1),i.push(-a,l,0),s.push(0,0,-1),n.push(0,1),e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),R._ComputeSides(h,i,e,s,n,t.frontUVs,t.backUVs);var u=new R;return u.indices=e,u.positions=i,u.normals=s,u.uvs=n,u},a.CreatePlane=function(t,e,i,s,n){var r={size:e,width:e,height:e,sideOrientation:n,updatable:s};return ut.CreatePlane(t,r,i)};var ut=function(){function t(){}return t.CreatePlane=function(t,e,i){void 0===i&&(i=null);var s=new a(t,i);return e.sideOrientation=a._GetDefaultSideOrientation(e.sideOrientation),s._originalBuilderSideOrientation=e.sideOrientation,R.CreatePlane(e).applyToMesh(s,e.updatable),e.sourcePlane&&(s.translate(e.sourcePlane.normal,-e.sourcePlane.d),s.setDirection(e.sourcePlane.normal.scale(-1))),s},t}();const ct=t=>t<.001?.001:t;class pt{constructor(t=!1,e=10){this.BJSCANNON=CANNON,this._physicsMaterials=[],this.world=new this.BJSCANNON.World,this.world.allowSleep=!0,this.world.solver.iterations=e,this.world.broadphase=new this.BJSCANNON.NaiveBroadphase,this._useDeltaForWorldStep=t}isSupported(){return!0}executeStep(t,e){this.world.step(this._useDeltaForWorldStep?t:.5*t)}setTimeStep(t){this._fixedTimeStep=t}setGravity(t){this.world.gravity.set(t.x,t.y,t.z)}sleepBody(t){t.physicsBody.sleep()}wakeUpBody(t){t.physicsBody.wakeUp()}setLinearVelocity(t,e){t.physicsBody.velocity.set(e.x,e.y,e.z)}setAngularVelocity(t,e){t.physicsBody.angularVelocity.set(e.x,e.y,e.z)}setPhysicsBodyTransformation(t,e,i){t.physicsBody.position.set(e.x,e.y,e.z),t.physicsBody.quaternion.set(i.x,i.y,i.z,i.w)}setTransformationFromPhysicsBody(t){const{position:e,quaternion:i}=t.physicsBody;t.object.position.set(e.x,e.y,e.z),t.object.rotationQuaternion&&t.object.rotationQuaternion.set(i.x,i.y,i.z,i.w)}applyImpulse(t,e,i){t.physicsBody.applyImpulse(new this.BJSCANNON.Vec3(e.x,e.y,e.z),new this.BJSCANNON.Vec3(i.x,i.y,i.z))}generatePhysicsBody(t){if(t.isBodyInitRequired()){const e=t.getObjectExtendSize().scale(.5),i=new this.BJSCANNON.Vec3(ct(e.x),ct(e.y),ct(e.z));t.physicsBody=new this.BJSCANNON.Body({mass:t.getParam("mass"),material:this._addMaterial("mat-"+t.uniqueId,t.getParam("friction"),t.getParam("restitution"))}),t.physicsBody.addShape(new this.BJSCANNON.Box(i)),t.physicsBody.addEventListener("collide",t.onCollide),this.world.addEventListener("preStep",t.beforeStep),this.world.addEventListener("postStep",t.afterStep),this.world.addBody(t.physicsBody)}const e=t.object;e.computeWorldMatrix&&e.computeWorldMatrix(!0),e.getBoundingInfo()}_addMaterial(t,e,i){let s,n;for(s=0;s<this._physicsMaterials.length;++s)if(n=this._physicsMaterials[s],n.friction===e&&n.restitution===i)return n;const r=new this.BJSCANNON.Material(t);return r.friction=e,r.restitution=i,this._physicsMaterials.push(r),r}}const _t=Array.from({length:10},((t,e)=>S(e))),ft={mass:1,friction:.9,restitution:.8},dt={mass:0,friction:.9,restitution:.8};(()=>{const e=new pt;I.enablePhysics(new t(0,-9.81,0),e);const i=Array.from({length:12},((t,e)=>{const i=.5*e+1.5,s=e<3?.5:1,n=.18*Math.pow(e/3.2,2)+.39,r=Math.ceil(2*i*Math.PI/s),o=2*Math.PI/r,h=11===e?2:-i/12;return Array.from({length:r},((t,e)=>{const r=x.CreateBox(`base-${e}`,{width:s,height:.1,depth:.6}),a=e*o;return r.isVisible=!1,r.rotation.y=a,r.rotation.x=h,r.position.y=n,r.position.x=i*Math.sin(a),r.position.z=i*Math.cos(a),r}))})).flat();i.unshift(x.CreateBox("cent",{width:2.3,height:.9,depth:2.3})),i[0].isVisible=!1,i.unshift(L),i.forEach((t=>{t.physicsImpostor=new H(t,H.BoxImpostor,dt)})),_t.forEach((t=>{t.physicsImpostor=new H(t,H.BoxImpostor,ft),t.physicsImpostor.physicsBody.allowSleep=!0,t.physicsImpostor.sleep()}))})();const yt=t=>{const e=new lt;return e.color="white",e.fontFamily="monospace",Object.assign(e,t),e},gt=(()=>{const t=ut.CreatePlane("bowlPlane",{size:10});t.rotation.x=Math.PI/2,t.rotation.y=-Math.PI/2,t.position.y=2.5;const e=at.CreateForMesh(t),i=yt({fontSize:100,top:"-2%"}),s=yt({fontSize:50,top:"10%"});return e.addControl(i),e.addControl(s),async(t,e)=>{i.text="ROLL:"+`${t}`.padStart(2,"  "),s.text=`${e} DICE`,await k(1500),i.text="",s.text=""}})(),mt=async(e={})=>{e.inRound=!0,e.throwing=0,e.score={},e.nudges=5,e.rolls=3,e.rollDice=5,e.rollNumber=1,e.rollResult=null;let i=null;const s=()=>{--e.rolls,++e.rollNumber,e.throwing=1,e.rollResult=null;const s=_t.slice(0,e.rollDice);s.forEach(((e,i)=>{e.position.x=4*U(),e.position.z=4*U(),e.position.y=7+1.5*i,e.rotation.z=U()*Math.PI,e.physicsImpostor.setLinearVelocity(new t(U(),U(),U())),e.physicsImpostor.setAngularVelocity(new t(U(),U(),U())),e.physicsImpostor.wakeUp()}));const n=I.onBeforeRenderObservable.add((()=>{s.every((t=>2===t.physicsImpostor.physicsBody.sleepState||(t.position.y<=0&&setTimeout((()=>t.physicsImpostor.sleep()),2e3),!1)))&&(I.onBeforeRenderObservable.remove(n),e.throwing=2,(async t=>{const s=[0,0,0,0,0,0];s.out=0,s.nil=0,t.forEach((t=>++s[D(t)]));const n=B(s);n.sort(((t,e)=>t.length-e.length)),console.log(s,n),e.rollResult=n;for(const i of n)await(null==e?void 0:e.showResult(i));n.length&&++e.rolls,e.nudges+=n.length,e.rollDice=5+Math.max(0,n.length-1),await k(2e3),e.throwing=3,e.rolls<1&&(I.onPointerObservable.remove(i),M.useAutoRotationBehavior=!0,e.inRound=!1,null==e||e.done(),setTimeout((()=>_t.forEach((t=>{t.position.y=-5}))),100))})(s))}))};await(async()=>{let t=M.autoRotationBehavior.idleRotationSpeed;for(;t>.001;)t*=.95,M.autoRotationBehavior.idleRotationSpeed=t,await k(20);M.useAutoRotationBehavior=!1})(),await gt(e.rollNumber,e.rollDice),i=I.onPointerObservable.add((i=>{if(1!==i.type)return;const{button:n}=i.event;if(0===n){if(0===e.throwing)return s();3===e.throwing&&(_t.forEach(((t,e)=>{t.position.x=50,t.position.z=2*e,t.position.y=-5})),gt(e.rollNumber,e.rollDice).then((()=>{e.throwing=0})))}else 2===n&&1===e.throwing&&e.nudges>0&&(_t.forEach((e=>{if(e.position.y<0||e.position.y>4)return;e.physicsImpostor.wakeUp();const i=new t(U(),2+5*Math.random(),U());e.physicsImpostor.applyImpulse(i,e.position)})),--e.nudges)}))};export{mt as startRound};
